{"title": "MySQL 索引设计概要", "url": "http://blog.jobbole.com/112487/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/e78e36715813f49e9e62fe0c6050075c.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,MySQL,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://draveness.me/sql-index-intro.html\">Draveness</a>   </div><p>在关系型数据库中设计索引其实并不是复杂的事情，很多开发者都觉得设计索引能够提升数据库的性能，相关的知识一定非常复杂。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/e53f2b2cf119db0c59de9f83caa31f5e.jpg\" alt=\"Index-and-Performance\"></p>\n<p>然而这种想法是不正确的，索引其实并不是一个多么高深莫测的东西，只要我们掌握一定的方法，理解索引的实现就能在不需要 DBA 的情况下设计出高效的索引。</p>\n<p>本文会介绍 <a href=\"https://www.amazon.cn/%E5%9B%BE%E4%B9%A6/dp/B00ZH27RH0\">数据库索引设计与优化</a> 中设计索引的一些方法，让各位读者能够快速的在现有的工程中设计出合适的索引。</p>\n<h3 id=\"io\">磁盘 IO</h3>\n<p>一个数据库必须保证其中存储的所有数据都是可以随时读写的，同时因为 MySQL 中所有的数据其实都是以文件的形式存储在磁盘上的，而从磁盘上<strong>随机访问</strong>对应的数据非常耗时，所以数据库程序和操作系统提供了缓冲池和内存以提高数据的访问速度。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/3eef1adc99076fce083d3b1beea313fd.jpg\" alt=\"Disk-IO\"></p>\n<p>除此之外，我们还需要知道数据库对数据的读取并不是以行为单位进行的，无论是读取一行还是多行，都会将该行或者多行所在的页全部加载进来，然后再读取对应的数据记录；也就是说，读取所耗费的时间与行数无关，只与页数有关。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/61d440834e7684466865619054c05717.jpg\" alt=\"Page-DatabaseBufferPool\"></p>\n<p>在 MySQL 中，页的大小一般为 16KB，不过也可能是 8KB、32KB 或者其他值，这跟 MySQL 的存储引擎对数据的存储方式有很大的关系，文中不会展开介绍，不过<strong>索引或行记录是否在缓存池中极大的影响了访问索引或者数据的成本</strong>。</p>\n<h4 id=\"section\">随机读取</h4>\n<p>数据库等待一个页从磁盘读取到缓存池的所需要的成本巨大的，无论我们是想要读取一个页面上的多条数据还是一条数据，都需要消耗<strong>约</strong> 10ms 左右的时间：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/0f07e5811a5dc125cc01482284cd2f3f.jpg\" alt=\"Disk-Random-IO\"></p>\n<p>10ms 的时间在计算领域其实是一个非常巨大的成本，假设我们使用脚本向装了 SSD 的磁盘上顺序写入字节，那么在 10ms 内可以写入大概 3MB 左右的内容，但是数据库程序在 10ms 之内只能将一页的数据加载到数据库缓冲池中，从这里可以看出随机读取的代价是巨大的。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/bdeb5251f80438e8d19027231912074a.jpg\" alt=\"Disk-IO-Total-Time\"></p>\n<p>这 10ms 的一次随机读取是按照每秒 50 次的读取计算得到的，其中等待时间为 3ms、磁盘的实际繁忙时间约为 6ms，最终数据页从磁盘传输到缓冲池的时间为 1ms 左右，在对查询进行估算时并不需要准确的知道随机读取的时间，只需要知道估算出的 10ms 就可以了。</p>\n<h4 id=\"section-1\">内存读取</h4>\n<p>如果在数据库的<strong>缓存池</strong>中没有找到对应的数据页，那么会去内存中寻找对应的页面：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/249d4599ab96b6adc85b9c01c3682e7e.jpg\" alt=\"Read-from-Memory\"></p>\n<p>当对应的页面存在于内存时，数据库程序就会使用内存中的页，这能够将数据的读取时间降低一个数量级，将 10ms 降低到 1ms；MySQL 在执行读操作时，会先从数据库的缓冲区中读取，如果不存在与缓冲区中就会尝试从内存中加载页面，如果前面的两个步骤都失败了，最后就只能执行随机 IO 从磁盘中获取对应的数据页。</p>\n<h4 id=\"section-2\">顺序读取</h4>\n<p>从磁盘读取数据并不是都要付出很大的代价，当数据库管理程序一次性从磁盘中<strong>顺序</strong>读取大量的数据时，读取的速度会异常的快，大概在 40MB/s 左右。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/2312998ad76d8fb341969812487f1de4.jpg\" alt=\"Sequential-Reads-from-Disk\"></p>\n<p>如果一个页面的大小为 4KB，那么 1s 的时间就可以读取 10000 个页，读取一个页面所花费的平均时间就是 0.1ms，相比随机读取的 10ms 已经降低了两个数量级，甚至比内存中读取数据还要快。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/9ebb7991b42865054e063cefb1a4347b.jpg\" alt=\"Random-to-Sequentia\"></p>\n<p>数据页面的顺序读取有两个非常重要的优势：</p>\n<ol>\n<li>同时读取多个界面意味着总时间的消耗会大幅度减少，磁盘的吞吐量可以达到 40MB/s；</li>\n<li>数据库管理程序会对一些即将使用的界面进行预读，以减少查询请求的等待和响应时间；</li>\n</ol>\n<h4 id=\"section-3\">小结</h4>\n<p>数据库查询操作的时间大都消耗在从磁盘或者内存中读取数据的过程，由于随机 IO 的代价巨大，如何在一次数据库查询中减少随机 IO 的次数往往能够大幅度的降低查询所耗费的时间提高磁盘的吞吐量。</p>\n<h3 id=\"section-4\">查询过程</h3>\n<p>在上一节中，文章从数据页加载的角度介绍了磁盘 IO 对 MySQL 查询的影响，而在这一节中将介绍 MySQL 查询的执行过程中以及数据库中的数据的特征对最终查询性能的影响。</p>\n<h4 id=\"index-slices\">索引片（Index Slices）</h4>\n<p>索引片其实就是 SQL 查询在执行过程中扫描的一个索引片段，在这个范围中的索引将被顺序扫描，根据索引片包含的列数不同，<a href=\"https://www.amazon.cn/%E5%9B%BE%E4%B9%A6/dp/B00ZH27RH0\">数据库索引设计与优化</a> 书中对将索引分为宽索引和窄索引：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/305453471fa87c6a090eb4f92003e759.jpg\" alt=\"Thin-Index-and-Fat-Index\"></p>\n<blockquote><p>主键列 <code>id</code> 在所有的 MySQL 索引中都是一定会存在的。</p></blockquote>\n<p>对于查询 <code>SELECT id, username, age FROM users WHERE username=\"draven\"</code> 来说，(id, username) 就是一个窄索引，因为该索引没有包含存在于 SQL 查询中的 age 列，而 (id, username, age) 就是该查询的一个宽索引了，它<strong>包含这个查询中所需要的全部数据列</strong>。</p>\n<p>宽索引能够避免二次的随机 IO，而窄索引就需要在对索引进行顺序读取之后再根据主键 id 从主键索引中查找对应的数据：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/d30e5ece6b40f3019e207a701d2c50ad.jpg\" alt=\"Thin-Index-and-Clustered-Index\"></p>\n<p>对于窄索引，每一个在索引中匹配到的记录行最终都需要执行另外的随机读取从聚集索引中获得剩余的数据，如果结果集非常大，那么就会导致随机读取的次数过多进而影响性能。</p>\n<h4 id=\"section-5\">过滤因子</h4>\n<p>从上一小节对索引片的介绍，我们可以看到影响 SQL 查询的除了查询本身还与数据库表中的数据特征有关，如果使用的是窄索引那么对表的随机访问就不可避免，在这时如何让索引片变『薄』就是我们需要做的了。</p>\n<p>一个 SQL 查询扫描的索引片大小其实是由过滤因子决定的，也就是满足查询条件的记录行数所占的比例：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/f4149e33e1dccc5702864a629b300bf5.jpg\" alt=\"Filter-Facto\"></p>\n<p>对于 users 表来说，sex=”male” 就不是一个好的过滤因子，它会选择整张表中一半的数据，所以<strong>在一般情况下</strong>我们最好不要使用 sex 列作为整个索引的第一列；而 name=”draven” 的使用就可以得到一个比较好的过滤因子了，它的使用能过滤整个数据表中 99.9% 的数据；当然我们也可以将这三个过滤进行组合，创建一个新的索引 (name, age, sex) 并同时使用这三列作为过滤条件：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/f0e821466f63037631b10ca9bce799cb.jpg\" alt=\"Combined-Filter-Facto\"></p>\n<blockquote><p>当三个过滤条件都是等值谓词时，几个索引列的顺序其实是无所谓的，索引列的顺序不会影响同一个 SQL 语句对索引的选择，也就是索引 (name, age, sex) 和 (age, sex, name) 对于上图中的条件来说是完全一样的，这两个索引在执行查询时都有着完全相同的效果。</p></blockquote>\n<p>组合条件的过滤因子就可以达到十万分之 6 了，如果整张表中有 10w 行数据，也只需要在扫描薄索引片后进行 6 次随机读取，这种直接使用乘积来计算组合条件的过滤因子其实有一个比较重要的问题：列与列之间不应该有太强的相关性，如果不同的列之间有相关性，那么得到的结果就会比直接乘积得出的结果大一些，比如：所在的城市和邮政编码就有非常强的相关性，两者的过滤因子直接相乘其实与实际的过滤因子会有很大的偏差，不过这在多数情况下都不是太大的问题。</p>\n<p>对于一张表中的同一个列，不同的值也会有不同的过滤因子，这也就造成了同一列的不同值最终的查询性能也会有很大差别：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/3a84a867b9d385867fa3e462cda4f376.jpg\" alt=\"Same-Columns-Filter-Facto\"></p>\n<p>当我们评估一个索引是否合适时，需要考虑极端情况下查询语句的性能，比如 0% 或者 50% 等；最差的输入往往意味着最差的性能，在平均情况下表现良好的 SQL 语句在极端的输入下可能就完全无法正常工作，这也是在设计索引时需要注意的问题。</p>\n<p>总而言之，需要扫描的索引片的大小对查询性能的影响至关重要，而扫描的索引记录的数量，就是总行数与组合条件的过滤因子的乘积，索引片的大小最终也决定了从表中读取数据所需要的时间。</p>\n<h4 id=\"section-6\">匹配列与过滤列</h4>\n<p>假设在 users 表中有 name、age 和 (name, sex, age) 三个辅助索引；当 WHERE 条件中存在类似 age = 21 或者 name = “draven” 这种<strong>等值谓词</strong>时，它们都会成为匹配列（Matching Column）用于选择索引树中的数据行，但是当我们使用以下查询时：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba667e564ac784331206\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT * FROM users\r\nWHERE name = \"draven\" AND sex = \"male\" AND age &gt; 20;\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba667e564ac784331206-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba667e564ac784331206-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba667e564ac784331206-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba667e564ac784331206-1\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">users</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba667e564ac784331206-2\"><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"draven\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"male\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">age</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba667e564ac784331206-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>虽然我们有 (name, sex, age) 索引包含了上述查询条件中的全部列，但是在这里只有 name 和 sex 两列才是匹配列，MySQL 在执行上述查询时，会选择 name 和 sex 作为匹配列，扫描所有满足条件的数据行，然后将 age 当做过滤列（Filtering Column）：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/98f9cda753228126ca4d454edfe18386.jpg\" alt=\"Match-Columns-Filter-Columns\"></p>\n<p>过滤列虽然不能够减少索引片的大小，但是能够减少从表中随机读取数据的次数，所以在索引中也扮演着非常重要的角色。</p>\n<h3 id=\"section-7\">索引的设计</h3>\n<p>作者相信文章前面的内容已经为索引的设计提供了充足的理论基础和知识，从总体来看如何减少随机读取的次数是设计索引时需要重视的最重要的问题，在这一节中，我们将介绍 <a href=\"https://www.amazon.cn/%E5%9B%BE%E4%B9%A6/dp/B00ZH27RH0\">数据库索引设计与优化</a> 一书中归纳出的设计最佳索引的方法。</p>\n<h4 id=\"section-8\">三星索引</h4>\n<p>三星索引是对于一个查询语句可能的最好索引，如果一个查询语句的索引是三星索引，那么它只需要进行<strong>一次磁盘的随机读及一个窄索引片的顺序扫描</strong>就可以得到全部的结果集；因此其查询的响应时间比普通的索引会少几个数量级；根据书中对三星索引的定义，我们可以理解为主键索引对于 <code>WHERE id = 1</code> 就是一个特殊的三星索引，我们只需要对主键索引树进行一次索引访问并且顺序读取一条数据记录查询就结束了。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/51b6a983ef0d571b7821f1c88738cf2f.jpg\" alt=\"Three-Star-Index\"></p>\n<p>为了满足三星索引中的三颗星，我们分别需要做以下几件事情：</p>\n<ol>\n<li>第一颗星需要取出所有等值谓词中的列，作为索引开头的最开始的列（任意顺序）；</li>\n<li>第二颗星需要将 ORDER BY 列加入索引中；</li>\n<li>第三颗星需要将查询语句剩余的列全部加入到索引中；</li>\n</ol>\n<blockquote><p>三星索引的概念和星级的给定来源于 <a href=\"https://www.amazon.cn/%E5%9B%BE%E4%B9%A6/dp/B00ZH27RH0\">数据库索引设计与优化</a> 书中第四章三星索引一节。</p></blockquote>\n<p>如果对于一个查询语句我们依照上述的三个条件进行设计，那么就可以得到该查询的三星索引，这三颗星中的最后一颗星往往都是最容易获得的，满足第三颗星的索引也就是上面提到的宽索引，能够避免大量的随机 IO，如果我们遵循这个顺序为一个 SQL 查询设计索引那么我们就可以得到一个完美的索引了；这三颗星的获得其实也没有表面上这么简单，每一颗星都有自己的意义：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/8acc115991e8b8f008f9b0a768092dbd.jpg\" alt=\"Behind-Three-Star-Index\"></p>\n<ol>\n<li>第一颗星不只是将等值谓词的列加入索引，它的作用是减少索引片的大小以减少需要扫描的数据行；</li>\n<li>第二颗星用于避免排序，减少磁盘 IO 和内存的使用；</li>\n<li>第三颗星用于避免每一个索引对应的数据行都需要进行一次随机 IO 从聚集索引中读取剩余的数据；</li>\n</ol>\n<p>在实际场景中，问题往往没有这么简单，我们虽然可以总能够通过宽索引避免大量的随机访问，但是在一些复杂的查询中我们无法同时获得第一颗星和第二颗星。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba667e564b9315066277\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT id, name, age FROM users\r\nWHERE age BETWEEN 18 AND 21\r\n  AND city = \"Beijing\"\r\nORDER BY name;\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba667e564b9315066277-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba667e564b9315066277-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba667e564b9315066277-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba667e564b9315066277-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba667e564b9315066277-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba667e564b9315066277-1\"><span class=\"crayon-e\">SELECT </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">age </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">users</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba667e564b9315066277-2\"><span class=\"crayon-e\">WHERE </span><span class=\"crayon-e\">age </span><span class=\"crayon-i\">BETWEEN</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span></div><div class=\"crayon-line\" id=\"crayon-59ba667e564b9315066277-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">city</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Beijing\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba667e564b9315066277-4\"><span class=\"crayon-e\">ORDER </span><span class=\"crayon-e\">BY </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba667e564b9315066277-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>在上述查询中，我们总可以通过增加索引中的列以获得第三颗星，但是如果我们想要获得第一颗星就需要最小化索引片的大小，这时索引的前缀必须为 (city, age)，在这时再想获得第三颗星就不可能了，哪怕在 age 的后面添加索引列 name，也会因为 name 在范围索引列 age 后面必须进行一次排序操作，最终得到的索引就是 (city, age, name, id)：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/0623c023856da52e860cca75c59198a4.jpg\" alt=\"Different-Stars-Index\"></p>\n<p>如果我们需要在内存中避免排序的话，就需要交换 age 和 name 的位置了，在这时就可以得到索引 (city, name, age, id)，当一个 SQL 查询中<strong>同时拥有范围谓词和 ORDER BY 时</strong>，无论如何我们都是没有办法获得一个三星索引的，我们能够做的就是在这两者之间做出选择，是牺牲第一颗星还是第二颗星。</p>\n<p>总而言之，在设计单表的索引时，首先把查询中所有的<strong>等值谓词全部取出</strong>以任意顺序放在索引最前面，在这时，如果索引中同时存在范围索引和 ORDER BY 就需要权衡利弊了，希望最小化扫描的索引片厚度时，应该将<strong>过滤因子最小的范围索引列</strong>加入索引，如果希望避免排序就选择 <strong>ORDER BY 中的全部列</strong>，在这之后就只需要将查询中<strong>剩余的全部列</strong>加入索引了，通过这种固定的方法和逻辑就可以最快地获得一个查询语句的二星或者三星索引了。</p>\n<h3 id=\"section-9\">总结</h3>\n<p>在单表上对索引进行设计其实还是非常容易的，只需要遵循固定的套路就能设计出一个理想的三星索引，在这里强烈推荐 <a href=\"https://www.amazon.cn/%E5%9B%BE%E4%B9%A6/dp/B00ZH27RH0\">数据库索引设计与优化</a> 这本书籍，其中包含了大量与索引设计与优化的相关内容；在之后的文章中读者也会分析介绍书中提供的几种估算方法，来帮助我们通过预估问题设计出更高效的索引。</p>\n<p>如果对文章内容的有疑问，可以在博客下面评论留言（评论系统使用 Disqus，需要翻墙）。</p>\n<blockquote><p>Follow: <a href=\"https://github.com/Draveness\">Draveness · GitHub</a></p></blockquote>\n<h2 id=\"reference\">Reference</h2>\n<ul>\n<li><a href=\"https://www.amazon.cn/%E5%9B%BE%E4%B9%A6/dp/B00ZH27RH0\">数据库索引设计与优化</a></li>\n<li><a href=\"https://dev.mysql.com/doc/refman/5.7/en/innodb-file-space.html\">File Space Management</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=9eMWG3fwiEU\">Inside of Hard Drive – YouTube</a></li>\n<li><a href=\"https://www.youtube.com/watch?v=4iaxOUYalJU\">Hard Disk Working – How does a hard disk work – Hard Drive – YouTube</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112487\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112487votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112487\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "完美主义对新手程序员的影响", "url": "http://blog.jobbole.com/112372/", "front_image_url": ["http://wx1.sinaimg.cn/large/7cc829d3gy1fj9xymo8v2j20h70b3dj7.jpg"], "praise_nums": "3", "comment_nums": 3, "fav_nums": 3, "tags": "职场,程序员,职场", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://medium.freecodecamp.org/why-striving-for-perfection-might-be-holding-you-back-as-a-newbie-web-developer-6e8ae257751f\">Rick West</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>我是一个完美主义者，或者，至少我喜欢这样自居。不管怎样，我绝对离完美主义者不远了。</p>\n<p>这样本来挺好的。然而，我最近意识到，它实际上阻碍我成为一个更出色的开发者。至少，它阻碍了我的进步，并妨碍了我的学习。</p>\n<p>像很多初级开发者和普通开发者，我有一个不完成副项目（side projects）的习惯。不是因为我懒或没时间，出于某种原因，我似乎从来不会把事情做完。</p>\n<p>然后就是受打击的地方了。</p>\n<p>在进行项目时，我一直努力追求完美，</p>\n<p>这就是问题的所在。</p>\n<p><em>怎么定义完美？完美是什么意思？完美真的是一个可以实现的目标吗？</em></p>\n<p>对我来说，我想交出一些了不起的东西，尽自己所能做出一些东西。</p>\n<p>想法是好的，但作为一个初级开发者，我面对的困境是，因为我每天都在学习，我的能力在不断增强。</p>\n<p>这样的话，我如何才能尽自己最大（且不断提高的）能力，将一个项目做到最好？！</p>\n<p>作为开发者，这是阻碍我进步的关键因素。我不知道要在哪里确定一条底线。我觉得很难对自己说“够了，可以继续前进了”。</p>\n<p><strong>而有时候，情况甚至会变得有些愚蠢…</strong></p>\n<p>6 个月前，我写了一个简单的 URL 缩短器，以熟悉 Symfony 框架。我花了几个晚上的时间，做出了一个基本的工作产品（Working Product），以及一个大的框架介绍。做得很开心？好吧，不尽然。</p>\n<p>信不信由你，3 个月后，我仍在对这个小项目修修补补：修改样式，用 Ajax 改进表单提交，我甚至考虑过用 Vue 或 React 来实现。</p>\n<p>随着我的能力和知识的不断增加，<strong>我完全无法继续前进</strong>。我不断看到能够改进的地方，并有了更好的改进方法。</p>\n<p>这在商业环境中是好事。在产品或项目上不断进行改进和迭代非常赞。</p>\n<p>但是，作为一个小小的学习项目，我明显用力过猛了，正在努力解决一个并不存在的问题。这不是尝试给 Bitly（知名短网址服务）造一个竞争对手，我只是利用这个小项目来加强自身的学习。事实上，根本没有人会看到这个项目！</p>\n<p>我并不是唯一会这么做的人，即使最有经验的开发者，也会在某个时候遇到类似的情况。当他们回顾几年前写的代码，他们可能会羞愧难当，甚至可能会对自己几个月前写的代码感到震惊。</p>\n<p><em><img id=\"pic\" class=\"M_cur_zoom_out aligncenter\" src=\"http://wx1.sinaimg.cn/large/7cc829d3gy1fj5iolq237j20je0j6nav.jpg\" width=\"572\" height=\"565\"></em></p>\n<p style=\"text-align: center;\"><em>（伯乐在线补充配图，Via：程序员的那些事）</em></p>\n<p>作为开发者，无论处于什么水平，你都在不断学习，这是野兽的天性。而经验告诉我们，你只有学会放手，才能继续前进。</p>\n<p>但说起来容易做起来难。作为一个初级的，或有抱负的开发者，“单单”继续前进就显得难得多了。在现实中，除非你的代码接受他人的审查，否则你完全不知道好与坏的标准。</p>\n<p>我的建议是，在你学习时，要创建一些东西，直到它看起来很得体，并能正常工作，此时你需要忘掉它继续前进。不要寻求完美，这是不存在的~ 你应该将时间花在学习并钻研更大、更好的事情上，而不是花在类似调整无关要紧的内边距这一类事情上。请务必相信我这个过来人的经验之谈！</p>\n<p><img id=\"pic\" class=\"aligncenter\" src=\"http://wx1.sinaimg.cn/large/7cc829d3gy1fj9xymo8v2j20h70b3dj7.jpg\"></p>\n<p>我最终明白了“<strong>完成比完美更好</strong>”这句话，这也是二八定律告诉我们的道理。（原因与结果、投入与产出、努力与报酬之间的关系往往是不平衡的，结果、产出或报酬的 80％ 取决于 20％ 的原因、投入或努力。）</p>\n<p>当你处于学习阶段时，所有的项目都不需要做到“完美”。它们本身就是用于学习的项目，做完尽管放手让它们去。</p>\n<p>瞎搞瞎弄、缝缝补补、或者试图压缩最后 10％ 的时间，这些都不是对有限时间的合理使用方式。</p>\n<p>在 Web 开发中，完美是不存在的。</p>\n<p>只有一种情况除外，那就是…完成，因为“完成即完美（done === perfect）”。</p>\n<p>随着时间的推移，你能做出更大、更好的东西！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112372\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112372votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112372\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/9667abaa540914200edd449974fb5538.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            我见青山多妩媚，料青山见我应如是        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zhj318\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/zhj318/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 36</a> · <a title=\"QQ：574375911\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "漫谈传统的 Linux 初始化系统的运行级别", "url": "http://blog.jobbole.com/112479/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.networkworld.com/article/3222070/linux/maneuvering-around-run-levels-on-linux.html\">Sandra Henry-stocker</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8857-1.html\">Linux中国/penghuster</a>   </div><blockquote><p>了解运行级别是如何配置的，如何改变系统运行级别以及修改对应状态下运行的服务。</p></blockquote>\n<p>在 Linux 系统中，运行级别run level是指运维的级别，用于描述一种表明什么服务是可用的系统运行状态。</p>\n<p>运行级别 1 是严格限制的，仅仅用于系统维护；该级别下，网络连接将不可操作，但是管理员可以通过控制台连接登录系统。</p>\n<p>其他运行级别的系统允许任何人登录和使用，但是不同级别中可使用的服务不同。本文将探索如何配置运行级别，如何交互式改变系统运行级别以及修改该状态下可用的服务。</p>\n<p>Linux 系统的默认运行状态是一个在系统开机时使用的运行级别（除非有其他的指示），它通常是在 <code>/etc/inittab</code> 文件中进行配置的，该文件内容通常如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba662d0bd04475114308\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nid:3:initdefault\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd04475114308-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd04475114308-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba662d0bd04475114308-1\"><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">initdefault</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd04475114308-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>包括 Debian 系统在内的一些系统，默认运行级别为 2，而不是上述文件中的 3，甚至都没有 <code>/etc/inittab</code> 文件。</p>\n<p>运行级别在默认情况下是如何被配置，其配置依赖于你所运行的 Linux 操作系统的具体发行版本。 例如，在某些系统中， 运行级别 2 是多用户模式，运行级别 3 是多用户模式并支持 NFS （网络文件系统）。 在另外一些系统，运行级别 2 – 5 基本相同，运行级别 1 是单用户模式。例如，Debian 系统的所用运行级别如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba662d0bd0e220184260\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n0 = 停机\r\n1 = 单用户（维护模式）\r\n2 = 多用户模式\r\n3-5 = 同 2 一样\r\n6 = 重启\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd0e220184260-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd0e220184260-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd0e220184260-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd0e220184260-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd0e220184260-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd0e220184260-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba662d0bd0e220184260-1\"><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span>停机</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd0e220184260-2\"><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span>单用户（维护模式）</div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd0e220184260-3\"><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span>多用户模式</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd0e220184260-4\"><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span>同<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span>一样</div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd0e220184260-5\"><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span>重启</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd0e220184260-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>在 Linux 系统上，运行级别 3 用于共享文件系统给其它系统，可以方便地只通过改变系统的运行级别来启动和停止文件系统共享。系统从运行级别 2 改变到 3 系统将允许文件系统共享，反之从运行级别 3 改变到 2 则系统不支持文件系统共享。</p>\n<p>在某个运行级别中，系统运行哪些进程依赖于目录 <code>/etc/rc?.d</code> 目录的内容，其中 <code>?</code> 可以是 2、 3、 4 或 5 （对应于相应的运行级别）。</p>\n<p>在以下示例中（Ubuntu 系统），由于这些目录的配置是相同的，我们将看见上述 4 个级别对应的目录中的内容是一致的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba662d0bd12652745880\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/etc/rc2.d$ ls\r\nREADME         S20smartmontools      S50saned      S99grub-common\r\nS20kerneloops  S20speech-dispatcher  S70dns-clean  S99ondemand\r\nS20rsync       S20sysstat            S70pppd-dns   S99rc.local\r\n/etc/rc2.d$ cd ../rc3.d\r\n/etc/rc3.d$ ls\r\nREADME         S20smartmontools      S50saned      S99grub-common\r\nS20kerneloops  S20speech-dispatcher  S70dns-clean  S99ondemand\r\nS20rsync       S20sysstat            S70pppd-dns   S99rc.local\r\n/etc/rc3.d$ cd ../rc4.d\r\n/etc/rc4.d$ ls\r\nREADME         S20smartmontools      S50saned      S99grub-common\r\nS20kerneloops  S20speech-dispatcher  S70dns-clean  S99ondemand\r\nS20rsync       S20sysstat            S70pppd-dns   S99rc.local\r\n/etc/rc4.d$ cd ../rc5.d\r\n/etc/rc5.d$ ls\r\nREADME         S20smartmontools      S50saned      S99grub-common\r\nS20kerneloops  S20speech-dispatcher  S70dns-clean  S99ondemand\r\nS20rsync       S20sysstat            S70pppd-dns   S99rc.local\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd12652745880-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd12652745880-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd12652745880-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd12652745880-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd12652745880-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd12652745880-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd12652745880-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd12652745880-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd12652745880-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd12652745880-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd12652745880-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd12652745880-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd12652745880-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd12652745880-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd12652745880-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd12652745880-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd12652745880-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd12652745880-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd12652745880-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd12652745880-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba662d0bd12652745880-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd12652745880-2\"><span class=\"crayon-e\">README         </span><span class=\"crayon-e\">S20smartmontools      </span><span class=\"crayon-e\">S50saned      </span><span class=\"crayon-v\">S99grub</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">common</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd12652745880-3\"><span class=\"crayon-e\">S20kerneloops  </span><span class=\"crayon-v\">S20speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dispatcher  </span><span class=\"crayon-v\">S70dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">clean  </span><span class=\"crayon-e\">S99ondemand</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd12652745880-4\"><span class=\"crayon-e\">S20rsync       </span><span class=\"crayon-e\">S20sysstat            </span><span class=\"crayon-v\">S70pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dns   </span><span class=\"crayon-v\">S99rc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">local</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd12652745880-5\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd12652745880-6\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd12652745880-7\"><span class=\"crayon-e\">README         </span><span class=\"crayon-e\">S20smartmontools      </span><span class=\"crayon-e\">S50saned      </span><span class=\"crayon-v\">S99grub</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">common</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd12652745880-8\"><span class=\"crayon-e\">S20kerneloops  </span><span class=\"crayon-v\">S20speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dispatcher  </span><span class=\"crayon-v\">S70dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">clean  </span><span class=\"crayon-e\">S99ondemand</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd12652745880-9\"><span class=\"crayon-e\">S20rsync       </span><span class=\"crayon-e\">S20sysstat            </span><span class=\"crayon-v\">S70pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dns   </span><span class=\"crayon-v\">S99rc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">local</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd12652745880-10\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc4</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd12652745880-11\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc4</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd12652745880-12\"><span class=\"crayon-e\">README         </span><span class=\"crayon-e\">S20smartmontools      </span><span class=\"crayon-e\">S50saned      </span><span class=\"crayon-v\">S99grub</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">common</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd12652745880-13\"><span class=\"crayon-e\">S20kerneloops  </span><span class=\"crayon-v\">S20speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dispatcher  </span><span class=\"crayon-v\">S70dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">clean  </span><span class=\"crayon-e\">S99ondemand</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd12652745880-14\"><span class=\"crayon-e\">S20rsync       </span><span class=\"crayon-e\">S20sysstat            </span><span class=\"crayon-v\">S70pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dns   </span><span class=\"crayon-v\">S99rc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">local</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd12652745880-15\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc4</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc5</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd12652745880-16\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc5</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd12652745880-17\"><span class=\"crayon-e\">README         </span><span class=\"crayon-e\">S20smartmontools      </span><span class=\"crayon-e\">S50saned      </span><span class=\"crayon-v\">S99grub</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">common</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd12652745880-18\"><span class=\"crayon-e\">S20kerneloops  </span><span class=\"crayon-v\">S20speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dispatcher  </span><span class=\"crayon-v\">S70dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">clean  </span><span class=\"crayon-e\">S99ondemand</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd12652745880-19\"><span class=\"crayon-e\">S20rsync       </span><span class=\"crayon-e\">S20sysstat            </span><span class=\"crayon-v\">S70pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dns   </span><span class=\"crayon-v\">S99rc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">local</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd12652745880-20\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0040 seconds] -->\r\n<p>这些都是什么文件？它们都是指向 <code>/etc/init.d</code> 目录下用于启动服务的脚本符号连接。 这些文件的文件名是至关重要的， 因为它们决定了这些脚本文件的执行顺序，例如, S20 脚本是在 S50 脚本前面运行的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba662d0bd16486424310\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ls -l\r\ntotal 4\r\n-rw-r--r-- 1 root root 677 Feb 16  2016 README\r\nlrwxrwxrwx 1 root root  20 Aug 30 14:40 S20kerneloops -&gt; ../init.d/kerneloops\r\nlrwxrwxrwx 1 root root  15 Aug 30 14:40 S20rsync -&gt; ../init.d/rsync\r\nlrwxrwxrwx 1 root root  23 Aug 30 16:10 S20smartmontools -&gt; ../init.d/smartmontools\r\nlrwxrwxrwx 1 root root  27 Aug 30 14:40 S20speech-dispatcher -&gt; ../init.d/speech-dispatcher\r\nlrwxrwxrwx 1 root root  17 Aug 31 14:12 S20sysstat -&gt; ../init.d/sysstat\r\nlrwxrwxrwx 1 root root  15 Aug 30 14:40 S50saned -&gt; ../init.d/saned\r\nlrwxrwxrwx 1 root root  19 Aug 30 14:40 S70dns-clean -&gt; ../init.d/dns-clean\r\nlrwxrwxrwx 1 root root  18 Aug 30 14:40 S70pppd-dns -&gt; ../init.d/pppd-dns\r\nlrwxrwxrwx 1 root root  21 Aug 30 14:40 S99grub-common -&gt; ../init.d/grub-common\r\nlrwxrwxrwx 1 root root  18 Aug 30 14:40 S99ondemand -&gt; ../init.d/ondemand\r\nlrwxrwxrwx 1 root root  18 Aug 30 14:40 S99rc.local -&gt; ../init.d/rc.local\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd16486424310-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd16486424310-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd16486424310-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd16486424310-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd16486424310-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd16486424310-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd16486424310-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd16486424310-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd16486424310-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd16486424310-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd16486424310-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd16486424310-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd16486424310-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd16486424310-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd16486424310-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba662d0bd16486424310-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd16486424310-2\"><span class=\"crayon-i\">total</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd16486424310-3\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">677</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Feb</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">2016</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">README</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd16486424310-4\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S20kerneloops</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">kerneloops</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd16486424310-5\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S20rsync</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">rsync</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd16486424310-6\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S20smartmontools</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">smartmontools</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd16486424310-7\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">27</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S20speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dispatcher</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dispatcher</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd16486424310-8\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">31</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S20sysstat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">sysstat</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd16486424310-9\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S50saned</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">saned</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd16486424310-10\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S70dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">clean</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">clean</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd16486424310-11\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">18</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S70pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dns</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dns</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd16486424310-12\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S99grub</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">common</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">grub</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">common</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd16486424310-13\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">18</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S99ondemand</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">ondemand</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd16486424310-14\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">18</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S99rc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">local</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">local</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd16486424310-15\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0076 seconds] -->\r\n<p>如你所想，目录 <code>/etc/rc1.d</code> 因运行级别 1 的特殊而不同。它包含的符号链接指向非常不同的一套脚本。 同样也要注意到其中一些脚本以 <code>K</code> 开头命名，而另一些与其它运行级别脚本一样以 <code>S</code> 开头命名。这是因为当系统进入单用户模式时， 一些服务需要<strong>停止</strong>。 然而这些 K 开头的符号链接指向了其它级别 S 开头的符号链接的同一文件时， K（kill）表示这个脚本将以指示其停止的参数执行，而不是以启动的参数执行。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba662d0bd1a075551213\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/etc/rc1.d$ ls -l\r\ntotal 4\r\nlrwxrwxrwx 1 root root  20 Aug 30 14:40 K20kerneloops -&gt; ../init.d/kerneloops\r\nlrwxrwxrwx 1 root root  15 Aug 30 14:40 K20rsync -&gt; ../init.d/rsync\r\nlrwxrwxrwx 1 root root  15 Aug 30 14:40 K20saned -&gt; ../init.d/saned\r\nlrwxrwxrwx 1 root root  23 Aug 30 16:10 K20smartmontools -&gt; ../init.d/smartmontools\r\nlrwxrwxrwx 1 root root  27 Aug 30 14:40 K20speech-dispatcher -&gt; ../init.d/speech-dispatcher\r\n-rw-r--r-- 1 root root 369 Mar 12  2014 README\r\nlrwxrwxrwx 1 root root  19 Aug 30 14:40 S30killprocs -&gt; ../init.d/killprocs\r\nlrwxrwxrwx 1 root root  19 Aug 30 14:40 S70dns-clean -&gt; ../init.d/dns-clean\r\nlrwxrwxrwx 1 root root  18 Aug 30 14:40 S70pppd-dns -&gt; ../init.d/pppd-dns\r\nlrwxrwxrwx 1 root root  16 Aug 30 14:40 S90single -&gt; ../init.d/single\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd1a075551213-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd1a075551213-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd1a075551213-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd1a075551213-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd1a075551213-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd1a075551213-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd1a075551213-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd1a075551213-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd1a075551213-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd1a075551213-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd1a075551213-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd1a075551213-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd1a075551213-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba662d0bd1a075551213-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">rc1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd1a075551213-2\"><span class=\"crayon-i\">total</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd1a075551213-3\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">K20kerneloops</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">kerneloops</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd1a075551213-4\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">K20rsync</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">rsync</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd1a075551213-5\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">K20saned</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">saned</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd1a075551213-6\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">K20smartmontools</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">smartmontools</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd1a075551213-7\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">27</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">K20speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dispatcher</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">speech</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dispatcher</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd1a075551213-8\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">369</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Mar</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">2014</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">README</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd1a075551213-9\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S30killprocs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">killprocs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd1a075551213-10\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">19</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S70dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">clean</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dns</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">clean</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd1a075551213-11\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">18</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S70pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dns</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pppd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dns</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd1a075551213-12\"><span class=\"crayon-i\">lrwxrwxrwx</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">40</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">S90single</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">init</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">single</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd1a075551213-13\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0063 seconds] -->\r\n<p>你可以改变系统的默认运行级别，尽管这很少被用到。例如，通过修改前文中提到的 <code>/etc/inittab</code> 文件，你能够配置 Debian 系统的默认运行级别为 3 （而不是 2），以下是该文件示例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba662d0bd1e326029284\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nid:3:initdefault:\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd1e326029284-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd1e326029284-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba662d0bd1e326029284-1\"><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">initdefault</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd1e326029284-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>一旦你修改完成并重启系统， <code>runlevel</code> 命令将显示如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba662d0bd21562593026\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ runlevel\r\nN 3\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd21562593026-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd21562593026-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd21562593026-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba662d0bd21562593026-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">runlevel</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd21562593026-2\"><span class=\"crayon-i\">N</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd21562593026-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>另外一种可选方式，使用 <code>init 3</code> 命令，你也能改变系统运行级别（且无需重启立即生效）， <code>runlevel</code> 命令的输出为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba662d0bd24839402524\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ runlevel\r\n2 3\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd24839402524-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba662d0bd24839402524-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba662d0bd24839402524-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba662d0bd24839402524-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">runlevel</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba662d0bd24839402524-2\"><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line\" id=\"crayon-59ba662d0bd24839402524-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>当然，除非你修改了系统默认级别的 <code>/etc/rc?.d</code> 目录下的符号链接，使得系统默认运行在一个修改的运行级别之下，否则很少需要通过创建或修改 <code>/etc/inittab</code> 文件改变系统的运行级别。</p>\n<h3 id=\"toc_1\">在 Linux 系统中如何使用运行级别？</h3>\n<p>为了扼要重述在系统中如何使用运行级别，下面有几个关于运行级别的快速问答问题：</p>\n<p><strong>如何查询系统当前的运行级别？</strong></p>\n<p>使用 <code>runlevel</code> 命令。</p>\n<p><strong>如何查看特定运行级别所关联的服务进程？</strong></p>\n<p>查看与该运行级别关联的运行级别开始目录（例如， <code>/etc/rc2.d</code> 对应于运行级别 2）。</p>\n<p><strong>如何查看系统的默认运行级别？</strong></p>\n<p>首先，查看 <code>/etc/inittab</code> 文件是否存在。如果不存在，就执行 <code>runlevel</code> 命令查询，你一般就已经处在该运行级别。</p>\n<p><strong>如何改变系统运行级别？</strong></p>\n<p>用 <code>init</code> 命令（例如 <code>init 3</code>）临时改变运行级别，通过修改或创建 <code>/etc/inittab</code> 文件永久改变其运行级别。</p>\n<p><strong>能改变特定运行级别下运行的服务么？</strong></p>\n<p>当然，通过改变对应的 <code>/etc/rc?.d</code> 目录下的符号连接即可。</p>\n<p><strong>还有一些其他的什么需要考虑？</strong></p>\n<p>当改变系统运行级别时，你应该特别小心，确保不影响到系统上正在运行的服务或者正在使用的用户。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112479\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112479votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112479\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "数据异构的武器-BINLOG+MQ", "url": "http://blog.jobbole.com/112466/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/wangxindong/blog/1531596\">新栋BOOK</a>   </div><h3>1、定义</h3>\n<p>何谓数据异构，上周交易部门商品的同事过来做分享，又看到这个词，他的PPT里面是 数据库异构。其实我们以前做的事情，也是可以成为数据异构。比如我们将DB里面的数据持久化到REDIS里面去，就是一种数据异构的方式。如果要下个定义的话：<strong>把数据按需（数据结构、存取方式、存取形式）异地构建存储。</strong></p>\n<h3>2、常见应用场景</h3>\n<p>分库分表中有一个最为常见的场景，为了提升数据库的查询能力，我们都会对数据库做分库分表操作。比如订单库，开始的时候我们是按照订单ID维度去分库分表，那么后来的业务需求想按照商家维度去查询，比如我想查询某一个商家下的所有订单，就非常麻烦。这个时候通过数据异构就能很好的解决此问题，比如下图</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/fa46be3f45850ad48951742bb9ec51df.png\" alt=\"异构维度.png\"></p>\n<p style=\"text-align: center\">异构维度</p>\n<p style=\"text-align: left\"><strong>总结起来大概有以下几种场景</strong></p>\n<ol>\n<li>数据库镜像</li>\n<li>数据库实时备份</li>\n<li>多级索引</li>\n<li>search build（比如分库分表后的多维度数据查询）</li>\n<li>业务cache刷新</li>\n<li>价格、库存变化等重要业务消息</li>\n</ol>\n<h3>3、数据异构方向</h3>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/939f4abdb92c7c0ce9a8ba0918d85180.png\" alt=\"异构的几种方向.png\"></p>\n<p style=\"text-align: center\">几种异构方式</p>\n<p>在日常业务开发中大致可以分为以上几种数据去向，DB-DB这种方式，一般常见于分库分表后，聚合查询的时候，比如我们按照订单ID去分库分表，那么这个时候我们要按照用户ID去查询，查询这个用户下面的订单就非常不方便了，当然可以使用统一加到内存中去，但这样不太好。所以我们就可以用数据库异构的方式，重新按照用户ID的维度来分一个表，像在上面常见应用场景中介绍的那样。把数据异构到redis、elasticserach、slor中去要解决的问题跟按照多维度来查询的需求差不多。这些存储天生都有聚合的功能。当然同时也可以提高查询性能，应对大访问量，比如redis这种抗量银弹。</p>\n<h3>4、数据异构的常用方法</h3>\n<h4>3.1、完整克隆</h4>\n<p>这个很简单就是将数据库A，全部拷贝一份到数据库B，这样的使用场景是离线统计跑任务脚本的时候可以。缺点也很突出，不适用于持续增长的数据。</p>\n<h4>3.2、标记同步</h4>\n<p>这个是业务场景比较简单的时候，理想情况下数据不会发生改变，比如日志数据，这个时候可以去标记，比如时间戳，这样当发生故障的时候还可以回溯到上一次同步点，开始重新同步数据。</p>\n<h4>3.3、BINLOG方式</h4>\n<p>通过实时的订阅mysql的binlog日志，消费到这些日志后，重新构建数据结构插入一个新的数据库或者是其他存储比如es、slor等等。订阅binlog日志可以比较好的能保证数据的一致性。</p>\n<h4>3.4、MQ方式</h4>\n<p>业务数据写入DB的同时，也发送MQ一份，也就是业务里面实现双写。这种方式比较简单，但也很难保证数据一致性，对简单的业务场景可以采用这种方式。</p>\n<h3>5、binlog和mq方式重点介绍</h3>\n<h4>5.1、binlog</h4>\n<h5>5.1.1、订阅binglog日志异构流程图</h5>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/a8369973e6880af9e85c3c0477430595.png\" alt=\"canal异构方式.png\"></p>\n<p style=\"text-align: center\">canal异构方式</p>\n<h5>5.1.2、使用说明</h5>\n<p>binglog是数据的日志记录方式，每次对数据的操作都会有binlog日志。现在开源的订阅binlog日志的组件，比如使用比较广泛的canal，它是阿里开源的基于mysql数据库binlog的增量订阅和消费组件。由于cannal服务器目前读取的binlog事件只保存在内存中，并且只有一个canal客户端可以进行消费。所以如果需要多个消费客户端，可以引入activemq或者kafka。如上图绿色虚线框部分。我们还需要确保全量对比来保证数据的一致性（canal+mq的重试机制基本可以保证写入异构库之后的数据一致性），这个时候可以有一个全量同步WORKER程序来保证，如上图深绿色部分。</p>\n<h5>5.1.3、canal的工作原理</h5>\n<p>先来看下mysql主备（主从）复制原理如下图，在此原理基础之上我们再来理解canal的实现原理就一眼能明白了。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/daadf7db68a30d1e844ebee84d7f854c.jpg\" alt=\"mysql主备复制实现原理.jpg\"></p>\n<p style=\"text-align: center\">mysql主备复制实现原理</p>\n<p style=\"text-align: left\"><strong>mysql主备（主从）复制原理，从上层来看，复制分成三步：</strong></p>\n<ol>\n<li>master将改变记录到二进制日志(binary log)中（这些记录叫做二进制日志事件，binary log events，可以通过show binlog events进行查看）；</li>\n<li>slave将master的binary log events拷贝到它的中继日志(relay log)；</li>\n<li>slave重做中继日志中的事件，将改变反映它自己的数据。<br>\n再来看下canal的原理，如下图：<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/a82380169db0d36662aaefb8c910003a.jpg\" alt=\"canal工作原理.jpg\"><br>\n<strong>cannal实现原理相对比较简单（参照上面的mysql主备复制实现原理）：</strong></li>\n<li>canal模拟mysql slave的交互协议，伪装自己为mysql slave，向mysql master发送dump协议</li>\n<li>mysql master收到dump请求，开始推送binary log给slave(也就是canal)</li>\n<li>canal解析binary log对象(原始为byte流)<br>\n我们在部署canal server的时候要部署多台，来保证高可用。但是canal的原理，是只有一台服务器在跑处理，其它的服务器作为热备。canal server的高可用是通过zookeeper来维护的。<br>\n<strong>有关canal更具体的使用和详细原理请参照：<a href=\"https://github.com/alibaba/canal\" target=\"_blank\" rel=\"nofollow\">https://github.com/alibaba/canal</a></strong></li>\n</ol>\n<h5>5.1.4、注意点</h5>\n<ul>\n<li>1、确认MySQL开启binlog，使用<strong>show variables like ‘log_bin’;</strong> 查看ON为已开启</li>\n<li>2、确认目标库可以产生binlog，<strong>show master status</strong> 注意Binlog_Do_DB，Binlog_Ignore_DB参数</li>\n<li>3、确认binlog格式为ROW，使用<strong>show variables like ‘binlog_format’;</strong> 非ROW模式登录MySQL执行 <strong>set global binlog_format=ROW; flush logs;</strong> 或者通过更改MySQL配置文件并重启MySQL生效。</li>\n<li>4、为保证binlake服务可以获取Binlog，需添加授权，执行 <strong>GRANT SELECT, REPLICATION SLAVE, REPLICATION CLIENT ON <em>.</em> TO ‘admin’@’%’ identified by ‘admin’; FLUSH PRIVILEGES;</strong></li>\n</ul>\n<h4>5.2、mq方式</h4>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/fd773d9eb65abb904785d4dbd31196d3.png\" alt=\"MQ异构方式.png\"></p>\n<p style=\"text-align: center\">MQ异构方式</p>\n<p>mq的方式，就相对简单，实际上是在业务逻辑中写DB的同时去写一次MQ，但是这种方式不能够保证数据一致性，就是不能保证跨资源的事务。<strong>注：调用第三方远程RPC的操作一定不要放到事务中。</strong></p>\n<h3>6、总结</h3>\n<p>本文主要叙述了数据异构的使用场景，方法。这里面涉及到的activemq以及canal并没有深入分析，关于这块的内容可以直接参考相关具体文档，文中已给了链接地址。根据数据异构的定义，将数据异地构建存储，我们可以应用的地方就非常多，文中说的分库分表之后按照其它维度来查询的时候，我们想脱离DB直接用缓存比如redis来抗量的时候。数据异构这种方式都能够很好的帮助我们来解决诸如此类的问题。<br>\n<strong>转载请注明出处，并附上链接 https://my.oschina.net/wangxindong/blog/1531596</strong><br>\n参考资料：<a href=\"https://github.com/alibaba/canal\" target=\"_blank\" rel=\"nofollow\">https://github.com/alibaba/canal</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112466\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112466votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112466\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "MySQL 进行 Replace 操作时造成数据丢失——那些坑你踩了吗？", "url": "http://blog.jobbole.com/112368/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/e78e36715813f49e9e62fe0c6050075c.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,MySQL,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/feicuigu/blog/1512275\">o翡翠谷o</a>   </div><h2>一、问题说明</h2>\n<p>公司开发人员在更新数据时使用了 replace into 语句，由于使用不当导致了数据的大量丢失，到底是如何导致的数据丢失？现分析如下。</p>\n<h2>二、问题分析</h2>\n<h3>a. REPLACE 原理</h3>\n<p>REPLACE INTO 原理的官方解释为：</p>\n<blockquote><p>REPLACE works exactly like INSERT, except that if an old row in the table has the same value as a new row for a PRIMARY KEY or a UNIQUE index, the old row is deleted before the new row is inserted.</p></blockquote>\n<blockquote><p>如果新插入行的主键或唯一键在表中已经存在，则会删除原有记录并插入新行；如果在表中不存在，则直接插入</p></blockquote>\n<p>地址：https://dev.mysql.com/doc/refman/5.6/en/replace.html</p>\n<h3>b. 问题现象</h3>\n<p>丢失数据的表结构如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba451830f13280263670\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE `active_items` (\r\n  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',\r\n  `ad_id` char(32) NOT NULL DEFAULT '' COMMENT 'XXX',\r\n  `ap_id` tinyint(4) NOT NULL DEFAULT '1' COMMENT 'XXX',\r\n  `price` bigint(20) NOT NULL DEFAULT '0' COMMENT 'xxx',\r\n  `rate` int(11) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `cc_price` bigint(20) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `sale_count` int(11) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `prom_count` int(11) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `c1` int(11) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `status` tinyint(4) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `order_num` int(11) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `score` int(11) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `audit_time` int(11) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `prom_modify_time` int(11) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `sales_modify_time` int(11) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `create_time` int(11) NOT NULL DEFAULT '0' COMMENT '创建时间',\r\n  `modify_time` int(11) NOT NULL DEFAULT '0' COMMENT '最后修改时间',\r\n  `score_modify_time` int(11) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `brand_id` int(11) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `freight_status` tinyint(1) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  `flag` tinyint(4) NOT NULL DEFAULT '0' COMMENT 'XXX',\r\n  PRIMARY KEY (`id`),\r\n  UNIQUE KEY `idx_ad_id` (`ad_id`) USING BTREE,\r\n  ...\r\n) ENGINE=InnoDB AUTO_INCREMENT=2699 DEFAULT CHARSET=utf8 COMMENT='XXXXX'\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba451830f13280263670-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f13280263670-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f13280263670-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f13280263670-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f13280263670-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f13280263670-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f13280263670-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f13280263670-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f13280263670-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f13280263670-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f13280263670-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f13280263670-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f13280263670-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f13280263670-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f13280263670-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f13280263670-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f13280263670-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f13280263670-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f13280263670-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f13280263670-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f13280263670-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f13280263670-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f13280263670-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f13280263670-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f13280263670-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f13280263670-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f13280263670-27\">27</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba451830f13280263670-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-i\">TABLE</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">active_items</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f13280263670-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bigint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AUTO_INCREMENT </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'主键'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f13280263670-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">ad_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">32</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f13280263670-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">ap_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tinyint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f13280263670-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">price</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bigint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'xxx'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f13280263670-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">rate</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f13280263670-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">cc_price</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bigint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f13280263670-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">sale_count</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f13280263670-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">prom_count</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f13280263670-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">c1</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f13280263670-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tinyint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f13280263670-12\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">order_num</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f13280263670-13\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">score</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f13280263670-14\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">audit_time</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f13280263670-15\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">prom_modify_time</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f13280263670-16\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">sales_modify_time</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f13280263670-17\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">create_time</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'创建时间'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f13280263670-18\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">modify_time</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'最后修改时间'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f13280263670-19\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">score_modify_time</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f13280263670-20\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">brand_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f13280263670-21\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">freight_status</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tinyint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f13280263670-22\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">flag</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tinyint</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'XXX'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f13280263670-23\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f13280263670-24\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">UNIQUE </span><span class=\"crayon-i\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">idx_ad_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">ad_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">USING </span><span class=\"crayon-v\">BTREE</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f13280263670-25\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f13280263670-26\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENGINE</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InnoDB </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2699</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">utf8 </span><span class=\"crayon-v\">COMMENT</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'XXXXX'</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f13280263670-27\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0103 seconds] -->\r\n<p>执行的replace语句如下（多条）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba451830f20497678805\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nREPLACE INTO active_items(ad_id,score) VALUES('XXXXXXX', 1800);\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba451830f20497678805-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f20497678805-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba451830f20497678805-1\"><span class=\"crayon-e\">REPLACE </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">active_items</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ad_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">score</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'XXXXXXX'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1800</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f20497678805-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>通过查询binlog找到执行记录，部分如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba451830f24743321013\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n### UPDATE `items`.`active_items`\r\n### WHERE\r\n###   @1=21926 /* LONGINT meta=0 nullable=0 is_null=0 */\r\n###   @2='XXXXXXX' /* STRING(96) meta=65120 nullable=0 is_null=0 */\r\n###   @3=1 /* TINYINT meta=0 nullable=0 is_null=0 */\r\n###   @4=3900 /* LONGINT meta=0 nullable=0 is_null=0 */\r\n###   @5=315 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @6=1228 /* LONGINT meta=0 nullable=0 is_null=0 */\r\n###   @7=19 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @8=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @9=-6 (4294967290) /* INT meta=0 nullable=0 is_null=0 */\r\n###   @10=0 /* TINYINT meta=0 nullable=0 is_null=0 */\r\n###   @11=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @12=8 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @13=1489997272 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @14=1495765800 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @15=1495728000 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @16=1489996426 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @17=1489997272 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @18=1495728725 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @19=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @20=1 /* TINYINT meta=0 nullable=0 is_null=0 */\r\n###   @21=0 /* TINYINT meta=0 nullable=0 is_null=0 */\r\n### SET\r\n###   @1=35313 /* LONGINT meta=0 nullable=0 is_null=0 */\r\n###   @2='XXXXXXX' /* STRING(96) meta=65120 nullable=0 is_null=0 */\r\n###   @3=1 /* TINYINT meta=0 nullable=0 is_null=0 */\r\n###   @4=0 /* LONGINT meta=0 nullable=0 is_null=0 */\r\n###   @5=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @6=0 /* LONGINT meta=0 nullable=0 is_null=0 */\r\n###   @7=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @8=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @9=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @10=0 /* TINYINT meta=0 nullable=0 is_null=0 */\r\n###   @11=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @12=3150 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @13=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @14=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @15=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @16=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @17=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @18=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @19=0 /* INT meta=0 nullable=0 is_null=0 */\r\n###   @20=0 /* TINYINT meta=0 nullable=0 is_null=0 */\r\n###   @21=0 /* TINYINT meta=0 nullable=0 is_null=0 */\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f24743321013-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f24743321013-46\">46</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-1\"><span class=\"crayon-p\">### UPDATE `items`.`active_items`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-2\"><span class=\"crayon-p\">### WHERE</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-3\"><span class=\"crayon-p\">###   @1=21926 /* LONGINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-4\"><span class=\"crayon-p\">###   @2='XXXXXXX' /* STRING(96) meta=65120 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-5\"><span class=\"crayon-p\">###   @3=1 /* TINYINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-6\"><span class=\"crayon-p\">###   @4=3900 /* LONGINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-7\"><span class=\"crayon-p\">###   @5=315 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-8\"><span class=\"crayon-p\">###   @6=1228 /* LONGINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-9\"><span class=\"crayon-p\">###   @7=19 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-10\"><span class=\"crayon-p\">###   @8=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-11\"><span class=\"crayon-p\">###   @9=-6 (4294967290) /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-12\"><span class=\"crayon-p\">###   @10=0 /* TINYINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-13\"><span class=\"crayon-p\">###   @11=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-14\"><span class=\"crayon-p\">###   @12=8 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-15\"><span class=\"crayon-p\">###   @13=1489997272 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-16\"><span class=\"crayon-p\">###   @14=1495765800 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-17\"><span class=\"crayon-p\">###   @15=1495728000 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-18\"><span class=\"crayon-p\">###   @16=1489996426 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-19\"><span class=\"crayon-p\">###   @17=1489997272 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-20\"><span class=\"crayon-p\">###   @18=1495728725 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-21\"><span class=\"crayon-p\">###   @19=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-22\"><span class=\"crayon-p\">###   @20=1 /* TINYINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-23\"><span class=\"crayon-p\">###   @21=0 /* TINYINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-24\"><span class=\"crayon-p\">### SET</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-25\"><span class=\"crayon-p\">###   @1=35313 /* LONGINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-26\"><span class=\"crayon-p\">###   @2='XXXXXXX' /* STRING(96) meta=65120 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-27\"><span class=\"crayon-p\">###   @3=1 /* TINYINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-28\"><span class=\"crayon-p\">###   @4=0 /* LONGINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-29\"><span class=\"crayon-p\">###   @5=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-30\"><span class=\"crayon-p\">###   @6=0 /* LONGINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-31\"><span class=\"crayon-p\">###   @7=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-32\"><span class=\"crayon-p\">###   @8=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-33\"><span class=\"crayon-p\">###   @9=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-34\"><span class=\"crayon-p\">###   @10=0 /* TINYINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-35\"><span class=\"crayon-p\">###   @11=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-36\"><span class=\"crayon-p\">###   @12=3150 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-37\"><span class=\"crayon-p\">###   @13=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-38\"><span class=\"crayon-p\">###   @14=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-39\"><span class=\"crayon-p\">###   @15=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-40\"><span class=\"crayon-p\">###   @16=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-41\"><span class=\"crayon-p\">###   @17=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-42\"><span class=\"crayon-p\">###   @18=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-43\"><span class=\"crayon-p\">###   @19=0 /* INT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-44\"><span class=\"crayon-p\">###   @20=0 /* TINYINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f24743321013-45\"><span class=\"crayon-p\">###   @21=0 /* TINYINT meta=0 nullable=0 is_null=0 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f24743321013-46\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p></p>\n<ul>\n<li>操作的ad_id已经存在，因此先删除后插入，可以看到除了指定的 ad_id,score，其他字段都变为默认值，导致原有数据丢失（虽然在日志中转为了update）</li>\n</ul>\n<h3>c. 对比测试</h3>\n<p>接下来我进行了如下测试：</p>\n<p><img title=\"test_duibi\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/bc1c5405e9f04bdf942d13b7e34928ef.png\" alt=\"测试对比\"></p>\n<ul>\n<li>左侧使用 <code>REPLACE</code> 语句，右侧使用 <code>DELETE</code> + <code>INSERT</code> 语句，最后结果完全相同</li>\n<li>原主键id为1的行被删除，新插入行主键id更新为4，<strong>没有指定内容的字段c则插入了默认值</strong></li>\n<li>使用 <code>REPLACE</code> 更新了一行数据，MySQL提示受影响行数为2行</li>\n<li>综上所述，说明确实是删除一行，插入一行</li>\n</ul>\n<h2>三、数据恢复</h2>\n<p>数据丢失或数据错误后，可以有如下几种方式恢复：</p>\n<ol>\n<li>业务方自己写脚本恢复</li>\n<li>通过MySQL的binlog查出误操作sql，生成反向sql进行数据恢复（适合sql数据量较小的情况）</li>\n<li>通过历史备份文件+增量binlog将数据状态恢复到误操作的前一刻</li>\n</ol>\n<h2>四、问题扩展</h2>\n<p>通过上述分析可以发现，<code>REPLACE</code> 会删除旧行并插入新行，但是binlog中是以update形式记录，这样就带来另一个问题：</p>\n<blockquote><p><strong>从库自增长值小于主库</strong></p></blockquote>\n<h3>1. 测试</h3>\n<p><strong>a. 主从一致：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba451830f29263118708\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n主库：\r\nmysql&gt; show create table t\\G\r\n*************************** 1. row ***************************\r\n       Table: t\r\nCreate Table: CREATE TABLE `t` (\r\n  `id` int(11) NOT NULL AUTO_INCREMENT,\r\n  `a` int(11) DEFAULT '0',\r\n  `b` int(11) DEFAULT '0',\r\n  `c` int(11) DEFAULT '0',\r\n  PRIMARY KEY (`id`),\r\n  UNIQUE KEY `a` (`a`)\r\n) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8\r\n1 row in set (0.00 sec)\r\n\r\n从库：\r\nmysql&gt; show create table t\\G\r\n*************************** 1. row ***************************\r\n       Table: t\r\nCreate Table: CREATE TABLE `t` (\r\n  `id` int(11) NOT NULL AUTO_INCREMENT,\r\n  `a` int(11) DEFAULT '0',\r\n  `b` int(11) DEFAULT '0',\r\n  `c` int(11) DEFAULT '0',\r\n  PRIMARY KEY (`id`),\r\n  UNIQUE KEY `a` (`a`)\r\n) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8\r\n1 row in set (0.00 sec)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba451830f29263118708-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f29263118708-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f29263118708-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f29263118708-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f29263118708-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f29263118708-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f29263118708-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f29263118708-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f29263118708-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f29263118708-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f29263118708-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f29263118708-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f29263118708-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f29263118708-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f29263118708-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f29263118708-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f29263118708-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f29263118708-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f29263118708-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f29263118708-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f29263118708-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f29263118708-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f29263118708-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f29263118708-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f29263118708-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f29263118708-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f29263118708-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f29263118708-28\">28</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba451830f29263118708-1\">主库：</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f29263118708-2\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">show </span><span class=\"crayon-e\">create </span><span class=\"crayon-i\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-e \">G</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f29263118708-3\"><span class=\"crayon-e \">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">row *</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f29263118708-4\"><span class=\"crayon-h\">       </span><span class=\"crayon-v\">Table</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f29263118708-5\"><span class=\"crayon-e\">Create </span><span class=\"crayon-v\">Table</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CREATE </span><span class=\"crayon-i\">TABLE</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f29263118708-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f29263118708-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f29263118708-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f29263118708-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f29263118708-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f29263118708-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">UNIQUE </span><span class=\"crayon-i\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f29263118708-12\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENGINE</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InnoDB </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">utf8</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f29263118708-13\"><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">row </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sec</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f29263118708-14\"> </div><div class=\"crayon-line\" id=\"crayon-59ba451830f29263118708-15\">从库：</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f29263118708-16\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">show </span><span class=\"crayon-e\">create </span><span class=\"crayon-i\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-e \">G</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f29263118708-17\"><span class=\"crayon-e \">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">row *</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f29263118708-18\"><span class=\"crayon-h\">       </span><span class=\"crayon-v\">Table</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f29263118708-19\"><span class=\"crayon-e\">Create </span><span class=\"crayon-v\">Table</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CREATE </span><span class=\"crayon-i\">TABLE</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f29263118708-20\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f29263118708-21\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f29263118708-22\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f29263118708-23\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f29263118708-24\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f29263118708-25\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">UNIQUE </span><span class=\"crayon-i\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f29263118708-26\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENGINE</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InnoDB </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">utf8</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f29263118708-27\"><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">row </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sec</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f29263118708-28\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0071 seconds] -->\r\n<p><strong>b. 主库REPLACE：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba451830f2d349496629\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n主库：\r\nmysql&gt; replace into t (a,b)values(1,7);\r\nQuery OK, 2 rows affected (0.01 sec)\r\n\r\nmysql&gt; show create table t\\G           \r\n*************************** 1. row ***************************\r\n       Table: t\r\nCreate Table: CREATE TABLE `t` (\r\n  `id` int(11) NOT NULL AUTO_INCREMENT,\r\n  `a` int(11) DEFAULT '0',\r\n  `b` int(11) DEFAULT '0',\r\n  `c` int(11) DEFAULT '0',\r\n  PRIMARY KEY (`id`),\r\n  UNIQUE KEY `a` (`a`)\r\n) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8\r\n1 row in set (0.00 sec)\r\n\r\n从库：\r\nmysql&gt; show create table t\\G\r\n*************************** 1. row ***************************\r\n       Table: t\r\nCreate Table: CREATE TABLE `t` (\r\n  `id` int(11) NOT NULL AUTO_INCREMENT,\r\n  `a` int(11) DEFAULT '0',\r\n  `b` int(11) DEFAULT '0',\r\n  `c` int(11) DEFAULT '0',\r\n  PRIMARY KEY (`id`),\r\n  UNIQUE KEY `a` (`a`)\r\n) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8\r\n1 row in set (0.00 sec)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba451830f2d349496629-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f2d349496629-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f2d349496629-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f2d349496629-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f2d349496629-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f2d349496629-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f2d349496629-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f2d349496629-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f2d349496629-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f2d349496629-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f2d349496629-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f2d349496629-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f2d349496629-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f2d349496629-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f2d349496629-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f2d349496629-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f2d349496629-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f2d349496629-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f2d349496629-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f2d349496629-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f2d349496629-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f2d349496629-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f2d349496629-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f2d349496629-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f2d349496629-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f2d349496629-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f2d349496629-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f2d349496629-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f2d349496629-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f2d349496629-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f2d349496629-31\">31</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba451830f2d349496629-1\">主库：</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f2d349496629-2\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">replace </span><span class=\"crayon-i\">into</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f2d349496629-3\"><span class=\"crayon-e\">Query </span><span class=\"crayon-v\">OK</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rows </span><span class=\"crayon-e\">affected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.01</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sec</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f2d349496629-4\"> </div><div class=\"crayon-line\" id=\"crayon-59ba451830f2d349496629-5\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">show </span><span class=\"crayon-e\">create </span><span class=\"crayon-i\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-e \">G           </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f2d349496629-6\"><span class=\"crayon-e \">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">row *</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f2d349496629-7\"><span class=\"crayon-h\">       </span><span class=\"crayon-v\">Table</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f2d349496629-8\"><span class=\"crayon-e\">Create </span><span class=\"crayon-v\">Table</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CREATE </span><span class=\"crayon-i\">TABLE</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f2d349496629-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f2d349496629-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f2d349496629-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f2d349496629-12\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f2d349496629-13\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f2d349496629-14\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">UNIQUE </span><span class=\"crayon-i\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f2d349496629-15\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENGINE</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InnoDB </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">utf8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f2d349496629-16\"><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">row </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sec</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f2d349496629-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f2d349496629-18\">从库：</div><div class=\"crayon-line\" id=\"crayon-59ba451830f2d349496629-19\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">show </span><span class=\"crayon-e\">create </span><span class=\"crayon-i\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-e \">G</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f2d349496629-20\"><span class=\"crayon-e \">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">row *</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f2d349496629-21\"><span class=\"crayon-h\">       </span><span class=\"crayon-v\">Table</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f2d349496629-22\"><span class=\"crayon-e\">Create </span><span class=\"crayon-v\">Table</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CREATE </span><span class=\"crayon-i\">TABLE</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f2d349496629-23\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f2d349496629-24\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f2d349496629-25\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f2d349496629-26\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f2d349496629-27\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f2d349496629-28\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">UNIQUE </span><span class=\"crayon-i\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f2d349496629-29\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENGINE</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InnoDB </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">utf8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f2d349496629-30\"><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">row </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sec</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f2d349496629-31\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0079 seconds] -->\r\n<p></p>\n<ul>\n<li>注意此时主从两个表的AUTO_INCREMENT值已经不同了</li>\n</ul>\n<p><strong>c. 模拟从升主，在从库进行INSERT：</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba451830f31688918351\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmysql&gt; insert into t (a,b,c)values(4,4,4);\r\nERROR 1062 (23000): Duplicate entry '4' for key 'PRIMARY'\r\nmysql&gt; show create table t\\G\r\n*************************** 1. row ***************************\r\n       Table: t\r\nCreate Table: CREATE TABLE `t` (\r\n  `id` int(11) NOT NULL AUTO_INCREMENT,\r\n  `a` int(11) DEFAULT '0',\r\n  `b` int(11) DEFAULT '0',\r\n  `c` int(11) DEFAULT '0',\r\n  PRIMARY KEY (`id`),\r\n  UNIQUE KEY `a` (`a`)\r\n) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8\r\n1 row in set (0.00 sec)\r\n\r\nmysql&gt; insert into t (a,b,c)values(4,4,4);\r\nQuery OK, 1 row affected (0.00 sec)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba451830f31688918351-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f31688918351-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f31688918351-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f31688918351-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f31688918351-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f31688918351-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f31688918351-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f31688918351-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f31688918351-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f31688918351-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f31688918351-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f31688918351-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f31688918351-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f31688918351-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f31688918351-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f31688918351-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ba451830f31688918351-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba451830f31688918351-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba451830f31688918351-1\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert </span><span class=\"crayon-i\">into</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f31688918351-2\"><span class=\"crayon-i\">ERROR</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1062</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">23000</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Duplicate </span><span class=\"crayon-i\">entry</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'4'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'PRIMARY'</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f31688918351-3\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">show </span><span class=\"crayon-e\">create </span><span class=\"crayon-i\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-e \">G</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f31688918351-4\"><span class=\"crayon-e \">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">row *</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f31688918351-5\"><span class=\"crayon-h\">       </span><span class=\"crayon-v\">Table</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f31688918351-6\"><span class=\"crayon-e\">Create </span><span class=\"crayon-v\">Table</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CREATE </span><span class=\"crayon-i\">TABLE</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f31688918351-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f31688918351-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f31688918351-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f31688918351-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f31688918351-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f31688918351-12\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">UNIQUE </span><span class=\"crayon-i\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f31688918351-13\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ENGINE</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">InnoDB </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">utf8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f31688918351-14\"><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">row </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sec</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f31688918351-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f31688918351-16\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">insert </span><span class=\"crayon-i\">into</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba451830f31688918351-17\"><span class=\"crayon-e\">Query </span><span class=\"crayon-v\">OK</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">row </span><span class=\"crayon-e\">affected</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.00</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sec</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba451830f31688918351-18\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0053 seconds] -->\r\n<p></p>\n<ul>\n<li>从库插入时会报错，主键重复，报错后AUTO_INCREMENT会 +1，因此再次执行就可以成功插入</li>\n</ul>\n<h3>2. 结论</h3>\n<p>这个问题在平时不会有丝毫影响，但是：</p>\n<blockquote><p><strong>如果主库平时大量使用 <code>REPLACE</code> 语句，造成从库 <code>AUTO_INCREMENT</code> 值落后主库太大，当主从发生切换后，再次插入数据时新的主库就会出现大量主键重复报错，导致数据无法插入。</strong></p></blockquote>\n<h3>3. 参考文章</h3>\n<p>http://www.cnblogs.com/monian/archive/2014/10/09/4013784.html</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112368\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112368votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112368\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "惊叹！这个盲人程序员是这样写代码的", "url": "http://blog.jobbole.com/112473/", "front_image_url": ["http://wx2.sinaimg.cn/mw690/6941baebly1fjj46lxsofj20sg0lc3zw.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "开发", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/snowhere\">孙腾浩</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://www.vincit.fi/en/blog/software-development-450-words-per-minute/\">Tuukka Ojala</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p><img src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fjj46lxsofj20sg0lc3zw.jpg\"></p>\n<p>我认为你第一次看到我的工作间肯定这样想 —— “总感觉少些什么”。没有显示器和鼠标，却有个人敲打着键盘，不知注视着哪里。</p>\n<p>这就是我，我同事可以证明我没问题。我是位于坦佩雷（芬兰西南部一座城市）的 Vincit 写字楼中的一名软件开发者。我双目失明。这篇文章中我将讲述有关我工作中的事情。</p>\n<h2>你真的什么都看不到吗？</h2>\n<p>准确来说，我觉察到阳光和其他明亮的光线，不过也仅限这些。其实，这对我的工作也并没有什么帮助。</p>\n<h2>你工作内容是什么？</h2>\n<p>和大部分人一样：忙时写代码，闲时和同事吹逼。我做全栈项目，主攻后端。兼职访问顾问 – 或称监管，随你如何称呼。</p>\n<h2>你如何使用电脑？</h2>\n<p>我用的电脑是一台运行 Windows 10 的普通笔记本。是其中的软件让一切变得神奇。我使用一款叫做屏幕阅读器的程序来访问电脑。屏幕阅读器监听屏幕上的变化并通过盲文（需要单独的盲文设备）或合成的声音来展示给用户。这并不是你如今听到的各种智能助理的合成声音。我使用一种机械声音，每分钟能说 450 个单词。相比较而言，英语正常语速每分钟 120-150 个单词。我有一个怪癖：我既说英语也说芬兰语，我用芬兰语合成器读英语，因为老旧的屏幕阅读器在语言之间切换不够智能，所以我习惯这样做。下面是个例子是阅读这个段落，我能听懂。</p>\n<p><a href=\"https://www.vincit.fi/wp-content/uploads/2017/08/mpsample.mp3?_=1\">https://www.vincit.fi/wp-content/uploads/2017/08/mpsample.mp3?_=1</a></p>\n<p>下面是英语合成器发出的声音：</p>\n<p><a href=\"https://www.vincit.fi/wp-content/uploads/2017/08/essample.mp3?_=2\">https://www.vincit.fi/wp-content/uploads/2017/08/essample.mp3?_=2</a></p>\n<p>鼠标对于我来说并不是非常有用，所以我仅仅通过键盘工作。在座的各位应该十分熟悉我用到的命令：方向键和 tab 键控制窗口内的移动，alt+tab 切换窗口等等。屏幕阅读器也有很多自己的快捷键，比如阅读活动窗口的不同区域或开关一些功能特性。</p>\n<p>有趣的是阅读网页和其他格式化文档。你看，屏幕阅读器分块呈现信息。每一块可能是一行，也可能是一个单词、一个字母，亦或是文本的片段。举个例子，我在网页中按向下的方向键，我听到页面的下一行。我并不能像正常人一样用眼睛从屏幕上阅读内容。相反，我听到一块一块的内容，或跳过我不感兴趣的部分。</p>\n<p>语音或盲文并不能描绘出窗口的显示布局。信息以线性方式呈现给我。如果你把网页复制粘贴进记事本，你就能明白我看到的网页是什么样子的。就是剥离大部分格式的多行文本。然而屏幕阅读器可以获取网页上的 HTML 语法，所以我也能知道超链接、标题、表单等等。事实上，如果非复选框元素展示成复选框样式，我并不能知道这是复选框。我之后将写一篇文章详细讲述这些内容，记住我刚刚举的是个“反人类”例子。 （译者注：突然感到自责和羞愧，深深明白了一个道理：不要用各种有含意义的传统标签 hack 布局和样式，也不要因为 css 的强大而懒得使用各种有含义的传统标签。共勉）</p>\n<p>我花费大量时间工作在命令行上。事实上我通常用浏览器和编辑器，很少用其他图形应用程序。相比那些为鼠标用户打造的图形界面，我发现用命令行处理手边的工作更加高效。</p>\n<p>既然我如此热爱命令行，为什么我却要选择 Windows 这个并不以命令行出名的操作系统呢？答案很简单：Windows 是最方便的操作系统。<a href=\"https://www.nvaccess.org/\">NVDA</a>是我所选择的屏幕阅读器，它是开源的并且维护比其他阅读器更频繁。如果上天再我一次机会，我可能会选 Mac 系统，因为我认为它是易用性和功能性平衡的典范。不幸的是 Mac 系统上的屏幕阅读器 <a href=\"https://www.apple.com/accessibility/mac/vision/\">VoiceOver</a> 经历了漫长的发布周期从而被遗忘，并且它的导航模型和我独特的工作方式并不协调。当然这里也有一个 Gnome 桌面上的<a href=\"https://wiki.gnome.org/action/show/Projects/Orca?action=show&amp;redirect=Orca\">屏幕阅读器</a>，虽然用户很少，依然被很好地维护着，不过还有一些不完善的地方和我日常工作不协调。所以，我选择 Windows。由 GNU 诞生的 Git Bash 和其他命令行工具弥补了 Windows 内置命令行的缺陷。</p>\n<h2>你如何写代码？</h2>\n<p>我花费好长时间才明白为什么大家觉得这个问题是个很高深的问题。记得我上面说过一行一行地阅读文本吗？我也是通过这种方式读代码。通常我会跳过无用的行，或仅听半行来获取内容，但当我需要知道完整信息的时候，我不得不像读小说一样读完所有东西。我当然无法阅读整个代码库。这种情况下我会在脑中抽象一部分代码：这个组件输入 x 返回 y，并不用关心细节逻辑。</p>\n<p>这种阅读方式让我和正常同事的工作方式有些区别。举个例子，当代码审查时，我喜欢看原始 diff 输出，并列窗口显示 diff 对我并不适用，而且还容易让人分心。有修改的代码行上用符号 + 和 – 比用不同背景色标注也要好太多，并不是因为我不能获知颜色名字，而是因为在新增的一行中，读“加”这个字比读“带复杂阴影的高亮红色”用更短的时间。（嘿，我说你呢 Gerrit (一款代码审查工具)）</p>\n<p>你或许会认为缩进和其他代码格式和我无关，因为都是基本的视觉问题。并不是这样，正确的缩进对我的帮助和正常开发者一样。当我用盲文（比语音更加高效）读代码时，我像其他正常程序员一样清楚代码结构。当我进入一段有缩进或无缩进的代码时，我也会得到语音提醒。这些信息帮助我在脑中描绘代码结构。事实上我学的第一门语言就是 Python （PHP 不算），它强制使用代码缩进，这对我来说并不是问题。我有众多理由来强烈建议使用整洁统一的代码风格，其中之一就是不要让我的生活变得更加艰难了，好吗。</p>\n<h2>你喜欢哪款编辑器？</h2>\n<p>剧透一下：这个答案并不是以 V 或者 E 开头（我虽然通过命令行用 Vim 来写 git commit 信息和其他备注。我认为我在这场圣战中是中立的）（译者注：Vim 和 Emacs 梗）一年前我认为 Notepad++ 最棒，它是轻量级的做工精细的文本编辑器。然而一年前我还没有接触大规模 Java 项目，当我接触这种项目时，意味着我应该在 Notepad++ 和理智之间做个选择。最后我选择理智，抛弃 Notepad++ 转投 IntelliJ IDEA 的怀抱。从那之后 IntelliJ IDEA 便是我首选编辑器。我曾对各种 IDE 有深深怨念，它们大多数在纯键盘流操作下麻烦又低效。如果我视力没问题，我肯定早就跳到 IDE 阵营了。</p>\n<p>但你可能会问，为什么当初选 Notepad++。还有其他很多更先进的轻量级编辑器，比如 Sublime 或 Atom。原因很简单：屏幕阅读器无法访问它们。Vim 一类的文本编辑器也是如此，我使用的屏幕阅读器对命令行程序的支持有问题，在这些编辑器上无法处理多于 commit 信息的文本。很遗憾，可用性决定了我能够使用的工具。即使我不能高效工作，也不是什么大问题。</p>\n<h2>你编写过前端代码吗？</h2>\n<p>你应该认为前端开发和视觉有关，注定与盲人程序员无缘。基本上是这样。我从来不自己做概念原型，我做都是有界面，需要随后加入功能的项目。</p>\n<p>然而，我也做过 Angular 和 React 工作任务。怎么会这样？如今很多 APP 基于浏览器。举个例子，我曾花费两周时间为一个 Angular APP 增加国际化支持。我并不需要做任何视觉上的改动。</p>\n<p>我发现对于我这类开发者开说，像 Bootstrap 这类的库简直是上天的礼物。正因为栅格系统（Bootstrap的响应式布局解决方案），我可以自己构建一个粗糙的界面。尽管如此，我做的有关界面的改动在呈现给用户之前仍然要有一双眼睛检查。所以，总而言之，我可以在一定程度上做些前端开发，至少不是和表现层太相关。</p>\n<h2>有什么其他没有提到的东西？</h2>\n<p>其实这篇文章有很多东西没有表达出来。正如上文所承诺，我将全力以赴写一篇文章，有关制作易访问网页的艺术，因为一言未尽是我讨厌的事情之一。我不会半途而废的，敬请期待。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/5085cce1bd4e144b7d148079a34b20c1.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/02b09a29fdb3ab5fe03d4bd1afe95664.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112473\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112473votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112473\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere\">孙腾浩</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/47765e50cfb7c4e598e72d893ab4f62f.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            毕业于郑州大学软件工程专业，身为 Java 程序猿却同样热爱着 JavaScript 。为了兴趣而写代码，做自己喜欢做的事。Keep coding ... Stay Cool ...        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/snowhere\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/snowhere/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 18</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://snowhere.me/\"><i class=\"fa fa-link\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/Snowhere/\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "C# 最佳工具集合： IDE 、分析、自动化工具等", "url": "http://blog.jobbole.com/112411/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/08/297e7ca127d2eef674c119331fe30dff1.jpg"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 4, "tags": "工具与资源,开发,C sharp", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/tdfblog/p/best-csharp-tools.html\">Sweet-Tang</a>   </div><p>C#是企业中广泛使用的编程语言，特别是那些依赖微软的程序语言。如果您使用C#构建应用程序，则最有可能使用Visual Studio，并且已经寻找了一些扩展来对您的开发进行管理。但是，这个工具列表可能会改变您编写C#代码的方式。</p>\n<h1 id=\"c编程的最佳工具有以下几类\">C#编程的最佳工具有以下几类：</h1>\n<ul>\n<li><a href=\"#IDEs\">IDE</a></li>\n<li><a href=\"#Extensions\">VS扩展</a></li>\n<li><a href=\"#Compilers\">编译器、编辑器和序列化</a></li>\n<li><a href=\"#Decompilers\">反编译和代码转换工具</a></li>\n<li><a href=\"#Automation\">构建自动化和合并工具</a></li>\n<li><a href=\"#VersionControl\">版本控制</a></li>\n<li><a href=\"#Testing\">测试工具和VS扩展</a></li>\n<li><a href=\"#Profilers\">性能分析</a></li>\n<li><a href=\"#APM\">APM</a></li>\n<li><a href=\"#Deployment\">部署自动化</a></li>\n<li><a href=\"#Containerization\">容器</a></li>\n</ul>\n<p>使用上面的链接直接跳转到特定工具，或继续阅读以浏览完整列表。</p>\n<h1>IDE</h1>\n<h2 id=\"visual-studio-code\">1. <a href=\"https://code.visualstudio.com/\">Visual Studio Code</a></h2>\n<h2><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/ab7cd9d2dc2e1643611ad6d6dc17a94b.jpg\"><img class=\"aligncenter size-full wp-image-112412\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/ab7cd9d2dc2e1643611ad6d6dc17a94b.jpg\" alt=\"162090-20170910205052272-559220882\"></a></h2>\n<p>Visual Studio Code是C#开发人员最受欢迎的代码编辑器。您可以使用Visual Studio Code与C#扩展功能实现强大的编辑功能，并完全支持C# IntelliSense和调试。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>优秀的自动完成与上下文感知提示</li>\n<li>内置Git集成，实现更好的版本控制</li>\n<li>大量的扩展进一步增强平台</li>\n</ul>\n<h2 id=\"monodevelop\">2. <a href=\"http://www.monodevelop.com/\">MonoDevelop</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/cdbf06f5a31bed35d6e8e99501364c76.jpg\"><img class=\"aligncenter size-full wp-image-112413\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/cdbf06f5a31bed35d6e8e99501364c76.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>由Xamarin开发，MonoDevelop具有许多与VS Code相似的功能，也是跨平台的。使用MonoDevelop，您可以在Windows，Linux和Mac OS X上快速编写桌面和Web应用程序。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>标准功能，如代码提示和调试</li>\n<li>还配有<a href=\"https://unity3d.com/\">Unity</a>，一个游戏引擎，可以为视频游戏等应用程序实现高级C#编程</li>\n<li>支持C#代码提示</li>\n<li>代码模板和代码折叠</li>\n<li>多语言支持</li>\n</ul>\n<h2 id=\"sharpdevelop\">3. <a href=\"http://www.icsharpcode.net/\">SharpDevelop</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/56e59653b98d56cb5a410d98cb7bedf7.jpg\"><img class=\"aligncenter size-full wp-image-112414\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/56e59653b98d56cb5a410d98cb7bedf7.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>一个用于C#、VB.net和Boo项目的免费开源IDE，#develop（SharpDevelop）是VS Code的轻量级替代品。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>Visual Studio提供的通常功能，包括代码编辑，编译和调试</li>\n<li>一些高级功能包括上下文操作和后台语法检查</li>\n</ul>\n<h2 id=\"rider\">4. <a href=\"https://www.jetbrains.com/rider/\">Rider</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/9d3f920744876bd8d1a24134838ba714.jpg\"><img class=\"aligncenter size-full wp-image-112415\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/9d3f920744876bd8d1a24134838ba714.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Jet Brains产品套件中一个成员，Rider是基于IntelliJ平台和ReSharper的跨平台.NET IDE。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>与其他JetBrains产品无缝集成</li>\n<li>2000多种代码检查</li>\n<li>上下文操作</li>\n<li>支持Unity游戏引擎</li>\n<li>支持.NET Framework和.NET Core</li>\n</ul>\n<h1 id=\"visual-studio-扩展\">Visual Studio 扩展</h1>\n<h2 id=\"productivity-power-tools-2017\">5. <a href=\"https://marketplace.visualstudio.com/items?itemName=VisualStudioProductTeam.ProductivityPowerPack2017\">Productivity Power Tools 2017</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/b6ea07eb5999a3e0136e07a09f122f49.jpg\"><img class=\"aligncenter size-full wp-image-112416\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/b6ea07eb5999a3e0136e07a09f122f49.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>由Microsoft提供，这是一个很好的扩展，以加快Visual Studio的开发。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>中间点击滚动</li>\n<li>快速查找</li>\n<li>解决方案错误可视化</li>\n<li>直观的界面</li>\n<li>其它版本可用于旧版Visual Studio版本</li>\n</ul>\n<h2 id=\"jquery-code-snippets\">6. <a href=\"https://github.com/kspearrin/Visual-Studio-jQuery-Code-Snippets\">jQuery Code Snippets</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/3e8c0688d1b43afcb054ae41872c6ed4.jpg\"><img class=\"aligncenter size-full wp-image-112417\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/3e8c0688d1b43afcb054ae41872c6ed4.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>简化jQuery框架编码，jQuery Code Snippets为Visual Studio 2012，2013，2015和2017提供了超过130个代码段。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>130多种jQuery代码片段</li>\n<li>支持所有版本的Visual Studio</li>\n<li>对于那些刚入门jQuery开发人员来说非常棒，可以使用这个扩展来学习jQuery的门道</li>\n</ul>\n<h2 id=\"codemaid\">7. <a href=\"http://www.codemaid.net/\">CodeMaid</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/2864e73047c391392c93c64b6f0e91cd.jpg\"><img class=\"aligncenter size-full wp-image-112418\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/2864e73047c391392c93c64b6f0e91cd.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>CodeMaid是一个开源的VS扩展，可以帮助您清理和简化除C#之外各种支持语言的代码。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>从代码中删除不必要的字符，如空格</li>\n<li>代码整理</li>\n<li>使用树型结构视图轻松浏览代码</li>\n<li>支持多种语言</li>\n<li>注释格式</li>\n</ul>\n<h2 id=\"refactoring-essentials\">8. <a href=\"http://vsrefactoringessentials.com/\">Refactoring Essentials</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/9c0f0877240c4e938221ed3b681237e4.jpg\"><img class=\"aligncenter size-full wp-image-112419\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/9c0f0877240c4e938221ed3b681237e4.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>使用Refactoring Essentials，一个具有内置的C#和VB代码转换器的VS扩展，使您的C#代码更容易阅读和修复常见错误。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>修复常见的错字和编码错误</li>\n<li>在代码库中找到每种不匹配的样式</li>\n<li>开源代码，您可以扩展或改进它</li>\n</ul>\n<h1 id=\"编译器编辑器和序列化\">编译器、编辑器和序列化</h1>\n<h3 id=\"slickedit\">9. <a href=\"https://www.slickedit.com/\">SlickEdit</a></h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/a1333c638778be745f8795863f76f2b9.jpg\"><img class=\"aligncenter size-full wp-image-112420\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/a1333c638778be745f8795863f76f2b9.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>SlickEdit是一个代码编辑工具，可以提高生产力并提高代码质量。它是一个跨平台的代码编辑器，可在九个平台上支持超过60种语言（包括C#）。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>编译并调试您的代码，显示所有错误以便行快速访问</li>\n<li>可以处理非常大的代码文件，大到2TB</li>\n<li>语法扩展和缩进</li>\n<li>按键模拟</li>\n<li>备份历史记录</li>\n<li>多个光标和选择</li>\n<li>标准和专业版可用于满足您的需求</li>\n</ul>\n<h2 id=\"rextester\">10. <a href=\"http://rextester.com/\">Rextester</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/aa72d6d1d2d6d850b8bc04e757da51dc.jpg\"><img class=\"aligncenter size-full wp-image-112421\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/aa72d6d1d2d6d850b8bc04e757da51dc.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Rextester（代表正则表达式测试器）是C#的简单在线编译器。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>每段代码运行CPU时间最多为5秒</li>\n<li>每段代码最多可以占用150MB内存</li>\n<li>代码在应用程序域中运行，具有基本的执行、反射、线程控制和web权限</li>\n</ul>\n<h2 id=\"c-pad\">11. <a href=\"https://csharppad.com/\">C# Pad</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/4fac2d2f11390ea2e6dd24c61717f926.jpg\"><img class=\"aligncenter size-full wp-image-112422\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/4fac2d2f11390ea2e6dd24c61717f926.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>C# Pad是C#的一个方便的REPL工具。使用起来很简单：输入代码，点击“Go”执行。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>在线快速测试C#代码</li>\n<li>包括代码自动完成</li>\n<li>可嵌入其它网站</li>\n</ul>\n<h2 id=\"jdoodle\">12. <a href=\"https://www.jdoodle.com/\">Jdoodle</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/085e042ba82da71329d3f2acc3a697b8.jpg\"><img class=\"aligncenter size-full wp-image-112423\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/085e042ba82da71329d3f2acc3a697b8.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>另一个轻量级代码编译器，Jdoodle支持63种语言（包括C#），并允许您保存程序并与其他人共享URL。您可以将Jdoodle中创建的代码嵌入到您的网站，用于协作，在线访问等。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>在线快速测试一小段代码，而无需打开IDE</li>\n<li>轻松地与他人分享您的代码</li>\n<li>API即将推出</li>\n</ul>\n<h2 id=\"net-fiddle\">13. <a href=\"https://dotnetfiddle.net/\">.NET Fiddle</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/c1c4f3caf8dc79a543e7fc07eb0431b9.jpg\"><img class=\"aligncenter size-full wp-image-112424\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/c1c4f3caf8dc79a543e7fc07eb0431b9.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>C#的一个流行的调试工具，.NET Fiddle的灵感来自于JSFiddle.net，旨在快速，简单的代码测试，而无需打开Visual Studio并创建一个新的项目。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>让您编写，保存和协作C#代码</li>\n<li>支持4种项目类型：控制台，Script，MVC，Nancy</li>\n<li>还支持VB.NET和F＃</li>\n</ul>\n<h2 id=\"telerik-fiddler\">14. <a href=\"http://www.telerik.com/fiddler\">Telerik Fiddler</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/1ba1c74d48a3197be5ea9a54663bf102.jpg\"><img class=\"aligncenter size-full wp-image-112425\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/1ba1c74d48a3197be5ea9a54663bf102.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Telerik Fiddler允许您在线执行代码。它提供了一系列功能，包括Web调试、Web会话操作、性能测试、安全测试等。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>运行一系列测试，如性能测试、Web调试和安全测试</li>\n<li>FiddlerCore可让您将Fiddler应用程序嵌入到您自己的应用程序中，以便您可以避免整个Fiddler UI，还可以获得Fiddler的所有功能</li>\n</ul>\n<h2 id=\"json.net\">15. <a href=\"http://www.newtonsoft.com/json\">Json.NET</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/00105e5bd3b3bcdbfe502aaacf9526dc.jpg\"><img class=\"aligncenter size-full wp-image-112426\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/00105e5bd3b3bcdbfe502aaacf9526dc.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Json.NET是一个流行的JSON框架。使用它，您可以在任何地方（Windows，Windows Store，Windows Phone，Mono和Xamarin）运行它时，创建、解析、查询和修改JSON，在XML和JSON之间进行转换。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>对.NET对象进行序列化和反序列化</li>\n<li>查询JSON数据库</li>\n<li>使用JObject，JArray和JValue对象创建、解析、查询和修改JSON</li>\n<li>开源</li>\n</ul>\n<h2 id=\"scriptcs\">16. <a href=\"http://scriptcs.net/\">Scriptcs</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/fb23c062ff12d10ad60fb4e3e65407be.jpg\"><img class=\"aligncenter size-full wp-image-112427\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/fb23c062ff12d10ad60fb4e3e65407be.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>一个简单的在线编辑器，编写和执行C#代码，Scriptcs被设计为非常简单，以避免使用过于复杂的工具和解决方案阻碍您的工作效率。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>避免完整IDE的臃肿</li>\n<li>为您提供简单的C#编码任务的灵活性和速度</li>\n<li>管理与NuGet的依赖关系</li>\n<li>优雅的C#脚本语法</li>\n</ul>\n<h1 id=\"反编译和代码转换工具\">反编译和代码转换工具</h1>\n<h2 id=\"dotpeek\">17. <a href=\"https://www.jetbrains.com/decompiler/\">dotPeek</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/5d1169da0b608f78a20702bff1909a77.jpg\"><img class=\"aligncenter size-full wp-image-112428\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/5d1169da0b608f78a20702bff1909a77.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>dotPeek允许您将.NET程序集反编译为C#。dotBeek是JetBrains提供的免费独立工具，基于ReSharper捆绑的反编译器。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>强大的搜索和导航功能</li>\n<li>将任何.NET程序集解码为等效的C#或IL代码</li>\n<li>支持多种格式（.dll、.exe、.winmd）</li>\n<li>将反编译的程序集保存为Visual Studio项目</li>\n</ul>\n<h2 id=\"ilspy\">18. <a href=\"http://ilspy.net/\">ILspy</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/b14c6254b53a1eef405a965f7e857a35.jpg\"><img class=\"aligncenter size-full wp-image-112429\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/b14c6254b53a1eef405a965f7e857a35.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>基于Red Gate的.NET Reflector开源反编译器，在2011年停止维护，ILspy需要.NET Framework 4.0。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>浏览程序集并将其反编译为C#</li>\n<li>将程序集保存为C#项目</li>\n<li>直观的搜索和导航功能</li>\n<li>导航历史</li>\n<li>支持C#5.0 “async”</li>\n<li>反编译为VB和C#</li>\n</ul>\n<h2 id=\"justdecompile\">19. <a href=\"http://www.telerik.com/products/decompiler.aspx\">JustDecompile</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/d93095d5cb7fe7a91e8e683a757068d8.jpg\"><img class=\"aligncenter size-full wp-image-112430\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/d93095d5cb7fe7a91e8e683a757068d8.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>一个来自Telerik的反编译器，JustDecompile是一个免费的开源反编译引擎。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>可扩展的开放API</li>\n<li>快速代码导航</li>\n<li>轻松地在标签页中切换方法和程序集</li>\n<li>在加载程序集中使用书签</li>\n<li>从反编译的程序集创建一个Visual Studio项目</li>\n<li>Visual Studio扩展在VS项目中进行反编译</li>\n</ul>\n<h2 id=\"telerik-code-converter\">20. <a href=\"http://converter.telerik.com/\">Telerik Code Converter</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/55f1c5759c01a823a8cd152e67e9fa28.jpg\"><img class=\"aligncenter size-full wp-image-112431\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/55f1c5759c01a823a8cd152e67e9fa28.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Telerik代码转换器将VB代码转换为C#，反之亦然。一个简单而强大的工具，Telerik代码转换器易于使用，具有直观的界面。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>基于云的转换，快速和轻松的</li>\n<li>使用NRefactory库进行复杂的代码转换</li>\n<li>使用ASP.NET AJAX的Telerik UI</li>\n</ul>\n<h1 id=\"构建自动化和合并工具\">构建自动化和合并工具</h1>\n<h3 id=\"cake-build\">21. <a href=\"http://cakebuild.net/\">Cake Build</a></h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/710b109b667b0a2a4c754815d85c73b8.jpg\"><img class=\"aligncenter size-full wp-image-112432\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/710b109b667b0a2a4c754815d85c73b8.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Cake（C#Make）是C#版的开源Make Build自动化工具。一个跨平台构建自动化系统，Cake使用C# DSL来编写代码，运行单元测试，复制文件和文件夹，压缩文件和构建NuGet软件包等任务。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>在Windows，Linux和OS X上可用</li>\n<li>建立与其他CI系统相同的方式</li>\n<li>支持构建工具，包括MSBuild，MSTest，xUnit，NUnit，NuGet，ILMerge，WiX和SignTool</li>\n<li>高可扩展</li>\n</ul>\n<h2 id=\"msbuild\">22. <a href=\"https://www.visualstudio.com/en-us/docs/build/steps/build/msbuild\">MSBuild</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/dc18c33a85da75cdb5e9e497dfc15020.jpg\"><img class=\"aligncenter size-full wp-image-112433\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/dc18c33a85da75cdb5e9e497dfc15020.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>MSBuild是由Microsoft于2008年推出的。它不是Visual Studio平台的一部分，但它是您的C#开发工具包的一个很好的资源，例如在您构建代码项目时，除了解决方案之外。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>来自微软，它被许多MS商店广泛使用</li>\n<li>微软把它放到了Visual Studio中确保它不会成单独存</li>\n<li>构建多个项目</li>\n<li>构建Win32，x86，x64或任何cpu平台</li>\n<li>为多个平台构建多个配置</li>\n</ul>\n<h2 id=\"finalbuilder\">23. <a href=\"https://www.finalbuilder.com/finalbuilder\">FinalBuilder</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/76cc136d56bf28d5f660a00e8dd0f20c.jpg\"><img class=\"aligncenter size-full wp-image-112434\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/76cc136d56bf28d5f660a00e8dd0f20c.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>FinalBuilder是构建自动化工具的一个很好的商业选择。使用FinalBuilder，您不需要编辑XML或编写脚本来自动完成构建过程。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>通过包括可视化调试，使构建变得容易</li>\n<li>可视地定义和调试构建脚本</li>\n<li>使用Windows调度程序安排脚本</li>\n<li>与Continua CI，Jenkins或任何其它CI服务器集成</li>\n</ul>\n<h2 id=\"semanticmerge\">24. <a href=\"http://www.semanticmerge.com/\">SemanticMerge</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/27c5f88a28199621439e8d5f121cf978.jpg\"><img class=\"aligncenter size-full wp-image-112435\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/27c5f88a28199621439e8d5f121cf978.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>SemanticMerge分析您的代码，旨在处理已被移动或修改的代码，使其成为团队协作的强大工具。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>实现协作和分布式开发</li>\n<li>从结构合并开始，然后在发生冲突时移动到更具体的基于文本的合并</li>\n<li>基于结构而不是位置合并</li>\n<li>处理特定于语言的冲突</li>\n<li>避免错误地识别自动合并</li>\n<li>保持清洁的代码并分析更改</li>\n</ul>\n<h1 id=\"版本控制\">版本控制</h1>\n<h2 id=\"git\">25. <a href=\"https://git-scm.com/\">Git</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/2ebd63d78a68b858493da22210f0a2bb.jpg\"><img class=\"aligncenter size-full wp-image-112436\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/2ebd63d78a68b858493da22210f0a2bb.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Git就不需要介绍了。这是一个免费的开源版本控制系统，也是当今最流行的版本控制系统。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>现代版本控制工具，适用于当今地理位置分布的团队</li>\n<li>包括强大的默认值，用于解决冲突，自动恢复等</li>\n<li>便宜的本地分支</li>\n<li>方便的暂存区</li>\n<li>多个工作流程</li>\n</ul>\n<h2 id=\"team-foundation-version-control\">26. <a href=\"https://www.visualstudio.com/team-services/tfvc/\">Team Foundation Version Control</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/328f6f58124bcf89625bc7bc2aa43639.jpg\"><img class=\"aligncenter size-full wp-image-112437\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/328f6f58124bcf89625bc7bc2aa43639.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>TFS版本控制是Microsoft替代Git的一种，它集成到Visual Studio中。它是企业准备的，所以对于使用VS项目的任何规模的团队来说，这是一个不错的选择。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>利用Visual Studio功能提供本地体验</li>\n<li>跟踪分支机构的代码更改</li>\n<li>在代码签入之前提供反馈</li>\n<li>集成最流行的CI和自动化构建工具</li>\n</ul>\n<h2 id=\"bitbucket\">27. <a href=\"https://bitbucket.org/\">BitBucket</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/83bb4073ba4ba43ec8f09f7221898316.jpg\"><img class=\"aligncenter size-full wp-image-112438\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/83bb4073ba4ba43ec8f09f7221898316.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>BitBucket是Jira的Git替代品，也是一个有能力的版本控制工具——“唯一一个大规模的协作的Git解决方案。”</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>使用内联注释选项更快地协作</li>\n<li>由于代码是开源的，还是让Jira为您管理代码</li>\n<li>拉请求允许更有效的代码审查批准</li>\n<li>使用BitBucket数据中心进行不间断的访问</li>\n<li>无限私有存储库</li>\n</ul>\n<h2 id=\"sourcetree\">28. <a href=\"https://www.sourcetreeapp.com/\">SourceTree</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/6dbc13b3a314cec4fe0c7366d37abb2c.jpg\"><img class=\"aligncenter size-full wp-image-112439\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/6dbc13b3a314cec4fe0c7366d37abb2c.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>SourceTree是另一个Jira产品，一个用于Windows和Mac的免费Git客户端，具有简单的Git GUI来管理您的仓库。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>支持Windows和Mac</li>\n<li>与您的存储库进行视觉交互</li>\n<li>简化分布式版本控制</li>\n<li>对初学者来说足够简单 足够强大的专家</li>\n</ul>\n<h1 id=\"测试工具和vs扩展\">测试工具和VS扩展</h1>\n<h3 id=\"linqpad\">29. <a href=\"http://www.linqpad.net/\">LINQPad</a></h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/8b84ef5c25005a19e0d25f7e19706ac6.jpg\"><img class=\"aligncenter size-full wp-image-112440\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/8b84ef5c25005a19e0d25f7e19706ac6.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>一个用于即时测试C#，F#和VB中的代码片段的工具，LINQPad可以让您以交互方式查询数据库。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>有自己的查询语言 – LINQ，这是一个强大的查询数据库的方法</li>\n<li>非常适合学习C#，因为它为您提供了IDE的许多功能，而不臃肿</li>\n<li>在LINQ（或SQL） – SQL/CE/Azure、Oracle、SQLite和MySQL中查询数据库</li>\n<li>丰富的输出格式</li>\n<li>脚本并以您首选的.NET语言自动化</li>\n</ul>\n<h2 id=\"selenium\">30. <a href=\"http://www.seleniumhq.org/\">Selenium</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/30d2148445af4f7ae6568772fc5ccae8.jpg\"><img class=\"aligncenter size-full wp-image-112441\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/30d2148445af4f7ae6568772fc5ccae8.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Selenium是目前最流行的测试工具之一。它可以自动化Web浏览器，以便您可以在规模和精度上运行测试。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>自动化的基于Web的管理任务</li>\n<li>创建强大的回归自动化套件和测试</li>\n<li>跨环境和脚本分发</li>\n<li>构建您自己的Selenium服务器或使用供应商提供的托管选项</li>\n</ul>\n<h2 id=\"resharper\">31. <a href=\"https://www.jetbrains.com/resharper/\">ReSharper</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/e0d310155483608ebc407ab9a28c6fda.jpg\"><img class=\"aligncenter size-full wp-image-112442\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/e0d310155483608ebc407ab9a28c6fda.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>由JetBrains创建的，ReSharper是.NET开发人员的Visual Studio扩展。使用它来即时分析代码质量，消除错误，安全地更改代码库等。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>提供即时代码分析</li>\n<li>快速修复错误</li>\n<li>帮助复杂重构</li>\n<li>多个代码编辑助手</li>\n</ul>\n<h2 id=\"ozcode\">32. <a href=\"https://oz-code.com/\">OzCode</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/5aad95b7d82740b30d92429af2aa9bcb.jpg\"><img class=\"aligncenter size-full wp-image-112443\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/5aad95b7d82740b30d92429af2aa9bcb.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>OzCode是C#的Visual Studio扩展，提供强大的调试工具，因此您可以花更多的时间开发和更少的时间调试。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>使Visual Studio中更容易找到并修复错误</li>\n<li>与ReSharper合作</li>\n<li>用Magic Glance来绘制出复杂的表达式</li>\n<li>强大的搜索，显示和比较功能</li>\n</ul>\n<h2 id=\"coderush\">33. <a href=\"https://www.devexpress.com/products/coderush/\">CodeRush</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/afb8749eb07de32dd5886f8121b86baf.jpg\"><img class=\"aligncenter size-full wp-image-112444\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/afb8749eb07de32dd5886f8121b86baf.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>CodeRush可以帮助您轻松找到并修复问题，像本节中的其它测试工具一样，是一个VS扩展。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>视觉突出显示代码库中的问题，并帮助您快速发现问题</li>\n<li>快速创建新的测试和测试套件与快捷方式</li>\n<li>容易重构</li>\n</ul>\n<h1 id=\"性能分析\">性能分析</h1>\n<h3 id=\"prefix\">34. <a href=\"https://stackify.com/prefix/\">Prefix</a></h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/03b06f5d1cb589306d5795789ad8d54d.png\"><img class=\"aligncenter size-full wp-image-112445\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/03b06f5d1cb589306d5795789ad8d54d.png\" alt=\"162090-20170910211007866-1263253556\"></a></p>\n<p>一个用于.NET和Java的轻量级开发工具，Prefix会实时显示日志、错误、查询等。它可以在您现有的工作站内使用 – 它是免费的。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>提供每个Web请求的详细跟踪</li>\n<li>没有凌乱的配置或代码更改</li>\n<li>立即下载; 立即获得代码分析结果</li>\n<li>按要求查看日志</li>\n<li>查找隐藏的异常</li>\n<li>查看SQL查询</li>\n<li>快速找出可疑行为</li>\n</ul>\n<h2 id=\"dottrace\">35. <a href=\"https://www.jetbrains.com/profiler/\">dotTrace</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/d305e83fd3ff97da47bbcbd688abb102.jpg\"><img class=\"aligncenter size-full wp-image-112446\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/d305e83fd3ff97da47bbcbd688abb102.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>来自JetBrains，dotTrace是一个分析器，可帮助排除性能问题并加快应用程序的速度。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>了解SQL查询和HTTP请求如何影响应用程序性能</li>\n<li>查看逐行剖析数据并获取特定的绩效指标</li>\n<li>获取调用执行时间的数据</li>\n<li>配置文件SQL查询和HTTP请求</li>\n<li>简介静态方法和单元测试</li>\n<li>在Visual Studio中配置和可视化结果</li>\n</ul>\n<h2 id=\"ants-performance-profiler\">36. <a href=\"https://www.red-gate.com/products/dotnet-development/ants-performance-profiler/\">ANTS Performance Profiler</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/421d2c22e18956d4c7d759d2189ddb2a.jpg\"><img class=\"aligncenter size-full wp-image-112447\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/421d2c22e18956d4c7d759d2189ddb2a.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>ANTS性能分析器是.NET代码的分析工具，包括提供逐行分析统计信息。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>查看SQL查询和HTTP请求的性能数据</li>\n<li>提供逐行结果</li>\n<li>显示历史性的表现</li>\n<li>深入了解长期分析结果</li>\n</ul>\n<h2 id=\"n-profiler\">37.<a href=\"https://www.nprofiler.com/\">N Profiler</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/193d29df37f2c0a6de25bb5f83b8c30c.jpg\"><img class=\"aligncenter size-full wp-image-112448\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/193d29df37f2c0a6de25bb5f83b8c30c.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>一个分析工具声称比任何其培训分析器更快，N Profiler提供丰富的.NET性能数据，可以节省90%的优化时间。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>了解性能问题的真实原因 – 数据库查询或I/O时间</li>\n<li>性能指标组织在调用树中，可以在概述或细节级别查看</li>\n</ul>\n<h1 id=\"apm\">APM</h1>\n<h2 id=\"retrace\">38. <a href=\"https://stackify.com/retrace/\">Retrace</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/54b4463f786af4d51a64b9624ce703e3.png\"><img class=\"aligncenter size-full wp-image-112450\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/54b4463f786af4d51a64b9624ce703e3.png\" alt=\"162090-20170910211007866-1263253556\"></a></p>\n<p>Retrace是唯一将APM、日志、错误、指标和监控结合在一个平台上的开发者工具，可帮助您更好地构建。它专为生产和预生产服务器而设计，每月只需10美元。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>在代码级收集性能数据</li>\n<li>应用程序和服务器记录</li>\n<li>各种来源的应用指标</li>\n<li>错误跟踪和监控</li>\n<li>与现有堆栈一起工作</li>\n<li>免费试用</li>\n</ul>\n<h1 id=\"部署自动化\">部署自动化</h1>\n<h2 id=\"octopus\">39. <a href=\"https://octopus.com/\">Octopus</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/1143dc56d334c82c08d0e6e076190eb0.jpg\"><img class=\"aligncenter size-full wp-image-112451\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/1143dc56d334c82c08d0e6e076190eb0.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>C#主要部署自动化工具，这使得自动化复杂的应用程序部署成为可能。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>提供和配置新机器来部署您的应用程序</li>\n<li>与CI服务器集成，将构建自动化和CI进程扩展到部署中</li>\n<li>精简各环境之间的版本</li>\n<li>可重复，可靠的部署</li>\n</ul>\n<h2 id=\"appveyor\">40. <a href=\"https://www.appveyor.com/\">Appveyor</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/541566723eb5308d235dcfc63e057987.jpg\"><img class=\"aligncenter size-full wp-image-112452\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/541566723eb5308d235dcfc63e057987.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>一个CI构建服务器，不仅可以处理构建，而且还可以进行部署，Appveyor非常强大，安全，并且无需设置即可开始使用。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>用于构建，测试和部署端到端解决方案</li>\n<li>易于使用，无需设置</li>\n<li>隔离构建环境</li>\n<li>使用UI或YAML的开发人员友好的构建配置</li>\n<li>内置部署和NuGet服务器</li>\n<li>多分支构建</li>\n</ul>\n<h2 id=\"appharbor\">41.<a href=\"https://appharbor.com/\">AppHarbor</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/38343a06fc098841a183e68f8dc5c71e.jpg\"><img class=\"aligncenter size-full wp-image-112453\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/38343a06fc098841a183e68f8dc5c71e.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>AppHarbor不仅仅是部署：它是一个完全托管的.NET 平台服务。它用于托管从个人博客到高流量网络应用程序的所有内容。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>从源代码存储库获取代码，并将其部署在自己的托管平台上</li>\n<li>使用您最喜欢的版本控制工具即时部署和扩展.NET应用程序</li>\n<li>不用担心扩展您的基础架构来跟上负载，AppHarbor会为您处理这一切</li>\n</ul>\n<h2 id=\"jenkins\">42. <a href=\"https://jenkins.io/\">Jenkins</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/74f7d0aa59c2d8ac0aad93e8ef7cfe4a.jpg\"><img class=\"aligncenter size-full wp-image-112454\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/74f7d0aa59c2d8ac0aad93e8ef7cfe4a.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Jenkins不仅仅是部署自动化工具，也是最受欢迎的CI服务器，它将其覆盖面扩展到部署和交付阶段。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>丰富的收集扩展，以适应每个堆栈</li>\n<li>从构建到部署的端到端解决方案</li>\n<li>数以百计的插件来支持构建，部署和自动化</li>\n</ul>\n<h1 id=\"容器\">容器</h1>\n<h2 id=\"docker.dotnet\">43. <a href=\"https://www.nuget.org/packages/Docker.DotNet/\">Docker.DotNet</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/15f470b4e14bc30557d58f71c8372b3f.jpg\"><img class=\"aligncenter size-full wp-image-112458\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/15f470b4e14bc30557d58f71c8372b3f.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>Docker.DotNet是Docker API的C#客户端库。通过它，您可以通过编程方式与Docker Remote API进行交互。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>可以通过Visual Studio的NuGet库管理器进行安装</li>\n<li>在.NET中启用完全异步，非阻塞，面向对象的代码</li>\n</ul>\n<h2 id=\"distelli\">44. <a href=\"https://www.distelli.com/\">Distelli</a></h2>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/34cc483c247ca99f52ba7cb37d0c2f07.jpg\"><img class=\"aligncenter size-full wp-image-112459\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/34cc483c247ca99f52ba7cb37d0c2f07.jpg\" alt=\"162090-20170910205052272-559220882\"></a></p>\n<p>一个强大的工具来集中化C#应用程序，Distelli帮助您从头到尾自动化您的容器工作流程。有关如何使用Distelli构建和部署C#应用程序，请参阅<a href=\"https://www.distelli.com/docs/tutorials/build-and-deploy-c-sharp-application/\">此有用的教程</a> 。本教程提供了构建和部署Docker C#应用程序的分步说明。</p>\n<p><strong>主要特征：</strong></p>\n<ul>\n<li>使用Distelli自动化您的容器工作流端到端</li>\n<li>部署到Kubernetes，用于最先进的容器编排</li>\n</ul>\n<p>C#和.NET Core 将在2018年及以后的得到巨大的发展，磨练C#技能将在未来几年内为您服务。我们希望您已经找到了一两种可以使用的工具，并提高了C#开发的质量和生产力。如果有什么工具我们遗漏了，请告诉我们，这个工具应该在这个工具包中有一席之地。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112411\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112411votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112411\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "HttpClient 获取 Cookie 的一次踩坑实录", "url": "http://blog.jobbole.com/112469/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/09/b133aed073d8d50b86dc17cd62408b91.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "开发,HttpClient,java", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/2653yy\">fullstackyang</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>在使用HttpClient进行抓取一些网页的时候，经常会保留从服务器端发回的Cookie信息，以便发起其他需要这些Cookie的请求。大多数情况下，我们使用内置的cookie策略，便能够方便直接地获取这些cookie。</p>\n<p>下面的一小段代码，就是访问<a href=\"http://www.baidu.com\">http://www.baidu.com</a>，并获取对应的cookie：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba386676bb9491512030\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@ Test\r\npublic void getCookie(){\r\n    CloseableHttpClient httpClient = HttpClients.createDefault();\r\n    HttpGet get=new HttpGet(\"http://www.baidu.com\");\r\n    HttpClientContext context = HttpClientContext.create();\r\n    try {\r\n        CloseableHttpResponse response = httpClient.execute(get, context);\r\n        try{\r\n            System.out.println(\"&gt;&gt;&gt;&gt;&gt;&gt;headers:\");\r\n            Arrays.stream(response.getAllHeaders()).forEach(System.out::println);\r\n            System.out.println(\"&gt;&gt;&gt;&gt;&gt;&gt;cookies:\");\r\n            context.getCookieStore().getCookies().forEach(System.out::println);\r\n        }\r\n        finally {\r\n            response.close();\r\n        }\r\n    } catch (IOException e) {\r\n        e.printStackTrace();\r\n    }finally {\r\n        try {\r\n            httpClient.close();\r\n        } catch (IOException e) {\r\n            e.printStackTrace();\r\n        }\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba386676bb9491512030-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bb9491512030-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bb9491512030-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bb9491512030-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bb9491512030-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bb9491512030-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bb9491512030-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bb9491512030-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bb9491512030-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bb9491512030-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bb9491512030-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bb9491512030-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bb9491512030-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bb9491512030-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bb9491512030-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bb9491512030-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bb9491512030-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bb9491512030-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bb9491512030-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bb9491512030-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bb9491512030-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bb9491512030-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bb9491512030-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bb9491512030-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bb9491512030-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bb9491512030-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba386676bb9491512030-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Test</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bb9491512030-2\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getCookie</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bb9491512030-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">CloseableHttpClient </span><span class=\"crayon-v\">httpClient</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HttpClients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">createDefault</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bb9491512030-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">HttpGet </span><span class=\"crayon-v\">get</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HttpGet</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://www.baidu.com\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bb9491512030-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">HttpClientContext </span><span class=\"crayon-v\">context</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HttpClientContext</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bb9491512030-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bb9491512030-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">CloseableHttpResponse </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">httpClient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">get</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bb9491512030-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bb9491512030-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"&gt;&gt;&gt;&gt;&gt;&gt;headers:\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bb9491512030-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">Arrays</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getAllHeaders</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">println</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bb9491512030-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"&gt;&gt;&gt;&gt;&gt;&gt;cookies:\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bb9491512030-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getCookieStore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getCookies</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">println</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bb9491512030-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bb9491512030-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">finally</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bb9491512030-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bb9491512030-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bb9491512030-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">IOException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bb9491512030-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">printStackTrace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bb9491512030-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-st\">finally</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bb9491512030-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bb9491512030-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">httpClient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bb9491512030-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">IOException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bb9491512030-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">printStackTrace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bb9491512030-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bb9491512030-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bb9491512030-26\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0047 seconds] -->\r\n<p>打印结果</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba386676bc4825619978\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt;&gt;&gt;&gt;headers:\r\nServer: bfe/1.0.8.18\r\nDate: Tue, 12 Sep 2017 06:19:06 GMT\r\nContent-Type: text/html\r\nLast-Modified: Mon, 23 Jan 2017 13:28:24 GMT\r\nTransfer-Encoding: chunked\r\nConnection: Keep-Alive\r\nCache-Control: private, no-cache, no-store, proxy-revalidate, no-transform\r\nPragma: no-cache\r\nSet-Cookie: BDORZ=27315; max-age=86400; domain=.baidu.com; path=/\r\n&gt;&gt;&gt;&gt;&gt;&gt;cookies:\r\n[version: 0][name: BDORZ][value: 27315][domain: baidu.com][path: /][expiry: null]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba386676bc4825619978-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bc4825619978-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bc4825619978-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bc4825619978-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bc4825619978-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bc4825619978-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bc4825619978-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bc4825619978-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bc4825619978-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bc4825619978-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bc4825619978-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bc4825619978-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba386676bc4825619978-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bc4825619978-2\"><span class=\"crayon-v\">Server</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bfe</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1.0.8.18</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bc4825619978-3\"><span class=\"crayon-v\">Date</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Tue</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Sep</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">19</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">06</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GMT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bc4825619978-4\"><span class=\"crayon-v\">Content</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">html</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bc4825619978-5\"><span class=\"crayon-v\">Last</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Modified</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Mon</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jan</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">28</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">24</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GMT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bc4825619978-6\"><span class=\"crayon-v\">Transfer</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Encoding</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">chunked</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bc4825619978-7\"><span class=\"crayon-v\">Connection</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Keep</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Alive</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bc4825619978-8\"><span class=\"crayon-v\">Cache</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Control</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">private</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">cache</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">store</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">proxy</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">revalidate</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">transform</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bc4825619978-9\"><span class=\"crayon-v\">Pragma</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">cache</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bc4825619978-10\"><span class=\"crayon-v\">Set</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Cookie</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BDORZ</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">27315</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">age</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">86400</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">domain</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">baidu</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bc4825619978-11\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">cookies</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bc4825619978-12\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BDORZ</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">27315</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">domain</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">baidu</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">expiry</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0043 seconds] -->\r\n<p>但是也有一些网站返回的cookie并不一定完全符合规范，例如下面这个例子，从打印出的header中可以看到，这个cookie中的Expires属性是时间戳形式，并不符合标准的时间格式，因此，httpclient对于cookie的处理失效，最终无法获取到cookie，并且发出了一条警告信息：“Invalid ‘expires’ attribute: 1505204523”</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba386676bc8564163839\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n警告: Invalid cookie header: \"Set-Cookie: yd_cookie=90236a64-8650-494b332a285dbd886e5981965fc4a93f023d; Expires=1505204523; Path=/; HttpOnly\". Invalid 'expires' attribute: 1505204523\r\n&gt;&gt;&gt;&gt;&gt;&gt;headers:\r\nDate: Tue, 12 Sep 2017 06:22:03 GMT\r\nContent-Type: text/html\r\nConnection: keep-alive\r\nSet-Cookie: yd_cookie=90236a64-8650-494b332a285dbd886e5981965fc4a93f023d; Expires=1505204523; Path=/; HttpOnly\r\nCache-Control: no-cache, no-store\r\nServer: WAF/2.4-12.1\r\n&gt;&gt;&gt;&gt;&gt;&gt;cookies:</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba386676bc8564163839-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bc8564163839-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bc8564163839-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bc8564163839-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bc8564163839-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bc8564163839-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bc8564163839-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bc8564163839-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bc8564163839-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba386676bc8564163839-1\">警告<span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Invalid </span><span class=\"crayon-e\">cookie </span><span class=\"crayon-v\">header</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Set-Cookie: yd_cookie=90236a64-8650-494b332a285dbd886e5981965fc4a93f023d; Expires=1505204523; Path=/; HttpOnly\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Invalid</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'expires'</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">attribute</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1505204523</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bc8564163839-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bc8564163839-3\"><span class=\"crayon-v\">Date</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Tue</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Sep</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">22</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">03</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GMT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bc8564163839-4\"><span class=\"crayon-v\">Content</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">html</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bc8564163839-5\"><span class=\"crayon-v\">Connection</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">alive</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bc8564163839-6\"><span class=\"crayon-v\">Set</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Cookie</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">yd_cookie</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">90236a64</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">8650</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">494b332a285dbd886e5981965fc4a93f023d</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Expires</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1505204523</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Path</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HttpOnly</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bc8564163839-7\"><span class=\"crayon-v\">Cache</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Control</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">cache</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">store</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bc8564163839-8\"><span class=\"crayon-v\">Server</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WAF</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2.4</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12.1</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bc8564163839-9\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">cookies</span><span class=\"crayon-o\">:</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0045 seconds] -->\r\n<p>虽然我们可以利用header的数据，重新构造一个cookie出来，也有很多人确实也是这么做的，但这种方法不够优雅，那么如何解决这个问题？网上相关的资料又很少，所以就只能先从官方文档入手。在官方文档3.4小节custom cookie policy中讲到允许自定义的cookie策略，自定义的方法是实现CookieSpec接口，并通过CookieSpecProvider来完成在httpclient中的初始化和注册策略实例的工作。好了，关键的线索在于CookieSpec接口，我们来看一下它的源码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba386676bcd474434591\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic interface CookieSpec {\r\n……\r\n    /**\r\n      * Parse the {@ code \"Set-Cookie\"} Header into an array of Cookies.\r\n      *\r\n      * &lt;p&gt; This method will not perform the validation of the resultant&lt;code&gt;\r\n      * {@link Cookie}s&lt;/p&gt;\r\n      *\r\n      * @ see #validate\r\n      *\r\n      * @param header the {@ code Set-Cookie} received from the server\r\n      * @param origin details of the cookie origin\r\n      * @ return an array of {@ code Cookie}s parsed from the header\r\n      * @throws MalformedCookieException if an exception occurs during parsing\r\n      */\r\n    List parse(Header header, CookieOrigin origin) throws MalformedCookieException;\r\n……\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba386676bcd474434591-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bcd474434591-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bcd474434591-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bcd474434591-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bcd474434591-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bcd474434591-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bcd474434591-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bcd474434591-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bcd474434591-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bcd474434591-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bcd474434591-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bcd474434591-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bcd474434591-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bcd474434591-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bcd474434591-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bcd474434591-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bcd474434591-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bcd474434591-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba386676bcd474434591-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CookieSpec</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bcd474434591-2\">……</div><div class=\"crayon-line\" id=\"crayon-59ba386676bcd474434591-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bcd474434591-4\"><span class=\"crayon-c\">      * Parse the {@ code \"Set-Cookie\"} Header into an array of Cookies.</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bcd474434591-5\"><span class=\"crayon-c\">      *</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bcd474434591-6\"><span class=\"crayon-c\">      * &lt;p&gt; This method will not perform the validation of the resultant&lt;code&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bcd474434591-7\"><span class=\"crayon-c\">      * {@link Cookie}s&lt;/p&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bcd474434591-8\"><span class=\"crayon-c\">      *</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bcd474434591-9\"><span class=\"crayon-c\">      * @ see #validate</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bcd474434591-10\"><span class=\"crayon-c\">      *</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bcd474434591-11\"><span class=\"crayon-c\">      * @param header the {@ code Set-Cookie} received from the server</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bcd474434591-12\"><span class=\"crayon-c\">      * @param origin details of the cookie origin</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bcd474434591-13\"><span class=\"crayon-c\">      * @ return an array of {@ code Cookie}s parsed from the header</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bcd474434591-14\"><span class=\"crayon-c\">      * @throws MalformedCookieException if an exception occurs during parsing</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bcd474434591-15\"><span class=\"crayon-c\">      */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bcd474434591-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">List </span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Header </span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CookieOrigin </span><span class=\"crayon-v\">origin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws </span><span class=\"crayon-v\">MalformedCookieException</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bcd474434591-17\">……</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bcd474434591-18\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>在源码中我们发现了一个parse方法，看注释就知道正是这个方法，将Set-Cookie的header信息解析为Cookie对象，自然地再了解一下在httplcient中的默认实现DefaultCookieSpec，限于篇幅，源码就不贴了。在默认的实现中，DefaultCookieSpec主要的工作是判断header中Cookie规范的类型，然后再调用具体的某一个实现。像上述这种Cookie，最终是交由NetscapeDraftSpec的实例来做解析，而在NetscapeDraftSpec的源码中，定义了默认的expires时间格式为“EEE, dd-MMM-yy HH:mm:ss z”</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba386676bd0902174872\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class NetscapeDraftSpec extends CookieSpecBase {\r\n\r\n    protected static final String EXPIRES_PATTERN = \"EEE, dd-MMM-yy HH:mm:ss z\";\r\n\r\n    /** Default constructor */\r\n    public NetscapeDraftSpec(final String[] datepatterns) {\r\n        super(new BasicPathHandler(),\r\n                new NetscapeDomainHandler(),\r\n                new BasicSecureHandler(),\r\n                new BasicCommentHandler(),\r\n                new BasicExpiresHandler(\r\n                        datepatterns != null ? datepatterns.clone() : new String[]{EXPIRES_PATTERN}));\r\n    }\r\n\r\n    NetscapeDraftSpec(final CommonCookieAttributeHandler... handlers) {\r\n        super(handlers);\r\n    }\r\n\r\n    public NetscapeDraftSpec() {\r\n        this((String[]) null);\r\n    }\r\n……\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd0902174872-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd0902174872-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd0902174872-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd0902174872-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd0902174872-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd0902174872-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd0902174872-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd0902174872-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd0902174872-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd0902174872-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd0902174872-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd0902174872-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd0902174872-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd0902174872-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd0902174872-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd0902174872-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd0902174872-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd0902174872-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd0902174872-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd0902174872-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd0902174872-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd0902174872-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd0902174872-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba386676bd0902174872-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NetscapeDraftSpec</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CookieSpecBase</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd0902174872-2\"> </div><div class=\"crayon-line\" id=\"crayon-59ba386676bd0902174872-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">EXPIRES_PATTERN</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"EEE, dd-MMM-yy HH:mm:ss z\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd0902174872-4\"> </div><div class=\"crayon-line\" id=\"crayon-59ba386676bd0902174872-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/** Default constructor */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd0902174872-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NetscapeDraftSpec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">datepatterns</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd0902174872-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BasicPathHandler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd0902174872-8\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NetscapeDomainHandler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd0902174872-9\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BasicSecureHandler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd0902174872-10\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BasicCommentHandler</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd0902174872-11\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BasicExpiresHandler</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd0902174872-12\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">datepatterns</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">datepatterns</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">clone</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">EXPIRES_PATTERN</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd0902174872-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd0902174872-14\"> </div><div class=\"crayon-line\" id=\"crayon-59ba386676bd0902174872-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">NetscapeDraftSpec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CommonCookieAttributeHandler</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handlers</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd0902174872-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">handlers</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd0902174872-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd0902174872-18\"> </div><div class=\"crayon-line\" id=\"crayon-59ba386676bd0902174872-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NetscapeDraftSpec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd0902174872-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd0902174872-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd0902174872-22\">……</div><div class=\"crayon-line\" id=\"crayon-59ba386676bd0902174872-23\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n<p>到这里已经比较清楚了，我们只需要将Cookie中expires的时间转换为正确的格式，然后再送入默认的解析器就可以了。</p>\n<p><strong>解决方法：</strong></p>\n<ol>\n<li>自定义一个CookieSpec类，继承DefaultCookieSpec</li>\n<li>重写parser方法</li>\n<li>将Cookie中的expires转换为正确的时间格式</li>\n<li>调用默认的解析方法</li>\n</ol>\n<p>实现如下（URL就不公开了，已经隐去）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba386676bd4586810000\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class TestHttpClient {\r\n    \r\n    String url = sth;\r\n\r\n    class MyCookieSpec extends DefaultCookieSpec {\r\n        @ Override\r\n        public List parse(Header header, CookieOrigin cookieOrigin) throws MalformedCookieException {\r\n            String value = header.getValue();\r\n            String prefix = \"Expires=\";\r\n            if (value.contains(prefix)) {\r\n                String expires = value.substring(value.indexOf(prefix) + prefix.length());\r\n                expires = expires.substring(0, expires.indexOf(\";\"));\r\n                String date = DateUtils.formatDate(new Date(Long.parseLong(expires) * 1000L),\"EEE, dd-MMM-yy HH:mm:ss z\");\r\n                value = value.replaceAll(prefix + \"\\\\d{10};\", prefix + date + \";\");\r\n            }\r\n            header = new BasicHeader(header.getName(), value);\r\n            return super.parse(header, cookieOrigin);\r\n        }\r\n    }\r\n\r\n    @ Test\r\n    public void getCookie() {\r\n\r\n        CloseableHttpClient httpClient = HttpClients.createDefault();\r\n\r\n        Registry cookieSpecProviderRegistry = RegistryBuilder.create()\r\n                .register(\"myCookieSpec\", context -&gt; new MyCookieSpec()).build();//注册自定义CookieSpec\r\n\r\n        HttpClientContext context = HttpClientContext.create();\r\n        context.setCookieSpecRegistry(cookieSpecProviderRegistry);\r\n\r\n        HttpGet get = new HttpGet(url);\r\n        get.setConfig(RequestConfig.custom().setCookieSpec(\"myCookieSpec\").build());\r\n\r\n        try {\r\n            CloseableHttpResponse response = httpClient.execute(get, context);\r\n            try{\r\n                System.out.println(\"&gt;&gt;&gt;&gt;&gt;&gt;headers:\");\r\n                Arrays.stream(response.getAllHeaders()).forEach(System.out::println);\r\n                System.out.println(\"&gt;&gt;&gt;&gt;&gt;&gt;cookies:\");\r\n                context.getCookieStore().getCookies().forEach(System.out::println);\r\n            }\r\n            finally {\r\n                response.close();\r\n            }\r\n        } catch (IOException e) {\r\n            e.printStackTrace();\r\n        }finally {\r\n            try {\r\n                httpClient.close();\r\n            } catch (IOException e) {\r\n                e.printStackTrace();\r\n            }\r\n        }\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd4586810000-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd4586810000-56\">56</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">TestHttpClient</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-2\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sth</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-4\"> </div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyCookieSpec</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DefaultCookieSpec</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Override</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-7\"><span class=\"crayon-e\">        </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">List </span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Header </span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CookieOrigin </span><span class=\"crayon-v\">cookieOrigin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MalformedCookieException</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getValue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">prefix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Expires=\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">contains</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">prefix</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-11\"><span class=\"crayon-h\">                </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">expires</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">substring</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">indexOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">prefix</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">prefix</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-12\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">expires</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">expires</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">substring</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">expires</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">indexOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\";\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DateUtils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">formatDate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parseLong</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">expires</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000L</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"EEE, dd-MMM-yy HH:mm:ss z\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-14\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replaceAll</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">prefix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\\\\d{10};\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">prefix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\";\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">header</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BasicHeader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">super</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">header</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cookieOrigin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-20\"> </div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Test</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-22\"><span class=\"crayon-e\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getCookie</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">CloseableHttpClient </span><span class=\"crayon-v\">httpClient</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HttpClients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">createDefault</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Registry </span><span class=\"crayon-v\">cookieSpecProviderRegistry</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RegistryBuilder</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-27\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">register</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"myCookieSpec\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">context</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">MyCookieSpec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">build</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-c\">//注册自定义CookieSpec</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-28\"> </div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">HttpClientContext </span><span class=\"crayon-v\">context</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">HttpClientContext</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setCookieSpecRegistry</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">cookieSpecProviderRegistry</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-31\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">HttpGet </span><span class=\"crayon-v\">get</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HttpGet</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">get</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setConfig</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">RequestConfig</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">custom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setCookieSpec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"myCookieSpec\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">build</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-34\"> </div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-36\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">CloseableHttpResponse </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">httpClient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">execute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">get</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-37\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">try</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-38\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"&gt;&gt;&gt;&gt;&gt;&gt;headers:\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-39\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">Arrays</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stream</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getAllHeaders</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">println</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-40\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">println</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"&gt;&gt;&gt;&gt;&gt;&gt;cookies:\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-41\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">context</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getCookieStore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getCookies</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">forEach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">println</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-42\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-43\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">finally</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-44\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-45\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">IOException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">printStackTrace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-st\">finally</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-49\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">try</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-50\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">httpClient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-51\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">catch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">IOException</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-52\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">printStackTrace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-53\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd4586810000-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd4586810000-56\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0101 seconds] -->\r\n<p>再次运行，顺利地打印出正确的结果，完美！</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba386676bd9489667266\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt;&gt;&gt;&gt;headers:\r\nDate: Tue, 12 Sep 2017 07:24:10 GMT\r\nContent-Type: text/html\r\nConnection: keep-alive\r\nSet-Cookie: yd_cookie=9f521fc5-0248-4ab3ee650ca50b1c7abb1cd2526b830e620f; Expires=1505208250; Path=/; HttpOnly\r\nCache-Control: no-cache, no-store\r\nServer: WAF/2.4-12.1\r\n&gt;&gt;&gt;&gt;&gt;&gt;cookies:\r\n[version: 0][name: yd_cookie][value: 9f521fc5-0248-4ab3ee650ca50b1c7abb1cd2526b830e620f][domain: www.sth.com][path: /][expiry: Tue Sep 12 17:24:10 CST 2017]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd9489667266-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd9489667266-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd9489667266-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd9489667266-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd9489667266-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd9489667266-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd9489667266-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba386676bd9489667266-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba386676bd9489667266-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba386676bd9489667266-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd9489667266-2\"><span class=\"crayon-v\">Date</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Tue</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Sep</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">24</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GMT</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd9489667266-3\"><span class=\"crayon-v\">Content</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">html</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd9489667266-4\"><span class=\"crayon-v\">Connection</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keep</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">alive</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd9489667266-5\"><span class=\"crayon-v\">Set</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Cookie</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">yd_cookie</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9f521fc5</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0248</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">4ab3ee650ca50b1c7abb1cd2526b830e620f</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Expires</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1505208250</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Path</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HttpOnly</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd9489667266-6\"><span class=\"crayon-v\">Cache</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Control</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">cache</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">store</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd9489667266-7\"><span class=\"crayon-v\">Server</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WAF</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2.4</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">12.1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba386676bd9489667266-8\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-v\">cookies</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59ba386676bd9489667266-9\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">version</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">yd_cookie</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9f521fc5</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0248</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">4ab3ee650ca50b1c7abb1cd2526b830e620f</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">domain</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">www</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">path</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">expiry</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Tue </span><span class=\"crayon-i\">Sep</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">24</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">CST</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>本文也发我的个人博客：<a href=\"http://www.fullstackyang.com/archives/416.html\">fullstackyang</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112469\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112469votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112469\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/2653yy\">fullstackyang</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/2653yy\">\r\n\t\t\t<img src=\"http://tp2.sinaimg.cn/2233098320/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            会当凌绝顶，一览众山小——全栈之路        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/2653yy\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/2653yy/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/2653yy/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 3</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://www.fullstackyang.com\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/2653yy\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "如何向 6 岁的孩子解释何为编程", "url": "http://blog.jobbole.com/112375/", "front_image_url": ["http://wx3.sinaimg.cn/mw690/6941baebly1fjb5w7x6khj208406imx4.jpg"], "praise_nums": "5", "comment_nums": 2, "fav_nums": 2, "tags": "趣文小说,儿童,编程,趣文", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a> 翻译，<a href=\"http://www.jobbole.com/members/young605867996\">Lada</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://dev.to/tkaczanowski/explaining-programming-to-6-years-old-kids\">Tomek Kaczanowski</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>任务：<strong>向一组六岁的孩子解释你的工作（我自己的女儿也在其中）。</strong></p>\n<p>难度等级：高。</p>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/6941baebly1fjb5w7x6khj208406imx4.jpg\"></p>\n<p>关于这个任务/主题，之前网上已有许多人分享了他们对这种“讲座”的想法，你可以在 Stack Overflow 上找到一些非常有趣的例子（例如<a href=\"http://stackoverflow.com/questions/2455786/career-day-in-kindergarten-how-to-demonstrate-programming-in-20-minutes\">这里</a>）。其中许多人的想法是关于<strong>计算机是多么愚蠢</strong>，因为要取得成功，你需要非常准确地告诉它做事的方法和规律。我保证这样很有趣，但我也很怀疑，过后孩子们能对编程有什么了解。</p>\n<p>一个成功的演讲在我心里应该是这样的：</p>\n<ul>\n<li><strong>让他们通过提问和画画来持续参与其中。</strong>我在谈话期间画下的原画（白板纸）相当大。顺便一提，画画是一个能让年轻观众参与进来的好方法（他们玩得很开心，嘲笑代表程序员的稻草人，或者指出<span id=\"0KSFindDIV\" class=\"KSFIND_CLASS\">粉红猪小妹</span>（Peppa Pig）长得不是这样的等等）。我没有原始图纸（忘了拍照），但我又画了一次，让你看到这个想法。</li>\n<li><strong>所有演讲的内容要基于他们已知的事物</strong>（比如：YouTube、笔记本、平板、DVD）。现在每个孩子都在 YouTube 上观看卡通片，在平板上玩游戏，看到爸妈在笔记本上工作。他们也知道电影是保存在 CD/DVD 上的，以及（在涉及游戏和电影时）智能手机和平板非常相似。</li>\n</ul>\n<p>我从一个最基本的问题开始，“<strong>谁知道程序员是做什么的？</strong>”我知道他们昨天讨论过这个问题，所以对他们提出的一些想法，我并不感到惊讶。我给了他们我自己的定义：“程序员是编写计算机程序的人，他们掌握和计算机交流的语言，而且对计算机懂得很多。“</p>\n<p>然后我画了一个工作中的程序员。</p>\n<p><img src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fjb5w8duw2j20dw089glp.jpg\"></p>\n<p>下一步是讨论<strong>计算机</strong>。所有的孩子都开始谈论他们父母的笔记本（他们反复提到同样的东西，这样真的很可爱）。讨论了一段时间后，我打断他们并指出，<strong>在不同地方还有很多计算机</strong>，比如智能手机或手表，还包括汽车和电梯。我把上面提到的每一项都画了出来，并用几个字简单地概述每一种情况下计算机的用途。我还问他们他们如何看待天气预报的工作（这时一个聪明的孩子回答：“卫星知道第二天的天气”），并告诉他们计算机得出的预测，基于上千的测量设备给出的测量结果。</p>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/6941baebly1fjb5w8s86gj20dw0dfaag.jpg\"></p>\n<p>为了转到下一个话题<strong>计算机程序</strong>，我提到计算机之所以能做很多事，要归功于指导它们做这些事情的程序。</p>\n<p>话题随之转向 YouTube，我知道他们很了解它，我从他们熟悉的 UI 开始。</p>\n<p>我问他们 YouTube 上有多少部电影。有些人比较困惑，而有些人高喊“数百万”或“无限”。我问所有的电影是否都可以放在一张光盘上。然后我画出许多光盘，问他们“在给 YouTube 下达观看 《粉红猪小妹》某一集的指令后，你了解它是如何找到那个正确的光盘吗？”他们以沉默回应，所以我画了一个数据库，并快速描述了它的作用。</p>\n<p><img src=\"http://wx1.sinaimg.cn/mw690/6941baebly1fjb5w97wn4j20dw0ftmxv.jpg\"></p>\n<p>我想让他们知道，他们所看到的只是冰山一角，<strong>而程序员们还有很多要做的</strong>。我解释了我们必须如何处理以下各种事情：</p>\n<ul>\n<li>保护电影免受坏人的篡改（“如果有人改变了数据库会发生什么事情，你会看到一些足球比赛，而不是<span id=\"2KSFindDIV\" class=\"KSFIND_CLASS\">粉红猪小妹</span>。”，底下的孩子一片死寂 😁 ）</li>\n<li>制作备份（“一个光盘破裂了怎么办？那你永远不会在<span id=\"3KSFindDIV\" class=\"KSFIND_CLASS_SELECT\">粉红猪小妹</span>中，看到猪爸爸设法挂画这一情节了。“，底下又是一片死寂 😁 ）</li>\n<li>使得 YouTube 可以在不同的设备上运行（智能手机、平板、笔记本）</li>\n<li>展示广告</li>\n<li>计算观看每一部电影的人数</li>\n<li>显示相似电影的缩略图，等等</li>\n</ul>\n<p>这是一个提醒他们<strong>编程是团队合作</strong>的好时机。这些项目很大，需要不同领域的知识，所以很多人都参与了创作。在这一点上，我更新了第一张图，添加了另一个程序员，让他们俩坐得很近。</p>\n<p>下一个主题是<strong>计算机的工作原理</strong>，当然我一笔带过，没有详细展开。我是这样告诉他们的：</p>\n<ul>\n<li>鼠标和键盘是供人们发送命令给计算机的</li>\n<li>计算机屏幕是供计算机响应（命令）的</li>\n<li>每台计算机里都有一个处理器（你可以把它当成计算机的大脑）</li>\n<li>还有一些磁盘允许计算机存储信息</li>\n</ul>\n<p><img src=\"http://wx2.sinaimg.cn/mw690/6941baebly1fjb5wac6g5j20dw0db74q.jpg\"></p>\n<p>我把注意力集中在处理器上，告诉他们计算机使用<strong>一种只包含 0 和 1 的有趣语言</strong>。当我假装只用 A 和 B 开头的词说话时，我们获得了一点乐趣。然后我解释程序员之所以使用编程语言，是为了更容易与处理器沟通对话。</p>\n<p>然后我使用了一些最简单的<strong>编程语言进行示例</strong>（使用一些伪代码）。我本想再给他们看一些东西，但我觉得他们正在失去注意力，所以我甚至没有提出 for 循环。</p>\n<p><img src=\"http://wx4.sinaimg.cn/mw690/6941baebly1fjb5wap1zoj20dw06haa5.jpg\"></p>\n<p>为了完成我的演讲，我再次画出了我们所谈论过的符号。我一个一个地画出来，问他们“这是什么？”、“你还记得什么？”这样的问题。整个过程都非常棒。</p>\n<p><img src=\"http://wx3.sinaimg.cn/mw690/6941baebly1fjb5wb29ncj205k0hcmx8.jpg\"></p>\n<p>额外的说明、注意事项、提示及技巧：</p>\n<ul>\n<li>这比我想象的要<strong>有趣</strong>得多！我认真地对待这件事，进行了很好的准备，结果也得到了回报。孩子们很感兴趣，我想他们可能会记得一些事情。</li>\n<li><strong>画画</strong>是正确的方式。它能抓住他们的注意力。通过指着某一幅画，能让我提醒他们几分钟前我们就此讨论过的事情。</li>\n<li>要做好<strong>一遍遍重复</strong>的准备。当我问他们知道的语言时，一个孩子举起手说：“我知道一点英语”，然后他的同伴也一样，这一个，那一个，然后组里剩下的人一个接一个（或几个同时）举手，但几乎所有人说的都是英语。当你谈到他们喜欢的主题，比如卡通片时，场面会变得更加混乱。</li>\n<li>不管你做什么，有些孩子会变得<strong>无聊</strong>，因为他们的注意力周期实在太短了。</li>\n<li>注意<strong>书写。</strong>举个例子，当你写 1 时，他们会抗议这看起来像 7。</li>\n<li>在这次演讲中，我明白了<strong>纠正他们是毫无意义的</strong>。例如，我认为在他们眼中， YouTube 会将卡通片保存在 DVD 上，当你要求某个卡通片时，计算机会选择正确的光盘并播放。我个人觉得这种想法很好，我想让他们理解的是概念（搜索是怎样的，数据库做什么的），而不是技术细节，这才是我认为正确的方法。</li>\n<li>演讲花了大约 25 分钟，感觉没必要更长了。</li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112375\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112375votetotal\">5</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112375\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">飞哥的咖啡</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/9667abaa540914200edd449974fb5538.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            我见青山多妩媚，料青山见我应如是        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/zhj318\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/zhj318/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/zhj318/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 36</a> · <a title=\"QQ：574375911\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "树形结构数据存储方案（五）：区间嵌套", "url": "http://blog.jobbole.com/112339/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.biaodianfu.com/nested-intervals.html\">标点符</a>   </div><p>前面的一篇文章介绍了<a href=\"http://blog.jobbole.com/112323/\">左右值编码</a>，不知道大家注意到了没有，如果数据庞大，每次更新都需要更新差不多全表，效率较低没有更好的方式？今天我们就来研究下区间嵌套法。</p>\n<p><strong>区间嵌套法原理</strong></p>\n<p>如果节点区间[clft, crgt]与[plft, prgt]存在如下关系：plft &lt;= clft and crgt &gt;= prgt，则[clft, crgt]区间里的点是[plft, prgt]的子节点。基于此假设我们就可以通过对区间的不断的向下划来获取新的区间。举例：如果在区间[plft, prgt]中存在一个空白区间[lft1, rgt1]，如果要加入一个[plft,lft1]、[rgt1,prgt]同级的区间，只需插入节点：[(2*lft1+rgt1)/3,  (rgt1+2*lft)/3]。在添加完节点后我们还留下[lft1,(2*lft1+rgt1)/3]和 [(rgt1+2*lft)/3,rgt1]两个空余的空间用来添加更多的子节点。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/94d451042cd71b68d4b44369f8ecff49.png\" alt=\"nested-intervals\" width=\"575\" height=\"100\">如果我们把区间放在二位平面上，把rgt当成是x轴，lft当做是y轴，纳闷嵌套的区间数差不多是这样的：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/6e99479d95abda03131d9100ec75ec0f.png\" alt=\"nested-intervals-2\" width=\"500\" height=\"500\"></p>\n<p>每个节点[lft, rgt]拥有的子节点都被包含在y &gt;= lft &amp; x &lt;= rgt中。同时y &gt;= clft &amp; x &lt;= crgt所在的空间也是y &gt;= plft  &amp; x &lt;= prgt的子集。另外由于新增的右区间都小于已有的左区间，所以新增的节点均在y=x这条直线以下。</p>\n<p><strong>区间嵌套法实现</strong></p>\n<p>了解了区间嵌套法的原理后，接下来我们就要考虑如何实现他，原则上初始的区间使用任何区间都是可以的，这里我们使用的是[0,1]作为根区间。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/81fa2963538889e727c4b2e0ba0e9df5.png\" alt=\"nested-intervals-3\" width=\"594\" height=\"594\"></p>\n<p>首先，我们在XY平面上定义2个点。深度优先集合点和广度有限集合点，针对点&lt;x=1,y=1/2&gt;的深度优先集合点为&lt;x=1,y=1&gt;，广度优先集合点为&lt;x=1/2,y=1/2&gt;。接下来我们定义第一个子节点的位置为父节点和深度优先集合点的中间点。兄弟节点则为前一个子节点到广度优先集合点的中间点，如上图所示，节点1.2的位置为&lt;x=3/4, y=5/8&gt;。</p>\n<p>另外仔细看我们可以看到点与点之间的关系。另外如果我们知道x和y的和，我们就能反推出x,y的值（具体的逻辑是什么，我现在也还没有搞懂，有知道的朋友可以帮忙解释下）。</p>\n<p>我们以节点&lt;x=3/4, y=5/8&gt;为例，我们可以得到他的和为11/8。</p>\n<p>我们定义11为分子（numerator），8为分母（denominator），则x点的分子为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba63310a02b743638961\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `x_numer`(`numer` int,`denom` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE ret_num INT;\r\n\tDECLARE ret_den INT;\r\n\tSET ret_num := numer+1;\r\n\tSET ret_den := denom*2;\r\n\tWHILE floor(ret_num/2) = ret_num/2 DO\r\n\t\tSET ret_num := ret_num/2;\r\n\t\tSET ret_den := ret_den/2;\r\n\tEND WHILE;\r\n\tRETURN ret_num;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba63310a02b743638961-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a02b743638961-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a02b743638961-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a02b743638961-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a02b743638961-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a02b743638961-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a02b743638961-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a02b743638961-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a02b743638961-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a02b743638961-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a02b743638961-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a02b743638961-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a02b743638961-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba63310a02b743638961-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">x_numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a02b743638961-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a02b743638961-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a02b743638961-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a02b743638961-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a02b743638961-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a02b743638961-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">denom*</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a02b743638961-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a02b743638961-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a02b743638961-10\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a02b743638961-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a02b743638961-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a02b743638961-13\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>x点的分母为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba63310a03a437127563\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `x_ denom`(`numer` int,`denom` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE ret_num INT;\r\n\tDECLARE ret_den INT;\r\n\tSET ret_num := numer+1;\r\n\tSET ret_den := denom*2;\r\n\tWHILE floor(ret_num/2) = ret_num/2 DO\r\n\t\tSET ret_num := ret_num/2;\r\n\t\tSET ret_den := ret_den/2;\r\n\tEND WHILE;\r\n\tRETURN ret_den;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba63310a03a437127563-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a03a437127563-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a03a437127563-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a03a437127563-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a03a437127563-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a03a437127563-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a03a437127563-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a03a437127563-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a03a437127563-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a03a437127563-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a03a437127563-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a03a437127563-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a03a437127563-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba63310a03a437127563-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-e\">x_ </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a03a437127563-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a03a437127563-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a03a437127563-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a03a437127563-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a03a437127563-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a03a437127563-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">denom*</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a03a437127563-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a03a437127563-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a03a437127563-10\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a03a437127563-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a03a437127563-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a03a437127563-13\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>Y点的分子:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba63310a03f836396774\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `y_numer`(`numer` int,`denom` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE num INT;\r\n\tDECLARE den INT;\r\n\tSET num := x_numer(numer, denom);\r\n\tSET den := x_denom(numer, denom);\r\n\tWHILE den &lt; denom DO\r\n\t\tSET num := num*2;\r\n\t\tSET den := den*2;\r\n\tEND WHILE;\r\n\tSET num := (numer - num);\r\n\tWHILE floor(num/2) = num/2 DO\r\n\t\tSET num := num/2;\r\n\t\tSET den := den/2;\r\n\tEND WHILE;\r\n\tRETURN num;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba63310a03f836396774-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a03f836396774-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a03f836396774-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a03f836396774-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a03f836396774-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a03f836396774-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a03f836396774-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a03f836396774-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a03f836396774-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a03f836396774-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a03f836396774-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a03f836396774-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a03f836396774-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a03f836396774-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a03f836396774-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a03f836396774-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a03f836396774-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a03f836396774-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba63310a03f836396774-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">y_numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a03f836396774-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a03f836396774-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a03f836396774-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a03f836396774-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a03f836396774-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">x_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a03f836396774-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">x_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a03f836396774-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">denom </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a03f836396774-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">num*</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a03f836396774-10\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">den*</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a03f836396774-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a03f836396774-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a03f836396774-13\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a03f836396774-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a03f836396774-15\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">den</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a03f836396774-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a03f836396774-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a03f836396774-18\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n<p>Y 的分母：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba63310a042415955331\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `y_denom`(`numer` int,`denom` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE num INT;\r\n\tDECLARE den INT;\r\n\tSET num := x_numer(numer, denom);\r\n\tSET den := x_denom(numer, denom);\r\n\tWHILE den &lt; denom DO\r\n\t\tSET num := num*2;\r\n\t\tSET den := den*2;\r\n\tEND WHILE;\r\n\tSET num := (numer - num);\r\n\tWHILE floor(num/2) = num/2 DO\r\n\t\tSET num := num/2;\r\n\t\tSET den := den/2;\r\n\tEND WHILE;\r\n\tRETURN den;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba63310a042415955331-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a042415955331-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a042415955331-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a042415955331-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a042415955331-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a042415955331-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a042415955331-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a042415955331-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a042415955331-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a042415955331-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a042415955331-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a042415955331-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a042415955331-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a042415955331-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a042415955331-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a042415955331-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a042415955331-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a042415955331-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba63310a042415955331-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">y_denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a042415955331-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a042415955331-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a042415955331-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a042415955331-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a042415955331-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">x_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a042415955331-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">x_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a042415955331-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">denom </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a042415955331-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">num*</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a042415955331-10\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">den*</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a042415955331-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a042415955331-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a042415955331-13\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a042415955331-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a042415955331-15\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">den</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a042415955331-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a042415955331-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a042415955331-18\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p>接下来我们来测试下，X与Y是否能解码出来：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba63310a046328262231\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT\r\n\tCONCAT(x_numer (11, 8),'/',x_denom (11, 8)) AS X,\r\n\tCONCAT(y_numer (11, 8),'/',y_denom (11, 8)) AS Y</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba63310a046328262231-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a046328262231-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a046328262231-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba63310a046328262231-1\"><span class=\"crayon-e\">SELECT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a046328262231-2\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">x_numer</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">x_denom</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a046328262231-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">y_numer</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">y_denom</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Y</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/bbeb82483ee93ccefe1247f25950d91a.png\" alt=\"result\" width=\"232\" height=\"83\"></p>\n<p>结果与节点1.2的位置为&lt;x=3/4, y=5/8&gt;完全一致。现在我们知道只需要一个分数即可表示平面上的一个点。</p>\n<p>如有已经有分数11/8如何获取该节点的父节点？(如果分子为3，则代表其为根节点)</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba63310a049129289747\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `parent_numer`(`numer` int,`denom` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE ret_num INT;\r\n\tDECLARE ret_den INT;\r\n\tIF numer=3 THEN\r\n\t\tRETURN denom/2;\r\n\tEND IF;\r\n\tSET ret_num := (numer-1)/2;\r\n\tSET ret_den := denom/2;\r\n\tWHILE floor((ret_num-1)/4) = (ret_num-1)/4 DO\r\n\t\tSET ret_num := (ret_num+1)/2;\r\n\t\tSET ret_den := ret_den/2;\r\n\tEND WHILE;\r\n\tRETURN ret_num;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba63310a049129289747-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a049129289747-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a049129289747-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a049129289747-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a049129289747-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a049129289747-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a049129289747-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a049129289747-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a049129289747-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a049129289747-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a049129289747-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a049129289747-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a049129289747-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a049129289747-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a049129289747-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a049129289747-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba63310a049129289747-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">parent_numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a049129289747-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a049129289747-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a049129289747-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a049129289747-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a049129289747-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a049129289747-7\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a049129289747-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a049129289747-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a049129289747-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a049129289747-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a049129289747-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a049129289747-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a049129289747-14\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a049129289747-15\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a049129289747-16\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba63310a04c762473807\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT CONCAT(parent_numer(11,8),'/',parent_denom(11,8)) AS parent</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba63310a04c762473807-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba63310a04c762473807-1\"><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">parent_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">parent_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AS</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">parent</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>计算当前节点在同级所在的位置：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba63310a050763145236\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `parent_denom`(`numer` int,`denom` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE ret_num INT;\r\n\tDECLARE ret_den INT;\r\n\tIF numer=3 THEN\r\n\t\tRETURN NULL;\r\n\tEND IF;\r\n\tSET ret_num := (numer-1)/2;\r\n\tSET ret_den := denom/2;\r\n\tWHILE floor((ret_num-1)/4) = (ret_num-1)/4 DO\r\n\t\tSET ret_num := (ret_num+1)/2;\r\n\t\tSET ret_den := ret_den/2;\r\n\tEND WHILE;\r\n\tRETURN ret_den;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba63310a050763145236-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a050763145236-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a050763145236-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a050763145236-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a050763145236-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a050763145236-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a050763145236-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a050763145236-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a050763145236-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a050763145236-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a050763145236-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a050763145236-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a050763145236-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a050763145236-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a050763145236-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a050763145236-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba63310a050763145236-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">parent_denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a050763145236-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a050763145236-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a050763145236-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a050763145236-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a050763145236-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a050763145236-7\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a050763145236-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a050763145236-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a050763145236-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a050763145236-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a050763145236-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a050763145236-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a050763145236-14\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a050763145236-15\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a050763145236-16\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>有了查询父节点的方法及当前节点所在同级中的位置的方法，即可通过这两个的组合，将节点的路径给计算出来。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba63310a055288405212\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `path`(`numer` int,`denom` int)\r\n RETURNS varchar(255)\r\nBEGIN\r\n\tIF numer is NULL THEN\r\n\t\tRETURN '';\r\n\tEND IF;\r\n\tRETURN path(parent_numer(numer, denom),parent_denom(numer, denom))|| ‘.’ || sibling_number(numer, denom);\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba63310a055288405212-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a055288405212-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a055288405212-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a055288405212-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a055288405212-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a055288405212-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a055288405212-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a055288405212-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba63310a055288405212-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a055288405212-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a055288405212-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a055288405212-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">numer </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a055288405212-5\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a055288405212-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a055288405212-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">path</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">parent_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">parent_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span>‘<span class=\"crayon-sy\">.</span>’<span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sibling_number</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a055288405212-8\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>按照以上方法添加后进行测试，返回[Err] 1424 – Recursive stored functions and triggers are not allowed. 即MySQL的自定义函数不支持递归查询。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba63310a059087304218\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `path`(`numer` int,`denom` int)\r\n RETURNS varchar(255)\r\nBEGIN\r\n\tDECLARE numer_temp INT;\r\n\tDECLARE denom_temp INT;\r\n\tDECLARE path_result VARCHAR(255);\r\n\tDECLARE path_temp VARCHAR(255);\r\n\tDECLARE sn VARCHAR(255);\r\n\tSET path_temp := '';\r\n\tWHILE numer IS NOT NULL DO\r\n\t\tIF path_temp = ''\r\n\t\tTHEN\r\n\t\t\tSET path_result := sibling_number(numer, denom);\r\n\t\tELSE\r\n\t\t\tSET path_result := CONCAT(sibling_number(numer, denom),'.',path_temp);\r\n\t\tEND IF;\r\n\t\tSET path_temp := path_result;\r\n\t\tSET numer_temp := parent_numer(numer, denom);\r\n\t\tSET denom_temp := parent_denom(numer, denom);\r\n\t\tSET numer := numer_temp;\r\n\t\tSET denom := denom_temp;\r\n\tEND WHILE;\r\n\tRETURN path_result;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba63310a059087304218-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a059087304218-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a059087304218-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a059087304218-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a059087304218-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a059087304218-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a059087304218-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a059087304218-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a059087304218-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a059087304218-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a059087304218-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a059087304218-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a059087304218-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a059087304218-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a059087304218-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a059087304218-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a059087304218-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a059087304218-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a059087304218-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a059087304218-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a059087304218-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a059087304218-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a059087304218-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a059087304218-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba63310a059087304218-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a059087304218-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a059087304218-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a059087304218-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">numer_temp </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a059087304218-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">denom_temp </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a059087304218-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">path_result </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a059087304218-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">path_temp </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a059087304218-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sn </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a059087304218-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">path_temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a059087304218-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">numer </span><span class=\"crayon-st\">IS</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a059087304218-11\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path_temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a059087304218-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a059087304218-13\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">path_result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sibling_number</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a059087304218-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">ELSE</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a059087304218-15\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">path_result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">sibling_number</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">path_temp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a059087304218-16\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a059087304218-17\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">path_temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path_result</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a059087304218-18\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">numer_temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parent_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a059087304218-19\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">denom_temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parent_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a059087304218-20\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">numer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numer_temp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a059087304218-21\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">denom</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom_temp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a059087304218-22\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a059087304218-23\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path_result</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a059087304218-24\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0042 seconds] -->\r\n<p>SELECT path (11, 8) 的结果为 1.2</p>\n<p>计算节点层级的方法：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba63310a05d152854569\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `node_level`(`numer` int,`denom` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE ret_num INT;\r\n\tDECLARE ret_den INT;\r\n\tDECLARE ret INT;\r\n\tSET ret =1;\r\n\tIF numer=3 THEN\r\n\t\treturn 1;\r\n\tEND IF;\r\n\tWHILE numer!=3 DO\r\n\t\tSET ret_num := parent_numer(numer, denom);\r\n\t\tSET ret_den := parent_denom(numer, denom);\r\n\t\tSET numer := ret_num;\r\n\t\tSET denom := ret_den;\r\n\t\tSET ret := ret + 1;\r\n\tEND WHILE;\r\n\tRETURN ret;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba63310a05d152854569-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a05d152854569-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a05d152854569-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a05d152854569-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a05d152854569-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a05d152854569-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a05d152854569-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a05d152854569-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a05d152854569-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a05d152854569-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a05d152854569-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a05d152854569-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a05d152854569-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a05d152854569-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a05d152854569-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a05d152854569-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a05d152854569-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a05d152854569-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a05d152854569-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba63310a05d152854569-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">node_level</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a05d152854569-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a05d152854569-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a05d152854569-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a05d152854569-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret_den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a05d152854569-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ret </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a05d152854569-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a05d152854569-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a05d152854569-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a05d152854569-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a05d152854569-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">numer</span><span class=\"crayon-o\">!=</span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a05d152854569-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parent_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a05d152854569-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parent_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">numer</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">denom</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a05d152854569-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">numer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_num</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a05d152854569-15\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">denom</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret_den</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a05d152854569-16\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">ret</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a05d152854569-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a05d152854569-18\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ret</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a05d152854569-19\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p>我们知道了如何将编码过的节点转成目录形式，如何逆转呢？以下是方法：</p>\n<p>先添加2个辅助函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba63310a060646466016\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `child_numer`(`num` int,`den` int,`child` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tRETURN num * power(2, child) + 3 - power(2, child);\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba63310a060646466016-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a060646466016-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a060646466016-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a060646466016-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a060646466016-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba63310a060646466016-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">child_numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a060646466016-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a060646466016-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a060646466016-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">num *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">power</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">power</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a060646466016-5\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba63310a063245254560\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `child_denom`(`num` int,`den` int,`child` int)\r\n RETURNS int(11)\r\nBEGIN\r\n\tRETURN den*power(2, child);\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba63310a063245254560-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a063245254560-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a063245254560-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a063245254560-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a063245254560-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba63310a063245254560-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">child_denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a063245254560-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a063245254560-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a063245254560-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">den*</span><span class=\"crayon-e\">power</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">child</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a063245254560-5\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>再来编写逆转函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba63310a066436274159\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `path_numer`(`path` varchar(255))\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE num INT;\r\n\tDECLARE den INT;\r\n\tDECLARE postfix VARCHAR(255);\r\n\tDECLARE sibling VARCHAR(255);\r\n\tSET num := 1;\r\n\tSET den := 1;\r\n\tSET postfix := CONCAT(path,'.');\r\n\tWHILE length(postfix) &gt; 1 DO\r\n\t\tSET sibling := SUBSTR(postfix, 1, instr(postfix,'.')-1);\r\n\t\tSET postfix := SUBSTR(postfix, instr(postfix,'.')+1);\r\n\t\tSET num := child_numer(num,den,sibling+0);\r\n\t\tSET den := child_denom(num,den,sibling+0);\r\n\tEND WHILE;\r\n\tRETURN num;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba63310a066436274159-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a066436274159-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a066436274159-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a066436274159-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a066436274159-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a066436274159-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a066436274159-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a066436274159-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a066436274159-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a066436274159-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a066436274159-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a066436274159-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a066436274159-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a066436274159-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a066436274159-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a066436274159-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a066436274159-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a066436274159-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba63310a066436274159-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">path_numer</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a066436274159-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a066436274159-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a066436274159-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a066436274159-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a066436274159-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">postfix </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a066436274159-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sibling </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a066436274159-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a066436274159-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a066436274159-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">postfix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a066436274159-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a066436274159-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">sibling</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SUBSTR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">instr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a066436274159-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">postfix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SUBSTR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">instr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a066436274159-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">child_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">sibling</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a066436274159-15\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">child_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">sibling</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a066436274159-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a066436274159-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a066436274159-18\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0040 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba63310a06a820075125\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` FUNCTION `path_denom`(`path` varchar(255))\r\n RETURNS int(11)\r\nBEGIN\r\n\tDECLARE num INT;\r\n\tDECLARE den INT;\r\n\tDECLARE postfix VARCHAR(255);\r\n\tDECLARE sibling VARCHAR(255);\r\n\tSET num := 1;\r\n\tSET den := 1;\r\n\tSET postfix := CONCAT(path,'.');\r\n\tWHILE length(postfix) &gt; 1 DO\r\n\t\tSET sibling := SUBSTR(postfix, 1, instr(postfix,'.')-1);\r\n\t\tSET postfix := SUBSTR(postfix, instr(postfix,'.')+1);\r\n\t\tSET num := child_numer(num,den,sibling+0);\r\n\t\tSET den := child_denom(num,den,sibling+0);\r\n\tEND WHILE;\r\n\tRETURN den;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba63310a06a820075125-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a06a820075125-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a06a820075125-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a06a820075125-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a06a820075125-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a06a820075125-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a06a820075125-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a06a820075125-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a06a820075125-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a06a820075125-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a06a820075125-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a06a820075125-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a06a820075125-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a06a820075125-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a06a820075125-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a06a820075125-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ba63310a06a820075125-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba63310a06a820075125-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba63310a06a820075125-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">FUNCTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">path_denom</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a06a820075125-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RETURNS </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a06a820075125-3\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a06a820075125-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">num </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a06a820075125-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">den </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a06a820075125-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">postfix </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a06a820075125-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sibling </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a06a820075125-8\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a06a820075125-9\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a06a820075125-10\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">postfix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a06a820075125-11\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">length</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a06a820075125-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">sibling</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SUBSTR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">instr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a06a820075125-13\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">postfix</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SUBSTR</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">instr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">postfix</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'.'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a06a820075125-14\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">num</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">child_numer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">sibling</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a06a820075125-15\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">den</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">child_denom</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">num</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">sibling</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a06a820075125-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">WHILE</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba63310a06a820075125-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">RETURN</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">den</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba63310a06a820075125-18\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0040 seconds] -->\r\n<p>select CONCAT(path_numer(‘2.1.3′),’/’,path_denom(‘2.1.3’)) 结果为51/64</p>\n<p>参考资料：</p>\n<ul>\n<li>http://www.rampant-books.com/art_vadim_nested_sets_sql_trees.htm</li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112339\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112339votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112339\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "MySQL 8.0.3 RC 版即将发布，看看有哪些变化", "url": "http://blog.jobbole.com/112407/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/e78e36715813f49e9e62fe0c6050075c.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,MySQL,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://dev.mysql.com/doc/relnotes/mysql/8.0/en/\">MySQL</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/news/88499/mysql-8-0-3-rc-coming-soon\">老叶茶馆 微信公众号</a>   </div><p>MySQL 8.0.3 即将发布，一起看看有什么新变化吧</p>\n<p>MySQL 8.0.3 即将发布 RC 版本，这预示着 8.0 版本离 GA 越来越近了。</p>\n<p>下面分享一下 8.0.3 版本的一些重要新特性、新变化：</p>\n<ol class=\" list-paddingleft-2\">\n<li>直接<strong>废除 query cache</strong>（应该只是关闭入口，自行编译源码的话，还能再次启用）</li>\n<li>查询优化器支持直接在 SQL 中利用 <strong>SET_VAR</strong> 这个 HINT 语法修改某些会话级的选项，比如：- SELECT /*+ SET_VAR(sort_buffer_size = 16M) */ name FROM people ORDER BY name;- INSERT /*+ SET_VAR(foreign_key_checks=OFF) */ INTO t2 VALUES(2);\n<p>（这个功能超级实用啊，直接在 SQL 内可以修改了，都不用再写一个 SQL，而且还担心会影响别人）</p></li>\n<li>查询优化器现在支持将各个列统计结果直方图存储在 <strong>column_statistics</strong> 数据字典中，以便构造执行计划。有了这个直方图，就可用于该列和常量的比较判断</li>\n<li>查询优化器中新增标记位 <strong>use_invisible_indexes</strong>，用于控制在构造执行计划时是否考虑不可见索引（invisible indexes）因素</li>\n<li>InnoDB 新增<strong>备份专用锁</strong>，以前 InnoDB 表在线热备时若同时进行 DML 可能导致 InnoDB 文件的快照不一致，有了这个备份锁就不用担心了。备份锁用法是 <strong>LOCK INSTANCE FOR BACKUP、UNLOCK INSTANCE</strong>，需要有 <strong>BACKUP_ADMIN</strong> 权限</li>\n<li>InnoDB 现在支持<strong>表 DDL 的原子性</strong>，也就是 InnoDB 表上的 DDL 也可以实现事务完整性了，要么失败回滚，要么成功提交，不至于出现 DDL 时部分成功的问题，此外还<strong>支持 crash-safe 特性</strong>（这个功能大赞啊）</li>\n<li>若是延迟初始化组复制（GR，Group Replication），也就是在 single-primary 模式下，辅助节点上可以通过异步复制通道写入数据，这在正常初始化组复制插件时是不允许的（Bug #26314756，这是个内部 BUG ID，我们看不到的，别费劲了。不过还有万能的 github 啊，也能看到相关描述，参见：<a title=\"https://github.com/mysql/mysql-server/commit/acbf1d13ecd1d89557f8ca62116f06e8633dc90d\" href=\"https://github.com/mysql/mysql-server/commit/acbf1d13ecd1d89557f8ca62116f06e8633dc90d\" target=\"_blank\">https://github.com/mysql/mysql-server/commit/acbf1d13ecd1d89557f8ca62116f06e8633dc90d</a>）</li>\n<li>系统库 INFORMATION_SCHEMA 中的 <strong>FILES、PARTITIONS、REFERENTIAL_CONSTRAINTS </strong>等几个视图被重新实现了一番（这个没说太具体，可能和所有的 DDL 都放入 InnoDB 有关系，不再使用 FRM 文件存储 DDL 信息）</li>\n<li>由于外键约束锁功能改造，涉及到外键约束的父表上的列改名功能将暂时被禁用一段时间（估计过几个小版本就能正常用了）</li>\n<li>InnoDB 通用表空间新增改名语法：<strong>ALTER TABLESPACE … RENAME TO</strong>（作为 MySQL DBA，貌似没什么人玩通用表空间，可能从 Oracle DBA 转过来更习惯使用吧）</li>\n<li>MySQL 复制的 slave 节点上，<strong>log_slave_updates </strong>选项默认值改为 ON（这个也是比较实用，方便将该 slave 直接作为中继节点使用）</li>\n<li>选项 <strong>sql_log_bin </strong>的全局作用域被改成回话级作用域，也就是修改本选项只影响本会话，不再影响全局（这个选项一般也是在会话级使用）</li>\n<li>选项 <strong>max_allowed_packet </strong>的默认值从 4M 提高到 64M（这个貌似比较实在）</li>\n<li>选项 <strong>event_scheduler </strong>的默认值由 OFF 改成 ON，使得默认启用 event scheduler 功能（我觉得 event 功能挺好的呀，不过貌似没几个人使用 event）</li>\n<li>选项 <strong>max_error_count </strong>的默认值从 64 提高到 1024（没感觉的说）</li>\n<li>最后一个，utf8mb4 字符集增加俄语的校验集（新增 utf8mb4_ru_0900_ai_ci、utf8mb4_ru_0900_as_cs 两种 collations set）</li>\n</ol>\n<p>一起期待 8.0.3 的发布吧！</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112407\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112407votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112407\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "基于 Redis 实现分布式应用限流", "url": "http://blog.jobbole.com/112381/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 2, "tags": "IT技术,Redis,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/giegie/blog/1525931\">冷冷gg</a>   </div><p>限流的目的是通过对并发访问/请求进行限速或者一个时间窗口内的的请求进行限速来保护系统，一旦达到限制速率则可以拒绝服务。</p>\n<p>前几天在DD的公众号，看了一篇关于使用 瓜娃 实现单应用限流的方案，参考《redis in action》 实现了一个jedis版本的，都属于业务层次限制。 实际场景中常用的限流策略：</p>\n<ul>\n<li>Nginx接入层限流<br>\n按照一定的规则如帐号、IP、系统调用逻辑等在Nginx层面做限流</li>\n<li>业务应用系统限流<br>\n通过业务代码控制流量这个流量可以被称为信号量，可以理解成是一种锁，它可以限制一项资源最多能同时被多少进程访问。</li>\n</ul>\n<h3>代码实现</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba632d78971116166838\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport redis.clients.jedis.Jedis;\r\nimport redis.clients.jedis.Transaction;\r\nimport redis.clients.jedis.ZParams;\r\n\r\nimport java.util.List;\r\nimport java.util.UUID;\r\n\r\n/**\r\n * email wangiegie@gmail.com\r\n * @data 2017-08\r\n */\r\npublic class RedisRateLimiter {\r\n    private static final String BUCKET = \"BUCKET\";\r\n    private static final String BUCKET_COUNT = \"BUCKET_COUNT\";\r\n    private static final String BUCKET_MONITOR = \"BUCKET_MONITOR\";\r\n\r\n    static String acquireTokenFromBucket(\r\n            Jedis jedis, int limit, long timeout) {\r\n        String identifier = UUID.randomUUID().toString();\r\n        long now = System.currentTimeMillis();\r\n        Transaction transaction = jedis.multi();\r\n\r\n        //删除信号量\r\n        transaction.zremrangeByScore(BUCKET_MONITOR.getBytes(), \"-inf\".getBytes(), String.valueOf(now - timeout).getBytes());\r\n        ZParams params = new ZParams();\r\n        params.weightsByDouble(1.0,0.0);\r\n        transaction.zinterstore(BUCKET, params, BUCKET, BUCKET_MONITOR);\r\n\r\n        //计数器自增\r\n        transaction.incr(BUCKET_COUNT);\r\n        List&lt;Object&gt; results = transaction.exec();\r\n        long counter = (Long) results.get(results.size() - 1);\r\n\r\n        transaction = jedis.multi();\r\n        transaction.zadd(BUCKET_MONITOR, now, identifier);\r\n        transaction.zadd(BUCKET, counter, identifier);\r\n        transaction.zrank(BUCKET, identifier);\r\n        results = transaction.exec();\r\n        //获取排名，判断请求是否取得了信号量\r\n        long rank = (Long) results.get(results.size() - 1);\r\n        if (rank &lt; limit) {\r\n            return identifier;\r\n        } else {//没有获取到信号量，清理之前放入redis 中垃圾数据\r\n            transaction = jedis.multi();\r\n            transaction.zrem(BUCKET_MONITOR, identifier);\r\n            transaction.zrem(BUCKET, identifier);\r\n            transaction.exec();\r\n        }\r\n        return null;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78971116166838-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78971116166838-51\">51</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">clients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Jedis</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">clients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Transaction</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">clients</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ZParams</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-4\"> </div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-5\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">List</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-6\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">java</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">util</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">UUID</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-8\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-9\"><span class=\"crayon-c\"> * email wangiegie@gmail.com</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-10\"><span class=\"crayon-c\"> * @data 2017-08</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-11\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-12\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedisRateLimiter</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"BUCKET\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BUCKET_COUNT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"BUCKET_COUNT\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">final</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BUCKET_MONITOR</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"BUCKET_MONITOR\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-16\"> </div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">acquireTokenFromBucket</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">limit</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">UUID</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">randomUUID</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toString</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">now</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">System</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">currentTimeMillis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">Transaction </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">multi</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-22\"> </div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//删除信号量</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zremrangeByScore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET_MONITOR</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"-inf\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">valueOf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">now</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getBytes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">ZParams </span><span class=\"crayon-v\">params</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ZParams</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">weightsByDouble</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zinterstore</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BUCKET_MONITOR</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-28\"> </div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//计数器自增</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">incr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET_COUNT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">List</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">Object</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">results</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">size</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">multi</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zadd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET_MONITOR</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zadd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">counter</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zrank</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">results</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//获取排名，判断请求是否取得了信号量</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-t\">long</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rank</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">Long</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">size</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rank</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">limit</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-42\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-c\">//没有获取到信号量，清理之前放入redis 中垃圾数据</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-44\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">multi</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-45\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zrem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET_MONITOR</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-46\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">zrem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">BUCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">identifier</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">transaction</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exec</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78971116166838-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78971116166838-51\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0088 seconds] -->\r\n<p></p>\n<h3>调用</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba632d78989459631808\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n测试接口调用\r\n@GetMapping(\"/\")\r\npublic void index(HttpServletResponse response) throws IOException {\r\n    Jedis jedis = jedisPool.getResource();\r\n    String token = RedisRateLimiter.acquireTokenFromBucket(jedis, LIMIT, TIMEOUT);\r\n    if (token == null) {\r\n        response.sendError(500);\r\n    }else{\r\n        //TODO 你的业务逻辑\r\n    }\r\n    jedisPool.returnResource(jedis);\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba632d78989459631808-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78989459631808-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78989459631808-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78989459631808-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78989459631808-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78989459631808-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78989459631808-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78989459631808-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78989459631808-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78989459631808-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78989459631808-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78989459631808-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78989459631808-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba632d78989459631808-1\">测试接口调用</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78989459631808-2\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">GetMapping</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78989459631808-3\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">HttpServletResponse </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IOException</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78989459631808-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78989459631808-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RedisRateLimiter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">acquireTokenFromBucket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LIMIT</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TIMEOUT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78989459631808-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78989459631808-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">500</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78989459631808-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78989459631808-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//TODO 你的业务逻辑</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78989459631808-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78989459631808-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">returnResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78989459631808-12\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78989459631808-13\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p></p>\n<h2>优化</h2>\n<p>使用拦截器 + 注解优化代码</p>\n<h3>拦截器</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba632d7898e237247428\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@Configuration\r\nstatic class WebMvcConfigurer extends WebMvcConfigurerAdapter {\r\n    private Logger logger = LoggerFactory.getLogger(WebMvcConfigurer.class);\r\n    @Autowired\r\n    private JedisPool jedisPool;\r\n\r\n    public void addInterceptors(InterceptorRegistry registry) {\r\n        registry.addInterceptor(new HandlerInterceptorAdapter() {\r\n            public boolean preHandle(HttpServletRequest request, HttpServletResponse response,\r\n                                     Object handler) throws Exception {\r\n                HandlerMethod handlerMethod = (HandlerMethod) handler;\r\n                Method method = handlerMethod.getMethod();\r\n                RateLimiter rateLimiter = method.getAnnotation(RateLimiter.class);\r\n\r\n                if (rateLimiter != null){\r\n                    int limit = rateLimiter.limit();\r\n                    int timeout = rateLimiter.timeout();\r\n                    Jedis jedis = jedisPool.getResource();\r\n                    String token = RedisRateLimiter.acquireTokenFromBucket(jedis, limit, timeout);\r\n                    if (token == null) {\r\n                        response.sendError(500);\r\n                        return false;\r\n                    }\r\n                    logger.debug(\"token -&gt; {}\",token);\r\n                    jedis.close();\r\n                }\r\n                return true;\r\n            }\r\n        }).addPathPatterns(\"/*\");\r\n    }\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba632d7898e237247428-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d7898e237247428-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d7898e237247428-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d7898e237247428-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d7898e237247428-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d7898e237247428-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d7898e237247428-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d7898e237247428-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d7898e237247428-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d7898e237247428-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d7898e237247428-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d7898e237247428-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d7898e237247428-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d7898e237247428-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d7898e237247428-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d7898e237247428-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d7898e237247428-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d7898e237247428-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d7898e237247428-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d7898e237247428-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d7898e237247428-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d7898e237247428-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d7898e237247428-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d7898e237247428-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d7898e237247428-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d7898e237247428-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d7898e237247428-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d7898e237247428-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d7898e237247428-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d7898e237247428-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d7898e237247428-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d7898e237247428-32\">32</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba632d7898e237247428-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Configuration</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d7898e237247428-2\"><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WebMvcConfigurer</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WebMvcConfigurerAdapter</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d7898e237247428-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Logger </span><span class=\"crayon-v\">logger</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LoggerFactory</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getLogger</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">WebMvcConfigurer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">class</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d7898e237247428-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Autowired</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d7898e237247428-5\"><span class=\"crayon-e\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">JedisPool </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d7898e237247428-6\"> </div><div class=\"crayon-line\" id=\"crayon-59ba632d7898e237247428-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">addInterceptors</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">InterceptorRegistry </span><span class=\"crayon-v\">registry</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d7898e237247428-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">registry</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addInterceptor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HandlerInterceptorAdapter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d7898e237247428-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">preHandle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">HttpServletRequest </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HttpServletResponse </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d7898e237247428-10\"><span class=\"crayon-h\">                                     </span><span class=\"crayon-t\">Object</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handler</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d7898e237247428-11\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">HandlerMethod </span><span class=\"crayon-v\">handlerMethod</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HandlerMethod</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handler</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d7898e237247428-12\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">Method </span><span class=\"crayon-v\">method</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handlerMethod</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getMethod</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d7898e237247428-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">RateLimiter </span><span class=\"crayon-v\">rateLimiter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">method</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getAnnotation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">RateLimiter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">class</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d7898e237247428-14\"> </div><div class=\"crayon-line\" id=\"crayon-59ba632d7898e237247428-15\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rateLimiter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d7898e237247428-16\"><span class=\"crayon-h\">                    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">limit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rateLimiter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">limit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d7898e237247428-17\"><span class=\"crayon-h\">                    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rateLimiter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">timeout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d7898e237247428-18\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">Jedis </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jedisPool</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getResource</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d7898e237247428-19\"><span class=\"crayon-h\">                    </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">RedisRateLimiter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">acquireTokenFromBucket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">limit</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d7898e237247428-20\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">token</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d7898e237247428-21\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">500</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d7898e237247428-22\"><span class=\"crayon-h\">                        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d7898e237247428-23\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d7898e237247428-24\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">debug</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"token -&gt; {}\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">token</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d7898e237247428-25\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">jedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d7898e237247428-26\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d7898e237247428-27\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d7898e237247428-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d7898e237247428-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addPathPatterns</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/*\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d7898e237247428-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d7898e237247428-31\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d7898e237247428-32\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0055 seconds] -->\r\n<p></p>\n<h3>定义注解</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba632d78992476773683\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/**\r\n * email wangiegie@gmail.com\r\n * @data 2017-08\r\n * 限流注解\r\n */\r\n\r\n@Target(ElementType.METHOD)\r\n@Retention(RetentionPolicy.RUNTIME)\r\n@Documented\r\npublic @interface RateLimiter {\r\n    int limit() default 5;\r\n    int timeout() default 1000;\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba632d78992476773683-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78992476773683-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78992476773683-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78992476773683-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78992476773683-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78992476773683-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78992476773683-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78992476773683-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78992476773683-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78992476773683-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78992476773683-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78992476773683-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78992476773683-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78992476773683-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba632d78992476773683-1\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78992476773683-2\"><span class=\"crayon-c\"> * email wangiegie@gmail.com</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78992476773683-3\"><span class=\"crayon-c\"> * @data 2017-08</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78992476773683-4\"><span class=\"crayon-c\"> * 限流注解</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78992476773683-5\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78992476773683-6\"> </div><div class=\"crayon-line\" id=\"crayon-59ba632d78992476773683-7\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Target</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ElementType</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">METHOD</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78992476773683-8\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Retention</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">RetentionPolicy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">RUNTIME</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78992476773683-9\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">Documented</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78992476773683-10\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-t\">interface</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RateLimiter</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78992476773683-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">limit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">default</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78992476773683-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">timeout</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">default</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78992476773683-13\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78992476773683-14\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p></p>\n<h3>使用</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba632d78995646587118\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@RateLimiter(limit = 2, timeout = 5000)\r\n@GetMapping(\"/test\")\r\npublic void test() {\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba632d78995646587118-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78995646587118-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78995646587118-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba632d78995646587118-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba632d78995646587118-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba632d78995646587118-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">RateLimiter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">limit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5000</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78995646587118-2\"><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">GetMapping</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/test\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78995646587118-3\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">test</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba632d78995646587118-4\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59ba632d78995646587118-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<h2>并发测试</h2>\n<p>工具：apache-jmeter-3.2<br>\n说明： 没有获取到信号量的接口返回500，status是红色，获取到信号量的接口返回200，status是绿色。<br>\n当限制请求信号量为2，并发5个线程： <img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/88fe4ce72def9cd9bcb4ddcc1185200e.png\" alt=\"image\"><br>\n当限制请求信号量为5，并发10个线程：<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/d92c4624c99f43a7093aa4fe92b7a112.png\" alt=\"image\"></p>\n<h2>资料</h2>\n<p><a href=\"https://github.com/tangaiyun/RedisRateLimiter\">基于reids + lua的实现</a></p>\n<h2>总结</h2>\n<ol>\n<li>对于信号量的操作，使用事务操作。</li>\n<li>不要使用时间戳作为信号量的排序分数，因为在分布式环境中，各个节点的时间差的原因，会出现不公平信号量的现象。</li>\n<li>可以使用把这块代码抽成@rateLimiter注解，然后再方法上使用就会很方便啦</li>\n<li>不同接口的流控，可以参考源码的里面RedisRateLimiterPlus,无非是每个接口生成一个监控参数</li>\n<li>源码<a href=\"http://git.oschina.net/boding1/pig-cloud\">http://git.oschina.net/boding1/pig-cloud</a></li>\n</ol>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112381\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112381votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112381\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "Linux 系统开机启动项清理", "url": "http://blog.jobbole.com/112384/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 3, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.linux.com/learn/cleaning-your-linux-startup-process\">David Both</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8835-1.html\">Linux中国/penghuster</a>   </div><p>一般情况下，常规用途的 Linux 发行版在开机启动时拉起各种相关服务进程，包括许多你可能无需使用的服务，例如蓝牙bluetooth、Avahi、 调制解调管理器ModemManager、ppp-dns（LCTT 译注：此处作者笔误 ppp-dns 应该为 pppd-dns) 等服务进程，这些都是什么东西？用于哪里，有何功能？</p>\n<p>Systemd 提供了许多很好的工具用于查看系统启动情况，也可以控制在系统启动时运行什么。在这篇文章中，我将说明在 Systemd 类发行版中如何关闭一些令人讨厌的进程。</p>\n<h3 id=\"toc_1\">查看开机启动项</h3>\n<p>在过去，你能很容易通过查看 <code>/etc/init.d</code> 了解到哪些服务进程会在引导时启动。Systemd 以不同的方式展现，你可以使用如下命令罗列允许开机启动的服务进程。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba628acb001003315367\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ systemctl list-unit-files --type=service | grep enabled\r\naccounts-daemon.service                    enabled\r\nanacron-resume.service                     enabled\r\nanacron.service                            enabled\r\nbluetooth.service                          enabled\r\nbrltty.service                             enabled\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba628acb001003315367-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb001003315367-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb001003315367-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb001003315367-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb001003315367-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb001003315367-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb001003315367-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb001003315367-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba628acb001003315367-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-v\">list</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">unit</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">files</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">service</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">grep </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb001003315367-2\"><span class=\"crayon-v\">accounts</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">daemon</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                    </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line\" id=\"crayon-59ba628acb001003315367-3\"><span class=\"crayon-v\">anacron</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">resume</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                     </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb001003315367-4\"><span class=\"crayon-v\">anacron</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                            </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line\" id=\"crayon-59ba628acb001003315367-5\"><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                          </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb001003315367-6\"><span class=\"crayon-v\">brltty</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                             </span><span class=\"crayon-i\">enabled</span></div><div class=\"crayon-line\" id=\"crayon-59ba628acb001003315367-7\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb001003315367-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>在此列表顶部，对我来说，蓝牙服务是冗余项，因为在该电脑上我不需要使用蓝牙功能，故无需运行此服务。下面的命令将停止该服务进程，并且使其开机不启动。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba628acb00b541497060\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo systemctl stop bluetooth.service\r\n$ sudo systemctl disable bluetooth.service\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba628acb00b541497060-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb00b541497060-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb00b541497060-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba628acb00b541497060-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-e\">stop </span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb00b541497060-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-e\">disable </span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59ba628acb00b541497060-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>你可以通过下面命令确定是否操作成功。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba628acb00f098031306\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ systemctl status bluetooth.service\r\n bluetooth.service - Bluetooth service\r\n  Loaded: loaded (/lib/systemd/system/bluetooth.service; disabled; vendor preset: enabled)\r\n  Active: inactive (dead)\r\n    Docs: man:bluetoothd(8)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba628acb00f098031306-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb00f098031306-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb00f098031306-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb00f098031306-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb00f098031306-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb00f098031306-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba628acb00f098031306-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-e\">status </span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb00f098031306-2\"><span class=\"crayon-e\"> </span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">service</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Bluetooth </span><span class=\"crayon-e\">service</span></div><div class=\"crayon-line\" id=\"crayon-59ba628acb00f098031306-3\"><span class=\"crayon-e\">  </span><span class=\"crayon-v\">Loaded</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">loaded</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">system</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">service</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">disabled</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">vendor </span><span class=\"crayon-v\">preset</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">enabled</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb00f098031306-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">Active</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">inactive</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dead</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba628acb00f098031306-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">Docs</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">man</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">bluetoothd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb00f098031306-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>停用的服务进程仍然能够被另外一个服务进程启动。如果你真的想在任何情况下系统启动时都不启动该进程，无需卸载该它，只需要把它掩盖起来就可以阻止该进程在任何情况下开机启动。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba628acb013149264678\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo systemctl mask bluetooth.service\r\n Created symlink from /etc/systemd/system/bluetooth.service to /dev/null.\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba628acb013149264678-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb013149264678-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb013149264678-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba628acb013149264678-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-e\">mask </span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb013149264678-2\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">Created </span><span class=\"crayon-e\">symlink </span><span class=\"crayon-v\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">system</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bluetooth</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59ba628acb013149264678-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>一旦你对禁用该进程启动而没有出现负面作用感到满意，你也可以选择卸载该程序。</p>\n<p>通过执行命令可以获得如下服务列表：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba628acb017205939606\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ systemctl list-unit-files --type=service                       \r\nUNIT FILE                                  STATE   \r\naccounts-daemon.service                    enabled\r\nacpid.service                              disabled\r\nalsa-restore.service                       static    \r\nalsa-utils.service                         masked\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba628acb017205939606-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb017205939606-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb017205939606-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb017205939606-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb017205939606-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb017205939606-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb017205939606-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba628acb017205939606-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">systemctl </span><span class=\"crayon-v\">list</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">unit</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">files</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">service                       </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb017205939606-2\"><span class=\"crayon-e\">UNIT </span><span class=\"crayon-e\">FILE                                  </span><span class=\"crayon-e\">STATE   </span></div><div class=\"crayon-line\" id=\"crayon-59ba628acb017205939606-3\"><span class=\"crayon-v\">accounts</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">daemon</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                    </span><span class=\"crayon-e\">enabled</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb017205939606-4\"><span class=\"crayon-v\">acpid</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                              </span><span class=\"crayon-e\">disabled</span></div><div class=\"crayon-line\" id=\"crayon-59ba628acb017205939606-5\"><span class=\"crayon-v\">alsa</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">restore</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                       </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb017205939606-6\"><span class=\"crayon-v\">alsa</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">utils</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">service                         </span><span class=\"crayon-i\">masked</span></div><div class=\"crayon-line\" id=\"crayon-59ba628acb017205939606-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>你不能启用或禁用静态服务，因为静态服务被其他的进程所依赖，并不意味着它们自己运行。</p>\n<h3 id=\"toc_2\">哪些服务能够禁止？</h3>\n<p>如何知道你需要哪些服务，而哪些又是可以安全地禁用的呢？它总是依赖于你的个性化需求。</p>\n<p>这里举例了几个服务进程的作用。许多服务进程都是发行版特定的，所以你应该看看你的发行版文档（比如通过 google 或 StackOverflow）。</p>\n<ul>\n<li><strong>accounts-daemon.service</strong> 是一个潜在的安全风险。它是 AccountsService 的一部分，AccountsService 允许程序获得或操作用户账户信息。我不认为有好的理由能使我允许这样的后台操作，所以我选择掩盖mask该服务进程。</li>\n<li><strong>avahi-daemon.service</strong> 用于零配置网络发现，使电脑超容易发现网络中打印机或其他的主机，我总是禁用它，别漏掉它。</li>\n<li><strong>brltty.service</strong> 提供布莱叶盲文设备支持，例如布莱叶盲文显示器。</li>\n<li><strong>debug-shell.service</strong> 开放了一个巨大的安全漏洞（该服务提供了一个无密码的 root shell ，用于帮助 调试 systemd 问题），除非你正在使用该服务，否则永远不要启动服务。</li>\n<li><strong>ModemManager.service</strong> 该服务是一个被 dbus 激活的守护进程，用于提供移动宽频broadband（2G/3G/4G）接口，如果你没有该接口，无论是内置接口，还是通过如蓝牙配对的电话，以及 USB 适配器，那么你也无需该服务。</li>\n<li><strong>pppd-dns.service</strong> 是一个计算机发展的遗物，如果你使用拨号接入互联网的话，保留它，否则你不需要它。</li>\n<li><strong>rtkit-daemon.service</strong> 听起来很可怕，听起来像是 rootkit。 但是你需要该服务，因为它是一个实时内核调度器real-time kernel scheduler。</li>\n<li><strong>whoopsie.service</strong> 是 Ubuntu 错误报告服务。它用于收集 Ubuntu 系统崩溃报告，并发送报告到 <a href=\"https://daisy.ubuntu.com\">https://daisy.ubuntu.com</a> 。 你可以放心地禁止其启动，或者永久的卸载它。</li>\n<li><strong>wpa_supplicant.service</strong> 仅在你使用 Wi-Fi 连接时需要。</li>\n</ul>\n<h3 id=\"toc_3\">系统启动时发生了什么？</h3>\n<p>Systemd 提供了一些命令帮助调试系统开机启动问题。该命令会重演你的系统启动的所有消息。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba628acb01b898833933\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ journalctl -b\r\n\r\n-- Logs begin at Mon 2016-05-09 06:18:11 PDT,\r\nend at Mon 2016-05-09 10:17:01 PDT. --\r\nMay 16 06:18:11 studio systemd-journal[289]:\r\nRuntime journal (/run/log/journal/) is currently using 8.0M.\r\nMaximum allowed usage is set to 157.2M.\r\nLeaving at least 235.9M free (of currently available 1.5G of space).\r\nEnforced usage limit is thus 157.2M.\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba628acb01b898833933-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb01b898833933-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb01b898833933-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb01b898833933-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb01b898833933-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb01b898833933-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb01b898833933-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb01b898833933-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb01b898833933-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb01b898833933-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb01b898833933-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba628acb01b898833933-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">journalctl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">b</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb01b898833933-2\"> </div><div class=\"crayon-line\" id=\"crayon-59ba628acb01b898833933-3\"><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Logs </span><span class=\"crayon-e\">begin </span><span class=\"crayon-e\">at </span><span class=\"crayon-i\">Mon</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2016</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">05</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">09</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PDT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb01b898833933-4\"><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">at </span><span class=\"crayon-i\">Mon</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2016</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">05</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">09</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PDT</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line\" id=\"crayon-59ba628acb01b898833933-5\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">journal</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">289</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb01b898833933-6\"><span class=\"crayon-e\">Runtime </span><span class=\"crayon-e\">journal</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">run</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">journal</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">currently </span><span class=\"crayon-i\">using</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8.0M.</span></div><div class=\"crayon-line\" id=\"crayon-59ba628acb01b898833933-7\"><span class=\"crayon-e\">Maximum </span><span class=\"crayon-e\">allowed </span><span class=\"crayon-e\">usage </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">157.2M.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb01b898833933-8\"><span class=\"crayon-e\">Leaving </span><span class=\"crayon-e\">at </span><span class=\"crayon-i\">least</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">235.9M</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">free</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">currently </span><span class=\"crayon-i\">available</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.5G</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">of </span><span class=\"crayon-v\">space</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59ba628acb01b898833933-9\"><span class=\"crayon-e\">Enforced </span><span class=\"crayon-e\">usage </span><span class=\"crayon-e\">limit </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">thus</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">157.2M.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb01b898833933-10\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59ba628acb01b898833933-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>通过命令 <code>journalctl -b -1</code> 可以复审前一次启动，<code>journalctl -b -2</code> 可以复审倒数第 2 次启动，以此类推。</p>\n<p>该命令会打印出大量的信息，你可能并不关注所有信息，只是关注其中问题相关部分。为此，系统提供了几个过滤器，用于帮助你锁定目标。让我们以进程号为 1 的进程为例，该进程是所有其它进程的父进程。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba628acb01f916206134\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ journalctl _PID=1\r\n\r\nMay 08 06:18:17 studio systemd[1]: Starting LSB: Raise network interfaces....\r\nMay 08 06:18:17 studio systemd[1]: Started LSB: Raise network interfaces..\r\nMay 08 06:18:17 studio systemd[1]: Reached target System Initialization.\r\nMay 08 06:18:17 studio systemd[1]: Started CUPS Scheduler.\r\nMay 08 06:18:17 studio systemd[1]: Listening on D-Bus System Message Bus Socket\r\nMay 08 06:18:17 studio systemd[1]: Listening on CUPS Scheduler.\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba628acb01f916206134-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb01f916206134-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb01f916206134-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb01f916206134-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb01f916206134-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb01f916206134-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb01f916206134-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb01f916206134-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb01f916206134-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb01f916206134-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba628acb01f916206134-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">journalctl </span><span class=\"crayon-v\">_PID</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb01f916206134-2\"> </div><div class=\"crayon-line\" id=\"crayon-59ba628acb01f916206134-3\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Starting </span><span class=\"crayon-v\">LSB</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Raise </span><span class=\"crayon-e\">network </span><span class=\"crayon-v\">interfaces</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb01f916206134-4\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Started </span><span class=\"crayon-v\">LSB</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Raise </span><span class=\"crayon-e\">network </span><span class=\"crayon-v\">interfaces</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59ba628acb01f916206134-5\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Reached </span><span class=\"crayon-e\">target </span><span class=\"crayon-e\">System </span><span class=\"crayon-v\">Initialization</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb01f916206134-6\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Started </span><span class=\"crayon-e\">CUPS </span><span class=\"crayon-v\">Scheduler</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59ba628acb01f916206134-7\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Listening </span><span class=\"crayon-i\">on</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">D</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Bus </span><span class=\"crayon-e\">System </span><span class=\"crayon-e\">Message </span><span class=\"crayon-e\">Bus </span><span class=\"crayon-e\">Socket</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb01f916206134-8\"><span class=\"crayon-i\">May</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">studio </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Listening </span><span class=\"crayon-e\">on </span><span class=\"crayon-e\">CUPS </span><span class=\"crayon-v\">Scheduler</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59ba628acb01f916206134-9\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb01f916206134-10\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0033 seconds] -->\r\n<p>这些打印消息显示了什么被启动，或者是正在尝试启动。</p>\n<p>一个最有用的命令工具之一 <code>systemd-analyze blame</code>，用于帮助查看哪个服务进程启动耗时最长。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba628acb023579732118\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ systemd-analyze blame\r\n         8.708s gpu-manager.service\r\n         8.002s NetworkManager-wait-online.service\r\n         5.791s mysql.service\r\n         2.975s dev-sda3.device\r\n         1.810s alsa-restore.service\r\n         1.806s systemd-logind.service\r\n         1.803s irqbalance.service\r\n         1.800s lm-sensors.service\r\n         1.800s grub-common.service\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba628acb023579732118-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb023579732118-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb023579732118-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb023579732118-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb023579732118-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb023579732118-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb023579732118-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb023579732118-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb023579732118-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba628acb023579732118-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba628acb023579732118-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba628acb023579732118-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">analyze </span><span class=\"crayon-i\">blame</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb023579732118-2\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">8.708s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gpu</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">manager</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59ba628acb023579732118-3\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">8.002s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">NetworkManager</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">wait</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">online</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb023579732118-4\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">5.791s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mysql</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59ba628acb023579732118-5\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">2.975s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sda3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">device</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb023579732118-6\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1.810s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">alsa</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">restore</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59ba628acb023579732118-7\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1.806s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">logind</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb023579732118-8\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1.803s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">irqbalance</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59ba628acb023579732118-9\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1.800s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lm</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sensors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba628acb023579732118-10\"><span class=\"crayon-h\">         </span><span class=\"crayon-cn\">1.800s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">grub</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">common</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">service</span></div><div class=\"crayon-line\" id=\"crayon-59ba628acb023579732118-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>这个特定的例子没有出现任何异常，但是如果存在系统启动瓶颈，则该命令将能发现它。</p>\n<p>你也能通过如下资源了解 Systemd 如何工作：</p>\n<ul>\n<li><a href=\"https://www.linux.com/learn/understanding-and-using-systemd\">理解和使用 Systemd</a></li>\n<li><a href=\"https://www.linux.com/learn/intro-systemd-runlevels-and-service-management-commands\">介绍 Systemd 运行级别和服务管理命令</a></li>\n<li><a href=\"https://www.linux.com/learn/here-we-go-again-another-linux-init-intro-systemd\">再次前行，另一个 Linux 初始化系统：Systemd 介绍</a></li>\n</ul>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112384\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112384votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112384\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "100:10:1方法 : 我是这样参与开源的", "url": "http://blog.jobbole.com/112320/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/09/f1a3d556b79a7fae23ad3ecc6f972164.jpg"], "praise_nums": "2", "comment_nums": 1, "fav_nums": 4, "tags": "IT技术,开源", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/q1857502771\">暖日生烟</a> 翻译，<a href=\"http://www.jobbole.com/members/young605867996\">Lada</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://blog.fogus.me/2015/11/04/the-100101-method-my-approach-to-open-source/\">Michael Fogus</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【导读】：据本文作者 Michael Fogus 博客上的简介，他是一位 Clojure 开发者和狂热用户，并且是 Clojure 的贡献者（Clojure 本身也是一个开源项目）。平常在 Clojure 和 ClojureScript 花费时间很多。他喜欢棒球、象棋、哲学、恐怖电影、阅读和写作。出过两本书《Functional JavaScript》和《The joy of Clojure》。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fjbxewni6rj206y06ymx6.jpg\" width=\"250\" height=\"250\"></p>\n<hr>\n<p>许多年里我一直全心投入于开源运动，不过那时候我很少在空闲时写代码，在 Sourceforge、GoogleCode、GitHub 之类的代码托管平台，也找不到我的项目（repo）。<sup>【1】</sup>然而随着时间流逝，我逐渐意识到向全球公开代码的责任，毫不夸张的说，这吸引住了我。</p>\n<p>除了很多“已发布”的代码是低水准的这一事实之外，无论<a href=\"https://en.wikipedia.org/wiki/Authorial_intent\">有意</a>与<a href=\"https://en.wikipedia.org/wiki/Reader-response_criticism\">否</a>，将代码公布于众的行为意味着与某些人签订契约<sup>【2】</sup>，这些人可以为自己的目的使用公开的代码。当然，我并不一定反对这种社会契约，相反，在发布代码的时候我最终改变了主意，以致于我在我的方法中变得更保守了。这个我现在正在使用的方法叫做“100:10:1 方法”，此术语是由开发者 Nick Bentley 创造。<sup>【3】</sup></p>\n<h3>100:10:1 方法究竟是什么？</h3>\n<p>我不会重复赘述此方法的细节，你可以通过阅读 《<a href=\"https://nickbentleygames.wordpress.com/2014/05/12/the-100-10-1-method-for-game-design/\" target=\"_blank\">The 100:10:1 method – the heart of my game design process</a>》来了解。但我会试着从我的开源软件开发方法这一背景下来概括它。</p>\n<p>具体操作分三部分，步骤如下：</p>\n<h3>写下 100 种疯狂的想法</h3>\n<p>首先，准备一本笔记本和一支笔，为开发有意思的开源项目写下 100 种想法即可。这些有关项目的想法可以涉及各种主题，深度和质量。我想过的有，野生语言的创意、已有项目的新功能、系统设计、协议、缺损文件、有趣的 forks、代码简化、游戏、原型、论文想法的实现、第二个系统等等。</p>\n<p><img class=\"aligncenter\" src=\"http://wx2.sinaimg.cn/mw690/a17d6bb7gy1fisza9ufvoj208c03b3yl.jpg\"></p>\n<p>在使用 100:10:1 方法之前，我总是会用疯狂的想法填满我的笔记本。它们通常是东一点西一点，从不会聚集在一个地方。在几页纸上写下这 100个想法后，我的注意力立马集中在它们身上。这样我就可以好好筛选比较为第二步做准备。</p>\n<h3><span id=\"pos_placeholder\" style=\"width: 0px; height: 0px; margin: 0px; padding: 0px;\"></span>为这 10 个想法创造最小可行性产品（MVP）</h3>\n<p>我面前的这 100 个想法，让我了解到我不止当时对追求它们充满兴趣，并且我感觉它们可以使我和他人同时获益。<sup>【4】</sup>从原始的 100 个想法里，我挑出了确定想探索和专研下去的 10 个。在这 10 个项目里，我挑不出一个更好的了，因此我想同时为它们各自编写一个最小可行“项目”。</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/a17d6bb7gy1fisza9oxcdj208c04pjrl.jpg\" width=\"300\" height=\"169\"></p>\n<p>你可能马上会想到同时开发 10 个项目这件事本身就是一个负担。这不能说是一个错误的评估。然而，我意识到对于我选择的大多数项目，要找到最可行的实现方式是非常难的，如果有也得耗费几个月甚至数年时间。你看，我曾一度认为发布开源软件是把潜在可用的工具给予他人的一种方法。很遗憾的是，随着时间推移，这个观点已经退化到能做到将代码公开就不错了。我现在的想法是，在业余时间写代码仅仅是一个探索，有没有结果也无所谓了。</p>\n<p>同时开发 10 个项目有个好处就是，当我在一个上遇到了瓶颈可以轻易的转移到另一个更有灵感的项目去。作为一个除编程外拥有丰富爱好、社区和家庭生活的人，用一堆选择来对抗我的三分钟热度无疑是非常有用的。拥有 10 个并行的项目意味着总有一个能让我在短时间内感兴趣。我知道当所有兴趣集中在一个任务上时，工作会变的更有效率。无论怎样最后总有一个项目会见到希望<sup>【5】</sup>，当它到来时我已经准备好了进入最后一个阶段。</p>\n<h3>全力开发选中的项目，使其成为一个可以合法发布的软件</h3>\n<p>在开发 10 个项目的过程中，其中一个不可避免会成为有价值的东西。<sup>【6】</sup>万事俱备后，我会将其变为一个高质量的软件产品。<sup>【7】</sup>这意味着要完成所有内容，确保一个健壮的系统，有可靠的例子、测试、文档、稳定的API、博客文章或演讲，甚至可能有网络。<sup>【8】</sup></p>\n<p><img class=\"aligncenter\" src=\"http://wx3.sinaimg.cn/mw690/a17d6bb7gy1fiszaa656cj206004c3yj.jpg\" width=\"216\" height=\"156\"></p>\n<p>在此之前为了我自己而开发的项目，可能要经历大量的工作才能使其成为值得与他人分享的东西。这当然取决于软件本身的复杂度，很可能最后一步要花最长的时间来完成。同样最后阶段也是我最容易彻底放弃的时候。因为我发现了一个大麻烦，如果我不愿为我的代码写文档、例子和测试的话，在未来的数十年想要维护它是根本不可能的。</p>\n<h3>总结</h3>\n<p>这个方法我已经用了一段时间，在此之前，使用类似的方法同样取得了不错的成果。Zeder 和 Patagonia 也是用 100:10:1 方法或类似方法进行开发的。我现在有的一个叫 Tathata 的 Clojure 库，即将进入最后阶段。或许 10 个项目<sup>【9】</sup>里会有一个成功，不过即使失败了，我还会再挑选更多的 10 个去尝试。</p>\n<p><img class=\"aligncenter\" src=\"http://wx4.sinaimg.cn/mw690/a17d6bb7gy1fiszaaj4n9j208c04rt9y.jpg\" width=\"300\" height=\"171\"></p>\n<p>我有足够的时间，准确的说是一辈子。:F</p>\n<p>感谢 Carin Meier、Rich Hickey、Justin Gehtland 和 Paul deGrandis 阅读，并为这篇文章提供修改意见。</p>\n<hr>\n<p>1.事实证明，我的其他爱好(游戏设计、Sabremetrics、写作等)在过去也有类似的趋势，但就像开源编码一样，它们也已经达到100:10:1的理想状态。</p>\n<p>2.不幸的是，人们似乎也倾向于将开源视为一种道德声明。</p>\n<p>3.“100:10:1 方法”这个名字来自尼克·本特利在他的一篇文章中所描述的游戏设计方法。虽然我自己对开源代码的看法已经有点类似于尼克的观点，但他的文章让我的方法有了一个名字和基本结构。无论你在哪儿，Mr. Bentley，谢谢你!</p>\n<p>4.如果我们不创建开源代码来造福他人，那又有什么意义呢？</p>\n<p>5.有时候一个项目会从根上就腐烂，在这种情况下，我会毫不犹豫的废弃它，并将其他替代品放进 100 的列表中。100 的链表是一个动态链表，所有东西可以随存随取。</p>\n<p>6.或者不一定？我担心个啥！</p>\n<p>7.当那一个已经浮出水面了，我仍然不会放弃其他 9 个，不过仅仅是在更表层，MVP 式的水平上开发。如果某个想法失败了，我还会从 100 个中挑选其他的代替。这个方法当然是没有任何硬性规定的。</p>\n<p>8.当然还有最终的名字和标志:p。</p>\n<p>9.如你所见，我将100:10:1 方法应用于其他的创造性的爱好。从编码、音乐、写作到游戏设计，它适用于任何创造性事情。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112320\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112320votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112320\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/q1857502771\">暖日生烟</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/q1857502771\">\r\n\t\t\t<img src=\"http://q.qlogo.cn/qqapp/208656/06EB1B2C5C7835017E628CFB8E25D68F/100\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/q1857502771\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/q1857502771/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/q1857502771/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 11</a> · <a title=\"QQ：826672619\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：xzs826672619\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/NinoMiao\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "技术面试中常被问到是否参与开源，那如何清晰展示 GitHub 项目呢？", "url": "http://blog.jobbole.com/112322/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2013/03/124.jpg"], "praise_nums": "1", "comment_nums": 2, "fav_nums": 2, "tags": "IT技术,Github,开源", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/buntamarui\">小米云豆粥</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://thehftguy.com/2016/10/24/heres-how-to-make-a-good-github-project-for-your-resume/\">thehftguy</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>你面试的公司找你要 GitHub 链接，猎头找你要 GitHub 链接。“你参与过开源项目么？”是目前 IT 技术面试中的常见问题之一。</p>\n<p>既然他们要 GitHub，你就得给。本文将阐述如何在面试中展示你在 GitHub 上的项目。</p>\n<p>以下的建议有两个用途：应聘者可以学习怎么写软件的简介（不一定非要是GitHub）；招聘者（程序员）可以学习可以从哪些关键点来评价一个程序员的水平和软件的质量。</p>\n<figure id=\"attachment_3948\" class=\"wp-caption aligncenter\"><img class=\"aligncenter size-medium wp-image-3948\" src=\"https://thehftguy.files.wordpress.com/2016/10/github-submit-application1.png?w=300&amp;h=239\" alt=\"submit application form with a GitHub link\" width=\"300\" height=\"239\">\n<figcaption class=\"wp-caption-text\">When having a GitHub is mandatory, just like having a name.</figcaption>\n</figure>\n<h3>链接一个特定的项目</h3>\n<p>在你的简历和每一份申请里面都放上你的GitHub链接。</p>\n<p>该链接要直链到一个项目。不要给你GitHub的主页地址，那个页面没有有用信息，很难让人继续浏览。</p>\n<p>你必须只展示一个项目。一个就够了，不需要更多。</p>\n<p>这个项目将是你的“登录页面”，是招聘者看到的第一个页面。他们很少去看其他页面（也没有这个必要）所以该页面本身就应该展示一切信息。如果他们去看了其他页面，说明这个主页成功引起了他们的兴趣，他们想知道更多项目细节。</p>\n<p>我们要写一个可以充分展示你的能力，并能给人留下好的第一印象的项目页面。</p>\n<h3>项目结构</h3>\n<p>用5秒时间看软件的架构就可以知道项目优劣。</p>\n<p>你一眼就能看出来一个程序员没有经验，他们的项目往往没有结构。项目文件要么在随便一个地方或者都在根目录。</p>\n<p><strong>一个好的项目结构必须将源代码，测试，库文件，可执行文件分开放在不同的文件夹中</strong>。</p>\n<p>命名的细节，例如是用‘doc’还是用‘docs’并不重要。这里是GitHub项目的<a href=\"https://GitHub.com/kriasoft/Folder-Structure-Conventions\">文件夹结构</a>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba6632e7821751256945\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n.\r\n├── build                   # Compiled files (alternatively `dist`)\r\n├── docs                    # Documentation files (alternatively `doc`)\r\n├── src                     # Source files (alternatively `lib` or `app`)\r\n├── test                    # Automated tests (alternatively `spec` or `tests`)\r\n├── tools                   # Tools and utilities\r\n├── LICENSE\r\n└── README.md\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba6632e7821751256945-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba6632e7821751256945-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba6632e7821751256945-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba6632e7821751256945-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba6632e7821751256945-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba6632e7821751256945-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba6632e7821751256945-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba6632e7821751256945-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba6632e7821751256945-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba6632e7821751256945-1\"><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba6632e7821751256945-2\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">build</span><span class=\"crayon-h\">                   </span><span class=\"crayon-p\"># Compiled files (alternatively `dist`)</span></div><div class=\"crayon-line\" id=\"crayon-59ba6632e7821751256945-3\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">docs</span><span class=\"crayon-h\">                    </span><span class=\"crayon-p\"># Documentation files (alternatively `doc`)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba6632e7821751256945-4\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">src</span><span class=\"crayon-h\">                     </span><span class=\"crayon-p\"># Source files (alternatively `lib` or `app`)</span></div><div class=\"crayon-line\" id=\"crayon-59ba6632e7821751256945-5\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">test</span><span class=\"crayon-h\">                    </span><span class=\"crayon-p\"># Automated tests (alternatively `spec` or `tests`)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba6632e7821751256945-6\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">tools</span><span class=\"crayon-h\">                   </span><span class=\"crayon-p\"># Tools and utilities</span></div><div class=\"crayon-line\" id=\"crayon-59ba6632e7821751256945-7\">├──<span class=\"crayon-h\"> </span><span class=\"crayon-i\">LICENSE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba6632e7821751256945-8\">└──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">README</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">md</span></div><div class=\"crayon-line\" id=\"crayon-59ba6632e7821751256945-9\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p></p>\n<figure id=\"attachment_4111\" class=\"wp-caption alignnone\"><img class=\"alignnone size-full wp-image-4111\" src=\"https://thehftguy.files.wordpress.com/2016/10/github-project-structure.png?w=809\" alt=\"software project structure\">\n<figcaption class=\"wp-caption-text\">A well-organized project</figcaption>\n</figure>\n<h3>有一个项目简介文件</h3>\n<p>项目简介文件可以提供：</p>\n<ul>\n<li>项目目标</li>\n<li>截屏或视频</li>\n<li>使用说明</li>\n<li>软件下载页面</li>\n</ul>\n<h3>在简介文件里面放软件界面截屏</h3>\n<p>一张图比一千个字更能说明问题。</p>\n<p>人们不会因为要看软件界面就去安装软件。请提供软件界面截图。</p>\n<h3>在简介中放视频</h3>\n<p>一张图能抵一千个字，那么一个视频顶一千张图。</p>\n<figure id=\"attachment_3846\" class=\"wp-caption alignnone\"><img class=\"alignnone size-full wp-image-3846\" src=\"https://thehftguy.files.wordpress.com/2016/10/github-snake-gif.gif?w=809\" alt=\"snake game preview animated gif\" width=\"600\" height=\"370\">\n<figcaption class=\"wp-caption-text\">Great demo from <a href=\"https://GitHub.com/DyegoCosta/snake-game\" target=\"_blank\" rel=\"noopener\">a random snake project on GitHub</a></figcaption>\n</figure>\n<p><strong>注意</strong>：GitHub不允许插入视频，你可以使用动态图。</p>\n<h3>网页链接或安装文件链接</h3>\n<p>如果该项目是网络应用，请提供网页地址。当然，所有人都应该能访问该地址。</p>\n<p>如果该项目是单机程序，请提供安装文件下载地址。如果安装文件看上去不专业，用户是不会安装它的。很多时候，是否专业跟发布方式有关。</p>\n<h3>整合GitHub工具</h3>\n<p>GitHub提供了一整套免费工具用于编连，打包，测试和其他功能。这些工具在专业软件开发中都是必须的。</p>\n<p>以前想要实现这些功能非常困难，但如今通过GitHub一切都非常简单。你没有理由不用它们。</p>\n<p><img class=\" size-full wp-image-3871 aligncenter\" style=\"height: auto; max-width: 100%; clear: both; margin: 0.8em auto;\" src=\"https://thehftguy.files.wordpress.com/2016/10/github-integration-icons.png?w=809\" alt=\"GitHub-integration-icons\"></p>\n<p>这是一个由C++实现的四子棋的例子。按钮从左到右代表：</p>\n<ol>\n<li>在Linux上编连（<a href=\"https://travis-ci.org/\" target=\"_blank\" rel=\"noopener\">Travis CI</a>）</li>\n<li>在Windows上编连（<a href=\"https://www.appveyor.com/\" target=\"_blank\" rel=\"noopener\">AppVeyor</a>）</li>\n<li>单元测试和测试覆盖分析（<a href=\"https://coveralls.io/\" target=\"_blank\" rel=\"noopener\">Coveralls</a>）</li>\n</ol>\n<h3>如何处理源代码？</h3>\n<p>“没人在乎你的源代码——得知这个事实的时候我也很吃惊。我在整理代码上花了不少时间，但发现没人在乎。重要的不是代码，而是产品” （<a href=\"https://mortoray.com/2015/04/20/nobody-cares-about-your-code/\">出处</a>）</p>\n<p>比起猜，读一段软件功能描述要快10倍。比起自己弄明白软件用法，观看一个介绍基本用法的视频可以快100倍。比起逆向工程，读设计图表要快1000倍。你可以通过读源代码来搞清楚一切，但这个过程要费事得多。读源代码（解码源代码）是非常耗时的。只有在走投无路的时候才应该用。</p>\n<p>经验教训1：没人在乎你的代码，也不会有人去读你的代码。</p>\n<p>经验教训2：别指望别人会去读你的代码，也别强迫别人去读代码。</p>\n<h3>如果我没有像样的大项目要怎么办？</h3>\n<p>挺好的。简单的项目更容易展示，更容易解释，面试官也更容易理解。比如大家都知道四子棋是怎么回事。</p>\n<p>即使第一眼看上去很简单，但每一个项目都包含了很多工作量：写一个好的用户界面，调整颜色，允许两个人一起游戏，加上对下一步棋的走子建议，加上 AI 选手等等。</p>\n<p>这个游戏规则很简单但是要把它做成好的软件要做很多工作。这些都是你在面对面的面试中可以跟面试官深入探讨的地方。</p>\n<p>你知道玩四子棋的时候先走的选手一定会赢么？【如果他不犯错的话】你知道如果第一个选手第一步棋不走中间的话，第二个选手一定可以将棋走成平局么？</p>\n<p>来源：<a href=\"http://www.informatik.uni-trier.de/~fernau/DSL0607/Masterthesis-Viergewinnt.pdf\" target=\"_blank\" rel=\"noopener\">A Knowledge-based Approach of Connect-Four</a>, <em>The Game is Solved: White Wins</em>, Victor Allis</p>\n<h3>面试官真的会去看GitHub么？</h3>\n<p>事实上<strong>他们不会</strong>。</p>\n<figure id=\"attachment_4010\" class=\"wp-caption aligncenter\"><img class=\" size-full wp-image-4010 aligncenter\" src=\"https://thehftguy.files.wordpress.com/2016/10/github-traffic.png?w=809\" alt=\"GitHub traffic statistics\">\n<figcaption class=\"wp-caption-text\">GitHub Traffic Statistics</figcaption>\n</figure>\n<p>我们测试过了。这个图是我们发出一堆简历之后的数据统计。这三个点击是我自己点的。在写这篇文章的时候我没有登录就去点了GitHub。我的错。</p>\n<p>从我上次找工作的经验来说，经过十几个电话面试（每次电话有一个技术人员）和几个现场面试（4到7个技术人员），只有一个人去看了我的GitHub页面。</p>\n<p>结论：没人关心GitHub，没人会看GitHub。每人都会问，是因为别人也在这样做。</p>\n<p>好处：既然没有人真的去看，你也可以拒绝参加这场GitHub的假面舞会。你可以用这个<a href=\"https://GitHub.com/leachim6/hello-world\"> hello world 终极版本库</a> 去回应所有的GitHub要求。这个版本库包含用一百种语言实现的“Hello world”。</p>\n<h3>小抄</h3>\n<ol>\n<li>项目要有结构</li>\n<li>要有项目简介文件</li>\n<li>写一段说明软件功能的介绍</li>\n<li>放上软件界面截图和使用说明视频</li>\n<li>提供安装文件下载地址或者网络应用的网址</li>\n<li>整合发开工具（CI，单元测试，打包工具等等）</li>\n</ol>\n<p>这世上还有其他软件工程的好范例，不仅仅局限于GitHub。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/2ec965670e006b5d53c221a7cdcf0108.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/07/a5e36df34a1aea088f06fb503c7ce93d.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112322\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112322votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112322\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/buntamarui\">小米云豆粥</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/buntamarui\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/09/5bfa690c5bc8a2dc2344cffdebf5f50b.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            数据科学进修中，Python小码农。不用QQ，有事站内信联系。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/buntamarui\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/buntamarui/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/buntamarui/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 29</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/ammie/\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/bchen4\"><i class=\"fa fa-github\"></i></a> <a title=\"Linked主页\" target=\"_blank\" href=\"https://www.linkedin.com/\"><i class=\"fa fa-linkedin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "为提高用户体验，Yelp 是如何无损压缩图片的", "url": "http://blog.jobbole.com/112321/", "front_image_url": ["http://wx1.sinaimg.cn/mw690/7cc829d3gy1fjgtf2uq3bj218s0rdwot.jpg"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 2, "tags": "IT技术,Yelp,图片压缩", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/fengzhuang19940106\">iScream</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://engineeringblog.yelp.com/2017/06/making-photos-smaller.html\">Yelp</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>Yelp 拥有超过 1 亿张由用户生成的照片，这些照片从晚餐、理发，到我们最新的功能之一：yelfies。这些图像占据了用户 APP 和网站的大部分带宽，这意味着存储和传输的巨大成本。为了向用户提供最好的体验，我们努力优化这些图片并将其平均大小缩小了 30%。这样节省了用户的时间和带宽，并降低了为这些图像提供服务的成本。哦，我们这样做都没有降低图像的质量呢！</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1fjgtf2uq3bj218s0rdwot.jpg\" width=\"690\" height=\"422\"></p>\n<h3>背景</h3>\n<p>Yelp 已经帮用户存储上传的照片超过 12 年了。我们那些将无损格式的图片（PNG，GIF）保存成 PNG 格式，而所有其他的格式的图片则保存成 JPEG 格式。我们保存图片用的是 Python 和 Pillow，并使用如下代码片段，开启了我们照片上传的故事：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba72a1eaf6a712015773\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# do a typical thumbnail, preserving aspect ratio\r\nnew_photo = photo.copy()\r\nnew_photo.thumbnail(\r\n    (width, height),\r\n    resample=PIL.Image.ANTIALIAS,\r\n)\r\nthumbfile = cStringIO.StringIO()\r\nsave_args = {'format': format}\r\nif format == 'JPEG':\r\n    save_args['quality'] = 85\r\nnew_photo.save(thumbfile, **save_args)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf6a712015773-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf6a712015773-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf6a712015773-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf6a712015773-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf6a712015773-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf6a712015773-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf6a712015773-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf6a712015773-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf6a712015773-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf6a712015773-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf6a712015773-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf6a712015773-1\"><span class=\"crayon-p\"># do a typical thumbnail, preserving aspect ratio</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf6a712015773-2\"><span class=\"crayon-v\">new_photo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">copy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf6a712015773-3\"><span class=\"crayon-v\">new_photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">thumbnail</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf6a712015773-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">width</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">height</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf6a712015773-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">resample</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">PIL</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ANTIALIAS</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf6a712015773-6\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf6a712015773-7\"><span class=\"crayon-v\">thumbfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cStringIO</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">StringIO</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf6a712015773-8\"><span class=\"crayon-v\">save_args</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'format'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">format</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf6a712015773-9\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">format</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'JPEG'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf6a712015773-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">save_args</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'quality'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">85</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf6a712015773-11\"><span class=\"crayon-v\">new_photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">thumbfile</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">save_args</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>以此作为起点，我们开始研究潜在的文件大小优化方法，可以让我们在不损失质量的前提下使用。</p>\n<h3 id=\"optimizations\">优化</h3>\n<p>首先，我们不得不决定是自己来处理这个问题，还是让 CDN 提供商用他们的魔力来神奇地改变我们的照片。在优先保证高质量的内容前提下，去评估众多选项并使得潜在的尺寸与质量相互抵消是有意义的。我们先行调查了当前照片文件大小缩小的现状 – 可以做出什么改变，以及与每个改变相关联的大小/质量下降。随着这项调查的完成，我们决定从三大类方法来着手。这篇文章剩下的部分解释了我们做了什么，并在每项优化中获得了多少收益。</p>\n<p><strong>1.Pillow中的改变</strong></p>\n<ul>\n<li>优化标志</li>\n<li>渐进的JPEG</li>\n</ul>\n<p><strong>2.应用照片逻辑的更改</strong></p>\n<ul>\n<li>大型 PNG 格式图的检测</li>\n<li>动态 JPEG 质量</li>\n</ul>\n<p><strong>3.JPEG编码器更改</strong></p>\n<ul>\n<li>Mozjpeg（网格量化，自定义量化矩阵）</li>\n</ul>\n<h3 id=\"changes-in-pillow\">Pillow 中的改变</h3>\n<h3 id=\"optimize-flag\">标志位优化</h3>\n<p>这是我们最简单的更改之一：启用 Pillow 中的设置，以 CPU 耗时为代价（optimize = True）来节约更多的文件大小。 由于该权衡的本质，这样做并不会影响图像质量。</p>\n<p>对于 JPEG 格式的图片，该标志位会指示编码器，通过扫描每张图片做一次附加的遍历，来找到最佳霍夫曼编码。对每张图片的第一遍扫描，我们不是写入文件，而是计算每个值的出现统计，这是计算理想编码所需要信息。PNG 内部使用 zlib，因此在这种情况下，标志位优化能有效地指示编码器使用 gzip -9，而不是 gzip -6。</p>\n<p>这是一项简单的改进，但事实证明它并非灵丹妙药，只减少百分之几的文件大小。</p>\n<h3 id=\"progressive-jpeg\">渐进式 JPEG</h3>\n<p>将图像保存为 JPEG 格式时，你可以选择几种不同的类型：</p>\n<ul>\n<li>从上到下加载的 JPEG 标准图像。</li>\n<li>渐进式 JPEG 图像，从较模糊加载到较不模糊。Pillow（progressive = True）可以轻松地启用渐进式选项。 因而，人类肉眼可感知到性能有了提升（也就是说，当图像部分缺失时，更容易注意到它不是完全锐利的）。</li>\n</ul>\n<p>此外，渐进式文件打包方式通常会使得文件尺寸减少。如维基百科文章中所详尽解释的那样，JPEG 格式在 8×8 像素块上使用 Z 字形模式进行熵编码。当这些像素块的值被解包并按顺序排列时，我们通常首先得到的是非零数字，然后是 0 的序列，用该模式对于图像中的每个 8×8 块进行重复和交织。在使用渐进编码时，解开的像素块的顺序发生了改变。每个块值较高的数字会首先出现文件中（它给出了渐进式图像最早扫描到的不同阻塞），并且那些能增加出色细节的小数字（包括更多的 0），它们的跨度将更长，并一直持续到末位。图像数据的这种重新排序不会改变图像本身，而是增加了在一行中的可能存在的 0 的数量（这样可以更容易地压缩）。</p>\n<p>与由用户贡献的美味甜甜圈图像做比较（点击查看大图）：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/7f058d53944b33506d3375138eca77b4.gif\"><img class=\"alignnone wp-image-65555\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/7f058d53944b33506d3375138eca77b4.gif\" alt=\"baseline-tiny\" width=\"299\" height=\"220\"></a></p>\n<p>（1）标准 JPEG 格式图渲染的模拟</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/2f553920cd4b568166bdbbfb5c0a3b40.gif\"><img class=\"alignnone wp-image-65554\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/2f553920cd4b568166bdbbfb5c0a3b40.gif\" alt=\"progressive-tiny\" width=\"299\" height=\"220\"></a></p>\n<p>（2）渐进式 JPEG 格式图渲染的模拟。</p>\n<h3 id=\"changes-to-application-photo-logic\">应用照片逻辑的改变</h3>\n<h3 id=\"large-png-detection\">大型 PNG 格式图片的检测</h3>\n<p>Yelp 为用户生成的内容提供了两种图像格式 –  JPEG 和 PNG。JPEG 是一种很好的照片格式，但通常会与高对比度设计内容（如 logo）相结合。相比之下，PNG 是完全无损的，非常适合图形，但对于那些小失真不可见的照片来说占用的空间太大了。在用户上传实际照片是 PNG 格式的情况下，我们识别这些文件并将其另存为 JPEG 格式，可节省下大量的存储空间。Yelp 上一些常见的 PNG 照片来源于移动设备由和应用程序拍摄的截图，这些照片是通过添加特效或边框修饰了的。</p>\n<p><img src=\"https://engineeringblog.yelp.com/images/posts/2017-05-31-making-images-smaller/example-pngs.png\"></p>\n<p>（左）一个典型的具有 logo 和边框的复合 PNG 格式的上传图。 （右）一个典型的来自于屏幕截图的 PNG 格式的上传图。</p>\n<p>我们想减少这些不必要的 PNG 格式的图片数量，但重要的是要避免矫枉过正或降低了 logo 和图形等的质量。我们应该如何区分出一张图片中属于照片的部分呢？从像素层面可以做到吗？</p>\n<p>使用了 2500 张图片作为实验样本后，我们发现文件大小和独特像素的结合可以很好地区分照片。我们用我们最大的分辨率生成候选缩略图，看看输出PNG文件是否大于 300 KiB。如果是，我们还将检查图像内容，查看是否有超过 2^16 种独特颜色（Yelp 将 RGBA 格式的上传图片转成 RGB 格式，但如果没这样做的话，我们也会检查）。</p>\n<p>在实验数据集中，那些手动调整阈值来定义成“ bigness ”占了有可能缩小的文件大小的 88％（即如果我们要转换所有图像，我们预期的文件大小的缩小），这是在不会导致转换后图形的任何假阳性的前提下进行的。</p>\n<p id=\"dynamic-jpeg-quality\"><strong>动态的 JPEG 质量</strong></p>\n<p>缩小 JPEG 文件大小的第一个也是最为人所知的一种方式是称为质量的设置。许多能保存 JPEG 格式图片的应用程序会将质量指定为一个数字。</p>\n<p>质量这个词有点抽象。事实上，一幅 JPEG 格式的图像的每个颜色通道都有单独的质量。质量等级从 0 到 100 映射到颜色通道的不同量化表，取决于丢失了多少数据（通常是高频成分）。信号域中的量化是 JPEG 编码过程中丢失信息的步骤之一。</p>\n<p>减小文件大小的最简单的方法是降低图像的质量，这会引入更多的噪声。不是每张图片在一个给定的相同质量水平上都会丢失相同的信息量。</p>\n<p>我们可以为每张图片动态地选择一种质量优化设置，找到质量和存储大小之间的理想平衡。有两种方法可以做到这一点：</p>\n<ul>\n<li>自下而上：这些是通过处理 8 x 8 像素块级别的图像生成调谐量化表的算法。它们计算出丢失了多少理论上的质量，以及丢失的数据如何放大或消除，对人眼可见失真的多或少。</li>\n<li>自上而下的：这些算法是将整张图片与其原始无失真版本进行比较，检测丢失了多少信息。通过迭代生成具有不同质量设置的候选图像，我们可以选择其中一张图片，作为满足某种评估算法的最低评估水平的图像。</li>\n</ul>\n<p style=\"text-align: left;\">我们评估了一种自下而上的算法，在实验中，在我们希望使用的质量范围的上限内没有产生合适的结果（尽管它似乎仍然具有中档图像质量的潜力， 这时编码器可以开始更冒险地去丢弃它的字节）。关于这一策略的众多学术论文在90年代初就有发表，该方法对计算能力要求很高，并且走了选项 B 地址这类的捷径，例如不评估块之间的交互。</p>\n<p>所以我们采取了第二种方法：使用对分的算法生成不同质量水平的候选图像，并通过使用 pyssim 函数来计算其结构相似性度量（SSIM），来评估每个候选图像的质量下降，直到该值处于可配置但阈值也还处于静态。这允许我们选择性地降低文件的平均大小（和平均质量），仅仅针对那些已经开始产生肉眼可识别的质量下降的图像。</p>\n<p>在下图中，我们绘制了用3种不同质量方法生成的 2500 张图像的SSIM值的表。</p>\n<p>1、用一种质量为 85 的初始方法作出原始图像，使用蓝线来绘制。</p>\n<p><span style=\"font-weight: normal; text-align: center;\">2、一种能降低文件大小，质量改为 80 的替代方法，用红线来绘制。</span></p>\n<p><span style=\"font-weight: normal; text-align: center;\">3、</span><span style=\"font-weight: normal; text-align: center;\">我们在最后选用了一种方法，使用橙色绘制动态质量的 SSIM 为 80 – 85 的图，即选择质量为 80 到 85（含）的图像，这是基于一种满足或超过的 SSIM 比率：该比率是预先计算的、使转换发生在图像范围中间的某个静态值。这样我们可以降低文件的平均大小，而不会降低那些质量最差的图片的质量。</span><strong style=\"text-align: center;\"><img src=\"https://engineeringblog.yelp.com/images/posts/2017-05-31-making-images-smaller/ssims-strategies.png\"></strong></p>\n<p style=\"text-align: center;\">3 种不同质量策略下 2500 张图片的 SSIM 值图</p>\n<h5 id=\"ssim\">SSIM？</h5>\n<p>有不少图像质量算法试图模仿人类视觉系统。我们已经评估过其中的许多算法，并认为 SSIM 虽然较为古老，但基于以下几个特征是最适合于迭代优化的：</p>\n<p>1、对 JPEG 量化误差敏感<br>\n2、快速，简单的算法<br>\n3、可以直接对 PIL 原生图像对象进行计算，而不是将图像转换为 PNG 格式并将其传递给 CLI 应用程序（参见＃2）</p>\n<p>动态质量的代码示例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba72a1eaf9d976645925\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport cStringIO\r\nimport PIL.Image\r\nfrom ssim import compute_ssim\r\n \r\n \r\ndef get_ssim_at_quality(photo, quality):\r\n    \"\"\"Return the ssim for this JPEG image saved at the specified quality\"\"\"\r\n    ssim_photo = cStringIO.StringIO()\r\n    # optimize is omitted here as it doesn't affect\r\n    # quality but requires additional memory and cpu\r\n    photo.save(ssim_photo, format=\"JPEG\", quality=quality, progressive=True)\r\n    ssim_photo.seek(0)\r\n    ssim_score = compute_ssim(photo, PIL.Image.open(ssim_photo))\r\n    return ssim_score\r\n \r\n \r\ndef _ssim_iteration_count(lo, hi):\r\n    \"\"\"Return the depth of the binary search tree for this range\"\"\"\r\n    if lo &gt;= hi:\r\n        return 0\r\n    else:\r\n        return int(log(hi - lo, 2)) + 1\r\n \r\n \r\ndef jpeg_dynamic_quality(original_photo):\r\n    \"\"\"Return an integer representing the quality that this JPEG image should be\r\n    saved at to attain the quality threshold specified for this photo class.\r\n \r\n    Args:\r\n        original_photo - a prepared PIL JPEG image (only JPEG is supported)\r\n    \"\"\"\r\n    ssim_goal = 0.95\r\n    hi = 85\r\n    lo = 80\r\n \r\n    # working on a smaller size image doesn't give worse results but is faster\r\n    # changing this value requires updating the calculated thresholds\r\n    photo = original_photo.resize((400, 400))\r\n \r\n    if not _should_use_dynamic_quality():\r\n        default_ssim = get_ssim_at_quality(photo, hi)\r\n        return hi, default_ssim\r\n \r\n    # 95 is the highest useful value for JPEG. Higher values cause different behavior\r\n    # Used to establish the image's intrinsic ssim without encoder artifacts\r\n    normalized_ssim = get_ssim_at_quality(photo, 95)\r\n    selected_quality = selected_ssim = None\r\n \r\n    # loop bisection. ssim function increases monotonically so this will converge\r\n    for i in xrange(_ssim_iteration_count(lo, hi)):\r\n        curr_quality = (lo + hi) // 2\r\n        curr_ssim = get_ssim_at_quality(photo, curr_quality)\r\n        ssim_ratio = curr_ssim / normalized_ssim\r\n \r\n        if ssim_ratio &gt;= ssim_goal:\r\n            # continue to check whether a lower quality level also exceeds the goal\r\n            selected_quality = curr_quality\r\n            selected_ssim = curr_ssim\r\n            hi = curr_quality\r\n        else:\r\n            lo = curr_quality\r\n \r\n    if selected_quality:\r\n        return selected_quality, selected_ssim\r\n    else:\r\n        default_ssim = get_ssim_at_quality(photo, hi)\r\n        return hi, default_ssim</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eaf9d976645925-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eaf9d976645925-67\">67</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">cStringIO</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">PIL</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Image</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-3\"><span class=\"crayon-e\">from </span><span class=\"crayon-e\">ssim </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">compute_ssim</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-4\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-5\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-6\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get_ssim_at_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">quality</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"Return the ssim for this JPEG image saved at the specified quality\"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ssim_photo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cStringIO</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">StringIO</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># optimize is omitted here as it doesn't affect</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># quality but requires additional memory and cpu</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">save</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ssim_photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">format</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"JPEG\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">quality</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">quality</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">progressive</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ssim_photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">seek</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ssim_score</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">compute_ssim</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PIL</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ssim_photo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ssim_score</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-15\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-16\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-17\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_ssim_iteration_count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"Return the depth of the binary search tree for this range\"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">log</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-23\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-24\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-25\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">jpeg_dynamic_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">original_photo</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\"Return an integer representing the quality that this JPEG image should be</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-27\"><span class=\"crayon-s\">    saved at to attain the quality threshold specified for this photo class.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-28\"><span class=\"crayon-s\"> </span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-29\"><span class=\"crayon-s\">    Args:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-30\"><span class=\"crayon-s\">        original_photo - a prepared PIL JPEG image (only JPEG is supported)</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-31\"><span class=\"crayon-s\">    \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ssim_goal</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.95</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">hi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">85</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-34\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">lo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-35\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># working on a smaller size image doesn't give worse results but is faster</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># changing this value requires updating the calculated thresholds</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">photo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">original_photo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">resize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-39\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_should_use_dynamic_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">default_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_ssim_at_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">default_ssim</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-43\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 95 is the highest useful value for JPEG. Higher values cause different behavior</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># Used to establish the image's intrinsic ssim without encoder artifacts</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">normalized_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_ssim_at_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">95</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">selected_quality</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selected_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-48\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-49\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># loop bisection. ssim function increases monotonically so this will converge</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">_ssim_iteration_count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">curr_quality</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">// 2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">curr_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_ssim_at_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curr_quality</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-53\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">ssim_ratio</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curr_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">normalized_ssim</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-54\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-55\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ssim_ratio</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ssim_goal</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-56\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># continue to check whether a lower quality level also exceeds the goal</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-57\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">selected_quality</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">curr_quality</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-58\"><span class=\"crayon-e\">            </span><span class=\"crayon-v\">selected_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">curr_ssim</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-59\"><span class=\"crayon-e\">            </span><span class=\"crayon-v\">hi</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">curr_quality</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-60\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-61\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">lo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">curr_quality</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-62\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-63\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selected_quality</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-64\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selected_quality</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">selected_ssim</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-65\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eaf9d976645925-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">default_ssim</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_ssim_at_quality</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">photo</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eaf9d976645925-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hi</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">default_ssim</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0076 seconds] -->\r\n<p>还有一些关于这种技术的其他博客文章，这里是柯尔特·麦卡尼斯（Colt Mcanlis）的一篇博文。当我们发布这篇博客的时候，Etsy 已经发表了一篇了！击掌吧，更快的网络！</p>\n<h3 id=\"changes-to-jpeg-encoder\">JPEG 编码器的更改</h3>\n<p id=\"mozjpeg\">Mozjpeg 是 libjpeg-turbo 的一个开源分支，它采取以时间换空间的方法，通过更长时间的运算换取更加优化的文件尺寸。这种方法很好地与离线批处理方法结合以重新生成图像。一些更昂贵的算法用了比 libjpeg-turbo 多出 3 – 5 倍的时间，使得图像更小了一些！</p>\n<p>mozjpeg 的区别之一是使用一种替代量化表。如上所述，质量是用于每个颜色通道的量化表的抽象。所有符号都指向默认的 JPEG 量化表，因而它很容易被击败。用这个词来说，</p>\n<p><a href=\"https://www.w3.org/Graphics/JPEG/itu-t81.pdf\">JPEG spec</a>:</p>\n<blockquote><p>这些表仅作为示例，并不一定适用于任何特定应用。</p></blockquote>\n<p>那么自然地，不要惊讶于你知道这些表是大多数编码器使用的默认值…</p>\n<p>Mozjpeg 经历了为我们的替代表做基准测试的麻烦时期，并在之后成为了它所创建的图像中，能用到的性能最好的通用替代品。</p>\n<h3 id=\"mozjpeg--pillow\">Mozjpeg + Pillow</h3>\n<p>大多数的 Linux 发行版都默认安装了 libjpeg。所以在 Pillow 下使用 mozjpeg 在默认情况下不起作用，但配置起来也不是很困难。当您构建 mozjpeg 时，请使用–with-jpeg8 标志位，并确保可以通过 Pillow 链接到它。如果您使用Docker，您可能会有一个 Dockerfile，如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba72a1eafa6930902924\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nFROM ubuntu:xenial\r\n \r\nRUN apt-get update \r\n\t&amp;&amp; DEBIAN_FRONTEND=noninteractive apt-get -y --no-install-recommends install \r\n\t# build tools\r\n\tnasm \r\n\tbuild-essential \r\n\tautoconf \r\n\tautomake \r\n\tlibtool \r\n\tpkg-config \r\n\t# python tools\r\n\tpython \r\n\tpython-dev \r\n\tpython-pip \r\n\tpython-setuptools \r\n\t# cleanup\r\n\t&amp;&amp; apt-get clean \r\n\t&amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\r\n \r\n# Download and compile mozjpeg\r\nADD https://github.com/mozilla/mozjpeg/archive/v3.2-pre.tar.gz /mozjpeg-src/v3.2-pre.tar.gz\r\nRUN tar -xzf /mozjpeg-src/v3.2-pre.tar.gz -C /mozjpeg-src/\r\nWORKDIR /mozjpeg-src/mozjpeg-3.2-pre\r\nRUN autoreconf -fiv \r\n\t&amp;&amp; ./configure --with-jpeg8 \r\n\t&amp;&amp; make install prefix=/usr libdir=/usr/lib64\r\nRUN echo \"/usr/lib64n\" &gt; /etc/ld.so.conf.d/mozjpeg.conf\r\nRUN ldconfig\r\n \r\n# Build Pillow\r\nRUN pip install virtualenv \r\n\t&amp;&amp; virtualenv /virtualenv_run \r\n\t&amp;&amp; /virtualenv_run/bin/pip install --upgrade pip \r\n\t&amp;&amp; /virtualenv_run/bin/pip install --no-binary=:all: Pillow==4.0.0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eafa6930902924-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eafa6930902924-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eafa6930902924-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eafa6930902924-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eafa6930902924-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eafa6930902924-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eafa6930902924-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eafa6930902924-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eafa6930902924-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eafa6930902924-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eafa6930902924-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eafa6930902924-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eafa6930902924-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eafa6930902924-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eafa6930902924-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eafa6930902924-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eafa6930902924-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eafa6930902924-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eafa6930902924-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eafa6930902924-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eafa6930902924-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eafa6930902924-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eafa6930902924-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eafa6930902924-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eafa6930902924-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eafa6930902924-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eafa6930902924-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eafa6930902924-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eafa6930902924-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eafa6930902924-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eafa6930902924-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eafa6930902924-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eafa6930902924-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba72a1eafa6930902924-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59ba72a1eafa6930902924-35\">35</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba72a1eafa6930902924-1\"><span class=\"crayon-e\">FROM </span><span class=\"crayon-v\">ubuntu</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">xenial</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eafa6930902924-2\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eafa6930902924-3\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">update</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eafa6930902924-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBIAN_FRONTEND</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">noninteractive </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">get</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">install</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">recommends </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eafa6930902924-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\"># build tools</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eafa6930902924-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">nasm </span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eafa6930902924-7\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">build</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">essential </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eafa6930902924-8\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">autoconf </span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eafa6930902924-9\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">automake </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eafa6930902924-10\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">libtool </span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eafa6930902924-11\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">pkg</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">config</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eafa6930902924-12\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\"># python tools</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eafa6930902924-13\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">python </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eafa6930902924-14\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">python</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">dev </span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eafa6930902924-15\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">python</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">pip </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eafa6930902924-16\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">python</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">setuptools</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eafa6930902924-17\"><span class=\"crayon-h\">\t</span><span class=\"crayon-p\"># cleanup</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eafa6930902924-18\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">get </span><span class=\"crayon-v\">clean</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eafa6930902924-19\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rm</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">apt</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lists</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eafa6930902924-20\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eafa6930902924-21\"><span class=\"crayon-p\"># Download and compile mozjpeg</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eafa6930902924-22\"><span class=\"crayon-e\">ADD </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/mozilla/mozjpeg/archive/v3.2-pre.tar.gz /mozjpeg-src/v3.2-pre.tar.gz</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eafa6930902924-23\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">tar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xzf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mozjpeg</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">src</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">v3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pre</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">gz</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">C</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mozjpeg</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">src</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eafa6930902924-24\"><span class=\"crayon-v\">WORKDIR</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mozjpeg</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">src</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mozjpeg</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">3.2</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">pre</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eafa6930902924-25\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">autoreconf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fiv</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eafa6930902924-26\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">configure</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">with</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">jpeg8</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eafa6930902924-27\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">make </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">prefix</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">usr </span><span class=\"crayon-v\">libdir</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">lib64</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eafa6930902924-28\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/usr/lib64n\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ld</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">so</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mozjpeg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">conf</span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eafa6930902924-29\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-v\">ldconfig</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eafa6930902924-30\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eafa6930902924-31\"><span class=\"crayon-p\"># Build Pillow</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eafa6930902924-32\"><span class=\"crayon-e\">RUN </span><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">virtualenv</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eafa6930902924-33\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">virtualenv</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">virtualenv_run</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba72a1eafa6930902924-34\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">virtualenv_run</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">pip </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-e\">upgrade </span><span class=\"crayon-v\">pip</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59ba72a1eafa6930902924-35\"><span class=\"crayon-h\">\t</span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">virtualenv_run</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">pip </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">no</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">binary</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">all</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Pillow</span><span class=\"crayon-o\">==</span><span class=\"crayon-cn\">4.0.0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0052 seconds] -->\r\n<p>以上！使用它，您将可以在正常图片工作流程中，使用由 mozjpeg 支持的 Pillow。</p>\n<h3 id=\"impact\">影响</h3>\n<p>这些改进中的每一项对我们的提升分别是多少呢？我们随机抽取 2,500 张 Yelp 上的商业照片开始了此项研究，测试照片大小在经过我们的处理流程后有怎样的变化。</p>\n<p>1、通过改变 Pillow 的设置，可以将图片大小减小 4.5%<br>\n2、大型 PNG 格式图片检测可以将图片大小减小 6.2%<br>\n3、动态质量可以将图片大小减小 4.5%<br>\n4、切换到 mozjpeg 编码器可以将图片大小减小 13.8%</p>\n<p>这些改进使得图像文件的平均大小减少了约 30％，并被我们应用到我们最大和最常见的图像分辨率上，使网站能为用户提供更快速的服务，并且每天在数据传输上节省了 TB 级别的容量。按照 CDN 来衡量：</p>\n<p><img src=\"https://engineeringblog.yelp.com/images/posts/2017-05-31-making-images-smaller/Filesize-over-time.png\"></p>\n<p style=\"text-align: center;\">从 CDN（结合非图像静态内容）测量的平均文件大小。</p>\n<h3 id=\"what-we-didnt-do\">我们还没做的</h3>\n<p>本节旨在向您介绍可能能够做出的一些常见改进，有的是因为它们和 Yelp 使用的工具并无关系，有些是因为我们权衡后决定不做。</p>\n<h3 id=\"subsampling\">子采样</h3>\n<p>子采样是决定网页图像的质量和文件大小的主要因素。对于子抽样的更详尽的描述可以在网上找到，但在这个博客文章我们只要说以 4：1：1（这是 Pillow 的默认值，没有指定任何其他内容）进行子采样就够了，所以我们无法了解能进一步缩小多少。</p>\n<h3 id=\"lossy-png-encoding\">有损的 PNG 编码</h3>\n<p>在了解我们对 PNG 格式图片做了什么之后，用例如 pngmini 这样的有损编码器，选择将这些图片中一部分保留为 PNG 格式，可能是有意义的，但是我们选择将其重新保存成 JPEG 格式。这是一个结果看来合理的替代选项，根据作者的说法，未修改的 PNG 格式图片的文件大小缩小了 72-85 ％。</p>\n<h3 id=\"dynamic-content-types\">动态内容类型</h3>\n<p>为更多的现代化内容类型提供支持，如 WebP 或 JPEG2k 肯定是我们的未来要做的。而一旦这个假设的项目实行了，就会有大量的用户要求为现有已优化的 JPEG / PNG 图像做这些，这将继续使该项工作非常值得做。</p>\n<h3 id=\"svg\">SVG</h3>\n<p>我们在网站上的许多地方使用 SVG，就像我们设计师创建的静态资产，这已成为我们的指导风格。虽然这种格式和优化工具（如 svgo）有助于减少网站页面的开销，但它与我们在这里所做的工作无关。</p>\n<h3 id=\"vendor-magic\">供应商的魔术</h3>\n<p>能提供图像传送/调整大小/裁剪/转码服务的供应商太多，包括开源的 thumbor。也许这是支持响应式图像，动态内容类型的最简单方法，并且在将来仍然能让我们保持在技术前沿。而现在我们的解决方案仍然是独立的。</p>\n<h3 id=\"further-reading\">拓展阅读</h3>\n<p>这里列出的两本书在这个领域历史上是绝对能站稳脚跟的，强烈建议您进一步阅读这些书籍。</p>\n<ul>\n<li><a href=\"https://content.akamai.com/pg6293-high-performance-images-ebook.html\">High Performance Images</a></li>\n<li><a href=\"http://designingforperformance.com/\">Designing for Performance</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112321\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112321votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112321\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/fengzhuang19940106\">iScream</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/fengzhuang19940106\">\r\n\t\t\t<img src=\"http://q.qlogo.cn/qqapp/208656/91B5C8EB0B449C2B9F52CCED48C6B4CD/100\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            一个大的学生        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/fengzhuang19940106\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/fengzhuang19940106/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/fengzhuang19940106/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 15</a> · <a title=\"QQ：295039571\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "程序员的技术选择：发达国家和发展中国家有这些差异", "url": "http://blog.jobbole.com/112351/", "front_image_url": ["http://wx4.sinaimg.cn/large/7cc829d3gy1fj7ulu5ctdj20sg0sgwmd.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "开发,编程语言,薪资", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/huangxiaofei\">黄小非</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://stackoverflow.blog/2017/08/29/tale-two-industries-programming-languages-differ-wealthy-developing-countries/\">stackoverflow</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【导读】：Stack Overflow 工程师最近 David Robinson 做了一次数据分析，总结了程序员的技术选择和所在国家收入之间的关系。<b></b></p>\n<p>Stack Overflow 非常热衷于利用数据来和用户分享对全世界开发者社区的认知。比如这篇<a href=\"https://stackoverflow.blog/2017/08/22/world-mobile-development/\">关于 Android 开发者分布的文章</a>就是个很好的例子，它通过对全球开发者在 Stack Overflow 上询问 Andorid 相关问题统计，得出了结论：收入较低国家的开发者询问 Android 问题的数量要高于高收入国家的开发者。</p>\n<p>这个问题引发了我们的联想：<span style=\"color: #800000;\"><strong>高收入国家和低收入国家之间，开发人员在技术选择方面有什么不同呢？</strong></span>这种不同又会如何影响全球的软件开发产业呢？在本文中，我们就探索了上述的问题，并且发现通过收入来区分软件工业的发展，是一种很有效的办法。</p>\n<p>本文中的所有分析结论都是基于 2017 年 1 月 到 8 月的数据，并挑选在这段时间内出现频率 Top 250 标签进行统计的。为了减少数据样本过大可能造成的偏差，我们集中选取了相应时间段内来自 64 个国家的超过 500 万个问题进行分析。需要说明的是，这些数据很大程度上只反应了英语开发者们的行为模式（当然通过对西班牙语和葡萄牙语站点的分析，发现在墨西哥，西班牙这些国家，得到的分析结论和英语国家差不多）。</p>\n<h3>技术和人均 GDP 的相关性</h3>\n<p>在最近的一篇文章中，我们通过计算 Android 相关问题的比例（就是某个国家Android相关的问题的数量占该国整体Stack Overflow问题数据量的百分比），发现这个比例和这个国家的人均GPD是成反比的。所以我们也想知道，其他种类的技术和人均GDP的关系。</p>\n<p>因此我们调查了主流的编程语言和平台，包括PHP、Python、R 等等。<a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/b0e581c125a2252f8e54bfbe6db1f064.png\"><img class=\"aligncenter size-full wp-image-65858\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fj7ulu5ctdj20sg0sgwmd.jpg\" alt=\"tag_gdp_compare-1-2-1024x1024\" width=\"1024\" height=\"1024\"></a></p>\n<p>统计发现，来自某个国家 Android 相关问题和 PHP 相关问题的数量是和国家的收入情况成反比的，而同 Python、R 语言相关问题的数量则是正比。当然，在每一个统计案例里都会有例外的情况（例如，来自人均收入较高的韩国的 Android 问题数量要远超我们的预期，来自中国的 Python 问题的数量相对较低），但是总体来看，这种正反比关系还是很有说服力的。（多重假设检验调整后，每一种语言案例统计的决定系数都在 0.5 到 0.6 之间，P 值为 10 的负六次方）。</p>\n<p><span style=\"color: #800000;\">必须要说明一下，我们得出这些结论不是要说明什么因果性。我们并不是说，如果你选择了那些富有国家的开发者使用的编程语言，那么你所在的国家就能变成富有的国家。并且我们也不是说，国家的经济会直接影响到某种计算机技术的使用。我们只是发现，把经济和社会因素（例如教育程度，软件工业发展的年限，外包的水平等）看成一个整体，从总体上会与这个国家的财富多寡相关。</span></p>\n<h3>软件开发产业是按什么标准一分为二的？</h3>\n<p>在我们调查软件技术趋势时，通常只会把全世界的国家分成两组（即高收入国家和非高收入国家）来统计。我们不会把各国分成许多组来把相关性问题复杂化。因为在这方面已经有了很成熟的划分标准，我们就直接用<a href=\"https://datahelpdesk.worldbank.org/knowledgebase/articles/906519-world-bank-country-and-lending-groups\">世界银行收入分级标准</a>就可以了，这种分级法是以人均国民总收入（GNI）为基准的（具体的分类方法可以看<a href=\"https://datahelpdesk.worldbank.org/knowledgebase/articles/378831-why-use-gni-per-capita-to-classify-economies-into\">这里</a>）</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/4a90e3ee6a488ad0181fb4853f82f968.png\"><img class=\"aligncenter size-large wp-image-65861\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fj7uluvb7ej20sg0h243t.jpg\" alt=\"worldbank_map-1-1024x614\" width=\"1024\" height=\"614\"></a></p>\n<p>上图显示，全球一共有 78 个国家属于高收入国家，这些国家多半由美国、加拿大、西欧、部分中东和东亚国家，以及澳大利亚/新西兰构成。通过统计学的手段可以证明，这种划分方法是有足够依据的，而且这种划分方法比其他的方法更有意义，比如很多时候人们喜欢按照东西半球来划分国家，可实际上澳大利亚的技术分布情况却更接近美国和欧洲，而不是同属东半球的中国和印度尼西亚。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/bc8880913bdcd9e2cdba976f19f6e47a.png\"><img class=\"aligncenter size-large wp-image-65860\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fj7ulvf42zj20sg0izdip.jpg\" alt=\"top_countries-1-2-1024x683\" width=\"1024\" height=\"683\"></a></p>\n<p>这种分类方法同时也把 Stack Overflow 的访问量分成了两组，其中高收入国家访问量超过 2/3，剩余的国家占了访问量的不到 1/3。（得到这样的结果是和被调查国家软件开发人员的数量、互联网的基础设施的情况、以及说英语人数的情况严重相关的）。其中非高收入国家的访问量的排名分别为：印度、巴西、俄罗斯和中国。</p>\n<h3>高低收入国家使用的技术有什么不同？</h3>\n<p>我们已经把软件开发的世界分成了两个区域了。那么高收入国家和非高收入国家在使用的技术上有什么不同呢？</p>\n<p>我们从中可以看到一些有趣的结论：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/b605e4100f6835b922f7fe48534c2d6f.png\"><img class=\"aligncenter size-large wp-image-65859\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fj7ulw4j26j20sg0kbjxu.jpg\" alt=\"tech_difference_graph-1-1-1024x731\" width=\"1024\" height=\"731\"></a></p>\n<p><strong>数据科学技术的不同：</strong>我们之前已经看到，Python 和 R 语言的使用情况和国家的富有程度是相关的。Python 在高收入国家使用的规模大约是其余国家的两倍之多，而 R 语言的使用规模差达到了 3 倍多。我们还注意到，通过对内容更具体的标签（tags）的统计，发现在Python和R科学计算领域，使用不同的计算包的人收入跳度很明显，例如 pandas、numpy,、matplotlib 和 ggplot2。这说明了在数据科学研究方面，不同的技术角色之间存在收入鸿沟。当然在越富有，工业化程度越高的国家，数据科学研究的占国家经济的比例越大，程序员的学历也越高，这个结论是符合逻辑的。</p>\n<p><strong>C/C++：</strong>在 Stack Overflow 上还有两个值得一提的语言就是 C 和 C++，高收入国家的程序员访问这两种语言的次数比低收入国家程序员多。对这个现象，有一种猜测是，它和教育机构有关：因为在之前的一篇<a href=\"https://stackoverflow.blog/2017/02/15/how-do-students-use-stack-overflow/\">《学生如何使用Stack Overflow》</a>的帖子里，我们发现美国的大学对 C/C++ 的访问频率是非常高的。当然这个现象也可能和电器制造商的地理分布情况有关。</p>\n<p><strong>PHP </strong><strong>和 </strong><strong>Android</strong>：我们在以前的一篇<a href=\"https://stackoverflow.blog/2017/08/22/world-mobile-development/?utm_source=so-owned&amp;utm_medium=blog&amp;utm_campaign=gen-blog&amp;utm_content=blog-link&amp;utm_term=income-countries\">《全球移动开发调查》</a>的帖子中讨论了 Android 开发的情况，除此之外，还有一种技术和低收入国家息息相关，那就是 PHP。在Stack Overflow上，来自低收入国家的对 CodeIgniter(一个PHP开源框架)的问题非常的多，而高收入国家队这个框架的提问几乎没有，这么大悬殊实在是一个很有趣的现象。经过进一步的调查，发现对 CodeIgniter 的重度访问来自于南亚，东南亚（尤其是印度、印度尼西亚、巴基斯坦和菲律宾），来自美国或者都周的访问几乎没有。所以可以推断，这个框架主要是这些外包公司用来开发门户网站用的。</p>\n<h3>结论：统计这些有什么用？</h3>\n<p>我们做这些统计当然是因为对编程语言生态系统的兴趣。而且这对我们日后要做的数据探索有很大的启发。</p>\n<p>我们在说软件开发工业方面的问题时，要意识到我们的问题都是由两个单独的问题混合起来的，这很重要，因为这种混合会给我们带来更多的信息。</p>\n<p>比如，我们想找到是哪些技术给Stack Overflow带来最大的流量，例如：《<a href=\"https://stackoverflow.blog/2017/08/01/flash-dead-technologies-might-next/\">探寻Flash技术不不断缩水的原因</a>》。如果我们把访问量最多的技术列出一张表，你会发现高收入和低收入的国家的分布是完全不一样的。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/09/81bc32fb2d22b73b61614c4362fedb0a.png\"><img class=\"aligncenter size-full wp-image-65857\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fj7ulxy4z8j20sg0sg7ap.jpg\" width=\"1024\" height=\"1024\"></a></p>\n<p>例如，2017 年以来，Python 是来自高收入国家被访问第二多的话题，但是在非高收入国家，Python 只能排到第 8 位。而本文作者自己使用的 R 语言，在高收入国家访问数量的排名是第 15，但是在非高收入国家排名却在 50 开外。</p>\n<p>这些数据对 Stack Overflow 了解全球的开发者生态来说都是很重要的数据。而对于美国的技术招聘者来说，他们需要掌握未来的动向，所以他们需要了解更多的方面的数据，而不仅是“来自印度的学生要学习什么样的计算机语言”、“技术投资人在肯尼亚寻找合适的技术公司”这类话题。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://www.jobbole.com/wp-content/uploads/2016/04/78805a221a988e79ef3f42d7c5bfd4187.jpeg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112351\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112351votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112351\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/huangxiaofei\">黄小非</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/huangxiaofei\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/avatars/5423/Corbis-42-221258652.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            黄小非：毕业于重庆大学计算机系，南开大学软件工程硕士，SCJP。 目前在一家国企信息中心任职软件开发工程师。主要技术兴趣为Java平台相关技术、系统构架、C/C++、计算机图形学等。（新浪微博：@黄小非）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/huangxiaofei\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/huangxiaofei/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/huangxiaofei/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 65</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/huangxiaofei2002\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "使用 Redis 解决“树”形数据的复杂查询", "url": "http://blog.jobbole.com/112358/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 2, "tags": "IT技术,Redis,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/u/1469495/blog/1504818\">qiujiayu</a>   </div><p>最近因业务需要，研究了一下树数据结果的存储及查询解决方案。 最初的想法是使用neo4j,可是在网上看了一下开源的不支持集群，感觉用的人不多。</p>\n<p>网上也查了一些 <a href=\"http://blog.jobbole.com/112309/\">树形结构数据存储方案</a> 但每种实现方案都有它的一定局限性。</p>\n<p>想了一短时间后，想出了下面的方案：</p>\n<p>一、 因为复杂的查询都由Redis来处理，所以数据库表的设计就变得非常简单：tree 表</p>\n<p>| 字段名称 | 数据类型 | 备注说明 | | —- | —- | —- | | id | int | 主键 | | parent_id | int | 上级节点ID |</p>\n<p>二、Redis的数据存储方案：</p>\n<p>把表的数据存储到一个Hash表中，使用表中的id值做为此hash表的key, value值为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9be018a1b3101153924\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n   id: 10,\r\n   parentId: 9,\r\n   childIds: [11]\r\n}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1b3101153924-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1b3101153924-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1b3101153924-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1b3101153924-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1b3101153924-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1b3101153924-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9be018a1b3101153924-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1b3101153924-2\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1b3101153924-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">parentId</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1b3101153924-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">childIds</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1b3101153924-5\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1b3101153924-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p>\n<h3>代码实现</h3>\n<p>为了简化测试，这里只演示Redis相关的操作</p>\n<ol>\n<li>Tree 类定义<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9be018a1be437193944\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n public class Tree {\r\n     private Integer id;\r\n     private String name;\r\n     private Integer parentId;\r\n     private List&lt;Integer&gt; childIds;\r\n }\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1be437193944-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1be437193944-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1be437193944-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1be437193944-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1be437193944-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1be437193944-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1be437193944-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9be018a1be437193944-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Tree</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1be437193944-2\"><span class=\"crayon-h\">     </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Integer</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1be437193944-3\"><span class=\"crayon-h\">     </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1be437193944-4\"><span class=\"crayon-h\">     </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Integer</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parentId</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1be437193944-5\"><span class=\"crayon-h\">     </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">List</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">Integer</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">childIds</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1be437193944-6\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1be437193944-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n\n</li>\n<li>往Redis中添加测试数据：<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9be018a1c3456883844\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n [@Test](https://my.oschina.net/azibug)\r\n public void addTestData() throws Exception {\r\n     String key = \"tree-test-key\";\r\n     Tree tree = new Tree();\r\n     List&lt;Integer&gt; childIds = new ArrayList&lt;&gt;();\r\n     int max = 100000\r\n     tree.setChildIds(childIds);\r\n     for (int i = 0; i &lt; max; i++) {\r\n         tree.setId(i);\r\n         tree.setName(\"tree\" + i);\r\n         if (i &gt; 0) {\r\n             tree.setParentId(i - 1);\r\n         }\r\n         childIds.clear();\r\n         if(i &lt; (max - 1)){\r\n             childIds.add(i + 1);\r\n         }\r\n         redis.setHash(key, \"\" + i, JsonUtil.toJson(tree));\r\n     }\r\n }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c3456883844-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c3456883844-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c3456883844-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c3456883844-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c3456883844-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c3456883844-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c3456883844-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c3456883844-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c3456883844-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c3456883844-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c3456883844-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c3456883844-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c3456883844-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c3456883844-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c3456883844-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c3456883844-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c3456883844-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c3456883844-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c3456883844-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c3456883844-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9be018a1c3456883844-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//my.oschina.net/azibug)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c3456883844-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">void</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">addTestData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c3456883844-3\"><span class=\"crayon-h\">     </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"tree-test-key\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c3456883844-4\"><span class=\"crayon-h\">     </span><span class=\"crayon-e\">Tree </span><span class=\"crayon-v\">tree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Tree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c3456883844-5\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">List</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">Integer</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">childIds</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ArrayList</span><span class=\"crayon-o\">&lt;&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c3456883844-6\"><span class=\"crayon-h\">     </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100000</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c3456883844-7\"><span class=\"crayon-h\">     </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setChildIds</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">childIds</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c3456883844-8\"><span class=\"crayon-h\">     </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">max</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c3456883844-9\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setId</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c3456883844-10\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setName</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"tree\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c3456883844-11\"><span class=\"crayon-h\">         </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c3456883844-12\"><span class=\"crayon-h\">             </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setParentId</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c3456883844-13\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c3456883844-14\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">childIds</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">clear</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c3456883844-15\"><span class=\"crayon-h\">         </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">max</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c3456883844-16\"><span class=\"crayon-h\">             </span><span class=\"crayon-v\">childIds</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c3456883844-17\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c3456883844-18\"><span class=\"crayon-h\">         </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setHash</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">JsonUtil</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">toJson</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c3456883844-19\"><span class=\"crayon-h\">     </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c3456883844-20\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n\n</li>\n<li>Lua 代码的实现</li>\n</ol>\n<p>在Lua中使用递归时，需要使用“尾调用”来优化代码。关于尾调用的知识，大家可以上网去搜索。</p>\n<h4>获取所有子节点 get-tree-childs.lua</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9be018a1c9259923294\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlocal treeKey = KEYS[1]\r\nlocal fnodeId  = ARGV[1]\r\n\r\nlocal function getTreeChild(currentnode, t, res)\r\n  if currentnode == nil or t == nil  then\r\n    return res\r\n  end\r\n\r\n  local nextNode = nil\r\n  local nextType = nil\r\n  if t == \"id\" and (type(currentnode) == \"number\" or type(currentnode) == \"string\") then\r\n    local treeNode = redis.call(\"HGET\", treeKey, currentnode)\r\n    if treeNode then\r\n      local node = cjson.decode(treeNode)\r\n      table.insert(res, treeNode)\r\n      if node and node.childIds then\r\n        nextNode = node.childIds\r\n        nextType = \"childIds\"\r\n      end\r\n    end\r\n  elseif t == \"childIds\" then\r\n    nextNode = {}\r\n    nextType = \"childIds\"\r\n    local treeNode  = nil\r\n    local node = nil\r\n    local cnt = 0\r\n    for _, val in ipairs(currentnode) do\r\n      treeNode = redis.call(\"HGET\", treeKey, tostring(val))\r\n      if treeNode then\r\n        node = cjson.decode(treeNode)\r\n        table.insert(res, treeNode)\r\n        if node and node.childIds then\r\n          for _, val2 in ipairs(node.childIds) do\r\n            table.insert(nextNode, val2)\r\n            cnt = cnt + 1\r\n          end\r\n        end\r\n      end\r\n    end\r\n    if cnt == 0 then\r\n      nextNode = nil\r\n      nextType = nil\r\n    end\r\n  end\r\n  return getTreeChild(nextNode, nextType, res)\r\nend\r\n\r\n\r\nif treeKey and fnodeId then\r\n  return getTreeChild(fnodeId, \"id\", {})\r\nend\r\n\r\nreturn {}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1c9259923294-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1c9259923294-54\">54</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-1\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">KEYS</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-2\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">fnodeId</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ARGV</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-4\"><span class=\"crayon-e\">local </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeChild</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil  </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">res</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-7\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-8\"> </div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-10\"><span class=\"crayon-e\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-11\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"number\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"string\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"HGET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeNode </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-14\"><span class=\"crayon-h\">      </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cjson</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-15\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">table</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-16\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">childIds </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">childIds</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-18\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"childIds\"</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-19\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-21\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">elseif</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"childIds\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"childIds\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-25\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-26\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">val </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ipairs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-28\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"HGET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tostring</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-29\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeNode </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cjson</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">table</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">childIds </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-33\"><span class=\"crayon-h\">          </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">val2 </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ipairs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">childIds</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-34\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">table</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">val2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-35\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-36\"><span class=\"crayon-h\">          </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-38\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-41\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-42\"><span class=\"crayon-e\">      </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-43\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-44\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-45\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeChild</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-46\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-47\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-48\"> </div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-49\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeKey </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fnodeId </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-50\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeChild</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fnodeId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-51\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-52\"> </div><div class=\"crayon-line\" id=\"crayon-59b9be018a1c9259923294-53\"><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1c9259923294-54\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0074 seconds] -->\r\n<p></p>\n<h4>获取所有子节点数目 get-tree-childs-cnt.lua</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9be018a1ce313445123\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlocal treeKey = KEYS[1]\r\nlocal fnodeId  = ARGV[1]\r\n\r\nlocal function getTreeChildCnt(currentnode, t, res)\r\n  if currentnode == nil or t == nil  then\r\n    return res\r\n  end\r\n\r\n  local nextNode = nil\r\n  local nextType = nil\r\n  if t == \"id\" and (type(currentnode) == \"number\" or type(currentnode) == \"string\") then\r\n    local treeNode = redis.call(\"HGET\", treeKey, currentnode)\r\n    if treeNode then\r\n      local node = cjson.decode(treeNode)\r\n      res = res + 1\r\n      if node and node.childIds then\r\n        nextNode = node.childIds\r\n        nextType = \"childIds\"\r\n      end\r\n    end\r\n  elseif t == \"childIds\" then\r\n    nextNode = {}\r\n    nextType = \"childIds\"\r\n    local treeNode  = nil\r\n    local cnt = 0\r\n    for _, val in ipairs(currentnode) do\r\n      treeNode = redis.call(\"HGET\", treeKey, tostring(val))\r\n      if treeNode then\r\n        local node = cjson.decode(treeNode)\r\n        res = res + 1\r\n        if node and node.childIds then\r\n          for _, val2 in ipairs(node.childIds) do\r\n            table.insert(nextNode, val2)\r\n            cnt = cnt + 1\r\n          end\r\n        end\r\n      end\r\n    end\r\n    if cnt == 0 then\r\n      nextNode = nil\r\n      nextType = nil\r\n    end\r\n  end\r\n  return getTreeChildCnt(nextNode, nextType, res)\r\nend\r\n\r\n\r\nif treeKey and fnodeId then\r\n  return getTreeChildCnt(fnodeId, \"id\", 0)\r\nend\r\n\r\nreturn 0\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1ce313445123-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1ce313445123-53\">53</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-1\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">KEYS</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-2\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">fnodeId</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ARGV</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-4\"><span class=\"crayon-e\">local </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeChildCnt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil  </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">res</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-7\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-8\"> </div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-10\"><span class=\"crayon-e\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-11\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"number\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"string\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"HGET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeNode </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-14\"><span class=\"crayon-h\">      </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cjson</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-15\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-16\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">childIds </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">childIds</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-18\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"childIds\"</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-19\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-21\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">elseif</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"childIds\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"childIds\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-25\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">val </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ipairs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">currentnode</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-27\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"HGET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tostring</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-28\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeNode </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cjson</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">childIds </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-32\"><span class=\"crayon-h\">          </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">val2 </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ipairs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">childIds</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-33\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">table</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">val2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-34\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-35\"><span class=\"crayon-h\">          </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-37\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cnt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-40\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-41\"><span class=\"crayon-e\">      </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-42\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-43\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-44\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeChildCnt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nextNode</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nextType</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-45\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-46\"> </div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-47\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-48\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeKey </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fnodeId </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-49\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeChildCnt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fnodeId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"id\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-50\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-51\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1ce313445123-52\"><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1ce313445123-53\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0090 seconds] -->\r\n<p></p>\n<h4>获取所有子节点数目 get-tree-parent.lua</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9be018a1d2407102528\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlocal treeKey = KEYS[1]\r\nlocal nodeId  = ARGV[1]\r\n\r\nlocal function getTreeParent(treeKey, res, nodeId)\r\n  if nodeId == nil or not (type(nodeId) == \"number\" or type(nodeId) == \"string\") then\r\n    return res\r\n  end\r\n  local treeNode = redis.call(\"HGET\", treeKey, nodeId)\r\n  local nextNodeId = nil\r\n  if treeNode then\r\n    local node = cjson.decode(treeNode)\r\n    table.insert(res, treeNode)\r\n    if node then\r\n      nextNodeId = node.parentId\r\n    end\r\n  end\r\n  return getTreeParent(treeKey, res, nextNodeId)\r\nend\r\n\r\n\r\nif treeKey and nodeId then\r\n  return getTreeParent(treeKey, {}, nodeId)\r\nend\r\n\r\nreturn {}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d2407102528-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d2407102528-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d2407102528-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d2407102528-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d2407102528-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d2407102528-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d2407102528-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d2407102528-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d2407102528-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d2407102528-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d2407102528-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d2407102528-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d2407102528-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d2407102528-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d2407102528-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d2407102528-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d2407102528-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d2407102528-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d2407102528-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d2407102528-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d2407102528-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d2407102528-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d2407102528-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d2407102528-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d2407102528-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d2407102528-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9be018a1d2407102528-1\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">KEYS</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d2407102528-2\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ARGV</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d2407102528-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d2407102528-4\"><span class=\"crayon-e\">local </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeParent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d2407102528-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"number\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"string\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d2407102528-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">res</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d2407102528-7\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d2407102528-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"HGET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d2407102528-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nextNodeId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d2407102528-10\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeNode </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d2407102528-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cjson</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d2407102528-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">table</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">insert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d2407102528-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d2407102528-14\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">nextNodeId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parentId</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d2407102528-15\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d2407102528-16\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d2407102528-17\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeParent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nextNodeId</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d2407102528-18\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d2407102528-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d2407102528-20\"> </div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d2407102528-21\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeKey </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nodeId </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d2407102528-22\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeParent</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d2407102528-23\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d2407102528-24\"> </div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d2407102528-25\"><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d2407102528-26\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n<p></p>\n<h4>获取所有子节点数目 get-tree-parent-cnt.lua</h4>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9be018a1d5337221825\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nlocal treeKey = KEYS[1]\r\nlocal nodeId  = ARGV[1]\r\n\r\nlocal function getTreeParentCnt(treeKey, nodeId, res)\r\n  if nodeId == nil or not (type(nodeId) == \"number\" or type(nodeId) == \"string\") then\r\n    return res\r\n  end\r\n  local treeNode = redis.call(\"HGET\", treeKey, nodeId)\r\n  local nextNodeId = nil\r\n  if treeNode then\r\n    local node = cjson.decode(treeNode)\r\n    res = res + 1\r\n    if node then\r\n      nextNodeId = node.parentId\r\n    end\r\n  end\r\n  return getTreeParentCnt(treeKey, nextNodeId, res)\r\nend\r\n\r\n\r\nif treeKey and nodeId then\r\n  return getTreeParentCnt(treeKey, nodeId, 0)\r\nend\r\n\r\nreturn 0\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d5337221825-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d5337221825-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d5337221825-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d5337221825-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d5337221825-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d5337221825-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d5337221825-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d5337221825-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d5337221825-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d5337221825-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d5337221825-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d5337221825-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d5337221825-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d5337221825-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d5337221825-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d5337221825-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d5337221825-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d5337221825-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d5337221825-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d5337221825-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d5337221825-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d5337221825-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d5337221825-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d5337221825-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b9be018a1d5337221825-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9be018a1d5337221825-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9be018a1d5337221825-1\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">KEYS</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d5337221825-2\"><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ARGV</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d5337221825-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d5337221825-4\"><span class=\"crayon-e\">local </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeParentCnt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d5337221825-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"number\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">type</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"string\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d5337221825-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">res</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d5337221825-7\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d5337221825-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"HGET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d5337221825-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">nextNodeId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nil</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d5337221825-10\"><span class=\"crayon-e\">  </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeNode </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d5337221825-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">local </span><span class=\"crayon-v\">node</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cjson</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeNode</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d5337221825-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d5337221825-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d5337221825-14\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">nextNodeId</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parentId</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d5337221825-15\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d5337221825-16\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d5337221825-17\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeParentCnt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nextNodeId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d5337221825-18\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d5337221825-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d5337221825-20\"> </div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d5337221825-21\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">treeKey </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nodeId </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d5337221825-22\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getTreeParentCnt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">treeKey</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodeId</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d5337221825-23\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d5337221825-24\"> </div><div class=\"crayon-line\" id=\"crayon-59b9be018a1d5337221825-25\"><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9be018a1d5337221825-26\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n<p>以上代码因为使用了“尾调用”，所以变得相对比较复杂</p>\n<h3>总结</h3>\n<p>此方案相对比较灵活，能支持相对比较大量的数据。</p>\n<p>缺点：过于依赖Redis。数据同步会麻烦些，好在操作不是很复杂。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112358\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112358votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112358\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "给中级 Meld 用户的实用技巧", "url": "http://blog.jobbole.com/112348/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/04/e260ae4f5d153b25be87819b25ff0577.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.howtoforge.com/tutorial/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/\">Ansh</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8808-1.html\">Linux中国/geekpi</a>   </div><p>Meld 是 Linux 上功能丰富的可视化比较和合并工具。如果你是第一次接触，你可以进入我们的<a href=\"http://blog.jobbole.com/112344/\">初学者指南</a>，了解该程序的工作原理，如果你已经阅读过或正在使用 Meld 进行基本的比较/合并任务，你将很高兴了解本教程的东西，在本教程中，我们将讨论一些非常有用的技巧，这将让你使用工具的体验更好。</p>\n<p><em>但在我们跳到安装和解释部分之前，值得一提的是，本教程中介绍的所有说明和示例已在 Ubuntu 14.04 上进行了测试，而我们使用的 Meld 版本为 3.14.2</em>。</p>\n<h3 id=\"toc_1\">1、 跳转</h3>\n<p>你可能已经知道（我们也在初学者指南中也提到过这一点），标准滚动不是在使用 Meld 时在更改之间跳转的唯一方法 – 你可以使用向上和向下箭头键轻松地从一个更改跳转到另一个更改位于编辑区域上方的窗格中：</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-go-next-prev-9.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/ffe53b7d64bad7dac95f36ba889bc13d.png\" alt=\"Navigating in Meld\"></a></p>\n<p>但是，这需要你将鼠标指针移动到这些箭头，然后再次单击其中一个（取决于你要去哪里 – 向上或向下）。你会很高兴知道，存在另一种更简单的方式来跳转：只需使用鼠标的滚轮即可在鼠标指针位于中央更改栏上时进行滚动。</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-center-area-scrolling.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/84810b35573d599d2a5a3ef2d2ee916e.png\" alt=\"The change bar\"></a></p>\n<p>这样，你就可以在视线不离开或者分心的情况下进行跳转，</p>\n<h3 id=\"toc_2\">2、 可以对更改进行的操作</h3>\n<p>看下上一节的最后一个屏幕截图。你知道那些黑箭头做什么吧？默认情况下，它们允许你执行合并/更改操作 – 当没有冲突时进行合并，并在同一行发生冲突时进行更改。</p>\n<p>但是你知道你可以根据需要删除个别的更改么？是的，这是可能的。为此，你需要做的是在处理更改时按下 Shift 键。你会观察到箭头被变成了十字架。</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-delete-changes.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/c867a5a2a0153b0a72912ff16ef19151.png\" alt=\"Things you can do with changes\"></a></p>\n<p>只需点击其中任何一个，相应的更改将被删除。</p>\n<p>不仅是删除，你还可以确保冲突的更改不会在合并时更改行。例如，以下是一个冲突变化的例子：</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-conflicting-change.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/746a354faaf438fa66001862e1956e1b.png\" alt=\"Delete changes in Meld\"></a></p>\n<p>现在，如果你点击任意两个黑色箭头，箭头指向的行将被改变，并且将变得与其他文件的相应行相似。只要你想这样做，这是没问题的。但是，如果你不想要更改任何行呢？相反，目的是将更改的行在相应行的上方或下方插入到其他文件中。</p>\n<p>我想说的是，例如，在上面的截图中，需要在 “test23” 之上或之下添加 “test 2”，而不是将 “test23” 更改为 “test2”。你会很高兴知道在 Meld 中这是可能的。就像你按下 Shift 键删除注释一样，在这种情况下，你必须按下 Ctrl 键。</p>\n<p>你会观察到当前操作将被更改为插入 – 双箭头图标将确认这一点 。</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-ctrl-insert.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/d48a91909a13070aadaac9d3377057ba.png\" alt=\"Change actions\"></a></p>\n<p>从箭头的方向看，此操作可帮助用户将当前更改插入到其他文件中的相应更改 (如所选择的)。</p>\n<h3 id=\"toc_3\">3、 自定义文件在 Meld 的编辑器区域中显示的方式</h3>\n<p>有时候，你希望 Meld 的编辑区域中的文字大小变大（为了更好或更舒适的浏览），或者你希望文本行被包含而不是脱离视觉区域（意味着你不要想使用底部的水平滚动条）。</p>\n<p>Meld 在 <em>Editor</em> 选项卡（<em>Edit-&gt;Preferences-&gt;Editor</em>）的 <em>Preferences</em> 菜单中提供了一些显示和字体相关的自定义选项，你可以进行这些调整：</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-editor-tab.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/e338b0cbc7bfbabd22b4ee2d44ff46d7.png\" alt=\"Meld preferences\"></a></p>\n<p>在这里你可以看到，默认情况下，Meld 使用系统定义的字体宽度。只需取消选中 <em>Font</em> 类别下的框，你将有大量的字体类型和大小选项可供选择。</p>\n<p>然后在 <em>Display</em> 部分，你将看到我们正在讨论的所有自定义选项：你可以设置 Tab 宽度、告诉工具是否插入空格而不是 tab、启用/禁用文本换行、使Meld显示行号和空白（在某些情况下非常有用）以及使用语法突出显示。</p>\n<h3 id=\"toc_4\">4、 过滤文本</h3>\n<p>有时候，并不是所有的修改都是对你很重要的。例如，在比较两个 C 编程文件时，你可能不希望 Meld 显示注释中的更改，因为你只想专注于与代码相关的更改。因此，在这种情况下，你可以告诉 Meld 过滤（或忽略）与注释相关的更改。</p>\n<p>例如，这里是 Meld 中的一个比较，其中由工具高亮了注释相关更改：</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-changes-with-comments.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/fb371296bbb42b3f6f915ac9b972510b.png\" alt=\"Filter Text in Meld\"></a></p>\n<p>而在这种情况下，Meld 忽略了相同的变化，仅关注与代码相关的变更：</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-changes-without-comments.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/90750b2dd9bb246c780ae1b82fced95e.png\" alt=\"Ignore Changes in Meld\"></a></p>\n<p>很酷，不是吗？那么这是怎么回事？为此，我是在 “<em>Edit-&gt;Preferences-&gt;Text Filters</em>” 标签中启用了 “C comments” 文本过滤器：</p>\n<p><a href=\"https://www.howtoforge.com/images/beginners-guide-to-visual-merge-tool-meld-on-linux-part-2/big/meld-text-filters.png\"> <img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/411274b89687a5a801c83b74a4310ac3.png\" alt=\"C-Comments in Meld\"></a></p>\n<p>如你所见，除了 “C comments” 之外，你还可以过滤掉 C++ 注释、脚本注释、引导或所有的空格等。此外，你还可以为你处理的任何特定情况定义自定义文本过滤器。例如，如果你正在处理日志文件，并且不希望 Meld 高亮显示特定模式开头的行中的更改，则可以为该情况定义自定义文本过滤器。</p>\n<p>但是，请记住，要定义一个新的文本过滤器，你需要了解 Python 语言以及如何使用该语言创建正则表达式。</p>\n<h3 id=\"toc_5\">总结</h3>\n<p>这里讨论的所有四个技巧都不是很难理解和使用（当然，除了你想立即创建自定义文本过滤器），一旦你开始使用它们，你会认为他们是真的有好处。这里的关键是要继续练习，否则你学到的任何技巧不久后都会忘记。</p>\n<p>你还知道或者使用其他任何中级 Meld 的贴士和技巧么？如果有的话，欢迎你在下面的评论中分享。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112348\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112348votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112348\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "MySQL 创始人：写代码比打游戏还爽，程序员应该多泡开源社区", "url": "http://blog.jobbole.com/112366/", "front_image_url": ["https://pic.36krcnd.com/avatar/201708/31082811/du4b3zkobsgzg70e.jpeg!1200"], "praise_nums": "1", "comment_nums": 1, "fav_nums": 3, "tags": "职场,MySQL", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://blog.openocean.vc/founder-stories-a-hackers-hacker-6d5054c90564\">OpenOcean</a>   译文出处：<a target=\"_blank\" href=\"http://36kr.com/p/5090841.html\">36氪</a>   </div><p>编者按：根据StackOverflow的最新调查，MySQL仍然是全世界最流行的数据库，受访的开发者中有44.3%的人在使用，超过了第二位的SQL Server 10多个百分点。可是你知道MySQL是怎么诞生的吗？openocean 的一篇有关MySQL开发者Michael “Monty” Widenius的传记为我们揭秘。</p>\n<p><span class=\"load-html-img loaded\"><img class=\"aligncenter\" src=\"https://pic.36krcnd.com/avatar/201708/31082811/du4b3zkobsgzg70e.jpeg!1200\" alt=\"MySQL创始人：写代码比打游戏还爽，程序员应该多泡开源社区\"></span></p>\n<p>大学计算机专业的数量总是会随着技术公司的兴衰而起伏，而现在，计算机科学正处在全盛时期。这意味着，不管怎样，计算机科学专业的毕业生绝大部分可能都会去敲2年的代码，再转到产品管理，然后过渡到企业、创业或者商学院，接着再转为既有公司的中层管理，32岁的时候结婚，有了2个孩子，一个儿子，一个女儿，一条狗，还有一栋2层的漂亮房子。对于大多数人来说，成为程序员就是一份朝九晚五的工作，一份有保障的6位数薪水来偿还高昂的学费，一种达到目的的手段，没人应该为此受到责备。但对于千千万万无论好坏的程序员来说，只有一个Monty Widenius。</p>\n<p>Monty是一位编程天才。19岁的时候，他从赫尔辛基理工大学辍学开始全职工作，因为大学已经没有什么东西可以教他了。在独自一人写完除了一个库以外的全部代码之后，33岁时，他发布了MySQL，后来后者成为了全世界最流行的开源数据库。55岁时，他藐视着对老年人的歧视，仍然是自己公司最好的程序员。</p>\n<p>Monty1962年出生于赫尔辛基，1978年他用暑假铺沥青挣来的钱买下自己的第一台个人计算机的。Monty迅速意识到自己相当擅长写代码——对于别人来说很复杂的事情他却觉得很简单，而且他对工作非常投入。Monty用一种在讲瑞典语的芬兰人中常见的浓厚口音说：“基本上这就像是在阅读一本真的非常非常好的书。或者像在玩视频游戏。你知道开始玩游戏然后嘣一声3小时的时间就过去了的那种感觉吗？写代码对我来说就是这种感觉。”</p>\n<p>当别人跑去聚会的时候，Monty却呆在家里编程。他把计算机从里到外都摸透了。他把BASIC的能力推到了极限。Monty说：“学校并不理解编程不是像语言或者历史这样的东西，它不是靠学就能学来的。所以学校是不够的。拔尖的黑客是万里挑一。他们奉献了所有能用的时间，10小时，16小时，每一天，年复一年周而复始。大多数人都不愿意做这样的事情。大多数人宁愿好好生活。”在Monty眼里，好的代码是写过一次就永远不需要再碰的那种。从性能角度来看它已经是最优化了，你可以不断增强，但永远都不需要重写。</p>\n<p>到1980年，17岁的Monty痴迷编程已经无法自拔，他需要把自己计算机的内存从8KB扩到16KB。由于芬兰没有商店卖他想要的东西，于是他弄了一条船去到瑞典Allan Larsson的计算机商店。通过Allan，Monty结识了David Axmark，三人沟通交流了多年，就各自项目互相帮忙，偶尔也会一起协作。1995年，他们一起成立了MySQL AB。Monty负责编程，David和Allan负责干完其他的事情。自1981年以来，Monty就一直以芬兰公司Tapio Laakso Oy程序员的身份在写MySQL前身的代码，他和Allan一起创办的数据仓库公司也要用到那个东西。然而，知道1995年，在Allan和David的游说之后Monty才决定在他写的东西之上增加一个SQL层。1996年10月，MySQL终于发布了，它得到了广泛的欢迎。MySQL快速、可靠并且易学，这主要是因为在多年的开发中Monty总是不断把正是客户的反馈整合进来。</p>\n<p>MySQL的初衷是存储和管理大数据。如果有人想要跟踪不同的数据点，他们互使用数据库，也就是有点像微软Excel那样的东西。然而，随着数据变得越来越大，查找Excel这样的数据库就会变得慢多了，也不再可靠。MySQL有能力存储大量数据，并且返回搜索结果极其迅速。“My”来自Monty女儿的名字，而“SQL”就是结构化查询语言（Structured Query Language）的意思，是一种跟数据库沟通的语言。</p>\n<p>对MySQL开源的决定出自1985年的另一次芬兰到瑞典的乘船旅行，这一次是在一场开源大会上。Monty说：“讨论没花多少分钟。我们都希望回馈给开源社区一点东西。哪怕有人想拷贝或者偷盗我们的代码，我们认为自己能挣的钱也不会比现在少。”开源项目使得开发者社区帮助把软件做得更好，但从商业角度来看不好的是货币化就要困难多了。为了避免这一点，Monty补充了一个条款，那就是如果任何企业用MySQL来赚钱的话，就需要付费授权。对此MySQL的代码里面并没有进行任何限制，但就靠这一荣誉制度MySQL实现了扩张并开始赚钱。Monty说：“我认为开源是开发软件的更好方式。但你仍然需要赚够钱来招聘员工，成立公司去跟闭源社区竞争。MySQL是第一款做到这一点的产品。”</p>\n<p>Monty在MySQL AB的职位是CTO，对于大多数成熟的公司来说，CTO其实已经很少再编程的了。然而，Monty从未停下来过，他的绝大部分时间都是在写代码。这种（很少管理的）做法会导致很多晚期阶段初创企业内爆，但哪怕公司人数已经达到550人，Monty在MySQL AB建立的独特文化也使得他可以避免天天开会的烦扰（事实上，Monty甚至都不接受议事日程邀请）。Monty说：“我总是招会自我驱动的人进来。所以我不需要告诉他们太多东西。而开源意味着你有开源社区，大家会给你提供代码，你可以看看那些代码的质量，看看他们是怎么跟社区互动的，跟你是怎么沟通的，他们会问什么问题，在这些情况下很容易就能看出一个人是好是坏。在一次面试里面是很难了解清楚编码者有多好的。”</p>\n<p>MySQL的成功是CTO Monty与CEO Mårten Mickos通力协作的结果。两人能力都很强且对公司非常重要，但方式不一样。Monty是技术专家，专注于员工生产出尽量完美的代码。Mårten是公司建设者，专注于交付东西并帮助团队发展。正是两人的联合愿景制造出了MySQL。但在一家没有免费洗衣、免费午餐、站立办公桌的公司里，是Monty的个人魅力吸引住了变成人才。Monty不是好交际的筹资人，讨好别人的人，博弈论大师，或者职业沟通者。他会写代码，而且写得很好。在Monty看来赢得开发者尊重是很简单的事情：“你干的是跟他们一样的事，而且干得更好。”</p>\n<p><strong>Monty给程序员的建议是，参与到开源社区去，花些时间到个人项目里面</strong>（“这些年来我开发了成百上千个程序：MySQL是其中被用得最多的一个，但其他的都只有我自己用。”）。他警告说，改变环境和代码库将意味着哪怕是最好的程序员也要去了解一堆的东西。在Sun被Oracle收购之后，Monty成立了MariaDB，这是MySQL的一个社区版的分支，开发的团队成员很多都是MySQL团队里面的，使用的也是一样的官方语言：“蹩脚的英语”。MySQL的许多热心的开源信徒跟着Monty去到了MariaDB。MariaDB更加面向开发者，允许由外人打补丁这样的事情发生，在很多Linux发行版中它都是默认的数据库。</p>\n<p>Monty对开源和开发者的承诺是坚定的——OpenOcean原先是Monty用自己在MySQL的所得成立的，使命是投身于开发者驱动、有技术深度的产品。他仍然在赫尔辛基自己家中主持开发者午餐，很快OpenOcean就将推出一个Slack频道让开发者可以直接向Monty提问。在几十年的时间里，Monty对塑造开源社区无私的形象做出的贡献无可争议的。但这里面大部分的功劳都应该归到成千上万无名的程序员和黑客身上，是他们投入的时间和能力造就了开源的繁荣，也是这批人才能确保开源革命的继续。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112366\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112366votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112366\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "颜值即正义，超好用的 Linux 桌面个性化工具推荐", "url": "http://blog.jobbole.com/112327/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 2, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/editorial-story/blog/1527138\">开源中国编辑部</a>   </div><p>对于系统桌面，有人追求美观，有人追求简洁，有人追求实用，也有人就是喜欢默认的设置效果。接下来，推荐几款适用于 Linux 的开源桌面个性化工具，代码敲累了的时候，换换主题，说不定也能让你更放松。</p>\n<h3><a href=\"https://github.com/horst3180/arc-theme\" target=\"_blank\" rel=\"nofollow\">1、Arc</a></h3>\n<p>一款主打透明元素的扁平化主题，支持基于 GTK 3 和 GTK 2 的桌面环境，如 GNOME、Unity、Budgie、Pantheon、Xfce、MATE 等，内含 3 种不同的风格可供选择。</p>\n<p>Arc</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/e41e73992d65b40d4d856f068e9d8d62.png\" width=\"728\" height=\"155\"></p>\n<p>Arc-Darker</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/fbc7c1532ebf62c705c2e98744257133.png\" width=\"728\" height=\"155\"></p>\n<p>Arc-Dark</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/5abc27be17959c64e32449fcaa25b5c6.png\" width=\"728\" height=\"155\"></p>\n<h3><a href=\"http://github.com/anmoljagetia/Flatabulous\" target=\"_blank\" rel=\"nofollow\">2、<strong>Flatabulous</strong></a></h3>\n<p>一款扁平化主题，适用于 Ubuntu 以及其它基于 Gnome 的 Linux 系统。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/6522206a9c1be1c6ef3506fbe28c85cc.png\" width=\"1366\" height=\"768\"></p>\n<h3><a href=\"https://github.com/adapta-project/adapta-gtk-theme\" target=\"_blank\" rel=\"nofollow\">3、Adapta</a></h3>\n<p>一款自适应的 Gtk+ 主题，遵循当前比较流行的 Material Design 设计风格。支持 GNOME、Budgie、Cinnamon、Unity、XFce4、Mate、LXDE 等桌面环境。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/1874fddce2d1634263d80adbfa498f14.png\" width=\"800\" height=\"800\"></p>\n<h3><a href=\"https://github.com/numixproject/numix-gtk-theme\" target=\"_blank\" rel=\"nofollow\">4、Numix</a></h3>\n<p>一款结合了明暗元素的现代化平面主题，支持 Gnome、Unity、XFCE 和 Openbox 。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/9ec4cee40a68985bdd7163f64eefcfe7.png\" width=\"1406\" height=\"1600\"></p>\n<h3><a href=\"https://krourke.org/projects/art/la-capitaine-icon-theme\" target=\"_blank\" rel=\"nofollow\">5、La Capitaine</a></h3>\n<p>这是一个图标主题，目标是适配大部分桌面环境。里面的图标受 macOS 和 Material Design 启发，主要是使用视觉上容易吸引眼球的渐变、阴影和简单的几何形式元素。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/09/4700d547b2265628ab762d53a2d5a658.png\" width=\"1500\" height=\"2000\"></p>\n<h3><a href=\"https://github.com/PapirusDevelopmentTeam/papirus-icon-theme\" target=\"_blank\" rel=\"nofollow\">6、Papirus</a></h3>\n<p>基于非开源的 <a href=\"https://snwh.org/paper\" target=\"_blank\" rel=\"nofollow\">Paper</a> 主题，并有一些额外的特性（如硬编码托盘支持，kde 颜色方案支持，libreoffice 图标主题，filezilla 主题，smplayer 主题…）以及其它的修改的 SVG 图标主题。有 Papirus 、Papirus Dark、Papirus Light、ePapirus 四种风格可供选择。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/6bd12b2013111e5a71af592a691fba2c.png\" width=\"370\" height=\"364\"></p>\n<h3><a href=\"https://github.com/bil-elmoussaoui/Hardcode-Tray\" target=\"_blank\" rel=\"nofollow\">7、Hardcode Tray</a></h3>\n<p>这是一个托盘脚本，通过在 Linux 中自动探测你的默认主题，正确的图标尺寸，硬编码内嵌图标应用，以及正确的状态图标，来修正硬编码的托盘图标。它还支持上面提到的 Numix 和 Papirus 。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/c5ddb413c4c4f2777d2a8a12475a112a.png\" width=\"727\" height=\"87\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/09/e1c69452a123294ca53f1fa4f690b46e.png\" width=\"718\" height=\"195\"></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112327\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112327votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112327\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "11 个超酷的编程新工具", "url": "http://blog.jobbole.com/112288/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/3a896dd4ec8d7dedbf3683bfca9e31c4.jpg"], "praise_nums": "3", "comment_nums": 0, "fav_nums": 6, "tags": "IT技术,工具", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://dzone.com/articles/11-cool-new-coding-tools-to-know?utm_medium=feed&amp;utm_source=feedpress.me&amp;utm_campaign=Feed:%20dzone\">Damian Wolf</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/11-cool-new-coding-tools-to-know?print\">开源中国</a>   </div><p>工具对开发人员来说至关重要。工具可以让一个开发人员的日常工作更高效，并且只需要关注最重要的事情。对于开发人员来讲，寻找更好的替代工具往往比坚持使用熟悉单身过时的工具更困难。</p>\n<p>在这篇文章中，我们将列出你在日常工作中能够使用的新的开发工具。很多对在线流媒体感兴趣的开发人员已经开始在他们的开发环境中使用这些新工具，因为相比他们的旧的设施来讲这些工具提供了更多的优势。</p>\n<p>你可能会想，如果旧的工具可以完成工作，还有必要去寻找新的工具吗？技术总是在变化，而且与我们的工作方式息息相关，它需要保持更新。此外，新工具可以在某些方面对工作进行自动化，让你更好的控制工作流程，从而带来更大的价值。因此，如果你现在确信并准备考虑使用市场上新的编程工具，请继续阅读本文，了解其中最好的一些。</p>\n<h1>LiveEdu</h1>\n<p><a href=\"https://www.liveedu.tv/\" target=\"_blank\" rel=\"nofollow\">LiveEdu</a> 是开发者和工程师入驻的好地方。它是一个基于项目的学习平台，服务于游戏开发、设计、数据科学、编程、增强现实、人工智能和虚拟现实等方面的技能提升。学习的关键在于项目的真实性，以及 <a href=\"https://www.liveedu.tv/projects/premium/\" target=\"_blank\" rel=\"nofollow\">LiveEdu 平台额外提供的项目教程</a>，这些教程涵盖大量不同的主题，适用于任何人，包括初学者。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/3a896dd4ec8d7dedbf3683bfca9e31c4.jpg\"><img class=\"aligncenter size-full wp-image-112289\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/3a896dd4ec8d7dedbf3683bfca9e31c4.jpg\" alt=\"1-LiveEdu.tv\"></a></p>\n<h1>Standup</h1>\n<p><a href=\"https://getstandup.com/\" target=\"_blank\" rel=\"nofollow\">Standup</a> 是一个监控团队开发进度的好工具。它很好地集成了你已经在用的所有工具，比如Trello， BitBucket， GitHub，以及其他工具。它是怎么工作的呢？它会完全按照开发团队成员的提交历史来自动生成工作报告。这项应用使团队之间共享信息变得更容易，也让团队成员之间形成了积极的竞争关系。该主意是Mesh Studio在完成一个客户的严格的汇报需求的合同工作的时候想出来的。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/3a127c8395466be2c10e9248164371cd.jpg\"><img class=\"aligncenter size-full wp-image-112294\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/3a127c8395466be2c10e9248164371cd.jpg\" alt=\"1-LiveEdu.tv\"></a></p>\n<h1>Cell</h1>\n<p><a href=\"http://www.celljs.org/\" target=\"_blank\" rel=\"nofollow\">Cell</a> 自称为“自驱动的网页应用开发框架”。框架这个词让人立刻想到它应该包含APIs，方法，或其他框架具备的功能。然而，Cell 提供的是一种写 HTML 代码的全新的方式。它基于三个简单的规则，而且不运行任何函数就自助建立 DOM。Cell 提供了一种类似写小说的方式来开发网页应用。</p>\n<p>请看示例代码。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc9b5a9ae713209298\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;html&gt;\r\n&lt;script src=\"https://www.celljs.org/cell.js\"&gt;&lt;/script&gt;\r\n&lt;script&gt;\r\nvar el = {\r\n  $cell: true,\r\n  style: \"font-family: Helvetica; font-size: 14px;\",\r\n  $components: [\r\n    {\r\n      $type: \"input\",\r\n      type: \"text\",\r\n      placeholder: \"Type something and press enter\",\r\n      style: \"width: 100%; outline:none; padding: 5px;\",\r\n      $init: function(e) { this.focus() },\r\n      onkeyup: function(e) {\r\n        if (e.keyCode === 13) {\r\n          document.querySelector(\"#list\")._add(this.value);\r\n          this.value = \"\";\r\n        }\r\n      }\r\n    },\r\n    {\r\n      $type: \"ol\",\r\n      id: \"list\",\r\n      _items: [],\r\n      $components: [],\r\n      _add: function(val) { this._items.push(val) },\r\n      $update: function() {\r\n        this.$components = this._items.map(function(item) {\r\n          return { $type: \"li\", $text: item }\r\n        })\r\n      }\r\n    }\r\n  ]\r\n}\r\n&lt;/script&gt;\r\n&lt;/html&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc9b5a9ae713209298-36\">36</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc9b5a9ae713209298-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">html</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc9b5a9ae713209298-2\"><span class=\"crayon-ta\">&lt;script </span><span class=\"crayon-e \">src</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"https://www.celljs.org/cell.js\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-ta\">&lt;/script&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc9b5a9ae713209298-3\"><span class=\"crayon-ta\">&lt;script&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc9b5a9ae713209298-4\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">el</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc9b5a9ae713209298-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">cell</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc9b5a9ae713209298-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">style</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"font-family: Helvetica; font-size: 14px;\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc9b5a9ae713209298-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">components</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc9b5a9ae713209298-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc9b5a9ae713209298-9\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"input\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc9b5a9ae713209298-10\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"text\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc9b5a9ae713209298-11\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">placeholder</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Type something and press enter\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc9b5a9ae713209298-12\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">style</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"width: 100%; outline:none; padding: 5px;\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc9b5a9ae713209298-13\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">init</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">focus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc9b5a9ae713209298-14\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">onkeyup</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc9b5a9ae713209298-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">keyCode</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">===</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc9b5a9ae713209298-16\"><span class=\"crayon-h\">          </span><span class=\"crayon-v\">document</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">querySelector</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"#list\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc9b5a9ae713209298-17\"><span class=\"crayon-h\">          </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc9b5a9ae713209298-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc9b5a9ae713209298-19\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc9b5a9ae713209298-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc9b5a9ae713209298-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc9b5a9ae713209298-22\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ol\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc9b5a9ae713209298-23\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"list\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc9b5a9ae713209298-24\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">_items</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc9b5a9ae713209298-25\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">components</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc9b5a9ae713209298-26\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">_add</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">push</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc9b5a9ae713209298-27\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">update</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc9b5a9ae713209298-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">components</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">item</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc9b5a9ae713209298-29\"><span class=\"crayon-h\">          </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">type</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"li\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">item</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc9b5a9ae713209298-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc9b5a9ae713209298-31\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc9b5a9ae713209298-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc9b5a9ae713209298-33\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc9b5a9ae713209298-34\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc9b5a9ae713209298-35\"><span class=\"crayon-ta\">&lt;/script&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc9b5a9ae713209298-36\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0070 seconds] -->\r\n<p>上面这段代码可以生成如下HTML：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/e8ba56d831e236baa499c6d2aeb80a2c.png\"><img class=\"aligncenter size-full wp-image-112295\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/e8ba56d831e236baa499c6d2aeb80a2c.png\" alt=\"autnonomous_dom\"></a></p>\n<h1>Osquery</h1>\n<p><a href=\"https://osquery.io/\" target=\"_blank\" rel=\"nofollow\">Osquery</a> 是 Facebook 通过 Query 语言揭示操作系统的方法。尽管初看并不吸引人，但其实有着很多实际的用途。例如，你可以通过它来获取通过USB连接的硬件设备列表。</p>\n<p>如果开发者想要保护他们的 APP 不受安全漏洞的影响，或是能在不同的系统上监视他们的应用，那么其中一个有效方法是不使用底层函数或API交互的能力。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/030b4cdf07d5b1fff4501c159be7740b.jpg\"><img class=\"aligncenter size-full wp-image-112296\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/030b4cdf07d5b1fff4501c159be7740b.jpg\" alt=\"1-LiveEdu.tv\"></a></p>\n<h1>React Native Firebase</h1>\n<p><a href=\"https://github.com/invertase/react-native-firebase?ref=stackshare\" rel=\"nofollow\">React Native Firebase</a> 旨在帮助开发者更好地使用 React Native 和Firebase。 RN Firebase 可以让你使用 JavaScript bridge 在 Android 和 iOS 上轻松访问本地 eFirebase SDK</p>\n<h1>Warp</h1>\n<p><a href=\"https://github.com/spolu/warp?ref=stackshare\" rel=\"nofollow\">Warp </a>是一个简单的工具，它可以让任何人分享他们的终端。分享终端就像输入一个 warp open 命令那么简单。这可以帮助开发者或主机供应商彼此分享终端。该工具的主要特点是安全和易于传输。让分享从未如此容易！你很快就会忘记SSH 的必要性，并使用它跟同远程团队和刚入坑的小伙伴进行互动。</p>\n<h1>Draft</h1>\n<p><a href=\"https://github.com/Azure/draft\" target=\"_blank\" rel=\"nofollow\">Draft</a> 是一个可以帮助开发者轻松在 Kubernet 构建应用程序的新工具。直到现在，把应用移动版本库之前的测试仍是一件费时费力的工作。有了 Draft，开发者可以在Kubernetes的开发沙箱中把“内循环”和测试应用作为测试对象。沙箱可以通过公共URL获得，并可以使用本地编辑器修改。</p>\n<h1>Docsify</h1>\n<p><a href=\"https://docsify.js.org/\" rel=\"nofollow\">Docsify</a> 是一个文档站点生成器工具。但它完全不同于其他静态的HTML文件生成器。有了 Docsify，你可以使用 Markdown 文件生成你的站点。这样你就可以在 Markdown 上修改代码并及时看到更新。这一特点使得它媲美GitBook等其他流行工具。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/624701b202ab86af496a8f4830a5a6bf.jpg\"><img class=\"aligncenter size-full wp-image-112297\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/624701b202ab86af496a8f4830a5a6bf.jpg\" alt=\"1-LiveEdu.tv\"></a></p>\n<h1>Prismic IO</h1>\n<p><a href=\"https://prismic.io/\" rel=\"nofollow\">Prismic IO</a> 是一个无头CMS系统的后台应用。感谢 API 让它可以和任何站点和App一起使用，并很容易和已有的系统进行整合。CMS 也为营销人员提供了一些现代化的发布和创作工具。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/599f353f6d045c4e0809c4a27437185f.jpg\"><img class=\"aligncenter size-full wp-image-112298\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/599f353f6d045c4e0809c4a27437185f.jpg\" alt=\"1-LiveEdu.tv\"></a></p>\n<h1>Javalin</h1>\n<p><a href=\"https://javalin.io/?ref=stackshare\" rel=\"nofollow\">Javalin</a> 为Kotlin和Java提供了简单的REST API。 这个REST API易于使用，API也非常的流畅。它不是框架，因此不会被混淆。它的目的是提供一个易用的轻量级 REST API库。</p>\n<p>下面是用Kotlin实现的 “Hello World”API的例子。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc9b5a9bb019583897\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport io.javalin.Javalin\r\nfunmain(args: Array&lt;String&gt;) {\r\n    val app = Javalin.create().port(7000)\r\n    app.get(\"/\") { ctx -&gt; ctx.result(\"Hello World\") }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc9b5a9bb019583897-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc9b5a9bb019583897-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc9b5a9bb019583897-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc9b5a9bb019583897-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc9b5a9bb019583897-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc9b5a9bb019583897-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">io</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">javalin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Javalin</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc9b5a9bb019583897-2\"><span class=\"crayon-e\">funmain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">args</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Array</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">String</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc9b5a9bb019583897-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">val </span><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Javalin</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">port</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">7000</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc9b5a9bb019583897-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ctx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ctx</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">result</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Hello World\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc9b5a9bb019583897-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p></p>\n<h1>Bootsnap</h1>\n<p>我们都知道速度对某些应用程序而言有多重要。Ruby的性能臭名昭著。然而，<a href=\"https://stackshare.io/bootsnap?utm_source=sitepoint&amp;utm_medium=guest_post&amp;utm_campaign=top_new_tools_june_2017&amp;utm_term=dev_tools&amp;utm_content=post\" target=\"_blank\" rel=\"nofollow\">Bootsnap</a>尝试通过缓存很多Ruby方法并提高其整体性能来加快其速度。它可以以gem的形式轻松插入你的应用程序中，目前可用于 MacOS 和 Linux 系统。</p>\n<h1>最后的思考<del></del></h1>\n<p>编码工具是开发人员工具的一部分。 就像其他职位一样，其对提高效率是很有帮助的。最终这些新的编码工具肯定会以某种方式帮助你。但是，上述提及的工具是非常专业的，你可能根本不会使用到它们。在这种情况下，我们期盼你对最近使用的任何新编码工具（与你的工作相关）进行评论。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112288\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112288votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112288\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "树形结构数据存储方案（一）：邻接列表模式", "url": "http://blog.jobbole.com/112309/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 2, "tags": "IT技术,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.biaodianfu.com/adjacency-list.html\">标点符</a>   </div><p>在程序开发中，我们常遇到用树型结构来表示某些数据间的关系，如企业的组织架构、商品的分类、操作栏目等，目前的关系型数据库都是以二维表的形式记录存储数据，而树型结构的数据如需存入二维表就必须进行Schema设计。最近对此方面比较感兴趣，专门做下梳理，如下为常见的树型结构的数据：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/22f7d85dbaeaaf50d465db3628ed7427.jpg\" alt=\"tree\" width=\"231\" height=\"259\"></p>\n<p>其中最简单的方法是：Adjacency List（邻接列表模式）。简单的说是根据节点之间的继承关系，显现的描述某一节点的父节点，从而建立二位的关系表。表结构通常设计为{Node_id,Parent_id}，如下图：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/55b08386eecd7d15cebf167c700aab46.jpg\" alt=\"adjacency-list\" width=\"312\" height=\"215\"></p>\n<p>使用连接表的大致代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb17f5fc758130676\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?php\r\n// $parent is the parent of the children we want to see\r\n// $level is increased when we go deeper into the tree,\r\n//        used to display a nice indented tree\r\n \r\nfunction display_children($parent, $level) \r\n{\r\n   // 获得一个 父节点 $parent 的所有子节点\r\n   $result = mysql_query('SELECT name FROM tree WHERE parent=\"'.$parent.'\";');\r\n \r\n   // 显示每个子节点\r\n   while ($row = mysql_fetch_array($result)) \r\n   {\r\n       // 缩进显示节点名称\r\n       echo str_repeat('  ',$level).$row['name'].\"\\n\";\r\n \r\n       //再次调用这个函数显示子节点的子节点\r\n      \r\n       display_children($row['name'], $level+1);\r\n   }\r\n}\r\n?&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f5fc758130676-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f5fc758130676-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f5fc758130676-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f5fc758130676-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f5fc758130676-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f5fc758130676-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f5fc758130676-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f5fc758130676-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f5fc758130676-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f5fc758130676-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f5fc758130676-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f5fc758130676-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f5fc758130676-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f5fc758130676-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f5fc758130676-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f5fc758130676-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f5fc758130676-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f5fc758130676-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f5fc758130676-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f5fc758130676-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f5fc758130676-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f5fc758130676-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb17f5fc758130676-1\"><span class=\"crayon-ta\">&lt;?php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f5fc758130676-2\"><span class=\"crayon-c\">// $parent is the parent of the children we want to see</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f5fc758130676-3\"><span class=\"crayon-c\">// $level is increased when we go deeper into the tree,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f5fc758130676-4\"><span class=\"crayon-c\">//        used to display a nice indented tree</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f5fc758130676-5\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f5fc758130676-6\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">display_children</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">$parent</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">$level</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f5fc758130676-7\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f5fc758130676-8\"><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// 获得一个 父节点 $parent 的所有子节点</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f5fc758130676-9\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">$result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mysql_query</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'SELECT name FROM tree WHERE parent=\"'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">$parent</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">'\";'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f5fc758130676-10\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f5fc758130676-11\"><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// 显示每个子节点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f5fc758130676-12\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">$row</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mysql_fetch_array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">$result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f5fc758130676-13\"><span class=\"crayon-h\">   </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f5fc758130676-14\"><span class=\"crayon-h\">       </span><span class=\"crayon-c\">// 缩进显示节点名称</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f5fc758130676-15\"><span class=\"crayon-h\">       </span><span class=\"crayon-k \">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str_repeat</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'  '</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">$level</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">$row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'name'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\"\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f5fc758130676-16\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f5fc758130676-17\"><span class=\"crayon-h\">       </span><span class=\"crayon-c\">//再次调用这个函数显示子节点的子节点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f5fc758130676-18\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f5fc758130676-19\"><span class=\"crayon-h\">       </span><span class=\"crayon-e\">display_children</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">$row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'name'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">$level</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f5fc758130676-20\"><span class=\"crayon-h\">   </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f5fc758130676-21\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f5fc758130676-22\"><span class=\"crayon-ta\">?&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0062 seconds] -->\r\n<p>对整个结构的根节点（Food）使用这个函数就可以打印出整个多级树结构，由于Food是根节点它的父节点是空的，所以这样调用: display_children(”,0)。将显示整个树的内容。如果你只想显示整个结构中的一部分，比如说水果部分，就可以这样调用：display_children(‘Fruit’,0);</p>\n<p>几乎使用同样的方法我们可以知道从根节点到任意节点的路径。比如 Cherry 的路径是　”Food &gt;; Fruit &gt;; Red”。 为了得到这样的一个路径我们需要从最深的一级”Cherry”开始， 查询得到它的父节点”Red”把它添加到路径中， 然后我们再查询Red的父节点并把它也添加到路径中，以此类推直到最高层的”Food”</p>\n<p>以下是代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb17f606780510621\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?php\r\n// $node 是那个最深的节点\r\nfunction get_path($node) \r\n{\r\n   // 查询这个节点的父节点\r\n   $result = mysql_query('SELECT parent FROM tree '.\r\n                          'WHERE name=\"'.$node.'\";');\r\n   $row = mysql_fetch_array($result);\r\n \r\n   // 用一个数组保存路径\r\n   $path = array();\r\n \r\n   // 如果不是根节点则继续向上查询\r\n   // (根节点没有父节点)\r\n   if ($row['parent']!='') \r\n   {\r\n       // the last part of the path to $node, is the name\r\n       // of the parent of $node\r\n       $path[] = $row['parent'];\r\n \r\n       // we should add the path to the parent of this node\r\n       // to the path\r\n       $path = array_merge(get_path($row['parent']), $path);\r\n   }\r\n \r\n   // return the path\r\n   return $path;\r\n}\r\n?&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f606780510621-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f606780510621-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f606780510621-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f606780510621-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f606780510621-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f606780510621-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f606780510621-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f606780510621-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f606780510621-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f606780510621-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f606780510621-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f606780510621-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f606780510621-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f606780510621-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f606780510621-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f606780510621-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f606780510621-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f606780510621-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f606780510621-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f606780510621-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f606780510621-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f606780510621-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f606780510621-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f606780510621-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f606780510621-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f606780510621-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f606780510621-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f606780510621-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f606780510621-29\">29</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb17f606780510621-1\"><span class=\"crayon-ta\">&lt;?php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f606780510621-2\"><span class=\"crayon-c\">// $node 是那个最深的节点</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f606780510621-3\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_path</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">$node</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f606780510621-4\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f606780510621-5\"><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// 查询这个节点的父节点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f606780510621-6\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">$result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mysql_query</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'SELECT parent FROM tree '</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f606780510621-7\"><span class=\"crayon-h\">                          </span><span class=\"crayon-s\">'WHERE name=\"'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">$node</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">'\";'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f606780510621-8\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">$row</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mysql_fetch_array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">$result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f606780510621-9\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f606780510621-10\"><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// 用一个数组保存路径</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f606780510621-11\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">$path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f606780510621-12\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f606780510621-13\"><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// 如果不是根节点则继续向上查询</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f606780510621-14\"><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// (根节点没有父节点)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f606780510621-15\"><span class=\"crayon-h\">   </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">$row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'parent'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">!=</span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f606780510621-16\"><span class=\"crayon-h\">   </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f606780510621-17\"><span class=\"crayon-h\">       </span><span class=\"crayon-c\">// the last part of the path to $node, is the name</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f606780510621-18\"><span class=\"crayon-h\">       </span><span class=\"crayon-c\">// of the parent of $node</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f606780510621-19\"><span class=\"crayon-h\">       </span><span class=\"crayon-v\">$path</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">$row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'parent'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f606780510621-20\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f606780510621-21\"><span class=\"crayon-h\">       </span><span class=\"crayon-c\">// we should add the path to the parent of this node</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f606780510621-22\"><span class=\"crayon-h\">       </span><span class=\"crayon-c\">// to the path</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f606780510621-23\"><span class=\"crayon-h\">       </span><span class=\"crayon-v\">$path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">array_merge</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">get_path</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">$row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'parent'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">$path</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f606780510621-24\"><span class=\"crayon-h\">   </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f606780510621-25\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f606780510621-26\"><span class=\"crayon-h\">   </span><span class=\"crayon-c\">// return the path</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f606780510621-27\"><span class=\"crayon-h\">   </span><span class=\"crayon-k \">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">$path</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f606780510621-28\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f606780510621-29\"><span class=\"crayon-ta\">?&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p>如果对”Cherry”使用这个函数：print_r(get_path(‘Cherry’))，就会得到这样的一个数组了：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb17f60b212359662\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nArray  \r\n(  \r\n  [0] =&gt;; Food  \r\n  [1] =&gt;; Fruit  \r\n  [2] =&gt;; Red  \r\n)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f60b212359662-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f60b212359662-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f60b212359662-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f60b212359662-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb17f60b212359662-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb17f60b212359662-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb17f60b212359662-1\"><span class=\"crayon-t\">Array</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f60b212359662-2\"><span class=\"crayon-sy\">(</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f60b212359662-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Food</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f60b212359662-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Fruit</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb17f60b212359662-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Red</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb17f60b212359662-6\"><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>这种方案的优点很明显：结构简单易懂，由于互相之间的关系只由一个parent_id维护，所以增删改都是非常容易，只需要改动和他直接相关的记录就可以。缺点当然也是非常的突出：由于直接地记录了节点之间的继承关系，因此对Tree的任何CRUD操作都将是低效的，这主要归根于频繁的“递归”操作，递归过程不断地访问数据库，每次数据库IO都会有时间开销。举个例子，如果想要返回所有水果，也就是水果的所有子孙节点，看似很简单的操作，就需要用到一堆递归。当然，这种方案并非没有用武之地，在树的层级比较少的时候就非常实用，在邻接列表模式的基础上还可以拓展的是平面表，区别是将节点的level和当前节点的顺序也放入表中，比较适合类似评论等场景，具体的表结构类似这样，这里就不再深入阐述。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/39555f44c984f39dcebeef0feeb23dce.png\" alt=\"flat-table\" width=\"800\" height=\"183\"></p>\n<p>参考链接：</p>\n<ul>\n<li>http://salman-w.blogspot.com/2012/08/php-adjacency-list-hierarchy-tree-traversal.html</li>\n<li>https://packagist.org/search/?tags=adjacency%20list</li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112309\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112309votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112309\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "全文搜索引擎 Elasticsearch 入门教程", "url": "http://blog.jobbole.com/112285/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/578ac00f9b31564920af2fc9701214ec.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 3, "tags": "IT技术,ElasticSearch", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.ruanyifeng.com/blog/2017/08/elasticsearch.html\">阮一峰</a>   </div><p><a href=\"https://baike.baidu.com/item/%E5%85%A8%E6%96%87%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E\">全文搜索</a>属于最常见的需求，开源的 <a href=\"https://www.elastic.co/\">Elasticsearch</a> （以下简称 Elastic）是目前全文搜索引擎的首选。</p>\n<p>它可以快速地储存、搜索和分析海量数据。维基百科、Stack Overflow、Github 都采用它。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/578ac00f9b31564920af2fc9701214ec.jpg\"><img class=\"aligncenter size-full wp-image-112291\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/578ac00f9b31564920af2fc9701214ec.jpg\" alt=\"bg2017081701\"></a></p>\n<p>Elastic 的底层是开源库 <a href=\"https://lucene.apache.org/\">Lucene</a>。但是，你没法直接用 Lucene，必须自己写代码去调用它的接口。Elastic 是 Lucene 的封装，提供了 REST API 的操作接口，开箱即用。</p>\n<p>本文从零开始，讲解如何使用 Elastic 搭建自己的全文搜索引擎。每一步都有详细的说明，大家跟着做就能学会。</p>\n<h1>一、安装</h1>\n<p>Elastic 需要 Java 8 环境。如果你的机器还没安装 Java，可以参考<a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-java-with-apt-get-on-debian-8\">这篇文章</a>，注意要保证环境变量<strong>JAVA_HOME</strong>正确设置。</p>\n<p>安装完 Java，就可以跟着<a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/zip-targz.html\">官方文档</a>安装 Elastic。直接下载压缩包比较简单。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdc85273755607\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.5.1.zip\r\n$ unzip elasticsearch-5.5.1.zip\r\n$ cd elasticsearch-5.5.1/</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdc85273755607-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdc85273755607-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdc85273755607-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdc85273755607-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">wget </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.5.1.zip</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdc85273755607-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">unzip </span><span class=\"crayon-v\">elasticsearch</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">5.5.1.zip</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdc85273755607-3\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cd </span><span class=\"crayon-v\">elasticsearch</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">5.5.1</span><span class=\"crayon-o\">/</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>接着，进入解压后的目录，运行下面的命令，启动 Elastic。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdc92190005517\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./bin/elasticsearch</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdc92190005517-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdc92190005517-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">elasticsearch</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>如果这时<a href=\"https://github.com/spujadas/elk-docker/issues/92\">报错</a>“max virtual memory areas vm.max<em>map</em>count [65530] is too low”，要运行下面的命令。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdc96271774138\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo sysctl -w vm.max_map_count=262144</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdc96271774138-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdc96271774138-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">sysctl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">vm</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">max_map_count</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">262144</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>如果一切正常，Elastic 就会在默认的9200端口运行。这时，打开另一个命令行窗口，请求该端口，会得到说明信息。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdc9a934220699\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl localhost:9200\r\n\r\n{\r\n  \"name\" : \"atntrTf\",\r\n  \"cluster_name\" : \"elasticsearch\",\r\n  \"cluster_uuid\" : \"tf9250XhQ6ee4h7YI11anA\",\r\n  \"version\" : {\r\n    \"number\" : \"5.5.1\",\r\n    \"build_hash\" : \"19c13d0\",\r\n    \"build_date\" : \"2017-07-18T20:44:24.823Z\",\r\n    \"build_snapshot\" : false,\r\n    \"lucene_version\" : \"6.6.0\"\r\n  },\r\n  \"tagline\" : \"You Know, for Search\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdc9a934220699-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdc9a934220699-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdc9a934220699-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdc9a934220699-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdc9a934220699-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdc9a934220699-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdc9a934220699-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdc9a934220699-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdc9a934220699-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdc9a934220699-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdc9a934220699-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdc9a934220699-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdc9a934220699-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdc9a934220699-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdc9a934220699-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdc9a934220699-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">curl </span><span class=\"crayon-v\">localhost</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">9200</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdc9a934220699-2\"> </div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdc9a934220699-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdc9a934220699-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"name\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"atntrTf\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdc9a934220699-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"cluster_name\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"elasticsearch\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdc9a934220699-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"cluster_uuid\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"tf9250XhQ6ee4h7YI11anA\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdc9a934220699-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"version\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdc9a934220699-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"number\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"5.5.1\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdc9a934220699-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"build_hash\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"19c13d0\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdc9a934220699-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"build_date\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"2017-07-18T20:44:24.823Z\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdc9a934220699-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"build_snapshot\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdc9a934220699-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"lucene_version\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"6.6.0\"</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdc9a934220699-13\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdc9a934220699-14\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"tagline\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"You Know, for Search\"</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdc9a934220699-15\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>上面代码中，请求9200端口，Elastic 返回一个 JSON 对象，包含当前节点、集群、版本等信息。</p>\n<p>按下 Ctrl + C，Elastic 就会停止运行。</p>\n<p>默认情况下，Elastic 只允许本机访问，如果需要远程访问，可以修改 Elastic 安装目录的<strong>config/elasticsearch.yml</strong>文件，去掉<strong>network.host</strong>的注释，将它的值改成<strong>0.0.0.0</strong>，然后重新启动 Elastic。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdc9e419102107\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnetwork.host: 0.0.0.0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdc9e419102107-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdc9e419102107-1\"><span class=\"crayon-v\">network</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">host</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0.0.0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>上面代码中，设成<strong>0.0.0.0</strong>让任何人都可以访问。线上服务不要这样设置，要设成具体的 IP。</p>\n<h1>二、基本概念</h1>\n<h2>2.1 Node 与 Cluster</h2>\n<p>Elastic 本质上是一个分布式数据库，允许多台服务器协同工作，每台服务器可以运行多个 Elastic 实例。</p>\n<p>单个 Elastic 实例称为一个节点（node）。一组节点构成一个集群（cluster）。</p>\n<h2>2.2 Index</h2>\n<p>Elastic 会索引所有字段，经过处理后写入一个反向索引（Inverted Index）。查找数据的时候，直接查找该索引。</p>\n<p>所以，Elastic 数据管理的顶层单位就叫做 Index（索引）。它是单个数据库的同义词。每个 Index （即数据库）的名字必须是小写。</p>\n<p>下面的命令可以查看当前节点的所有 Index。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdca1055920894\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -X GET 'http://localhost:9200/_cat/indices?v'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdca1055920894-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdca1055920894-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">GET</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'http://localhost:9200/_cat/indices?v'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h2>2.3 Document</h2>\n<p>Index 里面单条的记录称为 Document（文档）。许多条 Document 构成了一个 Index。</p>\n<p>Document 使用 JSON 格式表示，下面是一个例子。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdca5032102655\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n  \"user\": \"张三\",\r\n  \"title\": \"工程师\",\r\n  \"desc\": \"数据库管理\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdca5032102655-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdca5032102655-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdca5032102655-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdca5032102655-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdca5032102655-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdca5032102655-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdca5032102655-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"user\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"张三\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdca5032102655-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"title\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"工程师\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdca5032102655-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"desc\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"数据库管理\"</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdca5032102655-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>同一个 Index 里面的 Document，不要求有相同的结构（scheme），但是最好保持相同，这样有利于提高搜索效率。</p>\n<h2>2.4 Type</h2>\n<p>Document 可以分组，比如<strong>weather</strong>这个 Index 里面，可以按城市分组（北京和上海），也可以按气候分组（晴天和雨天）。这种分组就叫做 Type，它是虚拟的逻辑分组，用来过滤 Document。</p>\n<p>不同的 Type 应该有相似的结构（schema），举例来说，<strong>id</strong>字段不能在这个组是字符串，在另一个组是数值。这是与关系型数据库的表的<a href=\"https://www.elastic.co/guide/en/elasticsearch/guide/current/mapping.html\">一个区别</a>。性质完全不同的数据（比如<strong>products</strong>和<strong>logs</strong>）应该存成两个 Index，而不是一个 Index 里面的两个 Type（虽然可以做到）。</p>\n<p>下面的命令可以列出每个 Index 所包含的 Type。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdca8308154297\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl 'localhost:9200/_mapping?pretty=true'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdca8308154297-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdca8308154297-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/_mapping?pretty=true'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>根据<a href=\"https://www.elastic.co/blog/index-type-parent-child-join-now-future-in-elasticsearch\">规划</a>，Elastic 6.x 版只允许每个 Index 包含一个 Type，7.x 版将会彻底移除 Type。</p>\n<h1>三、新建和删除 Index</h1>\n<p>新建 Index，可以直接向 Elastic 服务器发出 PUT 请求。下面的例子是新建一个名叫<strong>weather</strong>的 Index。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdcae766802317\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -X PUT 'localhost:9200/weather'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcae766802317-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcae766802317-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">PUT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/weather'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>服务器返回一个 JSON 对象，里面的<strong>acknowledged</strong>字段表示操作成功。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdcb1264939238\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n  \"acknowledged\":true,\r\n  \"shards_acknowledged\":true\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcb1264939238-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcb1264939238-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcb1264939238-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcb1264939238-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcb1264939238-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcb1264939238-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"acknowledged\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcb1264939238-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"shards_acknowledged\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcb1264939238-4\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>然后，我们发出 DELETE 请求，删除这个 Index。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdcb4484891548\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -X DELETE 'localhost:9200/weather'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcb4484891548-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcb4484891548-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">DELETE</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/weather'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h1>四、中文分词设置</h1>\n<p>首先，安装中文分词插件。这里使用的是 <a href=\"https://github.com/medcl/elasticsearch-analysis-ik/\">ik</a>，也可以考虑其他插件（比如 <a href=\"https://www.elastic.co/guide/en/elasticsearch/plugins/current/analysis-smartcn.html\">smartcn</a>）。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdcb8768359256\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v5.5.1/elasticsearch-analysis-ik-5.5.1.zip</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcb8768359256-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcb8768359256-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">elasticsearch</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">plugin </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-c\">//github.com/medcl/elasticsearch-analysis-ik/releases/download/v5.5.1/elasticsearch-analysis-ik-5.5.1.zip</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>上面代码安装的是5.5.1版的插件，与 Elastic 5.5.1 配合使用。</p>\n<p>接着，重新启动 Elastic，就会自动加载这个新安装的插件。</p>\n<p>然后，新建一个 Index，指定需要分词的字段。这一步根据数据结构而异，下面的命令只针对本文。基本上，凡是需要搜索的中文字段，都要单独设置一下。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdcbb527210545\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -X PUT 'localhost:9200/accounts' -d '\r\n{\r\n  \"mappings\": {\r\n    \"person\": {\r\n      \"properties\": {\r\n        \"user\": {\r\n          \"type\": \"text\",\r\n          \"analyzer\": \"ik_max_word\",\r\n          \"search_analyzer\": \"ik_max_word\"\r\n        },\r\n        \"title\": {\r\n          \"type\": \"text\",\r\n          \"analyzer\": \"ik_max_word\",\r\n          \"search_analyzer\": \"ik_max_word\"\r\n        },\r\n        \"desc\": {\r\n          \"type\": \"text\",\r\n          \"analyzer\": \"ik_max_word\",\r\n          \"search_analyzer\": \"ik_max_word\"\r\n        }\r\n      }\r\n    }\r\n  }\r\n}'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcbb527210545-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcbb527210545-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcbb527210545-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcbb527210545-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcbb527210545-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcbb527210545-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcbb527210545-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcbb527210545-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcbb527210545-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcbb527210545-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcbb527210545-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcbb527210545-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcbb527210545-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcbb527210545-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcbb527210545-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcbb527210545-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcbb527210545-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcbb527210545-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcbb527210545-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcbb527210545-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcbb527210545-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcbb527210545-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcbb527210545-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcbb527210545-24\">24</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcbb527210545-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">PUT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcbb527210545-2\"><span class=\"crayon-s\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcbb527210545-3\"><span class=\"crayon-s\">  \"mappings\": {</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcbb527210545-4\"><span class=\"crayon-s\">    \"person\": {</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcbb527210545-5\"><span class=\"crayon-s\">      \"properties\": {</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcbb527210545-6\"><span class=\"crayon-s\">        \"user\": {</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcbb527210545-7\"><span class=\"crayon-s\">          \"type\": \"text\",</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcbb527210545-8\"><span class=\"crayon-s\">          \"analyzer\": \"ik_max_word\",</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcbb527210545-9\"><span class=\"crayon-s\">          \"search_analyzer\": \"ik_max_word\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcbb527210545-10\"><span class=\"crayon-s\">        },</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcbb527210545-11\"><span class=\"crayon-s\">        \"title\": {</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcbb527210545-12\"><span class=\"crayon-s\">          \"type\": \"text\",</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcbb527210545-13\"><span class=\"crayon-s\">          \"analyzer\": \"ik_max_word\",</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcbb527210545-14\"><span class=\"crayon-s\">          \"search_analyzer\": \"ik_max_word\"</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcbb527210545-15\"><span class=\"crayon-s\">        },</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcbb527210545-16\"><span class=\"crayon-s\">        \"desc\": {</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcbb527210545-17\"><span class=\"crayon-s\">          \"type\": \"text\",</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcbb527210545-18\"><span class=\"crayon-s\">          \"analyzer\": \"ik_max_word\",</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcbb527210545-19\"><span class=\"crayon-s\">          \"search_analyzer\": \"ik_max_word\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcbb527210545-20\"><span class=\"crayon-s\">        }</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcbb527210545-21\"><span class=\"crayon-s\">      }</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcbb527210545-22\"><span class=\"crayon-s\">    }</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcbb527210545-23\"><span class=\"crayon-s\">  }</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcbb527210545-24\"><span class=\"crayon-s\">}'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>上面代码中，首先新建一个名称为<strong>accounts</strong>的 Index，里面有一个名称为<strong>person</strong>的 Type。<strong>person</strong>有三个字段。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdcbe778247739\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nuser\r\ntitle\r\ndesc</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcbe778247739-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcbe778247739-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcbe778247739-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcbe778247739-1\"><span class=\"crayon-e\">user</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcbe778247739-2\"><span class=\"crayon-e\">title</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcbe778247739-3\"><span class=\"crayon-v\">desc</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这三个字段都是中文，而且类型都是文本（text），所以需要指定中文分词器，不能使用默认的英文分词器。</p>\n<p>Elastic 的分词器称为 <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis.html\">analyzer</a>。我们对每个字段指定分词器。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdcc1362722683\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\"user\": {\r\n  \"type\": \"text\",\r\n  \"analyzer\": \"ik_max_word\",\r\n  \"search_analyzer\": \"ik_max_word\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcc1362722683-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcc1362722683-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcc1362722683-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcc1362722683-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcc1362722683-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcc1362722683-1\"><span class=\"crayon-s\">\"user\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcc1362722683-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"text\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcc1362722683-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"analyzer\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ik_max_word\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcc1362722683-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"search_analyzer\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ik_max_word\"</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcc1362722683-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>上面代码中，<strong>analyzer</strong>是字段文本的分词器，<strong>search_analyzer</strong>是搜索词的分词器。<strong>ik_max_word</strong>分词器是插件<strong>ik</strong>提供的，可以对文本进行最大数量的分词。</p>\n<h1>五、数据操作</h1>\n<h2>5.1 新增记录</h2>\n<p>向指定的 /Index/Type 发送 PUT 请求，就可以在 Index 里面新增一条记录。比如，向<strong>/accounts/person</strong>发送请求，就可以新增一条人员记录。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdcc5071379772\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -X PUT 'localhost:9200/accounts/person/1' -d '\r\n{\r\n  \"user\": \"张三\",\r\n  \"title\": \"工程师\",\r\n  \"desc\": \"数据库管理\"\r\n}'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcc5071379772-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcc5071379772-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcc5071379772-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcc5071379772-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcc5071379772-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcc5071379772-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcc5071379772-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">PUT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts/person/1'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcc5071379772-2\"><span class=\"crayon-s\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcc5071379772-3\"><span class=\"crayon-s\">  \"user\": \"张三\",</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcc5071379772-4\"><span class=\"crayon-s\">  \"title\": \"工程师\",</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcc5071379772-5\"><span class=\"crayon-s\">  \"desc\": \"数据库管理\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcc5071379772-6\"><span class=\"crayon-s\">}'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>服务器返回的 JSON 对象，会给出 Index、Type、Id、Version 等信息。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdcc8241974102\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n  \"_index\":\"accounts\",\r\n  \"_type\":\"person\",\r\n  \"_id\":\"1\",\r\n  \"_version\":1,\r\n  \"result\":\"created\",\r\n  \"_shards\":{\"total\":2,\"successful\":1,\"failed\":0},\r\n  \"created\":true\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcc8241974102-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcc8241974102-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcc8241974102-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcc8241974102-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcc8241974102-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcc8241974102-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcc8241974102-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcc8241974102-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcc8241974102-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcc8241974102-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcc8241974102-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_index\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"accounts\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcc8241974102-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"person\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcc8241974102-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcc8241974102-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_version\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcc8241974102-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"result\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"created\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcc8241974102-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_shards\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"total\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"successful\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"failed\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcc8241974102-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"created\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcc8241974102-9\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>如果你仔细看，会发现请求路径是<strong>/accounts/person/1</strong>，最后的<strong>1</strong>是该条记录的 Id。它不一定是数字，任意字符串（比如<strong>abc</strong>）都可以。</p>\n<p>新增记录的时候，也可以不指定 Id，这时要改成 POST 请求。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdccd330395398\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -X POST 'localhost:9200/accounts/person' -d '\r\n{\r\n  \"user\": \"李四\",\r\n  \"title\": \"工程师\",\r\n  \"desc\": \"系统管理\"\r\n}'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdccd330395398-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdccd330395398-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdccd330395398-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdccd330395398-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdccd330395398-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdccd330395398-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdccd330395398-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">POST</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts/person'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdccd330395398-2\"><span class=\"crayon-s\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdccd330395398-3\"><span class=\"crayon-s\">  \"user\": \"李四\",</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdccd330395398-4\"><span class=\"crayon-s\">  \"title\": \"工程师\",</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdccd330395398-5\"><span class=\"crayon-s\">  \"desc\": \"系统管理\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdccd330395398-6\"><span class=\"crayon-s\">}'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>上面代码中，向<strong>/accounts/person</strong>发出一个 POST 请求，添加一个记录。这时，服务器返回的 JSON 对象里面，<strong>_id</strong>字段就是一个随机字符串。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdcd0096411681\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n  \"_index\":\"accounts\",\r\n  \"_type\":\"person\",\r\n  \"_id\":\"AV3qGfrC6jMbsbXb6k1p\",\r\n  \"_version\":1,\r\n  \"result\":\"created\",\r\n  \"_shards\":{\"total\":2,\"successful\":1,\"failed\":0},\r\n  \"created\":true\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcd0096411681-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcd0096411681-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcd0096411681-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcd0096411681-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcd0096411681-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcd0096411681-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcd0096411681-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcd0096411681-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcd0096411681-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcd0096411681-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcd0096411681-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_index\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"accounts\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcd0096411681-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"person\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcd0096411681-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"AV3qGfrC6jMbsbXb6k1p\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcd0096411681-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_version\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcd0096411681-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"result\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"created\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcd0096411681-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_shards\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"total\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"successful\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"failed\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcd0096411681-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"created\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcd0096411681-9\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>注意，如果没有先创建 Index（这个例子是<strong>accounts</strong>），直接执行上面的命令，Elastic 也不会报错，而是直接生成指定的 Index。所以，打字的时候要小心，不要写错 Index 的名称。</p>\n<h2>5.2 查看记录</h2>\n<p>向<strong>/Index/Type/Id</strong>发出 GET 请求，就可以查看这条记录。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdcd4179364193\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl 'localhost:9200/accounts/person/1?pretty=true'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcd4179364193-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcd4179364193-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts/person/1?pretty=true'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>上面代码请求查看<strong>/accounts/person/1</strong>这条记录，URL 的参数<strong>pretty=true</strong>表示以易读的格式返回。</p>\n<p>返回的数据中，<strong>found</strong>字段表示查询成功，<strong>_source</strong>字段返回原始记录。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdcd7742150905\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n  \"_index\" : \"accounts\",\r\n  \"_type\" : \"person\",\r\n  \"_id\" : \"1\",\r\n  \"_version\" : 1,\r\n  \"found\" : true,\r\n  \"_source\" : {\r\n    \"user\" : \"张三\",\r\n    \"title\" : \"工程师\",\r\n    \"desc\" : \"数据库管理\"\r\n  }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcd7742150905-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcd7742150905-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcd7742150905-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcd7742150905-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcd7742150905-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcd7742150905-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcd7742150905-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcd7742150905-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcd7742150905-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcd7742150905-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcd7742150905-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcd7742150905-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcd7742150905-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcd7742150905-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_index\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"accounts\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcd7742150905-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_type\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"person\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcd7742150905-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_id\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcd7742150905-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_version\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcd7742150905-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"found\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcd7742150905-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_source\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcd7742150905-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"user\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"张三\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcd7742150905-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"title\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"工程师\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcd7742150905-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"desc\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"数据库管理\"</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcd7742150905-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcd7742150905-12\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>如果 Id 不正确，就查不到数据，<strong>found</strong>字段就是<strong>false</strong>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdcda716783208\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl 'localhost:9200/weather/beijing/abc?pretty=true'\r\n\r\n{\r\n  \"_index\" : \"accounts\",\r\n  \"_type\" : \"person\",\r\n  \"_id\" : \"abc\",\r\n  \"found\" : false\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcda716783208-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcda716783208-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcda716783208-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcda716783208-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcda716783208-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcda716783208-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcda716783208-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcda716783208-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcda716783208-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/weather/beijing/abc?pretty=true'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcda716783208-2\"> </div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcda716783208-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcda716783208-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_index\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"accounts\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcda716783208-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_type\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"person\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcda716783208-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_id\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"abc\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcda716783208-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"found\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcda716783208-8\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p></p>\n<h2>5.3 删除记录</h2>\n<p>删除记录就是发出 DELETE 请求。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdcdd056344179\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -X DELETE 'localhost:9200/accounts/person/1'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcdd056344179-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcdd056344179-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">DELETE</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts/person/1'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>这里先不要删除这条记录，后面还要用到。</p>\n<h2>5.4 更新记录</h2>\n<p>更新记录就是使用 PUT 请求，重新发送一次数据。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdce0554487281\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -X PUT 'localhost:9200/accounts/person/1' -d '\r\n{\r\n    \"user\" : \"张三\",\r\n    \"title\" : \"工程师\",\r\n    \"desc\" : \"数据库管理，软件开发\"\r\n}' \r\n\r\n{\r\n  \"_index\":\"accounts\",\r\n  \"_type\":\"person\",\r\n  \"_id\":\"1\",\r\n  \"_version\":2,\r\n  \"result\":\"updated\",\r\n  \"_shards\":{\"total\":2,\"successful\":1,\"failed\":0},\r\n  \"created\":false\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce0554487281-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce0554487281-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce0554487281-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce0554487281-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce0554487281-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce0554487281-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce0554487281-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce0554487281-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce0554487281-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce0554487281-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce0554487281-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce0554487281-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce0554487281-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce0554487281-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce0554487281-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce0554487281-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce0554487281-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">PUT</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts/person/1'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce0554487281-2\"><span class=\"crayon-s\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce0554487281-3\"><span class=\"crayon-s\">    \"user\" : \"张三\",</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce0554487281-4\"><span class=\"crayon-s\">    \"title\" : \"工程师\",</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce0554487281-5\"><span class=\"crayon-s\">    \"desc\" : \"数据库管理，软件开发\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce0554487281-6\"><span class=\"crayon-s\">}'</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce0554487281-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce0554487281-8\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce0554487281-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_index\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"accounts\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce0554487281-10\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"person\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce0554487281-11\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce0554487281-12\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_version\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce0554487281-13\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"result\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"updated\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce0554487281-14\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_shards\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"total\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"successful\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"failed\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce0554487281-15\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"created\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce0554487281-16\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>上面代码中，我们将原始数据从”数据库管理”改成”数据库管理，软件开发”。 返回结果里面，有几个字段发生了变化。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdce4978043440\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\"_version\" : 2,\r\n\"result\" : \"updated\",\r\n\"created\" : false</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce4978043440-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce4978043440-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce4978043440-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce4978043440-1\"><span class=\"crayon-s\">\"_version\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce4978043440-2\"><span class=\"crayon-s\">\"result\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"updated\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce4978043440-3\"><span class=\"crayon-s\">\"created\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>可以看到，记录的 Id 没变，但是版本（version）从<strong>1</strong>变成<strong>2</strong>，操作类型（result）从<strong>created</strong>变成<strong>updated</strong>，<strong>created</strong>字段变成<strong>false</strong>，因为这次不是新建记录。</p>\n<h1>六、数据查询</h1>\n<h2>6.1 返回所有记录</h2>\n<p>使用 GET 方法，直接请求<strong>/Index/Type/_search</strong>，就会返回所有记录。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdce7446671542\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl 'localhost:9200/accounts/person/_search'\r\n\r\n{\r\n  \"took\":2,\r\n  \"timed_out\":false,\r\n  \"_shards\":{\"total\":5,\"successful\":5,\"failed\":0},\r\n  \"hits\":{\r\n    \"total\":2,\r\n    \"max_score\":1.0,\r\n    \"hits\":[\r\n      {\r\n        \"_index\":\"accounts\",\r\n        \"_type\":\"person\",\r\n        \"_id\":\"AV3qGfrC6jMbsbXb6k1p\",\r\n        \"_score\":1.0,\r\n        \"_source\": {\r\n          \"user\": \"李四\",\r\n          \"title\": \"工程师\",\r\n          \"desc\": \"系统管理\"\r\n        }\r\n      },\r\n      {\r\n        \"_index\":\"accounts\",\r\n        \"_type\":\"person\",\r\n        \"_id\":\"1\",\r\n        \"_score\":1.0,\r\n        \"_source\": {\r\n          \"user\" : \"张三\",\r\n          \"title\" : \"工程师\",\r\n          \"desc\" : \"数据库管理，软件开发\"\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce7446671542-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce7446671542-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce7446671542-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce7446671542-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce7446671542-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce7446671542-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce7446671542-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce7446671542-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce7446671542-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce7446671542-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce7446671542-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce7446671542-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce7446671542-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce7446671542-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce7446671542-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce7446671542-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce7446671542-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce7446671542-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce7446671542-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce7446671542-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce7446671542-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce7446671542-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce7446671542-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce7446671542-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce7446671542-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce7446671542-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce7446671542-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce7446671542-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce7446671542-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce7446671542-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce7446671542-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce7446671542-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce7446671542-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdce7446671542-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdce7446671542-35\">35</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce7446671542-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts/person/_search'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce7446671542-2\"> </div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce7446671542-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce7446671542-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"took\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce7446671542-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"timed_out\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce7446671542-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_shards\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"total\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"successful\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"failed\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce7446671542-7\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"hits\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce7446671542-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"total\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce7446671542-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"max_score\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce7446671542-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"hits\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce7446671542-11\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce7446671542-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_index\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"accounts\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce7446671542-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"person\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce7446671542-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"AV3qGfrC6jMbsbXb6k1p\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce7446671542-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_score\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce7446671542-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_source\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce7446671542-17\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"user\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"李四\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce7446671542-18\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"title\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"工程师\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce7446671542-19\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"desc\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"系统管理\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce7446671542-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce7446671542-21\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce7446671542-22\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce7446671542-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_index\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"accounts\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce7446671542-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"person\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce7446671542-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce7446671542-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_score\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1.0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce7446671542-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_source\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce7446671542-28\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"user\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"张三\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce7446671542-29\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"title\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"工程师\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce7446671542-30\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"desc\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"数据库管理，软件开发\"</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce7446671542-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce7446671542-32\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce7446671542-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdce7446671542-34\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdce7446671542-35\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0039 seconds] -->\r\n<p>上面代码中，返回结果的 <strong>took</strong>字段表示该操作的耗时（单位为毫秒），<strong>timed_out</strong>字段表示是否超时，<strong>hits</strong>字段表示命中的记录，里面子字段的含义如下。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdceb536821802\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntotal：返回记录数，本例是2条。\r\nmax_score：最高的匹配程度，本例是1.0。\r\nhits：返回的记录组成的数组。</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdceb536821802-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdceb536821802-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdceb536821802-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdceb536821802-1\"><span class=\"crayon-i\">total</span>：返回记录数，本例是<span class=\"crayon-cn\">2</span>条。</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdceb536821802-2\"><span class=\"crayon-v\">max</span><span class=\"crayon-sy\">_</span>score：最高的匹配程度，本例是<span class=\"crayon-cn\">1.0</span>。</div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdceb536821802-3\"><span class=\"crayon-i\">hits</span>：返回的记录组成的数组。</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>返回的记录中，每条记录都有一个<strong>_score</strong>字段，表示匹配的程序，默认是按照这个字段降序排列。</p>\n<h2>6.2 全文搜索</h2>\n<p>Elastic 的查询非常特别，使用自己的<a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/5.5/query-dsl.html\">查询语法</a>，要求 GET 请求带有数据体。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdcee598429572\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl 'localhost:9200/accounts/person/_search'  -d '\r\n{\r\n  \"query\" : { \"match\" : { \"desc\" : \"软件\" }}\r\n}'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcee598429572-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcee598429572-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcee598429572-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcee598429572-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcee598429572-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts/person/_search'</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcee598429572-2\"><span class=\"crayon-s\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcee598429572-3\"><span class=\"crayon-s\">  \"query\" : { \"match\" : { \"desc\" : \"软件\" }}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcee598429572-4\"><span class=\"crayon-s\">}'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>上面代码使用 <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/5.5/query-dsl-match-query.html\">Match 查询</a>，指定的匹配条件是<strong>desc</strong>字段里面包含”软件”这个词。返回结果如下。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdcf1253931840\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n  \"took\":3,\r\n  \"timed_out\":false,\r\n  \"_shards\":{\"total\":5,\"successful\":5,\"failed\":0},\r\n  \"hits\":{\r\n    \"total\":1,\r\n    \"max_score\":0.28582606,\r\n    \"hits\":[\r\n      {\r\n        \"_index\":\"accounts\",\r\n        \"_type\":\"person\",\r\n        \"_id\":\"1\",\r\n        \"_score\":0.28582606,\r\n        \"_source\": {\r\n          \"user\" : \"张三\",\r\n          \"title\" : \"工程师\",\r\n          \"desc\" : \"数据库管理，软件开发\"\r\n        }\r\n      }\r\n    ]\r\n  }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcf1253931840-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcf1253931840-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcf1253931840-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcf1253931840-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcf1253931840-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcf1253931840-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcf1253931840-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcf1253931840-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcf1253931840-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcf1253931840-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcf1253931840-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcf1253931840-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcf1253931840-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcf1253931840-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcf1253931840-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcf1253931840-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcf1253931840-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcf1253931840-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcf1253931840-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcf1253931840-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcf1253931840-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcf1253931840-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcf1253931840-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcf1253931840-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"took\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcf1253931840-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"timed_out\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcf1253931840-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"_shards\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"total\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"successful\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"failed\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcf1253931840-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"hits\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcf1253931840-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"total\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcf1253931840-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"max_score\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.28582606</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcf1253931840-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"hits\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcf1253931840-9\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcf1253931840-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_index\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"accounts\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcf1253931840-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"person\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcf1253931840-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcf1253931840-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_score\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.28582606</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcf1253931840-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"_source\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcf1253931840-15\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"user\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"张三\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcf1253931840-16\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"title\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"工程师\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcf1253931840-17\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"desc\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"数据库管理，软件开发\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcf1253931840-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcf1253931840-19\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcf1253931840-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcf1253931840-21\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcf1253931840-22\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>Elastic 默认一次返回10条结果，可以通过<strong>size</strong>字段改变这个设置。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdcf4556216403\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl 'localhost:9200/accounts/person/_search'  -d '\r\n{\r\n  \"query\" : { \"match\" : { \"desc\" : \"管理\" }},\r\n  \"size\": 1\r\n}'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcf4556216403-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcf4556216403-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcf4556216403-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcf4556216403-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcf4556216403-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcf4556216403-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts/person/_search'</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcf4556216403-2\"><span class=\"crayon-s\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcf4556216403-3\"><span class=\"crayon-s\">  \"query\" : { \"match\" : { \"desc\" : \"管理\" }},</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcf4556216403-4\"><span class=\"crayon-s\">  \"size\": 1</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcf4556216403-5\"><span class=\"crayon-s\">}'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>上面代码指定，每次只返回一条结果。</p>\n<p>还可以通过<strong>from</strong>字段，指定位移。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdcf8827855984\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl 'localhost:9200/accounts/person/_search'  -d '\r\n{\r\n  \"query\" : { \"match\" : { \"desc\" : \"管理\" }},\r\n  \"from\": 1,\r\n  \"size\": 1\r\n}'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcf8827855984-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcf8827855984-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcf8827855984-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcf8827855984-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcf8827855984-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcf8827855984-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcf8827855984-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts/person/_search'</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcf8827855984-2\"><span class=\"crayon-s\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcf8827855984-3\"><span class=\"crayon-s\">  \"query\" : { \"match\" : { \"desc\" : \"管理\" }},</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcf8827855984-4\"><span class=\"crayon-s\">  \"from\": 1,</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcf8827855984-5\"><span class=\"crayon-s\">  \"size\": 1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcf8827855984-6\"><span class=\"crayon-s\">}'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>上面代码指定，从位置1开始（默认是从位置0开始），只返回一条结果。</p>\n<h2>6.3 逻辑运算</h2>\n<p>如果有多个搜索关键字， Elastic 认为它们是<strong>or</strong>关系。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdcfb730068765\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl 'localhost:9200/accounts/person/_search'  -d '\r\n{\r\n  \"query\" : { \"match\" : { \"desc\" : \"软件 系统\" }}\r\n}'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcfb730068765-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcfb730068765-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcfb730068765-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcfb730068765-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcfb730068765-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts/person/_search'</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcfb730068765-2\"><span class=\"crayon-s\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcfb730068765-3\"><span class=\"crayon-s\">  \"query\" : { \"match\" : { \"desc\" : \"软件 系统\" }}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcfb730068765-4\"><span class=\"crayon-s\">}'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>上面代码搜索的是<strong>软件 or 系统</strong>。</p>\n<p>如果要执行多个关键词的<strong>and</strong>搜索，必须使用<a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/5.5/query-dsl-bool-query.html\">布尔查询</a>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9f25fbdcfe183180274\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl 'localhost:9200/accounts/person/_search'  -d '\r\n{\r\n  \"query\": {\r\n    \"bool\": {\r\n      \"must\": [\r\n        { \"match\": { \"desc\": \"软件\" } },\r\n        { \"match\": { \"desc\": \"系统\" } }\r\n      ]\r\n    }\r\n  }\r\n}'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcfe183180274-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcfe183180274-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcfe183180274-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcfe183180274-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcfe183180274-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcfe183180274-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcfe183180274-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcfe183180274-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcfe183180274-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9f25fbdcfe183180274-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9f25fbdcfe183180274-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcfe183180274-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'localhost:9200/accounts/person/_search'</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcfe183180274-2\"><span class=\"crayon-s\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcfe183180274-3\"><span class=\"crayon-s\">  \"query\": {</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcfe183180274-4\"><span class=\"crayon-s\">    \"bool\": {</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcfe183180274-5\"><span class=\"crayon-s\">      \"must\": [</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcfe183180274-6\"><span class=\"crayon-s\">        { \"match\": { \"desc\": \"软件\" } },</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcfe183180274-7\"><span class=\"crayon-s\">        { \"match\": { \"desc\": \"系统\" } }</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcfe183180274-8\"><span class=\"crayon-s\">      ]</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcfe183180274-9\"><span class=\"crayon-s\">    }</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9f25fbdcfe183180274-10\"><span class=\"crayon-s\">  }</span></div><div class=\"crayon-line\" id=\"crayon-59b9f25fbdcfe183180274-11\"><span class=\"crayon-s\">}'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p>\n<h1>七、参考链接</h1>\n<ul>\n<li><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started.html\">ElasticSearch 官方手册</a></li>\n<li><a href=\"https://www.elastic.co/blog/a-practical-introduction-to-elasticsearch\">A Practical Introduction to Elasticsearch</a></li>\n</ul>\n<p>（完）</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112285\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112285votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112285\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "在 Linux 中分割和重组文件", "url": "http://blog.jobbole.com/112303/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.linux.com/learn/intro-to-linux/2017/8/splitting-and-re-assembling-files-linux\">Carla Schroder</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8818-1.html\">Linux中国/firmianay</a>   </div><blockquote><p>非常有用的 <code>csplit</code> 命令可以将单个文件分割成多个文件。Carla Schroder 解释说。</p></blockquote>\n<p>Linux 有几个用于分割文件的工具程序。那么你为什么要分割文件呢？一个用例是将大文件分割成更小的尺寸，以便它适用于比较小的存储介质，比如 U 盘。当您遇到 FAT32（最大文件大小为 4GB），且您的文件大于此时，通过 U 盘传输文件也是一个很好的技巧。另一个用例是加速网络文件传输，因为小文件的并行传输通常更快。</p>\n<p>我们将学习如何使用 <code>csplit</code>，<code>split</code> 和 <code>cat</code> 来重新整理文件，然后再将文件合并在一起。这些操作在任何文件类型下都有用：文本、图片、音频文件、ISO 镜像文件等。</p>\n<h3 id=\"toc_1\">使用 csplit 分割文件</h3>\n<p><code>csplit</code> 是这些有趣的小命令中的一个，它永远伴你左右，一旦开始用它就离不开了。<code>csplit</code> 将单个文件分割成多个文件。这个示例演示了最简单的使用方法，它将文件 foo.txt 分为三个文件，以行号 17 和 33 作为分割点：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb1e5dd6165120894\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ csplit foo.txt 17 33\r\n2591\r\n3889\r\n2359\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5dd6165120894-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5dd6165120894-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5dd6165120894-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5dd6165120894-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5dd6165120894-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5dd6165120894-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">csplit </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">33</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5dd6165120894-2\"><span class=\"crayon-cn\">2591</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5dd6165120894-3\"><span class=\"crayon-cn\">3889</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5dd6165120894-4\"><span class=\"crayon-cn\">2359</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5dd6165120894-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><code>csplit</code> 在当前目录下创建了三个新文件，并以字节为单位打印出新文件的大小。默认情况下，每个新文件名为 <code>xx_nn</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb1e5de2693668877\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ls\r\nxx00\r\nxx01\r\nxx02\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5de2693668877-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5de2693668877-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5de2693668877-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5de2693668877-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5de2693668877-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5de2693668877-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5de2693668877-2\"><span class=\"crayon-e\">xx00</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5de2693668877-3\"><span class=\"crayon-e\">xx01</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5de2693668877-4\"><span class=\"crayon-i\">xx02</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5de2693668877-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>您可以使用 <code>head</code> 命令查看每个新文件的前十行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb1e5de7592186950\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ head xx*\r\n==&gt; xx00 &lt;==\r\nFoo File\r\nby Carla Schroder\r\nFoo text\r\nFoo subheading\r\nMore foo text\r\n==&gt; xx01 &lt;==\r\nFoo text\r\nFoo subheading\r\nMore foo text\r\n==&gt; xx02 &lt;==\r\nFoo text\r\nFoo subheading\r\nMore foo text </textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5de7592186950-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5de7592186950-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5de7592186950-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5de7592186950-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5de7592186950-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5de7592186950-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5de7592186950-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5de7592186950-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5de7592186950-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5de7592186950-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5de7592186950-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5de7592186950-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5de7592186950-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5de7592186950-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5de7592186950-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5de7592186950-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">head </span><span class=\"crayon-e \">xx*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5de7592186950-2\"><span class=\"crayon-o\">==</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">xx00</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5de7592186950-3\"><span class=\"crayon-e\">Foo </span><span class=\"crayon-e\">File</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5de7592186950-4\"><span class=\"crayon-e\">by </span><span class=\"crayon-e\">Carla </span><span class=\"crayon-e\">Schroder</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5de7592186950-5\"><span class=\"crayon-e\">Foo </span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5de7592186950-6\"><span class=\"crayon-e\">Foo </span><span class=\"crayon-e\">subheading</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5de7592186950-7\"><span class=\"crayon-e\">More </span><span class=\"crayon-e\">foo </span><span class=\"crayon-v\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5de7592186950-8\"><span class=\"crayon-o\">==</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">xx01</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5de7592186950-9\"><span class=\"crayon-e\">Foo </span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5de7592186950-10\"><span class=\"crayon-e\">Foo </span><span class=\"crayon-e\">subheading</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5de7592186950-11\"><span class=\"crayon-e\">More </span><span class=\"crayon-e\">foo </span><span class=\"crayon-v\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5de7592186950-12\"><span class=\"crayon-o\">==</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">xx02</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;=</span><span class=\"crayon-o\">=</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5de7592186950-13\"><span class=\"crayon-e\">Foo </span><span class=\"crayon-e\">text</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5de7592186950-14\"><span class=\"crayon-e\">Foo </span><span class=\"crayon-e\">subheading</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5de7592186950-15\"><span class=\"crayon-e\">More </span><span class=\"crayon-e\">foo </span><span class=\"crayon-i\">text</span><span class=\"crayon-h\"> </span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>如果要将文件分割成包含相同行数的多个文件怎么办？可以指定行数，然后将重复次数放在在花括号中。此示例重复分割 4 次，并将剩下的转储到最后一个文件中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb1e5dea436809677\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ csplit foo.txt 5 {4}\r\n57\r\n1488\r\n249\r\n1866\r\n3798\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5dea436809677-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5dea436809677-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5dea436809677-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5dea436809677-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5dea436809677-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5dea436809677-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5dea436809677-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5dea436809677-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">csplit </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5dea436809677-2\"><span class=\"crayon-cn\">57</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5dea436809677-3\"><span class=\"crayon-cn\">1488</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5dea436809677-4\"><span class=\"crayon-cn\">249</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5dea436809677-5\"><span class=\"crayon-cn\">1866</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5dea436809677-6\"><span class=\"crayon-cn\">3798</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5dea436809677-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>您可以使用星号通配符来告诉 <code>csplit</code> 尽可能多地重复分割。这听起来很酷，但是如果文件不能等分，则可能会失败（LCTT 译注：低版本的 <code>csplit</code> 不支持此参数）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb1e5dee950663227\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ csplit foo.txt 10 {*}\r\n1545\r\n2115\r\n1848\r\n1901\r\ncsplit: '10': line number out of range on repetition 4\r\n1430\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5dee950663227-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5dee950663227-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5dee950663227-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5dee950663227-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5dee950663227-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5dee950663227-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5dee950663227-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5dee950663227-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5dee950663227-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">csplit </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5dee950663227-2\"><span class=\"crayon-cn\">1545</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5dee950663227-3\"><span class=\"crayon-cn\">2115</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5dee950663227-4\"><span class=\"crayon-cn\">1848</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5dee950663227-5\"><span class=\"crayon-cn\">1901</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5dee950663227-6\"><span class=\"crayon-v\">csplit</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'10'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">line </span><span class=\"crayon-e\">number </span><span class=\"crayon-e\">out </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">range </span><span class=\"crayon-e\">on </span><span class=\"crayon-i\">repetition</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5dee950663227-7\"><span class=\"crayon-cn\">1430</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5dee950663227-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>默认的行为是删除发生错误时的输出文件。你可以用 <code>-k</code> 选项来解决这个问题，当有错误时，它就不会删除输出文件。另一个行为是每次运行 <code>csplit</code> 时，它将覆盖之前创建的文件，所以你需要使用新的文件名来分别保存它们。使用 <code>--prefix= _prefix_</code> 来设置一个不同的文件前缀：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb1e5df1007690095\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ csplit -k --prefix=mine foo.txt 5 {*}  \r\n57\r\n1488\r\n249\r\n1866\r\n993\r\ncsplit: '5': line number out of range on repetition 9\r\n437\r\n\r\n$ ls\r\nmine00\r\nmine01\r\nmine02\r\nmine03 \r\nmine04\r\nmine05\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5df1007690095-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5df1007690095-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5df1007690095-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5df1007690095-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5df1007690095-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5df1007690095-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5df1007690095-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5df1007690095-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5df1007690095-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5df1007690095-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5df1007690095-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5df1007690095-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5df1007690095-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5df1007690095-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5df1007690095-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5df1007690095-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5df1007690095-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5df1007690095-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">csplit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">prefix</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">mine </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5df1007690095-2\"><span class=\"crayon-cn\">57</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5df1007690095-3\"><span class=\"crayon-cn\">1488</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5df1007690095-4\"><span class=\"crayon-cn\">249</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5df1007690095-5\"><span class=\"crayon-cn\">1866</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5df1007690095-6\"><span class=\"crayon-cn\">993</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5df1007690095-7\"><span class=\"crayon-v\">csplit</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'5'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">line </span><span class=\"crayon-e\">number </span><span class=\"crayon-e\">out </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">range </span><span class=\"crayon-e\">on </span><span class=\"crayon-i\">repetition</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5df1007690095-8\"><span class=\"crayon-cn\">437</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5df1007690095-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5df1007690095-10\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5df1007690095-11\"><span class=\"crayon-e\">mine00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5df1007690095-12\"><span class=\"crayon-e\">mine01</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5df1007690095-13\"><span class=\"crayon-e\">mine02</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5df1007690095-14\"><span class=\"crayon-e\">mine03 </span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5df1007690095-15\"><span class=\"crayon-e\">mine04</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5df1007690095-16\"><span class=\"crayon-i\">mine05</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5df1007690095-17\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>选项 <code>-n</code> 可用于改变对文件进行编号的数字位数（默认是 2 位）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb1e5df4735387679\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ csplit -n 3 --prefix=mine foo.txt 5 {4}\r\n57\r\n1488\r\n249\r\n1866\r\n1381\r\n3798\r\n\r\n$ ls\r\nmine000\r\nmine001\r\nmine002\r\nmine003\r\nmine004\r\nmine005\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5df4735387679-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5df4735387679-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5df4735387679-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5df4735387679-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5df4735387679-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5df4735387679-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5df4735387679-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5df4735387679-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5df4735387679-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5df4735387679-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5df4735387679-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5df4735387679-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5df4735387679-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5df4735387679-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5df4735387679-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5df4735387679-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5df4735387679-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">csplit</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">prefix</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">mine </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5df4735387679-2\"><span class=\"crayon-cn\">57</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5df4735387679-3\"><span class=\"crayon-cn\">1488</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5df4735387679-4\"><span class=\"crayon-cn\">249</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5df4735387679-5\"><span class=\"crayon-cn\">1866</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5df4735387679-6\"><span class=\"crayon-cn\">1381</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5df4735387679-7\"><span class=\"crayon-cn\">3798</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5df4735387679-8\"> </div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5df4735387679-9\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5df4735387679-10\"><span class=\"crayon-e\">mine000</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5df4735387679-11\"><span class=\"crayon-e\">mine001</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5df4735387679-12\"><span class=\"crayon-e\">mine002</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5df4735387679-13\"><span class=\"crayon-e\">mine003</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5df4735387679-14\"><span class=\"crayon-e\">mine004</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5df4735387679-15\"><span class=\"crayon-i\">mine005</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5df4735387679-16\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p><code>csplit</code> 中的 “c” 是上下文（context）的意思。这意味着你可以根据任意匹配的方式或者巧妙的正则表达式来分割文件。下面的例子将文件分为两部分。第一个文件在包含第一次出现 “fie” 的前一行处结束，第二个文件则以包含 “fie” 的行开头。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb1e5df8306067979\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ csplit foo.txt /fie/ \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5df8306067979-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5df8306067979-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5df8306067979-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">csplit </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">fie</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5df8306067979-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>在每次出现 “fie” 时分割文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb1e5dfb064760368\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ csplit foo.txt /fie/ {*}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5dfb064760368-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5dfb064760368-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5dfb064760368-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">csplit </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">fie</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5dfb064760368-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>在 “fie” 前五次出现的地方分割文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb1e5dfe138265063\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ csplit foo.txt /fie/ {5}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5dfe138265063-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5dfe138265063-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5dfe138265063-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">csplit </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">fie</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5dfe138265063-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>仅当内容以包含 “fie” 的行开始时才复制，并且省略前面的所有内容：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb1e5e01473161662\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ csplit myfile %fie% \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5e01473161662-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5e01473161662-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5e01473161662-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">csplit </span><span class=\"crayon-v\">myfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">fie</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5e01473161662-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p>\n<h3 id=\"toc_2\">将文件分割成不同大小</h3>\n<p><code>split</code> 与 <code>csplit</code> 类似。它将文件分割成特定的大小，当您将大文件分割成小的多媒体文件或者使用网络传送时，这就非常棒了。默认的大小为 1000 行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb1e5e04148656620\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ split foo.mv\r\n$ ls -hl\r\n266K Aug 21 16:58 xaa\r\n267K Aug 21 16:58 xab\r\n315K Aug 21 16:58 xac\r\n[...]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5e04148656620-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5e04148656620-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5e04148656620-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5e04148656620-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5e04148656620-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5e04148656620-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5e04148656620-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5e04148656620-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">split </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">mv</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5e04148656620-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">hl</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5e04148656620-3\"><span class=\"crayon-cn\">266K</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">58</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">xaa</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5e04148656620-4\"><span class=\"crayon-cn\">267K</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">58</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">xab</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5e04148656620-5\"><span class=\"crayon-cn\">315K</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">58</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">xac</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5e04148656620-6\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5e04148656620-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>它们分割出来的大小相似，但你可以指定任何你想要的大小。这个例子中是 20M 字节：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb1e5e09997892948\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ split -b 20M foo.mv\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5e09997892948-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5e09997892948-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5e09997892948-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20M</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">mv</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5e09997892948-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>尺寸单位缩写为 K，M，G，T，P，E，Z，Y（1024 的幂）或者 KB，MB，GB 等等（1000 的幂）。</p>\n<p>为文件名选择你自己的前缀和后缀：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb1e5e0d375264268\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ split -a 3 --numeric-suffixes=9 --additional-suffix=mine foo.mv SB\r\n240K Aug 21 17:44 SB009mine\r\n214K Aug 21 17:44 SB010mine\r\n220K Aug 21 17:44 SB011mine\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5e0d375264268-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5e0d375264268-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5e0d375264268-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5e0d375264268-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5e0d375264268-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5e0d375264268-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">split</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">numeric</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">suffixes</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">9</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">additional</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">suffix</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">mine </span><span class=\"crayon-v\">foo</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mv </span><span class=\"crayon-i\">SB</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5e0d375264268-2\"><span class=\"crayon-cn\">240K</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">44</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SB009mine</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5e0d375264268-3\"><span class=\"crayon-cn\">214K</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">44</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SB010mine</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5e0d375264268-4\"><span class=\"crayon-cn\">220K</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">44</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">SB011mine</span></div><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5e0d375264268-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p><code>-a</code> 选项控制编号的数字位置。<code>--numeric-suffixes</code> 设置编号的开始值。默认前缀为 <code>x</code>，你也可以通过在文件名后输入它来设置一个不同的前缀。</p>\n<h3 id=\"toc_3\">将分割后的文件合并</h3>\n<p>你可能想在某个时候重组你的文件。常用的 <code>cat</code> 命令就用在这里：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb1e5e10840263475\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cat SB0* &gt; foo2.txt\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5e10840263475-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5e10840263475-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5e10840263475-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cat </span><span class=\"crayon-e \">SB0*</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5e10840263475-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>示例中的星号通配符将匹配到所有以 SB0 开头的文件，这可能不会得到您想要的结果。您可以使用问号通配符进行更精确的匹配，每个字符使用一个问号：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb1e5e14268611249\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cat SB0?????? &gt; foo2.txt\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb1e5e14268611249-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb1e5e14268611249-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb1e5e14268611249-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cat </span><span class=\"crayon-v\">SB0</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb1e5e14268611249-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>和往常一样，请查阅相关的手册和信息页面以获取完整的命令选项。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112303\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112303votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112303\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "六个优雅的 Linux 命令行技巧", "url": "http://blog.jobbole.com/112306/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/05/77d80105fd15f2465894827e23cc4842.jpeg"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 4, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.networkworld.com/article/3219684/linux/half-a-dozen-clever-linux-command-line-tricks.html\">Sandra Henry-stocker</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8820-1.html\">Linux中国/firmianay</a>   </div><blockquote><p>一些非常有用的命令能让命令行的生活更满足</p></blockquote>\n<p>使用 Linux 命令工作可以获得许多乐趣，但是如果您使用一些命令，它们可以减少您的工作或以有趣的方式显示信息时，您将获得更多的乐趣。在今天的文章中，我们将介绍六个命令，它们可能会使你用在命令行上的时间更加值当。</p>\n<h3 id=\"toc_1\">watch</h3>\n<p><code>watch</code> 命令会重复运行您给出的任何命令，并显示输出。默认情况下，它每两秒运行一次命令。命令的每次运行都将覆盖上一次运行时显示的内容，因此您始终可以看到最新的数据。</p>\n<p>您可能会在等待某人登录时使用它。在这种情况下，您可以使用 <code>watch who</code> 命令或者 <code>watch -n 15 who</code> 命令使每 15 秒运行一次，而不是两秒一次。另外终端窗口的右上角会显示日期和时间。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d1244b4ad564356378\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ watch -n 5 who\r\nEvery 5.0s: who                               stinkbug: Wed Aug 23 14:52:15 2017\r\n\r\nshs      pts/0        2017-08-23 14:45 (192.168.0.11)\r\nzoe      pts/1        2017-08-23 08:15 (192.168.0.19)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4ad564356378-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4ad564356378-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4ad564356378-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4ad564356378-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4ad564356378-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4ad564356378-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d1244b4ad564356378-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">watch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">who</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4ad564356378-2\"><span class=\"crayon-i\">Every</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.0s</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">who                               </span><span class=\"crayon-v\">stinkbug</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Wed </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">52</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4ad564356378-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4ad564356378-4\"><span class=\"crayon-e\">shs      </span><span class=\"crayon-v\">pts</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">192.168.0.11</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4ad564356378-5\"><span class=\"crayon-e\">zoe      </span><span class=\"crayon-v\">pts</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">15</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">192.168.0.19</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4ad564356378-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>您也可以使用它来查看日志文件。如果您显示的数据没有任何变化，则只有窗口角落里的日期和时间会发生变化。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d1244b4b7465672542\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ watch tail /var/log/syslog\r\nEvery 2.0s: tail /var/log/syslog              stinkbug: Wed Aug 23 15:16:37 2017\r\n\r\nAug 23 14:45:01 stinkbug CRON[7214]: (root) CMD (command -v debian-sa1 &gt; /dev/nu\r\nll &amp;&amp; debian-sa1 1 1)\r\nAug 23 14:45:17 stinkbug systemd[1]: Started Session 179 of user shs.\r\nAug 23 14:55:01 stinkbug CRON[7577]: (root) CMD (command -v debian-sa1 &gt; /dev/nu\r\nll &amp;&amp; debian-sa1 1 1)\r\nAug 23 15:05:01 stinkbug CRON[7582]: (root) CMD (command -v debian-sa1 &gt; /dev/nu\r\nll &amp;&amp; debian-sa1 1 1)\r\nAug 23 15:08:48 stinkbug systemd[1]: Starting Cleanup of Temporary Directories...\r\nAug 23 15:08:48 stinkbug systemd-tmpfiles[7584]: [/usr/lib/tmpfiles.d/var.conf:1\r\n4] Duplicate line for path \"/var/log\", ignoring.\r\nAug 23 15:08:48 stinkbug systemd[1]: Started Cleanup of Temporary Directories.\r\nAug 23 15:13:41 stinkbug systemd[1]: Started Session 182 of user shs.\r\nAug 23 15:14:29 stinkbug systemd[1]: Started Session 183 of user shs.\r\nAug 23 15:15:01 stinkbug CRON[7828]: (root) CMD (command -v debian-sa1 &gt; /dev/nu\r\nll &amp;&amp; debian-sa1 1 1)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4b7465672542-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4b7465672542-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4b7465672542-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4b7465672542-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4b7465672542-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4b7465672542-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4b7465672542-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4b7465672542-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4b7465672542-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4b7465672542-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4b7465672542-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4b7465672542-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4b7465672542-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4b7465672542-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4b7465672542-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4b7465672542-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4b7465672542-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4b7465672542-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4b7465672542-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d1244b4b7465672542-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">watch </span><span class=\"crayon-v\">tail</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">syslog</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4b7465672542-2\"><span class=\"crayon-i\">Every</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2.0s</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tail</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">log</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">syslog              </span><span class=\"crayon-v\">stinkbug</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Wed </span><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">37</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4b7465672542-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4b7465672542-4\"><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stinkbug </span><span class=\"crayon-v\">CRON</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">7214</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CMD</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">debian</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sa1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">nu</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4b7465672542-5\"><span class=\"crayon-v\">ll</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">debian</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">sa1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4b7465672542-6\"><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stinkbug </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Started </span><span class=\"crayon-i\">Session</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">179</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">user </span><span class=\"crayon-v\">shs</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4b7465672542-7\"><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">55</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stinkbug </span><span class=\"crayon-v\">CRON</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">7577</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CMD</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">debian</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sa1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">nu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4b7465672542-8\"><span class=\"crayon-v\">ll</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">debian</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">sa1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4b7465672542-9\"><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">05</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stinkbug </span><span class=\"crayon-v\">CRON</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">7582</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CMD</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">debian</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sa1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">nu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4b7465672542-10\"><span class=\"crayon-v\">ll</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">debian</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">sa1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4b7465672542-11\"><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">48</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stinkbug </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Starting </span><span class=\"crayon-e\">Cleanup </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">Temporary </span><span class=\"crayon-v\">Directories</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4b7465672542-12\"><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">48</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stinkbug </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">tmpfiles</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">7584</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmpfiles</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">d</span><span class=\"crayon-o\">/</span><span class=\"crayon-t\">var</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">conf</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4b7465672542-13\"><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Duplicate </span><span class=\"crayon-e\">line </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">path</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/var/log\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ignoring</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4b7465672542-14\"><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">48</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stinkbug </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Started </span><span class=\"crayon-e\">Cleanup </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">Temporary </span><span class=\"crayon-v\">Directories</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4b7465672542-15\"><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">13</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">41</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stinkbug </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Started </span><span class=\"crayon-i\">Session</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">182</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">user </span><span class=\"crayon-v\">shs</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4b7465672542-16\"><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">29</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stinkbug </span><span class=\"crayon-v\">systemd</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Started </span><span class=\"crayon-i\">Session</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">183</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">user </span><span class=\"crayon-v\">shs</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4b7465672542-17\"><span class=\"crayon-i\">Aug</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stinkbug </span><span class=\"crayon-v\">CRON</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">7828</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CMD</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">debian</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sa1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dev</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">nu</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4b7465672542-18\"><span class=\"crayon-v\">ll</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">debian</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">sa1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4b7465672542-19\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0079 seconds] -->\r\n<p>这里的输出和使用命令 <code>tail -f /var/log/syslog</code> 的输出相似。</p>\n<h3 id=\"toc_2\">look</h3>\n<p>这个命令的名字 <code>look</code> 可能会让我们以为它和 <code>watch</code> 做类似的事情，但其实是不同的。<code>look</code> 命令用于搜索以某个特定字符串开头的单词。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d1244b4bc326931212\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ look ecl\r\neclectic\r\neclectic's\r\neclectically\r\neclecticism\r\neclecticism's\r\neclectics\r\neclipse\r\neclipse's\r\neclipsed\r\neclipses\r\neclipsing\r\necliptic\r\necliptic's\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4bc326931212-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4bc326931212-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4bc326931212-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4bc326931212-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4bc326931212-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4bc326931212-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4bc326931212-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4bc326931212-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4bc326931212-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4bc326931212-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4bc326931212-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4bc326931212-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4bc326931212-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4bc326931212-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4bc326931212-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d1244b4bc326931212-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">look </span><span class=\"crayon-e\">ecl</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4bc326931212-2\"><span class=\"crayon-e\">eclectic</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4bc326931212-3\"><span class=\"crayon-i\">eclectic</span><span class=\"crayon-s\">'s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4bc326931212-4\"><span class=\"crayon-s\">eclectically</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4bc326931212-5\"><span class=\"crayon-s\">eclecticism</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4bc326931212-6\"><span class=\"crayon-s\">eclecticism'</span><span class=\"crayon-i\">s</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4bc326931212-7\"><span class=\"crayon-e\">eclectics</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4bc326931212-8\"><span class=\"crayon-e\">eclipse</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4bc326931212-9\"><span class=\"crayon-i\">eclipse</span><span class=\"crayon-s\">'s</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4bc326931212-10\"><span class=\"crayon-s\">eclipsed</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4bc326931212-11\"><span class=\"crayon-s\">eclipses</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4bc326931212-12\"><span class=\"crayon-s\">eclipsing</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4bc326931212-13\"><span class=\"crayon-s\">ecliptic</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4bc326931212-14\"><span class=\"crayon-s\">ecliptic'</span><span class=\"crayon-i\">s</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4bc326931212-15\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><code>look</code> 命令通常有助于单词的拼写，它使用 <code>/usr/share/dict/words</code> 文件，除非你使用如下的命令指定了文件名：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d1244b4c0835347697\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ look esac .bashrc\r\nesac\r\nesac\r\nesac\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c0835347697-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c0835347697-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c0835347697-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c0835347697-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c0835347697-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c0835347697-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">look </span><span class=\"crayon-i\">esac</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bashrc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c0835347697-2\"><span class=\"crayon-e\">esac</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c0835347697-3\"><span class=\"crayon-e\">esac</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c0835347697-4\"><span class=\"crayon-i\">esac</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c0835347697-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>在这种情况下，它的作用就像跟在一个 <code>awk</code> 命令后面的 <code>grep</code> ，只打印匹配行上的第一个单词。</p>\n<h3 id=\"toc_3\">man -k</h3>\n<p><code>man -k</code> 命令列出包含指定单词的手册页。它的工作基本上和 <code>apropos</code> 命令一样。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d1244b4c3204046234\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ man -k logrotate\r\ndh_installlogrotate (1) - install logrotate config files\r\nlogrotate (8)        - rotates, compresses, and mails system logs\r\nlogrotate.conf (5)   - rotates, compresses, and mails system logs\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c3204046234-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c3204046234-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c3204046234-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c3204046234-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c3204046234-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c3204046234-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">man</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">logrotate</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c3204046234-2\"><span class=\"crayon-e\">dh_installlogrotate</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">install </span><span class=\"crayon-e\">logrotate </span><span class=\"crayon-e\">config </span><span class=\"crayon-e\">files</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c3204046234-3\"><span class=\"crayon-e\">logrotate</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rotates</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">compresses</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mails </span><span class=\"crayon-e\">system </span><span class=\"crayon-e\">logs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c3204046234-4\"><span class=\"crayon-v\">logrotate</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">conf</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rotates</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">compresses</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mails </span><span class=\"crayon-e\">system </span><span class=\"crayon-i\">logs</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c3204046234-5\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p></p>\n<h3 id=\"toc_4\">help</h3>\n<p>当你完全绝望的时候，您可能会试图使用此命令，<code>help</code> 命令实际上是显示一个 shell 内置命令的列表。最令人惊讶的是它有相当多的参数变量。你可能会看到这样的东西，然后开始想知道这些内置功能可以为你做些什么：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d1244b4c6276652191\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ help\r\nGNU bash, version 4.4.7(1)-release (i686-pc-linux-gnu)\r\nThese shell commands are defined internally.  Type `help' to see this list.\r\nType `help name' to find out more about the function `name'.\r\nUse `info bash' to find out more about the shell in general.\r\nUse `man -k' or `info' to find out more about commands not in this list.\r\n\r\nA star (*) next to a name means that the command is disabled.\r\n\r\n job_spec [&amp;]                            history [-c] [-d offset] [n] or hist&gt;\r\n (( expression ))                        if COMMANDS; then COMMANDS; [ elif C&gt;\r\n . filename [arguments]                  jobs [-lnprs] [jobspec ...] or jobs &gt;\r\n :                                       kill [-s sigspec | -n signum | -sigs&gt;\r\n [ arg... ]                              let arg [arg ...]\r\n [[ expression ]]                        local [option] name[=value] ...\r\n alias [-p] [name[=value] ... ]          logout [n]\r\n bg [job_spec ...]                       mapfile [-d delim] [-n count] [-O or&gt;\r\n bind [-lpsvPSVX] [-m keymap] [-f file&gt;  popd [-n] [+N | -N]\r\n break [n]                               printf [-v var] format [arguments]\r\n builtin [shell-builtin [arg ...]]       pushd [-n] [+N | -N | dir]\r\n caller [expr]                           pwd [-LP]\r\n case WORD in [PATTERN [| PATTERN]...)&gt;  read [-ers] [-a array] [-d delim] [-&gt;\r\n cd [-L|[-P [-e]] [-@]] [dir]            readarray [-n count] [-O origin] [-s&gt;\r\n command [-pVv] command [arg ...]        readonly [-aAf] [name[=value] ...] o&gt;\r\n compgen [-abcdefgjksuv] [-o option] [&gt;  return [n]\r\n complete [-abcdefgjksuv] [-pr] [-DE] &gt;  select NAME [in WORDS ... ;] do COMM&gt;\r\n compopt [-o|+o option] [-DE] [name ..&gt;  set [-abefhkmnptuvxBCHP] [-o option-&gt;\r\n continue [n]                            shift [n]\r\n coproc [NAME] command [redirections]    shopt [-pqsu] [-o] [optname ...]\r\n declare [-aAfFgilnrtux] [-p] [name[=v&gt;  source filename [arguments]\r\n dirs [-clpv] [+N] [-N]                  suspend [-f]\r\n disown [-h] [-ar] [jobspec ... | pid &gt;  test [expr]\r\n echo [-neE] [arg ...]                   time [-p] pipeline\r\n enable [-a] [-dnps] [-f filename] [na&gt;  times\r\n eval [arg ...]                          trap [-lp] [[arg] signal_spec ...]\r\n exec [-cl] [-a name] [command [argume&gt;  true\r\n exit [n]                                type [-afptP] name [name ...]\r\n export [-fn] [name[=value] ...] or ex&gt;  typeset [-aAfFgilnrtux] [-p] name[=v&gt;\r\n false                                   ulimit [-SHabcdefiklmnpqrstuvxPT] [l&gt;\r\n fc [-e ename] [-lnr] [first] [last] o&gt;  umask [-p] [-S] [mode]\r\n fg [job_spec]                           unalias [-a] name [name ...]\r\n for NAME [in WORDS ... ] ; do COMMAND&gt;  unset [-f] [-v] [-n] [name ...]\r\n for (( exp1; exp2; exp3 )); do COMMAN&gt;  until COMMANDS; do COMMANDS; done\r\n function name { COMMANDS ; } or name &gt;  variables - Names and meanings of so&gt;\r\n getopts optstring name [arg]            wait [-n] [id ...]\r\n hash [-lr] [-p pathname] [-dt] [name &gt;  while COMMANDS; do COMMANDS; done\r\n help [-dms] [pattern ...]               { COMMANDS ; }\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4c6276652191-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4c6276652191-48\">48</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">help</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-2\"><span class=\"crayon-e\">GNU </span><span class=\"crayon-v\">bash</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">version</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4.4.7</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">release</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i686</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pc</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">linux</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">gnu</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-3\"><span class=\"crayon-e\">These </span><span class=\"crayon-e\">shell </span><span class=\"crayon-e\">commands </span><span class=\"crayon-e\">are </span><span class=\"crayon-e\">defined </span><span class=\"crayon-v\">internally</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">Type</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-i\">help</span><span class=\"crayon-s\">' to see this list.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-4\"><span class=\"crayon-s\">Type `help name'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">find </span><span class=\"crayon-e\">out </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">about </span><span class=\"crayon-e\">the </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-i\">name</span><span class=\"crayon-s\">'.</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-5\"><span class=\"crayon-s\">Use `info bash'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">find </span><span class=\"crayon-e\">out </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">about </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">shell </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">general</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-6\"><span class=\"crayon-st\">Use</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">man</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">k</span><span class=\"crayon-s\">' or `info'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">find </span><span class=\"crayon-e\">out </span><span class=\"crayon-e\">more </span><span class=\"crayon-e\">about </span><span class=\"crayon-e\">commands </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">list</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-8\"><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">star</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">next </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name </span><span class=\"crayon-e\">means </span><span class=\"crayon-e\">that </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">command </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">disabled</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-10\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">job</span><span class=\"crayon-sy\">_</span>spec<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                            </span><span class=\"crayon-i\">history</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">offset</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hist</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-11\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">expression</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">                        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">COMMANDS</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">COMMANDS</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">elif</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">C</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-12\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">filename</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">arguments</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                  </span><span class=\"crayon-i\">jobs</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">lnprs</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">jobspec</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jobs</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-13\"><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">                                       </span><span class=\"crayon-i\">kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sigspec</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">signum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">sigs</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-14\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">arg</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                              </span><span class=\"crayon-e\">let </span><span class=\"crayon-i\">arg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">arg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-15\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">expression</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                        </span><span class=\"crayon-i\">local</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">option</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-16\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">alias</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">          </span><span class=\"crayon-i\">logout</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-17\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">bg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">job</span><span class=\"crayon-sy\">_</span>spec<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                       </span><span class=\"crayon-i\">mapfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">delim</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">O</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-18\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">bind</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">lpsvPSVX</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">keymap</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">file</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">popd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">N</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-19\"><span class=\"crayon-h\"> </span><span class=\"crayon-st\">break</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                               </span><span class=\"crayon-i\">printf</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">var</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">format</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">arguments</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-20\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">builtin</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">shell</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">builtin</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">arg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">       </span><span class=\"crayon-i\">pushd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">N</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">N</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dir</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-21\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">caller</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">expr</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                           </span><span class=\"crayon-i\">pwd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">LP</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-22\"><span class=\"crayon-h\"> </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">WORD</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">PATTERN</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PATTERN</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">read</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ers</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">delim</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-23\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">L</span><span class=\"crayon-o\">|</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">P</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">dir</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">            </span><span class=\"crayon-i\">readarray</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">O</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">origin</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-24\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pVv</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">arg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">        </span><span class=\"crayon-i\">readonly</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">aAf</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">o</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-25\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">compgen</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">abcdefgjksuv</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">option</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-26\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">complete</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">abcdefgjksuv</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pr</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">DE</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">select </span><span class=\"crayon-i\">NAME</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">WORDS</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">COMM</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-27\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">compopt</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">o</span><span class=\"crayon-o\">|</span><span class=\"crayon-o\">+</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">option</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">DE</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">abefhkmnptuvxBCHP</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">option</span><span class=\"crayon-o\">-&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-28\"><span class=\"crayon-h\"> </span><span class=\"crayon-st\">continue</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                            </span><span class=\"crayon-i\">shift</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-29\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">coproc</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">NAME</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">redirections</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">    </span><span class=\"crayon-i\">shopt</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pqsu</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">o</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">optname</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-30\"><span class=\"crayon-h\"> </span><span class=\"crayon-r\">declare</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">aAfFgilnrtux</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">v</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">source </span><span class=\"crayon-i\">filename</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">arguments</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-31\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">dirs</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">clpv</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">N</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                  </span><span class=\"crayon-i\">suspend</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-32\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">disown</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ar</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">jobspec</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">test</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">expr</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-33\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">neE</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">arg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                   </span><span class=\"crayon-i\">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pipeline</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-34\"><span class=\"crayon-e\"> </span><span class=\"crayon-i\">enable</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dnps</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">f</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">filename</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">na</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">times</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-35\"><span class=\"crayon-e\"> </span><span class=\"crayon-i\">eval</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">arg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                          </span><span class=\"crayon-i\">trap</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">lp</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">arg</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">signal</span><span class=\"crayon-sy\">_</span>spec<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-36\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">exec</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">cl</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">argume</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-37\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">exit</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                                </span><span class=\"crayon-i\">type</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">afptP</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-38\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">export</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">fn</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ex</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">typeset</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">aAfFgilnrtux</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">v</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-39\"><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-h\">                                   </span><span class=\"crayon-i\">ulimit</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">SHabcdefiklmnpqrstuvxPT</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">l</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-40\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">fc</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ename</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">lnr</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">first</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">last</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">o</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">umask</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">p</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">S</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">mode</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-41\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">fg</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">job_spec</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">                           </span><span class=\"crayon-i\">unalias</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-42\"><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">NAME</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">WORDS</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">COMMAND</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">unset</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">v</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-43\"><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">exp1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">exp2</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">exp3</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">COMMAN</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">until </span><span class=\"crayon-v\">COMMANDS</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">COMMANDS</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">done</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-44\"><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMANDS</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">variables</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Names </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">meanings </span><span class=\"crayon-e\">of </span><span class=\"crayon-v\">so</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-45\"><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getopts </span><span class=\"crayon-e\">optstring </span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">arg</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">            </span><span class=\"crayon-i\">wait</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-46\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">hash</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">lr</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pathname</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dt</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\">  </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">COMMANDS</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">do</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">COMMANDS</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">done</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4c6276652191-47\"><span class=\"crayon-e\"> </span><span class=\"crayon-i\">help</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">dms</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">pattern</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">               </span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">COMMANDS</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4c6276652191-48\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0226 seconds] -->\r\n<p></p>\n<h3 id=\"toc_5\">stat -c</h3>\n<p><code>stat</code> 命令用于显示文件的大小、所有者、用户组、索引节点号、权限、修改和访问时间等重要的统计信息。这是一个非常有用的命令，可以显示比 <code>ls -l</code> 更多的细节。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d1244b4d5992892898\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ stat .bashrc\r\n  File: .bashrc\r\n  Size: 4048            Blocks: 8          IO Block: 4096   regular file\r\nDevice: 806h/2054d      Inode: 421481      Links: 1\r\nAccess: (0644/-rw-r--r--)  Uid: ( 1000/     shs)   Gid: ( 1000/     shs)\r\nAccess: 2017-08-23 15:13:41.781809933 -0400\r\nModify: 2017-06-21 17:37:11.875157790 -0400\r\nChange: 2017-06-21 17:37:11.899157791 -0400\r\n Birth: -\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4d5992892898-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4d5992892898-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4d5992892898-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4d5992892898-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4d5992892898-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4d5992892898-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4d5992892898-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4d5992892898-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4d5992892898-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4d5992892898-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d1244b4d5992892898-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">stat</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bashrc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4d5992892898-2\"><span class=\"crayon-e\">  </span><span class=\"crayon-v\">File</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bashrc</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4d5992892898-3\"><span class=\"crayon-e\">  </span><span class=\"crayon-v\">Size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4048</span><span class=\"crayon-h\">            </span><span class=\"crayon-v\">Blocks</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\">          </span><span class=\"crayon-e\">IO </span><span class=\"crayon-v\">Block</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4096</span><span class=\"crayon-h\">   </span><span class=\"crayon-e\">regular </span><span class=\"crayon-e\">file</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4d5992892898-4\"><span class=\"crayon-v\">Device</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">806h</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2054d</span><span class=\"crayon-h\">      </span><span class=\"crayon-v\">Inode</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">421481</span><span class=\"crayon-h\">      </span><span class=\"crayon-v\">Links</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4d5992892898-5\"><span class=\"crayon-v\">Access</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0644</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-v\">Uid</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\">     </span><span class=\"crayon-v\">shs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">   </span><span class=\"crayon-v\">Gid</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1000</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\">     </span><span class=\"crayon-v\">shs</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4d5992892898-6\"><span class=\"crayon-v\">Access</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">08</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">23</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">13</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">41.781809933</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0400</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4d5992892898-7\"><span class=\"crayon-v\">Modify</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">37</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">11.875157790</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0400</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4d5992892898-8\"><span class=\"crayon-v\">Change</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">06</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">21</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">37</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">11.899157791</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">0400</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4d5992892898-9\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Birth</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4d5992892898-10\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p>使用 <code>-c</code> 选项，您可以指定要查看的字段。例如，如果您只想查看一个文件或一系列文件的文件名和访问权限，则可以这样做：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d1244b4d9523371104\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ stat -c '%n %a' .bashrc\r\n.bashrc 644\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4d9523371104-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4d9523371104-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4d9523371104-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d1244b4d9523371104-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%n %a'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">bashrc</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4d9523371104-2\"><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">bashrc</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">644</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4d9523371104-3\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>在此命令中， <code>%n</code> 表示每个文件的名称，而 <code>%a</code> 表示访问权限。<code>%u</code> 表示数字类型的 UID，而 <code>%U</code> 表示用户名。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d1244b4dc070853860\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ stat -c '%n %a' bin/*\r\nbin/loop 700\r\nbin/move2nohup 700\r\nbin/nohup.out 600\r\nbin/show_release 700\r\n\r\n$ stat -c '%n %a %U' bin/*\r\nbin/loop 700 shs\r\nbin/move2nohup 700 shs\r\nbin/nohup.out 600 root\r\nbin/show_release 700 shs\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4dc070853860-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4dc070853860-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4dc070853860-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4dc070853860-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4dc070853860-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4dc070853860-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4dc070853860-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4dc070853860-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4dc070853860-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4dc070853860-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1244b4dc070853860-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1244b4dc070853860-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d1244b4dc070853860-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%n %a'</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4dc070853860-2\"><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">loop</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">700</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4dc070853860-3\"><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">move2nohup</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">700</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4dc070853860-4\"><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nohup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">600</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4dc070853860-5\"><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">show</span><span class=\"crayon-sy\">_</span>release<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">700</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4dc070853860-6\"> </div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4dc070853860-7\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%n %a %U'</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4dc070853860-8\"><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">loop</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">700</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">shs</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4dc070853860-9\"><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">move2nohup</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">700</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">shs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4dc070853860-10\"><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">nohup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">600</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1244b4dc070853860-11\"><span class=\"crayon-v\">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">show</span><span class=\"crayon-sy\">_</span>release<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">700</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">shs</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1244b4dc070853860-12\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p></p>\n<h3 id=\"toc_6\">TAB</h3>\n<p>如果你没有使用过 tab 键来补全文件名，你真的错过了一个非常有用的命令行技巧。tab 键提供文件名补全功能（包括使用 <code>cd</code> 时的目录）。它在出现歧义之前尽可能多的填充文件名（多个文件以相同的字母开头。如果您有一个名为 <code>bigplans</code> 的文件，另一个名为 <code>bigplans2017</code> 的文件会发生歧义，你将听到一个声音，然后需要决定是按下回车键还是输入 <code>2</code> 之后再按下 tab 键选择第二个文件。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112306\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112306votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112306\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "GitHub 简易入门指南", "url": "http://blog.jobbole.com/112281/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/e1c1cc8db1f52eec31747b94474b595a.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 7, "tags": "IT技术,Github", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://www.linuxandubuntu.com/home/getting-started-with-github\">Linuxandubuntu</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8814-1.html\">Linux中国/firmianay</a>   </div><p><a href=\"http://www.linuxandubuntu.com/home/getting-started-with-github\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/e1c1cc8db1f52eec31747b94474b595a.jpg\" alt=\"Getting Started With GitHub\"></a></p>\n<p><a href=\"https://github.com/\">GitHub</a> 是一个在线平台，旨在促进在一个共同项目上工作的个人之间的代码托管、版本控制和协作。通过该平台，无论何时何地，都可以对项目进行操作（托管和审查代码，管理项目和与世界各地的其他开发者共同开发软件）。<strong>GitHub 平台</strong>为开源项目和私人项目都提供了项目处理功能。</p>\n<p>关于团队项目处理的功能包括：GitHub 流Flow&gt;和 GitHub 页Pages。这些功能可以让需要定期部署的团队轻松处理工作流程。另一方面，GitHub 页提供了页面用于展示开源项目、展示简历、托管博客等。</p>\n<p>GitHub 也为个人项目提供了必要的工具，使得个人项目可以轻松地处理。它也使得个人可以更轻松地与世界分享他们的项目。</p>\n<h3 id=\"toc_1\">注册 GitHub 并启动一个项目</h3>\n<p>在 GitHub 上启动新项目时，您必须先使用您的电子邮件地址创建一个帐户。</p>\n<p><a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/github-homepage_orig.jpg\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/01c7882ef18db3d3f3887534261dc45c.jpg\" alt=\"github homepage\"></a></p>\n<p>然后，在验证邮箱的时候，用户将自动登录到他们的 GitHub 帐户。</p>\n<h4 id=\"toc_2\">1、 创建仓库</h4>\n<p>之后，我们会被带到一个用于创建仓库repository的页面。仓库存储着包括修订历史记录在内的所有项目文件。仓库可以是公开的或者是私有的。公开的仓库可以被任何人查看，但是，只有项目所有者授予权限的人才可以提交修改到这个仓库。另一方面，私有仓库提供了额外的控制，可以将项目设置为对谁可见。因此，公开仓库适用于开源软件项目，而私有仓库主要适用于私有或闭源项目。</p>\n<ul>\n<li>填写 “仓库名称Repository Name” 和 “简短描述Short Description”。</li>\n<li>选中 “以一个 README 文件初始化Initialize this repository with a README”。</li>\n<li>最后，点击底部的 “创建仓库Create Repository” 按钮。</li>\n</ul>\n<p><a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/create-a-github-repository_orig.jpg\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/14fcf6fd8154adb9a3c89cf0fa0a93fb.jpg\" alt=\"create a github repository\"></a></p>\n<h4 id=\"toc_3\">2、 添加分支</h4>\n<p>在 GitHub 中，分支branch是一种同时操作单个仓库的各种版本的方式。默认情况下，任何创建的单个仓库都会被分配一个名为 “MASTER” 的分支，它被认为是最后一个分支。在 GitHub 中，分支在被合并到主干master（最后的分支）之前，可以在对仓库进行实验和编辑中发挥作用。</p>\n<p>为了使项目适合每一个人的需求，通常情况下，总是需要添加几个格外的分支来匹配不同的项目。在主分支上创建一个分支和复制主分支时的当前状态是一样的。</p>\n<p><a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/add-a-branch-to-github-repository_orig.jpg\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/09f5d75c22e6dee20daa51b241e8a809.jpg\" alt=\"add a branch to github repository\"></a></p>\n<p>创建分支与在不同版本中保存单个文件是类似的。它通过在特定仓库上执行的任务重命名来实现。</p>\n<p>分支在保持错误修复和功能添加工作中同样被证明是有效。在进行必要的修改后，这些分支会被合并到主分支中。</p>\n<p>在创建仓库后创建一个分支：</p>\n<ul>\n<li>在这个例子中，点击仓库名称 “Hello-World” 跳转到你的新仓库。</li>\n<li>点击顶部的 “Branch:Master” 按钮，会看到一个下拉菜单，菜单里有填写分支名称的空白字段。</li>\n<li>输入分支名称，在这个例子中我们输入 “readme-edits“。</li>\n<li>按下回车键或者点击蓝色的 “创建分支create branch” 框。</li>\n</ul>\n<p>这样就成功创建了两个分支：master 和 readme-edits。</p>\n<h4 id=\"toc_4\">3、 修改项目文件并提交</h4>\n<p>此步骤提供了关于如何更改仓库并保存修改的指导。在 GitHub 上，提交commit被定义为保存的修改的意思。每一次提交都与一个提交信息commit message相关联，该提交信息包含了保存的修改的历史记录，以及为何进行这些更改。这使得其他贡献者可以很轻松地知道你做出的更改以及更改的原因。</p>\n<p>要对仓库进行更改和提交更改，请执行以下步骤：</p>\n<ul>\n<li>点击仓库名称 “Hello-World”。</li>\n<li>点击右上角的铅笔图标查看和编辑文件。 <a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/commit-changes-to-github-repository_orig.jpg\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/05ce163a30316ed081d9d40cf125afa5.jpg\" alt=\"commit changes to github repository\"></a></li>\n<li>在编辑器中，写一些东西来确定你可以进行更改。</li>\n<li>在提交消息commit message字段中做简要的总结，以解释为什么以及如何进行更改。</li>\n<li>点击提交更改 commit changes按钮保存更改。</li>\n</ul>\n<p>请注意，这些更改仅仅影响到 readme-edits 分支，而不影响主分支。</p>\n<p><a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/commit-branch-to-master_orig.jpg\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/5424b71e6ca81e83e4abdaa2b6f369ee.jpg\" alt=\"commit branch to master\"></a></p>\n<h4 id=\"toc_5\">4、 开启一个拉取请求</h4>\n<p>拉取请求pull request是一个允许贡献者提出并请求某人审查和合并某些更改到他们的分支的功能。拉取请求还显示了几个分支的差异（diffs）。更改、添加和删减通常以红色和绿色来表示。一旦提交完成就可以开启拉取请求，即使代码还未完成。</p>\n<p>开启一个拉取请求：</p>\n<ul>\n<li>点击拉取请求pull requests选项卡。 <a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/github-pull-request_orig.jpg\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/ff952c1eb62fd8adbd387eeb38e9673e.jpg\" alt=\"github pull request\"></a></li>\n<li>点击新建拉取请求new pull requests按钮。</li>\n<li>选择 readme-edits 分支与 master 分支进行比较。 <a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/compare-commit-changes-github_orig.jpg\"><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/c5eec8f40ee29eb37ecbf19b41584b56.jpg\" alt=\"compare commit changes github\"></a></li>\n<li>确定请求，并确定这是您要提交的内容。</li>\n<li>点击创建拉取请求绿色按钮并输入一个标题。 <a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/open-a-pull-request-in-github-repository_orig.jpg\"><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/c581f47872c3af18d32d2dff1d05a4ad.jpg\" alt=\"open a pull request in github repository\"></a></li>\n<li>按下回车键。</li>\n</ul>\n<p>用户可以通过尝试创建并保存拉取请求来证实这些操作。</p>\n<h4 id=\"toc_6\">5、 合并拉取请求</h4>\n<p>最后一步是将 readme-edits 分支和 master 分支合并到一起。如果 readme-edits 分支和 master 分支不会产生冲突，则会显示merge pull request合并拉取请求的按钮。</p>\n<p><a href=\"http://www.linuxandubuntu.com/uploads/2/1/1/5/21152474/merge-the-pull-request-github_orig.jpg\"><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/c45ba98c142ca89fa2544a69baab31d6.jpg\" alt=\"merge the pull request github\"></a></p>\n<p>当合并拉取时，有必要确保评论comment和其他字段被正确填写。合并拉取：</p>\n<ul>\n<li>点击merge pull request合并拉取请求的按钮。</li>\n<li>确认合并。</li>\n<li>按下紫色的删除分支按钮，删除 readme-edits 分支，因为它已经被包含在 master 分支中。（LCTT 译注：如果是合并他人提交的拉取请求，则无需也无法删除合并过来的他人的分支。）</li>\n</ul>\n<p>本文提供了 GitHub 平台从注册到使用的基本操作，接下来由大家尽情探索吧。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112281\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112281votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112281\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "30 多年的编码经验浓缩成的 10 条最佳实践", "url": "http://blog.jobbole.com/112300/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/ae1f71aa35785945dbe6af4a8ee36970.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 2, "tags": "IT技术,最佳实践", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://cdiggins.github.io/blog/programming-tips.html\">Christopher Diggins</a>   译文出处：<a target=\"_blank\" href=\"https://my.oschina.net/editorial-story/blog/1525762\">开源中国</a>   </div><p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/ae1f71aa35785945dbe6af4a8ee36970.jpg\" alt=\"\" width=\"650\" height=\"423\"></p>\n<p>所以，如何写出一手好代码？</p>\n<p>良好的代码更易于阅读、理解、调试和修改，最重要的是它的缺陷也更少。显然，编写良好的代码需要更多的时间，但是从长远来看，它也具有更多的价值，因为这降低了维护的成本，而且具有更好的可重用性。</p>\n<p>事实上，我们可以将好的代码等同为可重用的代码，这也是本篇文章罗列的许多技巧背后的驱动原则。作为一个要实现特定功能的开发者，代码可以实现你的短期目标，但如果没有其他人希望重用它（包括未来的自己），这些代码一定会缺失某些东西。无论它是太复杂，还是太具体，在不同情况下都有很大可能会出错，或者不被其他开发者信任。</p>\n<p>我发现，只要尝试坚持将下面的最佳实践应用于你编写的所有代码（包括你的实验和原型），无论你现在的经验水平如何，都会编写出更好的代码。</p>\n<h2><strong>1. 遵循单一职责原则</strong></h2>\n<p>函数是程序员的工具中最重要的抽象形式。它们能更多地被重复使用，你需要编写的代码就越少，代码也因此变得更可靠。较小的函数遵循<a href=\"https://en.wikipedia.org/wiki/Single_responsibility_principle\" target=\"_blank\" rel=\"nofollow\">单一职责原则</a>更有可能被重复使用。</p>\n<h2><strong>2. 尽量减少共享状态</strong></h2>\n<p>你应该尽量减少函数之间的隐式共享状态，无论它是文件作用域的变量还是对象的成员字段，这有利于明确要求把值作为参数。当能明确地显示函数需要什么才可以产生所需的结果时，代码会变得更容易理解和重用。</p>\n<p>对此的一个推论是，在一个对象中，相对于成员变量，你更应该优先选择静态的无状态变量 (static stateless variables)。</p>\n<h2><strong>3. 将“副作用”局部化</strong></h2>\n<p>理想的副作用（例如：打印到控制台、日志记录、更改全局状态、文件系统操作等）应该被放置到单独的模块中，而不是散布在整个代码里面。函数中的一些“副作用”功能往往违反了单一职责原则。</p>\n<h2><strong>4. 优先使用不变的对象</strong></h2>\n<p>如果一个对象的状态在其构造函数中仅被设置一次，并且从不再次更改，则调试会变得更加容易，因为只要构造正确就能保持有效。这也是降低软件项目复杂性的最简单方法之一。</p>\n<h2><strong>5. 多用接口少用类</strong></h2>\n<p>接收接口的函数（或 C++ 中的模板参数和概念）比在类上运行的函数更具可重用性。</p>\n<h2><strong>6. 对模块应用良好的原则</strong></h2>\n<p>寻找机会将软件项目分解成更小的模块（例如库和应用程序），以促进模块级别的重用。对于模块，应该遵循的一些关键原则是：</p>\n<ol>\n<li>尽可能减少依赖</li>\n<li>每个项目应该有一个明确的职责</li>\n<li>不要重复自身</li>\n</ol>\n<p>你应该努力使你的项目保持小巧和明确。</p>\n<h2><strong>7. 避免继承</strong></h2>\n<p>在面向对象编程中，继承 —— 特别是和虚拟函数结合使用时，在可重用性方面往往是一条死胡同。我很少有成功的使用或编写重载类的库的经历。</p>\n<h2><strong>8. 将测试作为设计和开发的一部分</strong></h2>\n<p>我不是测试驱动开发的坚定分子，但开始编码时先编写测试代码会使得代码十分自然地遵循许多指导原则。这也有助于尽早发现错误。不过要注意避免编写无用的测试，良好的编码实践意味着更高级别的测试（例如单元测试中的集成测试或特征测试）在揭示缺陷方面更有效。</p>\n<h2><strong>9. 优先使用标准库而不是手写的</strong></h2>\n<p>我经常看到<em>更好</em>版本的 <code>std::vector</code> 或 <code>std::string</code>，但这几乎总是浪费时间和精力。一个明显的事实是 —— 你正在为一个新的地方引入 bug，其他开发者也不太可能重用你的代码，因为没有被广泛理解、支持和测试。</p>\n<h2><strong>10. 避免编写新的代码</strong></h2>\n<p>这是每个程序员都应遵循的最重要的教诲：最好的代码就是还没写的代码。你写的代码越多，你将遇到的问题就越多，查找和修复错误就越困难。</p>\n<p>在写一行代码之前先问一问自己，有没有一个工具、函数或者库已经实现了你所需要的功能？你真的需要自己实现这个功能，而不是调用一个已经存在的功能吗？</p>\n<h2><strong>写在最后的话</strong></h2>\n<p>我发现编程是一门与学习艺术或运动非常相似的技能，你通过刻意的练习和从别人的经验中学习会得到更好的结果。不断提升你产出的代码质量有助于你成为更优秀的程序员。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112300\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112300votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112300\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "树形结构数据存储方案（二）： 物化路径", "url": "http://blog.jobbole.com/112312/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/03/database-logo.png"], "praise_nums": "1", "comment_nums": 1, "fav_nums": 1, "tags": "IT技术,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.biaodianfu.com/path-enumeration.html\">标点符</a>   </div><p>前一篇文章介绍了比较简单的<a href=\"http://blog.jobbole.com/112309/\">邻接列表模式</a>，物化路径其实更加容易理解，其实就是在创建节点时，将节点的完整路径进行记录。以下图为例：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/91ae30cffcfe91c0ebd3e6091f970295.jpg\" alt=\"tree\" width=\"231\" height=\"259\"></p>\n<p>按照Path Enumeration 进行存储后的结果如下：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/d1a1da59ee04bd6479425f929f1da5d0.png\" alt=\"Path-Enumeration\" width=\"252\" height=\"221\"></p>\n<p>此种方案借助了unix文件目录的思想，主要时以空间换时间。</p>\n<p>查询某一节点下的所有子节点:（以Fruit为例）</p>\n<div id=\"crayon-59a6b897c213a519548061-1\"></div>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba614b5f64d281517341\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSET @path = (SELECT path FROM pathTree WHERE node_name = 'Fruit');\r\nSELECT * FROM pathTree WHERE path like CONCAT(@path,'/%');</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba614b5f64d281517341-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba614b5f64d281517341-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba614b5f64d281517341-1\"><span class=\"crayon-i\">SET</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">path </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">pathTree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Fruit'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba614b5f64d281517341-2\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">pathTree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-e\">path </span><span class=\"crayon-e\">like </span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'/%'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>如何查询直属子节点？需要采用MySQL的正则表达式查询：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba614b5f657706328905\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSET @path = (SELECT path FROM pathTree WHERE node_name = 'Fruit');\r\nSELECT * FROM pathTree WHERE path REGEXP CONCAT(@path,'/','[0-9]$');</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba614b5f657706328905-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba614b5f657706328905-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba614b5f657706328905-1\"><span class=\"crayon-i\">SET</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">path </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">pathTree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Fruit'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba614b5f657706328905-2\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">pathTree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-e\">path </span><span class=\"crayon-e\">REGEXP </span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'[0-9]$'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>查询任意节点的所有上级：（以Yellow为例）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba614b5f65b185507360\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSET @path = (SELECT path FROM pathTree WHERE node_name = 'Yellow');\r\nSELECT * FROM pathTree WHERE @path LIKE CONCAT(path, '%') AND path &lt;&gt; @path;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba614b5f65b185507360-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba614b5f65b185507360-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba614b5f65b185507360-1\"><span class=\"crayon-i\">SET</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">path </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">pathTree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Yellow'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba614b5f65b185507360-2\"><span class=\"crayon-e \">SELECT *</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">pathTree </span><span class=\"crayon-i\">WHERE</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-e\">path </span><span class=\"crayon-e\">LIKE </span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>插入新增数据：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba614b5f65f898466060\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSET @parent_path = ( SELECT path FROM pathTree WHERE node_name = 'Fruit');\r\nINSERT INTO pathtree (path,node_name) VALUES (CONCAT(@parent_path,'/',LAST_INSERT_ID()+1),'White')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba614b5f65f898466060-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba614b5f65f898466060-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba614b5f65f898466060-1\"><span class=\"crayon-i\">SET</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">parent_path</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">path </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">pathTree </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Fruit'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba614b5f65f898466060-2\"><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">pathtree</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">node_name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VALUES</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">CONCAT</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">parent_path</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">LAST_INSERT_ID</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'White'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>此方案的缺点是树的层级太深有可能会超过PATH字段的长度，所以其能支持的最大深度并非无限的。</p>\n<p>如果层级数量是确定的，可以再将所有的列都展开，如下图，比较试用于类似行政区划、生物分类法（界、门、纲、目、科、属、种）这些层级确定的内容。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/579dacd5167f484176573e5603f755c3.png\" alt=\"Multiple-lineage-columns\" width=\"609\" height=\"239\"></p>\n<p>参考文章：</p>\n<ul>\n<li>https://communities.bmc.com/docs/DOC-9902</li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112312\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112312votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112312\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "树形结构数据存储方案（三）：闭包表", "url": "http://blog.jobbole.com/112315/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/03/4bae6998d00f180d42c7da716e3d0bb2.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.biaodianfu.com/closure-table.html\">标点符</a>   </div><p>将Closure Table翻译成闭包表不知道是否合适，闭包表的思路和<a href=\"http://blog.jobbole.com/112312/\">物化路径</a>差不多，都是空间换时间，Closure Table，一种更为彻底的全路径结构，分别记录路径上相关结点的全展开形式。能明晰任意两结点关系而无须多余查询，级联删除和结点移动也很方便。但是它的存储开销会大一些，除了表示结点的Meta信息，还需要一张专用的关系表。</p>\n<p>以下图举例数据举例：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/72dbc716e80c6f5d62a90ddf0cf49901.jpg\" alt=\"tree\" width=\"231\" height=\"259\"></p>\n<p>创建主表：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba1a7ac1b1b089224687\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE nodeInfo (\r\n\tnode_id INT NOT NULL AUTO_INCREMENT,\r\n\tnode_name VARCHAR (255),\r\n\tPRIMARY KEY (`node_id`)\r\n) DEFAULT CHARSET = utf8;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b1b089224687-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b1b089224687-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b1b089224687-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b1b089224687-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b1b089224687-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b1b089224687-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">nodeInfo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b1b089224687-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">node_id </span><span class=\"crayon-t\">INT</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AUTO_INCREMENT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b1b089224687-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">node_name </span><span class=\"crayon-e\">VARCHAR</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b1b089224687-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">node_id</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b1b089224687-5\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">utf8</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>创建关系表：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba1a7ac1b25659786729\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE TABLE nodeRelationship (\r\n\tancestor INT NOT NULL,\r\n\tdescendant INT NOT NULL,\r\n\tdistance INT NOT NULL,\r\n\tPRIMARY KEY (ancestor, descendant)\r\n) DEFAULT CHARSET = utf8;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b25659786729-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b25659786729-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b25659786729-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b25659786729-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b25659786729-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b25659786729-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b25659786729-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-e\">TABLE </span><span class=\"crayon-e\">nodeRelationship</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b25659786729-2\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">ancestor </span><span class=\"crayon-t\">INT</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b25659786729-3\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">descendant </span><span class=\"crayon-t\">INT</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b25659786729-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">distance </span><span class=\"crayon-t\">INT</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b25659786729-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">KEY</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ancestor</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">descendant</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b25659786729-6\"><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">DEFAULT</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CHARSET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">utf8</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>其中</p>\n<ul>\n<li>Ancestor代表祖先节点</li>\n<li>Descendant代表后代节点</li>\n<li>Distance 祖先距离后代的距离</li>\n</ul>\n<p>添加数据（创建存储过程）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba1a7ac1b29488213844\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCREATE DEFINER = `root`@`localhost` PROCEDURE `AddNode`(`_parent_name` varchar(255),`_node_name` varchar(255))\r\nBEGIN\r\n\tDECLARE _ancestor INT;\r\n\tDECLARE _descendant INT;\r\n\tDECLARE _parent INT;\r\n\tIF NOT EXISTS(SELECT node_id From nodeinfo WHERE node_name = _node_name)\r\n\tTHEN\r\n\t\tINSERT INTO nodeinfo (node_name) VALUES(_node_name);\r\n\t\tSET _descendant = (SELECT node_id FROM nodeinfo WHERE node_name = _node_name);\r\n\t\tINSERT INTO noderelationship (ancestor,descendant,distance) VALUES(_descendant,_descendant,0);\r\n\t\tIF EXISTS (SELECT node_id FROM nodeinfo WHERE node_name = _parent_name)\r\n\t\tTHEN\r\n\t\t\tSET _parent = (SELECT node_id FROM nodeinfo WHERE node_name = _parent_name);\r\n\t\t\tINSERT INTO noderelationship (ancestor,descendant,distance) SELECT ancestor,_descendant,distance+1 from noderelationship where descendant = _parent;\r\n\t\tEND IF;\r\n\tEND IF;\r\nEND;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b29488213844-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b29488213844-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b29488213844-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b29488213844-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b29488213844-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b29488213844-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b29488213844-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b29488213844-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b29488213844-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b29488213844-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b29488213844-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b29488213844-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b29488213844-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b29488213844-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b29488213844-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b29488213844-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b29488213844-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b29488213844-1\"><span class=\"crayon-e\">CREATE </span><span class=\"crayon-v\">DEFINER</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">root</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">localhost</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">PROCEDURE</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">AddNode</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">_parent_name</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">_node_name</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">varchar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">255</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b29488213844-2\"><span class=\"crayon-e\">BEGIN</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b29488213844-3\"><span class=\"crayon-e\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_ancestor </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b29488213844-4\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_descendant </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b29488213844-5\"><span class=\"crayon-h\">\t</span><span class=\"crayon-r\">DECLARE</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_parent </span><span class=\"crayon-t\">INT</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b29488213844-6\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">NOT</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EXISTS</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">node_id </span><span class=\"crayon-e\">From </span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_node_name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b29488213844-7\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b29488213844-8\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">nodeinfo</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node_name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">_node_name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b29488213844-9\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">_descendant</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">node_id </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_node_name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b29488213844-10\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">noderelationship</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ancestor</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">descendant</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">distance</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">VALUES</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">_descendant</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">_descendant</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b29488213844-11\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">IF</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">EXISTS</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">node_id </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_parent_name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b29488213844-12\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">THEN</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b29488213844-13\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">_parent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-e\">node_id </span><span class=\"crayon-e\">FROM </span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_parent_name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b29488213844-14\"><span class=\"crayon-h\">\t\t\t</span><span class=\"crayon-e\">INSERT </span><span class=\"crayon-e\">INTO </span><span class=\"crayon-e\">noderelationship</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ancestor</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">descendant</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">distance</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">SELECT </span><span class=\"crayon-v\">ancestor</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">_descendant</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">distance</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-e\">noderelationship </span><span class=\"crayon-e\">where </span><span class=\"crayon-v\">descendant</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">_parent</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b29488213844-15\"><span class=\"crayon-h\">\t\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b29488213844-16\"><span class=\"crayon-h\">\t</span><span class=\"crayon-st\">END</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">IF</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b29488213844-17\"><span class=\"crayon-st\">END</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0042 seconds] -->\r\n<p>完成后2张表的数据大致是这样的：（注意：每个节点都有一条到其本身的记录。）</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/97f89f232ea959cd8c01536308049baf.png\" alt=\"Closure-Table-1\" width=\"178\" height=\"224\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/5842ea4fa2e0b6f0bdc31ed02131df05.png\" alt=\"Closure-Table-2\" width=\"261\" height=\"451\"></p>\n<p>查询Fruit下所有的子节点：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba1a7ac1b2e384314117\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT\r\n\tn3.node_name\r\nFROM\r\n\tnodeinfo n1\r\nINNER JOIN noderelationship n2 ON n1.node_id = n2.ancestor\r\nINNER JOIN nodeinfo n3 ON n2.descendant = n3.node_id\r\nWHERE\r\n\tn1.node_name = 'Fruit'\r\nAND n2.distance != 0</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b2e384314117-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b2e384314117-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b2e384314117-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b2e384314117-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b2e384314117-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b2e384314117-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b2e384314117-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b2e384314117-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b2e384314117-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b2e384314117-1\"><span class=\"crayon-e\">SELECT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b2e384314117-2\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">n3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">node_name</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b2e384314117-3\"><span class=\"crayon-e\">FROM</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b2e384314117-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">n1</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b2e384314117-5\"><span class=\"crayon-e\">INNER </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">noderelationship </span><span class=\"crayon-e\">n2 </span><span class=\"crayon-e\">ON </span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">node_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ancestor</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b2e384314117-6\"><span class=\"crayon-e\">INNER </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">n3 </span><span class=\"crayon-e\">ON </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">descendant</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">node_id</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b2e384314117-7\"><span class=\"crayon-e\">WHERE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b2e384314117-8\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Fruit'</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b2e384314117-9\"><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">distance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>查询Fruit下直属子节点：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba1a7ac1b31808485891\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT\r\n\tn3.node_name\r\nFROM\r\n\tnodeinfo n1\r\nINNER JOIN noderelationship n2 ON n1.node_id = n2.ancestor\r\nINNER JOIN nodeinfo n3 ON n2.descendant = n3.node_id\r\nWHERE\r\n\tn1.node_name = 'Fruit'\r\nAND n2.distance = 1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b31808485891-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b31808485891-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b31808485891-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b31808485891-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b31808485891-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b31808485891-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b31808485891-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b31808485891-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b31808485891-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b31808485891-1\"><span class=\"crayon-e\">SELECT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b31808485891-2\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">n3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">node_name</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b31808485891-3\"><span class=\"crayon-e\">FROM</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b31808485891-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">n1</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b31808485891-5\"><span class=\"crayon-e\">INNER </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">noderelationship </span><span class=\"crayon-e\">n2 </span><span class=\"crayon-e\">ON </span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">node_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ancestor</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b31808485891-6\"><span class=\"crayon-e\">INNER </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">n3 </span><span class=\"crayon-e\">ON </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">descendant</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">node_id</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b31808485891-7\"><span class=\"crayon-e\">WHERE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b31808485891-8\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Fruit'</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b31808485891-9\"><span class=\"crayon-st\">AND</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">distance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>查询Fruit所处的层级：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59ba1a7ac1b34855151204\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSELECT\r\n\tn2.*, n3.node_name\r\nFROM\r\n\tnodeinfo n1\r\nINNER JOIN noderelationship n2 ON n1.node_id = n2.descendant\r\nINNER JOIN nodeinfo n3 ON n2.ancestor = n3.node_id\r\nWHERE\r\n\tn1.node_name = 'Fruit'\r\nORDER BY\r\n\tn2.distance DESC</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b34855151204-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b34855151204-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b34855151204-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b34855151204-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b34855151204-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b34855151204-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b34855151204-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b34855151204-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59ba1a7ac1b34855151204-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59ba1a7ac1b34855151204-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b34855151204-1\"><span class=\"crayon-e\">SELECT</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b34855151204-2\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">node_name</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b34855151204-3\"><span class=\"crayon-e\">FROM</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b34855151204-4\"><span class=\"crayon-e\">\t</span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">n1</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b34855151204-5\"><span class=\"crayon-e\">INNER </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">noderelationship </span><span class=\"crayon-e\">n2 </span><span class=\"crayon-e\">ON </span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">node_id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">descendant</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b34855151204-6\"><span class=\"crayon-e\">INNER </span><span class=\"crayon-e\">JOIN </span><span class=\"crayon-e\">nodeinfo </span><span class=\"crayon-e\">n3 </span><span class=\"crayon-e\">ON </span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ancestor</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">node_id</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b34855151204-7\"><span class=\"crayon-e\">WHERE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b34855151204-8\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">node_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Fruit'</span></div><div class=\"crayon-line\" id=\"crayon-59ba1a7ac1b34855151204-9\"><span class=\"crayon-e\">ORDER </span><span class=\"crayon-e\">BY</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59ba1a7ac1b34855151204-10\"><span class=\"crayon-e\">\t</span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">distance </span><span class=\"crayon-v\">DESC</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>另外要删除节点也非常的简单，这里就不再做过多的阐述。</p>\n<p>参考链接：</p>\n<ul>\n<li>https://coderwall.com/p/lixing/closure-tables-for-browsing-trees-in-sql</li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112315\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112315votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112315\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "从分布式计算到分布式训练", "url": "http://blog.jobbole.com/112222/", "front_image_url": ["http://insights.thoughtworkers.org/wp-content/uploads/2017/08/CPU-2-1024x571.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 4, "tags": "IT技术,spark,分布式计算,模型训练", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>对计算机来讲，所谓的计算，不过是将存储在各个地方的数据通过数据总线进行传输，然后经过算术逻辑单元执行一系列预设好的规则，最终再将输出写入到某个位置。</p>\n<p>在计算能力有限、存储成本偏高的情况下，就需要利用好计算机的资源，让它的计算能力发挥出最大的价值，所以在编程初期用指令直接操作硬件，例如汇编语言中常见的操纵寄存器，本质上都是为了减少数据传输的时间，充分利用CPU的计算能力，避免因为数据的长时间传输导致CPU进行过长的等待。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/CPU-2.jpg\"><img class=\"aligncenter size-large wp-image-5162\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/CPU-2-1024x571.jpg\" alt=\"\" width=\"700\" height=\"390\"></a></p>\n<h3>分布式计算的到来</h3>\n<p>随着科技的发展，“数据存储”领域有了质和量的双向发展，除了稳定性、安全性的提升外，容量也呈指数级增长。因此可以在单机上直接构建整套服务，类似LAMP类似的这种一键搭建服务器的套装软件有了更多的应用场景。</p>\n<p>然而随着业务的发展，另一个问题逐渐显现出来：虽然磁盘容量增加了，但是机器的访问速度并没有变快。</p>\n<p>什么意思呢？举个例子：虽然20年前一个盘最大的存储空间只有100MB，但是读取完整磁盘只需要1分钟。如今虽然磁盘容量可以轻易的变成1TB、1PB，然而读取完整个盘的数据需要数小时之上。</p>\n<p>这背后的问题在于技术发展的限制：磁头在磁道上移动速度的增速远远低于磁盘容量的增长。用通俗的话来说就是，仓库的面积已经从10平米扩展到100平米甚至到1000平米了，但是一个搬运工一天搬运货物的速度并没有显著的提升，所以虽然仓库的容量越来越大，但是搬完整个仓库的货物需要的时间却越来越多。</p>\n<p>不过好在我们还有另一个好消息：带宽逐渐变得廉价。相比20年前，GB带宽的光纤已经非常普遍，网络能够实现一秒传输，数据量已经远远超过了整块盘的容量。于是一个大胆的想法被提出来了：既然读取完一个盘的数据需要几个小时，那把数据分成N份，分别放在不同的机器上并行读取，是不是一秒钟就读取完了？</p>\n<p>采用网络并行的方式进行读取，将瓶颈从磁头移动转移到了网络，而要增加一条高速带宽，已经不需要付出多么大的代价。</p>\n<p>还是仓库的例子，既然一个搬运工速度这么慢，搬完1000平米仓库需要1000分钟，那么我用1000个搬运工搬1000平米是不是1分钟就完了？这个时候影响搬运工的，仅仅是大门的大小，需要同时容纳1000个搬运工进出而已，但是开个大门似乎成本并不高，大不了把四面的墙都拆了做成门嘛。</p>\n<h3>MR一代</h3>\n<p>一个优秀的思想被提出来后，总会有许多追随者尝试将其落地，Google率先丢出了三大论文：BigTable、GFS、MapReduce，从理论上讲述了在分布式下如何做到数据的存储、计算，甚至提出了可以在分布式下做结构化的检索。</p>\n<p>三大论文开启了分布式计算的时代，然而对于工程界来说，仅有三篇论文并不足以解决生产上的问题，Google并没有将内部实现的内容进行开源，于是另一帮团队：Yahoo，自行根据论文进行实现，而后将其贡献给Apache，逐渐发展成时至今日依旧如日中天的：HDFS、Mapreduce、HBase。</p>\n<p>其中尤为重要的分布式计算模型：MapReuce，我们常称为第一代MR，也就是：MRV1。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MRV1.png\"><img class=\"aligncenter size-large wp-image-5150\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MRV1-1024x485.png\" alt=\"\" width=\"700\" height=\"332\"></a></p>\n<p>上图是MRV1的主要架构图，我们可以看到，在MRV1里面，主要分为两个部分：运行环境和编程模型，所谓的运行环境，指的是用来进行分布式任务调度、资源分配等任务运行过程中涉及到的信息，而编程模型，则指的是提供给开发人员进行开发的接口。</p>\n<p>对于MRV1来说，它的运行结构图如下所示：</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MapReuce.png\"><img class=\"aligncenter size-large wp-image-5151\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MapReuce-1024x514.png\" alt=\"\" width=\"700\" height=\"351\"></a></p>\n<p>可以看到，在MRV1里面，当我们的一个任务被提交上去之后，由统一的调度器进行任务的监控、分发，以及资源的申请、回收控制等操作。</p>\n<p>MRV1有着明显的两个阶段：Map和Reduce，Map阶段主要负责处理输入，每一个Map任务对应一个分片的数据，而后将数据送入到一个特有的数据结构：环形缓冲区。所谓的环形缓冲区，是用来记录数据和索引的一个区域。当环形缓冲区快要溢出的时候，数据将会被落地到磁盘。在数据输入完成后，将会调用用户自己实现的map函数，而后通过与jobtracker的通信，保持着联系，然后分别进入到reduce的阶段，renduce阶段会汇集所有的数据，这个动作在广义上会被很多人称为：shuffle。实际上shuffle并不是reduce才发生的，对于MR来说，从数据从HDFS上加载开始，shuffle就已经开始了，一直伴随到reduce结束。</p>\n<p>MRV1类似于工厂生产辣椒酱，很多工人负责把流水线送到自己身边的辣椒切碎，这个就是Map操作，所有工人切碎的辣椒汇集在一起做成辣椒酱，这个就是Reduce操作。也许某个工人把辣椒切成块的速度赶不上流水线送给他辣椒的速度，那么他就需要把辣椒从流水线拿下来放在他的自己的某个地方存着慢慢切，这个动作就相当于shuffle操作。因为最后汇总会等到所有的人都把辣椒切成块之后再处理，所以如果有一个人没有完成，就需要等待，这个时候就发生了我们常说的，数据倾斜。</p>\n<h3>MR二代</h3>\n<p>MRV1是统一管理资源的，类似于一家公司的所有决策都需要通过CEO来发出指令，所有人都听命于CEO，每个人做什么事全都是CEO一一安排，所以如果CEO忙不过来了，或者有事联系不上了，整个组织就成了无头苍蝇、完蛋了。</p>\n<p>因此对于MRV1来说，虽然它实现了一个并行计算模型，但是其暴露出来的问题也显而易见：</p>\n<ul>\n<li>固化的两阶段模式，限制了迭代任务的进行</li>\n<li>多次数据落地，整个运行时间大大延长</li>\n<li>所有任务由统一的jobtracker调度，存在单点故障。</li>\n<li>对资源的控制不到位，没有明确的任务优先级</li>\n<li>资源利用不合理，例如在V1里面，资源分为map solt和reduce solt，导致运行map的时候，reduce的solt全部闲置</li>\n<li>安全控制</li>\n</ul>\n<p>在这些问题逐渐暴露出来后，有很多补救的措施逐渐出现，例如Tez就是一个非常好的例子，它通过接管MRV1的输入和输出，减少其落地到磁盘的动作，目前Tez已经是Hive的内置计算模型。</p>\n<p>但是这些补救框架，并不能从根本上解决MRV1的问题，于是第二代MR被研究出来，也就是MRV2，那么对于MRV2来说，它是怎么做的呢？既然一个公司全靠CEO去安排任务和进行管理有风险，那么我们就把公司的所有人分成N个小团队，每个团队有自己的Lead负责进行工作安排，CEO干什么呢？CEO只负责把要做的事情丢给小团队的Lead，小团队的Lead自己去安排手下的人干活。</p>\n<p>大多数时候我们对MRV2这个名字并不熟悉，但是我们一定熟悉一个名字：Yarn。Yarn就是MRV2下最核心的功能。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MRV2.png\"><img class=\"aligncenter size-large wp-image-5152\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MRV2-1024x492.png\" alt=\"\" width=\"700\" height=\"336\"></a></p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/Yarn.png\"><img class=\"aligncenter size-large wp-image-5164\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/Yarn-1024x399.png\" alt=\"\" width=\"700\" height=\"273\"></a></p>\n<p>通过上面的图我们发现，对于MRV2来说，它的资源的申请、控制、回收，不再由统一的jobtracker（前面举例中的CEO）来调度了。在MRV2里面，它产生了几个新的概念：</p>\n<ul>\n<li>Resource Manager：负责统一管理所有资源</li>\n<li>Application Master：负责一个任务的监控、资源分配、回收等工作（前面例子中的小团队Lead）</li>\n<li>Node Manager：各个节点的资源监控</li>\n</ul>\n<p>这里面并没有提到Yarn，因为Yarn并不是一个技术，而是一个概念，代表V2里面整个任务调度和资源管理系统。我们合并起来统一称为：Yarn。</p>\n<p>我们可以对比一下MRV1和MRV2的机构图：</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MRV1-MRV2.png\"><img class=\"aligncenter size-large wp-image-5154\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/MRV1-MRV2-1024x455.png\" alt=\"\" width=\"700\" height=\"311\"></a></p>\n<p>在MRV2里面，依旧分为两个部分：运行环境和编程模型。然而不一样的地方在于，每一个应用程序需要实现自己的Application Master，也就是资源管理系统。Resource Manager进行一次统一的资源分配，由Application Master自己去决定怎么把资源分给每一个Task，在实际开发中，我们发现自己似乎并没有写过资源分配相关的代码，MR的代码依旧可以运行，那是因为MRV2里面，默认提供了MR的Application Master，在MRV2里面，API也发生了变化，而为了兼容MRV1，分别存在两套API。</p>\n<p>同时由于MRV2的超高思想，将整个资源调度独立出来，这带来一个好处，那就是Yarn不单单能调度MR计算引擎，还能调度其他计算引擎，例如Spark。虽然目前有Mesos，但是大多数情况下我们还是会选择采用Yarn去作为资源调度器。</p>\n<h3>Spark分布式计算模型</h3>\n<p>看起来似乎MRV2向前迈进了一大步，解决了不少问题，然而对于MRV2来说，依然存在它无法跨越的问题。首先为了兼容MR计算模型，它依然保留着两阶段计算的模型，因为对迭代计算基本乏力。MR模型就像一个工厂流水线要生产辣椒酱，要先把辣椒切碎，然后再汇集起来做成辣椒酱，固定的2步操作，如果想在切碎之前再做点啥，或者做成辣椒酱之后再贴个标签啥的，MR模型就支撑不了，因此“需要任意灵活的进行迭代”这一需求就出来了，这个就是Spark的特点。</p>\n<p>同时，MR的核心思想是：运行在廉价服务器上，挪数据，所以对于实时计算，MVR2基本抓瞎。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/Spark.png\"><img class=\"aligncenter size-large wp-image-5153\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/Spark-1024x475.png\" alt=\"\" width=\"700\" height=\"325\"></a></p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/RDD.png\"><img class=\"aligncenter size-large wp-image-5155\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/RDD-1024x493.png\" alt=\"\" width=\"700\" height=\"337\"></a></p>\n<p>在这些问题之上，Spark诞生。Spark的思想比较简单：挪计算不挪数据。既然要挪计算，那怎么去描述这个计算呢？于是通过RDD封装一个针对数据对应关系记录，在这个封装之上来记录计算。所以在Spark里面，操作分为两类：Action和Transformation。</p>\n<p>为什么会有这两类操作？我们可以想一下，如果数据被分散在100个阶段，我们需要做的是查询某个字段大于0的数据，那么这个计算根本不用把数据汇集在一起，统一过滤，分别在不同节点进行过滤就行了。</p>\n<p>而如果我们的操作是统计共有多少条数据，则需要将数据汇总，所以对于Spark来说，Action才真正会触发“挪数据”这个动作，Transformation只是做了一个标记转换。我们对Spark的各种调优，大部分时间也是在尽量减少Action的操作。由于在Spark里面，RDD是只读的，所以每一次操作，都会产生一个新的RDD，因此可以形成一系列的RDD依赖，我们也叫RDD链。</p>\n<h3>模型训练</h3>\n<p>模型训练更多的偏向于AI领域，在AI领域有两个明显的分支：概率论和神经网络。在计算能力欠缺的时候，概率论模型是最为普遍的做法，但是近年来发展起来的计算能力，让深度神经网络模型逐渐的展现出风采，很多框架都表明自己就是一个深度学习框架。</p>\n<p>模型训练本质上是对数据特征的提取，训练本身和大数据没有必然的关系，但是却相辅相成，数据量越大，提取的特征越多，模型训练出来的效果自然越好，然而数据量越大，对计算的要求就越高，也正因为如此，对模型的探索始终是在小数据、抽样领域进行尝试。</p>\n<p>那么什么是特征呢？举个例子，我们如果想要预测一个人能活多少岁，最简单的办法就是返回已知去世的人的平均年龄，无论是谁都返回这个值，要做这样的系统当然没有问题。但是仔细观察就会发现，男性能活多少岁和女性似乎不一样，那么我们可以简单的修改一下，在预测之前先判断一下性别，如果是男的就返回男的平均，女的则返回女性的平均。在这里我们已经无形的用了性别这个特征，是因为我们认为性别对结果是有影响的，而训练就需要找出无数个这样的特征。</p>\n<p>然而目前对于大数据的处理能力，似乎已经发展到了一个非常好的阶段，至少在分布式计算上，理论上是可以通过水平扩展无限的增加计算能力。</p>\n<p>可是模型的训练和应用在工程中的发展一直不是那么顺利，大约总结起来有如下几个原因：</p>\n<ul>\n<li>门槛较高，首先需要有比较专业的背景知识，同时还需要具备较强的编程能力，方能将其应用于工程之上。</li>\n<li>对于模型训练来说，没有大数据量的支持，生产上的效果始终差强人意，而数据量增大，如何去处理数据又成了另外一个领域的问题，能够同时处理好两方面的问题，人员较少。</li>\n<li>在实际工程中，我们获取到的数据集，往往不是训练模型直接能用的，要达到能够直接用于训练模型，还需要非常多的额外处理，这些代价甚至会高于模型训练本身，因此让模型训练这件事的成本变高。</li>\n<li>部分使用者，往往并没有达到模型训练的程度，例如连基本的数据平台都不存在，茫然的使用模型，导致效果不如预期，而将结果归结于模型本身的好坏之上。</li>\n</ul>\n<p>虽然模型训练的发展过程中有诸多问题，但是依旧能够看到其在向前发展，目前来说，基于GPU的训练，已经成了所有做模型训练的人的标配，Google甚至研发了自己的GPU：TPU。而很多芯片研发公司，也在致力于研究开发出专门用于模型训练的芯片。</p>\n<p>对于模型训练来说，目前一般会有两种做法：</p>\n<ul>\n<li>单机模型训练</li>\n<li>分布式模型训练</li>\n</ul>\n<h3>单机模型训练</h3>\n<p>所谓的单机训练，其实就是在一台机器上训练了，对于单机模型训练来讲，瓶颈主要在于提升单机的性能配置，例如不停的提高单个GPU的计算能力。而对于数据来说，大部分都是利用本地数据，虽然我们可以读取分布式文件系统的数据，但是实际上还是经过了shuffle操作，将数据读取到本地，而模型的训练，都是全程单机训练，我们可以通过各种优化算法，例如奇异值分解等手段，来降低计算成本。</p>\n<h3>分布式模型训练</h3>\n<p>对于单机训练来说，单个GPU，始终会陷入瓶颈，所以对于模型训练，也有人开始尝试，是否可以分布式训练？</p>\n<p>模型的分布式，相对于其他分布式计算会困难许多，首先模型依赖于数据，而模型本身的计算又要依赖于GPU，那么要如何将数据和计算能力结合？</p>\n<p>对于目前来讲，模型的分布式一般会有以下几种做法：</p>\n<ul>\n<li>数据分布式训练</li>\n<li>模型分布式训练</li>\n<li>混合训练</li>\n</ul>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/model-parallelism.png\"><img class=\"aligncenter size-large wp-image-5156\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/model-parallelism-1024x480.png\" alt=\"\" width=\"700\" height=\"328\"></a></p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/date-parallelism.png\"><img class=\"aligncenter size-large wp-image-5157\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/date-parallelism-1024x258.png\" alt=\"\" width=\"700\" height=\"176\"></a></p>\n<p>上面的图片比较形象的描述了几种不同的训练方式，首先对于数据分布式来说，每一个节点都有一个完整模型的副本，而对于模型分布式来说，模型的计算会被分散到不同的节点上，例如Tensorflow就通过图形化的表达方法，将计算描述为一个图，然后再判断图中的哪些计算可以并行运行，分别拆分到不同的节点上进行训练，从而达到分布式训练的效果。在混合训练中，模型训练会被分散，同时数据也会分散，无论是哪种分布式训练，最终都会涉及一个操作：模型的归一。在目前来说，有不同的做法，可以将模型最终归一，例如集成算法就是逻辑上实现了模型的归一。</p>\n<h3>结尾</h3>\n<p>对于大数据和人工智能来讲，现在仅仅是萌芽时期，后面还有大量的工作要做，而模型的训练无论是单机还是分布式，都还没有达到真正稳定的生产批量效果，这些挑战，不仅仅来自于技术的实现，同时也来自于业务的配合，如何利用现有的技术能力，将其推广到业务上解决问题，才是重点需要关注的地方。</p>\n<p>文／ThoughtWorks白发川</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112222\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112222votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112222\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 72</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "Nginx 缓存引发的跨域惨案", "url": "http://blog.jobbole.com/112224/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2013/07/Nginx-Logo.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 4, "tags": "IT技术,Nginx,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://tech.lede.com/2017/07/21/rd/server/crossdomain/\">网易乐得 - 张捷</a>   </div><h3 id=\"1-前言\">1. 前言</h3>\n<p>贵金属wap版直播间上线后，偶尔有用户反馈，在进入wap直播间的时候，出现空白页面，但是重新刷新又可以正常显示了。我们曾一度认为是网络请求异常或兼容问题，直到开发PC版直播间，在进行调试中，同样遇到了“白屏”问题，才引起了足够重视，并进行了问题跟踪与分析。现在跟大家分享一下，这种偶然现象出现的原因。</p>\n<p>我们的直播间落地页在fa.163.com 系统，而直播间内容，是通过 向直播间系统 qz.fa.163.com 发起Ajax请求获取的。在出现“白屏”的时候，可以通过浏览器的调试窗口，可以看到出现下面的报错</p>\n<p style=\"text-align: center\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/a12fbf3c168315a7d1b5b5a2ca4b6129.png\"><img class=\"alignnone size-full wp-image-112226\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/a12fbf3c168315a7d1b5b5a2ca4b6129.png\" alt=\"p1\"></a></p>\n<h3 id=\"2-问题分析\">2. 问题分析</h3>\n<p>从上述错误提示文案中可以看到，问题首先和 <strong>跨域</strong> 有关。</p>\n<blockquote><p><strong>何为跨域</strong></p>\n<p>从字面上理解为“跨域名”，<br>\n浏览器不能执行其他网站的脚本，然而，跨域不仅仅局限于域名这一项。只要协议、域名、端口有任何一个不同，都被当作是不同的域。 这是由于&gt;同源策略的限制，从一个域上加载的脚本不允许访问另外一个域的文档属性。虽然在浏览器中，&lt;script&gt;、&lt;img&gt;、&lt;iframe&gt;、&lt;link&gt;等标签都&gt;可&gt;以加载跨域资源，而不受同源限制，但浏览器会限制脚本中发起的跨域请求。比如，使用 XMLHttpRequest 对象和Fetch发起 HTTP 请求就必须遵守同源策略。</p>\n<p><strong>同源策略/SOP（Same origin policy）</strong>是一种约定，它是浏览器最核心也最基本的安全功能，如果缺少了同源策略，浏览器很容易受到XSS、CSFR等攻击。SOP要求两个通讯地址的协议、域名、端口号必须相同，否则两个地址的通讯将被浏览器视为不安全的，并被block下来。</p>\n<p style=\"text-align: center\">举个例子：从贵金属主站 <a href=\"http://fa.163.com\" target=\"_blank\" rel=\"external\">http://fa.163.com</a> 发起请求访问以下url：<br>\n<a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/b26b0c19bf035ea217c4df11feb23328.png\"><img class=\"alignnone size-full wp-image-112227\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/b26b0c19bf035ea217c4df11feb23328.png\" alt=\"p6\"></a></p>\n<p><strong>解决跨域</strong></p>\n<p>在实际应用中有多种方式来解决跨域问题，相信在实践中都会用到其中的某些方案：</p>\n<p>1.JSONP （无状态连接，不能获悉连接状态和错误事件，而且只能走GET的形式）</p>\n<p>2.iframe形式</p>\n<p>3.服务器代理</p>\n<p>页面直接向同域的服务端发请求，服务端进行跨域处理或爬虫后，再把数据返回给客户端页。</p>\n<p>4.CORS</p>\n<p>CORS(Cross-Origin Resource Sharing)跨域资源共享，定义了必须在访问跨域资源时，浏览器与服务器应该如何沟通。CORS背后的基本思想就&gt;是使用自定义的HTTP头部让浏览器与服务器进行沟通，从而决定请求或响应是应该成功还是失败。目前，所有浏览器都支持该功能，IE浏览器不能低&gt;于IE10。整个CORS通信过程，都是浏览器自动完成，不需要用户参与。对于开发者来说，CORS通信与同源的AJAX通信没有差别，代码完全一样。浏&gt;览器一旦发现AJAX请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求，但用户不会有感觉。</p>\n<p>CORS方式实现：</p>\n<p>浏览器在发出CORS请求时会在头信息之中增加一个Origin字段；</p>\n<p>后端返回代码中增加三个字段</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d1487df17535826752\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nheader(“Access-Control-Allow-Origin”:“”);           // 必选 允许所有来源访问\r\nheader(“Access-Control-Allow-Credentials”:“true”);  //可选 是否允许发送cookie\r\nheader(“Access-Control-Allow-Method”:“POST,GET”);   //可选 允许访问的方式</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d1487df17535826752-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1487df17535826752-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1487df17535826752-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d1487df17535826752-1\"><span class=\"crayon-e\">header</span><span class=\"crayon-sy\">(</span>“<span class=\"crayon-v\">Access</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Control</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Allow</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Origin</span>”<span class=\"crayon-o\">:</span>“”<span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">           </span><span class=\"crayon-c\">// 必选 允许所有来源访问</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1487df17535826752-2\"><span class=\"crayon-e\">header</span><span class=\"crayon-sy\">(</span>“<span class=\"crayon-v\">Access</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Control</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Allow</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Credentials</span>”<span class=\"crayon-o\">:</span>“<span class=\"crayon-t\">true</span>”<span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\">//可选 是否允许发送cookie</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1487df17535826752-3\"><span class=\"crayon-e\">header</span><span class=\"crayon-sy\">(</span>“<span class=\"crayon-v\">Access</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Control</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">Allow</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Method</span>”<span class=\"crayon-o\">:</span>“<span class=\"crayon-v\">POST</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">GET</span>”<span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">   </span><span class=\"crayon-c\">//可选 允许访问的方式</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>nginx是一个高性能的web服务器，常用作反向代理服务器。nginx作为反向代理服务器，就是把http请求转发到另一个或者一些服务器上。通过把本地一个url前缀映射到要跨域访问的web服务器上，就可以。</p></blockquote>\n<p>为了解决跨域问题，我们选择方案d ， 在直播间的过滤器中，统一添加了如下代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d1487df20157190748\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n   &lt;a href=\"http://www.jobbole.com/members/wx610506454\"&gt;@Override&lt;/a&gt;\r\n   public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\r\n    // 加入响应头\r\n    String origin = request.getHeader(\"Origin\");\r\n    if(\"http://fa.163.com\".equals(origin) || \"https://fa.163.com\".equals(origin) ) {\r\n        response.addHeader(\"Access-Control-Allow-Origin\", origin);\r\n        response.addHeader(\"Access-Control-Allow-Credentials\", \"true\");\r\n    }\r\n    return true;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d1487df20157190748-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1487df20157190748-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1487df20157190748-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1487df20157190748-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1487df20157190748-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1487df20157190748-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1487df20157190748-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1487df20157190748-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1487df20157190748-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1487df20157190748-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d1487df20157190748-1\"><span class=\"crayon-h\">   </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"http://www.jobbole.com/members/wx610506454\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">Override</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1487df20157190748-2\"><span class=\"crayon-h\">   </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">boolean</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">preHandle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">HttpServletRequest </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HttpServletResponse </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Object</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handler</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">throws</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1487df20157190748-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">// 加入响应头</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1487df20157190748-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">String</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">origin</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getHeader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Origin\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1487df20157190748-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"http://fa.163.com\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">equals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">origin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"https://fa.163.com\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">equals</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">origin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1487df20157190748-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addHeader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Access-Control-Allow-Origin\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">origin</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1487df20157190748-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">addHeader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Access-Control-Allow-Credentials\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"true\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1487df20157190748-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1487df20157190748-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1487df20157190748-10\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>从错误提示文案中，我们还可以看到错误提示的关键点 “<a href=\"http://fa.163.com%E2%80%9D\" target=\"_blank\" rel=\"external\">http://fa.163.com”</a> that is not equal to the supplied origin. Origin ‘<a href=\"https://fa.163.com\" target=\"_blank\" rel=\"external\">https://fa.163.com</a>‘ is therefore not allowed access.<br>\n目前我们的系统同时支持http访问和https访问，但是为什么使用 http访问 ，返回的header中却是 https 协议呢？<br>\n通过多次模拟，确认出现问题的请求中，Request URL使用的协议和 response返回的headers中的 Access-Control-Allow-Origin 中的 协议确实不一致，且还有一个特性，X-Cached 为 HIT，如下图：</p>\n<p style=\"text-align: center\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/c7581ea997ecc2922a2e162ed57aef52.jpg\"><img class=\"alignnone size-full wp-image-112228\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/c7581ea997ecc2922a2e162ed57aef52.jpg\" alt=\"p2\"></a></p>\n<p>命中了缓存的请求，出现了协议不一致？</p>\n<p>突然想到，这个接口，我们配置了nginx 缓存，那必然和nginx缓存有关了。</p>\n<blockquote><p><strong>Nginx 缓存</strong></p>\n<p>Nginx (engine x) 是一个高性能的HTTP和反向代理服务器。<br>\n首先从源服务器（内部网络上的web服务器）上获取内容，然后把内容返回给用户，同时，也会把内容保存到代理服务器上一份，这样日后再接收同样的信息请求时，他会把本地缓存里的内容直接发给用户，以此减少后端web服务器的压力，提高响应速度。这其实就是缓存服务器所实现的功能。如下图所示。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/d93182a8d7f7fe0c1129b5c36ab6aad8.png\"><img class=\"alignnone size-full wp-image-112229\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/d93182a8d7f7fe0c1129b5c36ab6aad8.png\" alt=\"p3\"></a></p></blockquote>\n<p>进入直播间后，首先需要查询直播内容是否有更新，而这个接口客户端会以5s间隔轮询，为了减少tomcat的压力，我们配置了nginx缓存。配置如下</p>\n<p style=\"text-align: center\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/ecf29cf6d154c4ad3cfe0f5d4acfa2a4.png\"><img class=\"alignnone size-full wp-image-112231\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/ecf29cf6d154c4ad3cfe0f5d4acfa2a4.png\" alt=\"p4\"></a></p>\n<p>其中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d1487df26398538293\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nproxy_cache_methods： 用来设置HTTP哪些方法会被缓存，直播间接口配置了GET、HEAD、POST；\r\nproxy_cache_valid:    用来设置对不同HTTP状态码的不同缓存时间。直播间接口配置了对于 返回值为200的状态码，缓存5秒；\r\nproxy_cache_min_uses: 用来设置多少次访问后，应答值会被缓存，配置为3次；\r\nproxy_cache_key:      设置Web缓存的key\r\nproxy_cache:          用来设置哪个缓存区将被使用，并定义缓存区的名称\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d1487df26398538293-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1487df26398538293-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1487df26398538293-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1487df26398538293-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1487df26398538293-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1487df26398538293-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d1487df26398538293-1\"><span class=\"crayon-v\">proxy_cache</span><span class=\"crayon-sy\">_</span>methods：<span class=\"crayon-h\"> </span>用来设置<span class=\"crayon-i\">HTTP</span>哪些方法会被缓存，直播间接口配置了<span class=\"crayon-i\">GET</span>、<span class=\"crayon-i\">HEAD</span>、<span class=\"crayon-i\">POST</span>；</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1487df26398538293-2\"><span class=\"crayon-v\">proxy_cache_valid</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">    </span>用来设置对不同<span class=\"crayon-i\">HTTP</span>状态码的不同缓存时间。直播间接口配置了对于<span class=\"crayon-h\"> </span>返回值为<span class=\"crayon-cn\">200</span>的状态码，缓存<span class=\"crayon-cn\">5</span>秒；</div><div class=\"crayon-line\" id=\"crayon-59b9d1487df26398538293-3\"><span class=\"crayon-v\">proxy_cache_min_uses</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>用来设置多少次访问后，应答值会被缓存，配置为<span class=\"crayon-cn\">3</span>次；</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1487df26398538293-4\"><span class=\"crayon-v\">proxy_cache_key</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">      </span>设置<span class=\"crayon-i\">Web</span>缓存的<span class=\"crayon-e\">key</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1487df26398538293-5\"><span class=\"crayon-v\">proxy_cache</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">          </span>用来设置哪个缓存区将被使用，并定义缓存区的名称</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1487df26398538293-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>通过上述配置，我们可以看到 proxy_cache_key 配置中，只配置了host + uri + 参数，但没有配置协议，所以无论用http访问，还是https访问，只要被缓存后，返回的内容都是一样的，而不会区分http或https。从而引起了跨域问题。<br>\n至此，问题分析完毕。</p>\n<h3 id=\"3-问题解决\">3. 问题解决</h3>\n<p>跟运维同学沟通后，通过修改nginx配置，将协议类型scheme加入到缓存查找的判断参数中，配置如下。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/ce493ab2cec7b730fd5801c8cd15fa69.png\"><img class=\"alignnone size-full wp-image-112230\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/ce493ab2cec7b730fd5801c8cd15fa69.png\" alt=\"p5\"></a></p>\n<p>问题得到了解决。</p>\n<h1 id=\"4-总结\">4. 总结</h1>\n<p>上述“惨案” ，是 跨域、nginx缓存、http/https协议 这三种条件同时出现引发的。<br>\n如果不涉及跨域，混用 http/https协议 + nginx缓存，其实也是没有问题的。但是一旦出现了跨域使用，必须 在nginx 缓存配置中，配置 scheme + host + uri +　参数。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112224\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112224votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112224\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "谷歌用两年时间研究了 180 个团队，发现高效团队有这五个特征", "url": "http://blog.jobbole.com/112239/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/ec8b7891ca44138c9a9a09ee180cf33b.jpg"], "praise_nums": "3", "comment_nums": 5, "fav_nums": 7, "tags": "职场,Google,团队", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/young605867996\">Lada</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://rework.withgoogle.com/blog/five-keys-to-a-successful-google-team/\">rework.withgoogle</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><div>\n<h3>Google 成功团队的五大关键</h3>\n<p>小群聚、工作小组、委员会、自治体，无论它叫什么，身处其中，你都是 Google 的一份子，并且你无论在哪工作，都离不开团队。因此，如果我们知道什么能让管理者高效，那么为什么我们不知道什么能让团队高效呢？</p>\n<blockquote><p>更新：点击此处查看：工作指南——<a href=\"https://rework.withgoogle.com/guides/understanding-team-effectiveness/\">理解团队效能</a>之 Google 团队效能的调查全报道，以及有助于营造团队安全感的工具。</p></blockquote>\n<p>我们中的一群人在谷歌的人力运营部（我们称之为 HR）着手使用数据和严格的分析来回答这个问题：<strong><b>是什么让谷歌</b></strong><strong><b>的</b></strong><strong><b>团队</b></strong><strong><b>高效？</b></strong>今天的早些时候，我们与<a href=\"http://bigstory.ap.org/article/8c60341cc1da47e084b8e17e62e83c98/google-searches-itself-build-more-productive-teams\">美联社</a>分享了我们的研究，现在也在这里分享这些发现。</p>\n<p>过去两年我们对 200+ Googlers（谷歌员工）的采访，观察了 180+ 个谷歌活跃团队的 250 多种属性。我们曾非常自信能找到一流团队，一个完美混合了个人特质和必备技能的团队：一个 Rhodes 学者、两个外向的人、一个牛逼的 AngularJS 工程师，还有一个博士。你看看，这就是梦之队的配置，对吧?</p>\n<p>但我们大错特错了。<strong><span id=\"pos_placeholder\" style=\"width: 0px; height: 0px; margin: 0px; padding: 0px;\"></span>一个团队中有什么人，远不如团队成员是如何相互影响、组织工作、看待贡献更重要。</strong>因为神奇的算法，我们发现了更多。</p>\n<p>我们了解到了在 Google 区分成功团队和其他团队的五大关键因素：</p>\n<ol>\n<li><b></b><strong><b>安全感（<strong><b>Psychological safety）</b></strong>：</b></strong>在这个团队里，我们敢冒险，而且不会对此感到不安和难堪？</li>\n<li><b></b><strong><b>可靠性（<strong><b>Dependability</b></strong>）：</b></strong>我们能指望他人准时完成高质量的工作吗？</li>\n<li><b></b><strong><b>结构与清晰度（<strong><b>Structure &amp; clarity</b></strong>）：</b></strong>目标、角色和执行计划都是清楚明确的吗？</li>\n<li><b></b><strong><b>工作意义（<strong><b>Meaning of work）</b></strong>：</b></strong>我们都是在做对各自来说个人意义重大的工作吗？</li>\n<li><b></b><strong><b>工作影响（<strong><b>Impact of work</b></strong>）：</b></strong>我们从根本上认为自己所做的工作重要吗？</li>\n</ol>\n<p>如果上面 5 个问题，你的回答全是“yes”，那么恭喜你，你应该是处在一个高绩效团队里。如果没有，也不代表失去了希望。这只是一个帮助你找出哪里是重点、如何变得更好的快捷方式，一种和你的成员使用结构化方式讨论这种概念的方法。</p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fithlogdqdj21kw1v1anc.jpg\" width=\"2048\" height=\"2413\"></p>\n<p><a href=\"https://www.youtube.com/watch?v=LhoLuui9gX8\">安全感</a>无疑是五个动力中最重要的，我们发现——它是其他四个动力的支撑。这怎么可能呢？冒险在你的团队成员看来似乎很简单。但是回想你最后一次为一个项目工作的时候。你觉得你可以像一个唯一的局外人一样，忽略风险，只问目的？或是你选择了在没有明确问题的时候继续，只为了避免被视作无知？</p>\n<p>结果是，我们都不愿去做那些会负面影响别人看待我们的能力、意识和积极性的行为。虽然这种自我保护在工作场所是一种自然的策略，但它不利于高效的团队合作。而另一方面，团队成员彼此间感觉越安全，越有可能承认错误、一起合作，以及接受新的角色。它几乎影响着我们所观察雇员的每一个重要维度。在团队中具有较高安全感的个人不太可能离开 Google，<a href=\"http://www.mckinsey.com/insights/organization/why_diversity_matters\">他们更有可能</a>利用队友的<a href=\"http://blogs.wsj.com/atwork/2015/01/20/new-report-finds-a-diversity-dividend-at-work/\">多样化的想法</a>，带来更多的收入，高管常常会认为他们是双倍高效的。</p>\n<p>Googlers 热爱数据。并且他们不想让它闲置，而想做点什么。因此，我们创建了一个名为 gTeams exercise 的工具，包含：一个对五大动力进行的 10 分钟工作评估，一份总结团队是如何工作的报告，一场讨论结果、定制发展资源以帮助团队提高的现场面对面对话。在过去的一年里，已经有 3000 多名 Googlers 在 300 个团队中使用该工具。而这些谷歌团队中，采用了新团队规范的（比如通过在每次团队会议开始前共享上周的风险）安全感评分提高了 6%，结构与清晰度的评分提高了 10%。团队们说，“有一个团队效能的框架和强制方法来讨论这些之前失去的动力，是迄今为止最有效的一部分经历。”</p>\n<p class=\"\">从 Dublin（爱尔兰都柏林）的销售团队到 Mountain View（美国加州山景城）的工程团队，我们已经看到，关注这个框架有助于各种类型的团队提高。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112239\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112239votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112239\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 5 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/young605867996\">Lada</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/young605867996\">\r\n\t\t\t<img src=\"http://q.qlogo.cn/qqapp/208656/B77EEB9D520DE9C7BD42E89DC348FEC7/100\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            希望了解更多互联网、创业管理、创新思维、前沿技术和设计的知识。渐进明细，持续改进。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/young605867996\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/young605867996/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/young605867996/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 15</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://littlejanery.blog.163.com/\"><i class=\"fa fa-link\"></i></a> <a title=\"QQ：605867996\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：yao605867996\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "一文了解 Kubernetes 是什么？", "url": "http://blog.jobbole.com/112243/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/056e0ba2e853feeeca8d93018fa61151.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,容器", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/\">Kubernetes.io</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8800-1.html\">Linux中国/songshuang00</a>   </div><p>这是一篇 Kubernetes 的概览。</p>\n<p>Kubernetes 是一个<a href=\"http://www.slideshare.net/BrianGrant11/wso2con-us-2015-kubernetes-a-platform-for-automating-deployment-scaling-and-operations\">自动化部署、伸缩和操作应用程序容器的开源平台</a>。</p>\n<p>使用 Kubernetes，你可以快速、高效地满足用户以下的需求：</p>\n<ul>\n<li>快速精准地部署应用程序</li>\n<li>即时伸缩你的应用程序</li>\n<li>无缝展现新特征</li>\n<li>限制硬件用量仅为所需资源</li>\n</ul>\n<p>我们的目标是培育一个工具和组件的生态系统，以减缓在公有云或私有云中运行的程序的压力。</p>\n<h4 id=\"toc_1\">Kubernetes 的优势</h4>\n<ul>\n<li>  <strong>可移动</strong>: 公有云、私有云、混合云、多态云</li>\n<li>  <strong>可扩展</strong>: 模块化、插件化、可挂载、可组合</li>\n<li>  <strong>自修复</strong>: 自动部署、自动重启、自动复制、自动伸缩</li>\n</ul>\n<p>Google 公司于 2014 年启动了 Kubernetes 项目。Kubernetes 是在 <a href=\"https://research.google.com/pubs/pub43438.html\">Google 的长达 15 年的成规模的产品级任务的经验下</a>构建的，结合了来自社区的最佳创意和实践经验。</p>\n<h3 id=\"toc_2\">为什么选择容器?</h3>\n<p>想要知道你为什么要选择使用 <a href=\"https://aucouranton.com/2014/06/13/linux-containers-parallels-lxc-openvz-docker-and-more/\">容器</a>?</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/056e0ba2e853feeeca8d93018fa61151.jpg\"></p>\n<p>程序部署的<em>传统方法</em>是指通过操作系统包管理器在主机上安装程序。这样做的缺点是，容易混淆程序之间以及程序和主机系统之间的可执行文件、配置文件、库、生命周期。为了达到精准展现和精准回撤，你可以搭建一台不可变的虚拟机镜像。但是虚拟机体量往往过于庞大而且不可转移。</p>\n<p>容器部署的<em>新的方式</em>是基于操作系统级别的虚拟化，而非硬件虚拟化。容器彼此是隔离的，与宿主机也是隔离的：它们有自己的文件系统，彼此之间不能看到对方的进程，分配到的计算资源都是有限制的。它们比虚拟机更容易搭建。并且由于和基础架构、宿主机文件系统是解耦的，它们可以在不同类型的云上或操作系统上转移。</p>\n<p>正因为容器又小又快，每一个容器镜像都可以打包装载一个程序。这种一对一的“程序 – 镜像”联系带给了容器诸多便捷。有了容器，静态容器镜像可以在编译/发布时期创建，而非部署时期。因此，每个应用不必再等待和整个应用栈其它部分进行整合，也不必和产品基础架构环境之间进行妥协。在编译/发布时期生成容器镜像建立了一个持续地把开发转化为产品的环境。相似地，容器远比虚拟机更加透明，尤其在设备监控和管理上。这一点，在容器的进程生命周期被基础架构管理而非被容器内的进程监督器隐藏掉时，尤为显著。最终，随着每个容器内都装载了单一的程序，管理容器就等于管理或部署整个应用。</p>\n<p>容器优势总结：</p>\n<ul>\n<li>  <strong>敏捷的应用创建与部署</strong>：相比虚拟机镜像，容器镜像的创建更简便、更高效。</li>\n<li>  <strong>持续的开发、集成，以及部署</strong>：在快速回滚下提供可靠、高频的容器镜像编译和部署（基于镜像的不可变性）。</li>\n<li>  <strong>开发与运营的关注点分离</strong>：由于容器镜像是在编译/发布期创建的，因此整个过程与基础架构解耦。</li>\n<li>  <strong>跨开发、测试、产品阶段的环境稳定性</strong>：在笔记本电脑上的运行结果和在云上完全一致。</li>\n<li>  <strong>在云平台与 OS 上分发的可转移性</strong>：可以在 Ubuntu、RHEL、CoreOS、预置系统、Google 容器引擎，乃至其它各类平台上运行。</li>\n<li>  <strong>以应用为核心的管理</strong>: 从在虚拟硬件上运行系统，到在利用逻辑资源的系统上运行程序，从而提升了系统的抽象层级。</li>\n<li>  <strong>松散耦联、分布式、弹性、无拘束的<a href=\"https://martinfowler.com/articles/microservices.html\">微服务</a></strong>：整个应用被分散为更小、更独立的模块，并且这些模块可以被动态地部署和管理，而不再是存储在大型的单用途机器上的臃肿的单一应用栈。</li>\n<li>  <strong>资源隔离</strong>：增加程序表现的可预见性。</li>\n<li>  <strong>资源利用率</strong>：高效且密集。</li>\n</ul>\n<h4 id=\"toc_3\">为什么我需要 Kubernetes，它能做什么?</h4>\n<p>至少，Kubernetes 能在实体机或虚拟机集群上调度和运行程序容器。而且，Kubernetes 也能让开发者斩断联系着实体机或虚拟机的“锁链”，从<strong>以主机为中心</strong>的架构跃至<strong>以容器为中心</strong>的架构。该架构最终提供给开发者诸多内在的优势和便利。Kubernetes 提供给基础架构以真正的<strong>以容器为中心</strong>的开发环境。</p>\n<p>Kubernetes 满足了一系列产品内运行程序的普通需求，诸如：</p>\n<ul>\n<li>  <a href=\"https://kubernetes.io/docs/concepts/workloads/pods/pod/\">协调辅助进程</a>，协助应用程序整合，维护一对一“程序 – 镜像”模型。</li>\n<li>  <a href=\"https://kubernetes.io/docs/concepts/storage/volumes/\">挂载存储系统</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/concepts/configuration/secret/\">分布式机密信息</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/\">检查程序状态</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/concepts/workloads/controllers/replicationcontroller/\">复制应用实例</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/\">使用横向荚式自动缩放</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/concepts/services-networking/connect-applications-service/\">命名与发现</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/concepts/services-networking/service/\">负载均衡</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/tasks/run-application/rolling-update-replication-controller/\">滚动更新</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/tasks/debug-application-cluster/resource-usage-monitoring/\">资源监控</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/concepts/cluster-administration/logging/\">访问并读取日志</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/tasks/debug-application-cluster/debug-application-introspection/\">程序调试</a></li>\n<li>  <a href=\"https://kubernetes.io/docs/admin/authorization/\">提供验证与授权</a></li>\n</ul>\n<p>以上兼具平台即服务（PaaS）的简化和基础架构即服务（IaaS）的灵活，并促进了在平台服务提供商之间的迁移。</p>\n<h4 id=\"toc_4\">Kubernetes 是一个什么样的平台?</h4>\n<p>虽然 Kubernetes 提供了非常多的功能，总会有更多受益于新特性的新场景出现。针对特定应用的工作流程，能被流水线化以加速开发速度。特别的编排起初是可接受的，这往往需要拥有健壮的大规模自动化机制。这也是为什么 Kubernetes 也被设计为一个构建组件和工具的生态系统的平台，使其更容易地部署、缩放、管理应用程序。</p>\n<p><a href=\"https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/\">标签</a>（label）可以让用户按照自己的喜好组织资源。 <a href=\"https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/\">注释</a>（annotation）让用户在资源里添加客户信息，以优化工作流程，为管理工具提供一个标示调试状态的简单方法。</p>\n<p>此外，<a href=\"https://kubernetes.io/docs/concepts/overview/components/\">Kubernetes 控制面板</a>是由开发者和用户均可使用的同样的 <a href=\"https://kubernetes.io/docs/reference/api-overview/\">API</a> 构建的。用户可以编写自己的控制器，比如 <a href=\"https://git.k8s.io/community/contributors/devel/scheduler.md\">调度器</a>（scheduler），使用可以被通用的<a href=\"https://kubernetes.io/docs/user-guide/kubectl-overview/\">命令行工具</a>识别的<a href=\"https://git.k8s.io/community/contributors/design-proposals/extending-api.md\">他们自己的 API</a>。</p>\n<p>这种<a href=\"https://github.com/kubernetes/community/blob/master/contributors/design-proposals/principles.md\">设计</a>让大量的其它系统也能构建于 Kubernetes 之上。</p>\n<h4 id=\"toc_5\">Kubernetes 不是什么？</h4>\n<p>Kubernetes 不是传统的、全包容的平台即服务（Paas）系统。它尊重用户的选择，这很重要。</p>\n<p>Kubernetes：</p>\n<ul>\n<li>  并不限制支持的程序类型。它并不检测程序的框架 (例如，<a href=\"http://wildfly.org/\">Wildfly</a>)，也不限制运行时支持的语言集合 (比如， Java、Python、Ruby)，也不仅仅迎合 <a href=\"https://12factor.net/\">12 因子应用程序</a>，也不区分 <em>应用</em> 与 <em>服务</em> 。Kubernetes 旨在支持尽可能多种类的工作负载，包括无状态的、有状态的和处理数据的工作负载。如果某程序在容器内运行良好，它在 Kubernetes 上只可能运行地更好。</li>\n<li>  不提供中间件（例如消息总线）、数据处理框架（例如 Spark）、数据库（例如 mysql），也不把集群存储系统（例如 Ceph）作为内置服务。但是以上程序都可以在 Kubernetes 上运行。</li>\n<li>  没有“点击即部署”这类的服务市场存在。</li>\n<li>  不部署源代码，也不编译程序。持续集成 (CI) 工作流程是不同的用户和项目拥有其各自不同的需求和表现的地方。所以，Kubernetes 支持分层 CI 工作流程，却并不监听每层的工作状态。</li>\n<li>  允许用户自行选择日志、监控、预警系统。（ Kubernetes 提供一些集成工具以保证这一概念得到执行）</li>\n<li>  不提供也不管理一套完整的应用程序配置语言/系统（例如 <a href=\"https://github.com/google/jsonnet\">jsonnet</a>）。</li>\n<li>  不提供也不配合任何完整的机器配置、维护、管理、自我修复系统。</li>\n</ul>\n<p>另一方面，大量的 PaaS 系统运行<em>在</em> Kubernetes 上，诸如 <a href=\"https://www.openshift.org/\">Openshift</a>、<a href=\"http://deis.io/\">Deis</a>，以及 <a href=\"http://eldarion.cloud/\">Eldarion</a>。你也可以开发你的自定义 PaaS，整合上你自选的 CI 系统，或者只在 Kubernetes 上部署容器镜像。</p>\n<p>因为 Kubernetes 运营在应用程序层面而不是在硬件层面，它提供了一些 PaaS 所通常提供的常见的适用功能，比如部署、伸缩、负载平衡、日志和监控。然而，Kubernetes 并非铁板一块，这些默认的解决方案是可供选择，可自行增加或删除的。</p>\n<p>而且， Kubernetes 不只是一个<em>编排系统</em> 。事实上，它满足了编排的需求。 <em>编排</em> 的技术定义是，一个定义好的工作流程的执行：先做 A，再做 B，最后做 C。相反地， Kubernetes 囊括了一系列独立、可组合的控制流程，它们持续驱动当前状态向需求的状态发展。从 A 到 C 的具体过程并不唯一。集中化控制也并不是必须的；这种方式更像是<em>编舞</em>。这将使系统更易用、更高效、更健壮、复用性、扩展性更强。</p>\n<h4 id=\"toc_6\">Kubernetes 这个单词的含义？k8s？</h4>\n<p><strong>Kubernetes</strong> 这个单词来自于希腊语，含义是 <em>舵手</em> 或 <em>领航员</em> 。其词根是 <em>governor</em> 和 <a href=\"http://www.etymonline.com/index.php?term=cybernetics\">cybernetic</a>。 <em>K8s</em> 是它的缩写，用 8 字替代了“ubernete”。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112243\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112243votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112243\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "DevOps 团队之殇", "url": "http://blog.jobbole.com/112237/", "front_image_url": ["http://insights.thoughtworks.cn/wp-content/uploads/2017/08/1-DevOps-700x436.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,DevOps", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><blockquote><p>“你在团队里是做什么的？”“DevOps。”</p>\n<p>“DevOps是什么呢？”</p>\n<p>“DevOps是一种文化、一种实践，目标是加快软件迭代速度，让团队更快交付价值。”</p>\n<p>“能不能具体点，你们日常工作的主要内容是什么？”</p>\n<p>“修Pipeline…”</p></blockquote>\n<p><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/08/1-DevOps-700x436.png\" alt=\"\"></p>\n<p>作为一名开发，在刚涉足DevOps领域的时候，最难的就是和传统运维撇清关系；等到DevOps不再被当成是运维，又容易被当成是专职修Pipeline的人。</p>\n<p>DevOps在一遍遍被人们提及、一次次在项目中被实践时，也在不断地被重新定义，DevOps是什么？这个问题可能到现在也比较难说清楚，但是项目中的“DevOps”做了些什么，却是清晰可见的。</p>\n<p>本文就结合笔者的切身经历，谈一谈关于DevOps交付的价值以及在企业转型过程中遇到的一些问题。</p>\n<h3 id=\"toc_0\">背景介绍</h3>\n<p>客户是一家澳洲大型金融保险企业，其IT部门总人数在千人以上，维护应用两百余个。在经历了几年的收购和合并之后，在业务上指定了“将收购来的多个品牌进行整合”的大方针，于是IT部门也开始面临系统整合、业务线整合、网站合并的问题，同时客户正在将他们的服务逐渐从自建数据中心向AWS公有云服务上迁移。</p>\n<h3 id=\"toc_1\">团队概览</h3>\n<p>在数字化转型的漫漫长路中，该企业已经在内部搭建起了一套持续交付系统，以<a href=\"https://jenkins.io/\">Jenkins</a>为中心，有制品库、依赖管理、代码管理、任务管理系统，敏捷实践成熟。</p>\n<p>我所在的团队是在整个组织向DevOps转型中的一个比较关键的团队，肩负着CI/CD优化、持续交付改进、运维能力输出的重任。类似的团队应该在很多DevOps转型的组织里都有，负责维护CI/CD基础设施、搭建应用开发脚手架、维护基础设施变更、做各种自动化的工作（姑且就将这类团队称之为Platform团队）。</p>\n<p><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/08/2-Platform-700x402.png\" alt=\"\"></p>\n<p>比较特殊的是我在的这个团队实行轮岗制，由产品团队的成员（通常是开发人员）定期轮换到Platform团队，带着在产品团队遇到但是没能解决的问题，在这个团队中寻求最佳实践和解决方案，一段时间后（通常是三个月），开发人员从Platform团队回到开发团队，同时将DevOps技能和最佳实践带到产品开发团队。</p>\n<p>整个Platform团队基本维持在3-5人的规模，有一个IM（Iteration Manager迭代经理），其余全是开发人员。</p>\n<h3 id=\"toc_2\">取得的成就</h3>\n<p>回顾过去的五个月，Platform团队一共经历了10个迭代（每个迭代两个星期），我梳理了一下每个迭代的工作内容，整理出主要成就如下：</p>\n<ul>\n<li>围绕CI/CD做了很多优化，比如简化Jenkins slave创建流程、给自动化脚本（基础设施代码）贡献了许多新功能。</li>\n<li>新技术试点，比如尝试将静态文件部署到<a href=\"https://aws.amazon.com/cn/s3/\">AWS S3</a>中代替<a href=\"https://httpd.apache.org/\">Apache</a>服务。</li>\n<li>为应用设置监控，更新了基础设施脚本用于开启监控，并协助应用团队将配置脚本应用到各个环境。</li>\n<li>团队之间的沟通，了解开发团队痛点，帮助开发团队找到能够解决问题的团队（权限、责任划分、知识传递），技能培训等。</li>\n<li>响应变化，解决技术难题（虽然我认为这更像是一个沟通+权限的问题，但是其他所有团队都认为是技术难题，那我也就这样认为吧），以及修复一些类似于硬盘空间已满、网络延迟、权限的问题。</li>\n</ul>\n<h3 id=\"toc_3\">遇到的问题</h3>\n<p>当然在交付价值的同时，有很多痛点是非常折磨人的：</p>\n<ul>\n<li><strong>权限分配：</strong>作为一个跨开发团队工作的团队，不但没有拥有比开发团队更多的权限，甚至连开发团队的一些权限都没有，比如不能向开发团队的代码库提交代码(修改基础设施代码需要这个权限)，比如缺少Linux权限导致服务器底层问题没法直接修复，再比如 Jenkins 的问题追踪到了服务层需要维护Jenkins的团队支持，因为涉及到CI／CD的应用是由别的团队在管理。</li>\n<li><strong>沟通效率：</strong>为了解决一个bug，有时候要花上两周的时间发邮件，找关键人物，组织会议，跟不同的人解释五遍以上的上下文（技术细节的上下文是很繁琐的），最后解决问题的人还很有可能不是自己团队的（没有权限）。因为大家平时都很忙，而且建卡工作的方式让一部分人对团队请求帮助的问题不是很热心，这种情况在沟通的时候如果表现得情商不够高，对方就会要你发邮件给他们团队然后等 IM 建卡，规划到迭代里再说了，我遇到过一次这样的情况，最后还是通过社工手段拿下了这个关键人物，过程不可谓不曲折。</li>\n<li><strong>明确需求：</strong>Platform团队并不交付业务价值，因此没有BA(Business analyst业务分析师，通常扮演梳理需求的角色)，建卡的事基本都由IM和Dev来做，虽然感觉上是合理的，但实施起来却遇到很多问题，究其根本就是对需求的定义和划分不够明确，导致最后挪卡的时候大家都说不准这张卡算不算完成了，只能用拍脑袋的方式来决定。</li>\n<li><strong>质量分析：</strong>同上，团队缺少QA(Quality Assurance，质量工程师，测试人员)，Dev们都是自己做卡自己测，有时候会结对测试，但也会因为对需求理解不充分，或者说拆卡拆得有问题，导致一些卡完成得质量不够，直接影响受依赖的卡。举个例子，部署监控需要自动化脚本的两个模块支持，两个模块被分为两张卡，在做第一张卡的时候遇到了诸多问题，好不容易把代码提交到别人的版本库里了，在做第二张卡的时候却发现第一张卡代码里多写了一对引号，导致整个逻辑实现失败，这个时候再回过头来改之前的代码，又要重新解决之前遇到的各种问题（沟通、权限，PS：这个时候做第一张卡的人还下了项目），周期和浪费的工时是可想而知的。</li>\n<li><strong>人员轮岗：</strong>这是 IM 一直很头疼的一件事，Platform团队大量的时间花在给新来的团队成员输入上下文、同时又有成员离开团队要交接工作、尤其在沟通重要的工作中，成员的离开意味着需要新的人重新和干系人建立联系，再者，一些成员因为项目上的痛点，不是很有心思工作在团队的事务上，而是更关心自己过段时间会被分配到那个团队，如此种种都对团队的价值交付造成了很大的困扰。举一个例子，有一个端到端测试工具一直由Platform团队维护，从我加入Platform团队开始，这个测试工具就打算新增一个集成远程浏览器引擎的功能，这是一个非常有价值的功能，因为开发团队长期苦于浏览器版本支持过少，端到端测试不稳定；但是在实现过程中一直存在一个网络问题，这张卡先后被关闭、开启、标记完成、又重新开启，经历了大概五六个人的手，困扰我们的网络问题直到Platform团队解散，都没能解决。</li>\n<li><strong>关键角色管理：</strong>做了什么很重要，有时候让别人知道你做了什么比做了什么更重要。这一点在 Platform 团队体现的得尤为明显；在交付团队中，开发如果发现资源不足，需要和TL(Tech Lead 或是Team Lead，可以理解为项目组长)或者PM(Production Manager 产品经理)沟通，如果缺少合适的汇报对象，一方面在团队需要外部支持或更多资源（比如权限）的时候得不到及时的支持，另一方面意味着团队缺少了更高的视角来实时回顾自己做的事情是否是正确的，方向有没有走偏，或者是不是又在造别人造过的轮子。我在团队解散后的回顾会议中，IM还坚持认为我们团队被解散是因为没有一个强有力的领导在背后支持，这也从侧面反映了我们没有找到合适的汇报人，告诉他，我们在做什么，听他说，我们下一步可以做什么。</li>\n</ul>\n<p><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/08/4-Tech-Lead-1-700x390.jpg\" alt=\"\"></p>\n<h3 id=\"toc_4\">分析</h3>\n<h4 id=\"toc_5\">问题背后的原因及可能的改进方案</h4>\n<p>团队解散后经过一段时间的沉淀，我针对以上痛点与过往的成员一一交谈，了解了他们的想法，总结分析出了以下原因，以及可能的解决方案。</p>\n<h4 id=\"toc_6\">原因1：团队方向不清晰</h4>\n<p>不同于交付业务价值的产品团队，Platform团队不对某一个具体的产品负责，也不直接产出业务价值，加上Platform团队对交付的价值缺乏有效的指标度量，造成了团队方向不清晰的状况。</p>\n<p><strong>可能的改进方案：</strong>Platform 团队应该是属于架构师的一个机动团队，在团队方向不清晰的时候应该立即与利益相关者(Stakeholder)沟通，即与架构师取得联系，取得高视角的资源，最好能建立交付价值指标，比如Platform团队的目标是加快持续交付，提高交付质量，那就可视化开发团队发布周期、质量报告，让每个团队成员看到Platform团队交付价值的体现，从而明确团队方向。</p>\n<h4 id=\"toc_7\">原因2：团队角色缺失</h4>\n<p>在架构师不能全权参与团队工作的情况下（甚至Platform团队还可能没有IM），一帮Dev就很容易失去对团队整体的感知，每个Dev只关心自己手里的工作，迭代开始初期容易考虑不到全局影响、不能准确建卡，迭代进行时因为没有合适的汇报人因而跨团队交流困难，迭代结束时没有优质的回顾。 在Micromanagement Culture（微观管理文化）中有一个Alignment(校准)和Autonomy(自治)两个互斥的指标，我们使用这两个指标作为向量构成四个象限，如下图所示：</p>\n<p><img src=\"http://insights.thoughtworks.cn/wp-content/uploads/2017/08/5-Spotify-Engineering-Culture.png\" alt=\"\"></p>\n<p style=\"text-align: center;\">图片来源：<a href=\"https://www.youtube.com/watch?v=4GK1NDTWbkY\">Spotify Engineering Culture</a></p>\n<ul>\n<li>高校准、低自治的团队由领导决定做什么以及怎么做，团队只需要执行，这样会形成“领导说什么就是什么”的局面；</li>\n<li>而高校准且高自治的团队是由领导指出要解决的问题以及原因，然后由团队成员相互合作共同找到问题的解决方案；</li>\n<li>低校准、低自治的团队则缺乏活力，只能循规蹈矩；</li>\n<li>而高自治、低校准的团队成员可以做任何他们想做的事情，领导则很无助因为没有人关心真正需要解决的问题。</li>\n</ul>\n<p>在敏捷团队中，如果团队成员只剩下Dev，情形则很有可能变成图中左下象限（也有些许右下）的情况，要想达到右上象限的期望状态，需要提高自治，更多的是校准。</p>\n<p><strong>可能的改进方案：</strong>在意识到这个问题的时候，团队需要一个关键人物出面充当领导者的角色，扮演这个角色的人必须关注团队交付价值、目标和方向，并且有强大的沟通能力让团队成员目标一致；和利益相关者加强沟通，保证团队方向不会跑偏。</p>\n<h4 id=\"toc_8\">根本原因</h4>\n<p>Platform团队成立初期被定义为一个立意高远（DevOps转型）的组织，但是在项目实施过程中变得越来越边缘化，其中有“人”的原因，有组织架构的原因，当然还有一些客观原因。但我突然意识到这背后有一个原因一直忽视了，那就是——我们在实践DevOps反模式。</p>\n<p>国内近年来一直在对DevOps如何落地争论不休，DevOps提倡的是打破开发和运维的部门墙，将开发和运维（的能力）放在一个团队。然而国内大部分项目的现状是，开发不具备运维技能和意识，也不愿意做“背锅侠”（要求开发做运维一定程度上牺牲了开发的利益，比如亚马逊的开发每隔一周会被要求24小时On-call）。</p>\n<p>因此一些公司选择了在项目中先成立一个 “DevOps团队” 作为过渡，再慢慢将CI/CD的理念和技能扩散到其他团队，但是这种方式稍不注意就会变成“换了个名字的Ops ”，因为工作内容相似，写脚本、做高可用，这些是传统运维也会做的事情，这种形式非常不利于团队思维的转变，“团队整体对最终交付物负责”才是DevOps的精要，而不是把团队按职责划分（只对流程负责）。</p>\n<p>这样的要求无异是给项目成员增加了工作量和责任，对他们提出了更高的要求。然而很多职员不愿意无回报地多背负一些责任，比如说开发，谁不愿意每天写点代码一提交就早早回家，DevOps要求他们得看着新功能上线，确保无误之后才能离开；所以DevOps的推行在产品团队中是有阻力的，因此DevOps的成功不光需要团队内部努力，也需要得到高层支持并扫除障碍。</p>\n<h3 id=\"toc_9\">反思</h3>\n<blockquote><p>在一个不确定性多发的时代，快速的从成败经验中学习比找寻正确的路径更加重要。——ThoughtWorks高级咨询师顾宇</p></blockquote>\n<ul>\n<li><strong>尽早找到关键角色，并且管理好利益相关人。</strong>这一点在一个扁平化组织里往往是最容易被忽视的，在意识到要和 Stackholders(利益相关者)建立联系之前，Platform 团队走了很多弯路，也错失了很多机会。</li>\n<li><strong>让事情发生比如何发生更重要。</strong>应该说在这5个月的工作中，我认为最有价值的是最后两个迭代开始真正搜集来自应用团队的需求，开始在两地组织各个团队的 TL 开会搜集痛点和解决方案。作为 Platform 团队的一员，这件事其实我早就意识到会是非常有价值的，但始终没有去做，总是顾虑不知道怎么去开始、去推动，担心TL 们提出的问题不能得到真正解决。但是最后这件事终于发生了，才意识到真的是非常有价值，而且早该这么做了。关于这点在我还在 ThoughtWorks 试用期的时候我的 Buddy(由公司安排负责伴随新员工渡过试用期的人) 给了我一个非常好的建议，就是决定在讲一个分享之前先把日程表（邀请邮件）发出来，这种看似是“Deadline driven(截止日期驱动)”的方式，背后暗含了“这件事情必须发生”的道理，这和 MVP(Minumum viable product，产品原型) 的原理也是一样的，先上线，再搜集反馈，迭代改进；就算它是一个错误的行为，这也是一次有价值的试错。</li>\n</ul>\n<h3 id=\"toc_10\">我们是否还需要DevOps团队</h3>\n<p>结合我自身的经历，“DevOps 团队”应该是一次有价值的试错，让我看到了这种方式的一些弊端，应用开发团队自身如果不具备产品思维，要由一个独立的团队去影响它们是很难的，这种实践下的 DevOps 团队就像是披着 DevOps 外衣的 Ops 团队，不能产生理想的价值。</p>\n<p>相比之下如果有一种自上而下的方式让开发团队基于已有业务基础之上去优化交付流程，并对每一个提交的最终价值负责，将产品思维真正植入到开发团队，从而达到全局优化的效果，这种做法才更符合真正的 DevOps 精神。</p>\n<p>（文／ThoughtWorks杜屹东）</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112237\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112237votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112237\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 72</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "提升 C++ 技能的 7 种方法", "url": "http://blog.jobbole.com/112246/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2014/09/64a7802a3a60295a4726c49e90604108.png"], "praise_nums": "2", "comment_nums": 3, "fav_nums": 9, "tags": "C/C++,开发,C++", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/chenyahui\">精算狗</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://www.fluentcpp.com/2017/06/23/7-ways-better-cpp-summer/\">Jonathan Boccara</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>夏天时常会谈到大海、太阳、沙滩、大山或者你的家庭住宅。<strong>更充裕的时间</strong>也是夏天带来的好处之一。可能是因为你在休假，也可能是因为这段时间工作没有那么忙。无论是哪种情况，与一年中的其他季节相比，夏天的时间似乎更加宽裕。</p>\n<p>你有两个选择：1）把所有夏季空闲时间都用来休整，适当放松一下没什么不可以。2）或者你可以投入一部分空闲时间来提升你的技能，尤其是 C++，用 C++ 水平的提高（boost C++）来开始新的一年。</p>\n<p>如果你觉得选择1）更适合你，那么关掉手机和笔记本吧，真正地放松一下！但是如果你倾向于选择2），那么这篇文章就是为你准备的。</p>\n<p>有 7 种方法帮助你利用夏天真正提高 C++。之后我会给你一些小技巧来帮助你<strong>真正实现</strong>所选的目标。</p>\n<h3>1）开始一个项目</h3>\n<p>用 C++ 来建一个你自己的小项目是一个很好的试验方法，而且能通过这个项目真正理解程序的运行。另一个优点在于你可以完全自由地决定使用什么组件。这样你能够提升这一年没有权限/时间使用的语言特性和库组件。</p>\n<p>在我去年的夏季项目中，我实现了一些区间适配器，这让我学到了超多东西。所以我会把这个项目的细节告诉你，这样你能够得到一些灵感来构建你自己的项目：</p>\n<ul>\n<li>如果你不熟悉 C++ 中的区间（Ranges），请参考<a href=\"http://www.fluentcpp.com/2017/01/12/ranges-stl-to-the-next-level/\">《Ranges: the STL to the Next Level》</a></li>\n<li>实现 transform_iterator，</li>\n<li>实现变换区间适配器（transform range adaptor），</li>\n<li>实现 filter_iterator，</li>\n<li>实现筛选区间适配器（filter range adaptor），</li>\n<li>实现 zip 适配器（zip adaptor），然后结合变换区间适配器使用。Zip 适配器需要两个区间，并且返回到来自这两个区间的成对对象的视图</li>\n<li>为 zip 适配器一般化，要令 zip 适配器能够使用任意数量的区间，</li>\n<li>实现<a href=\"http://www.fluentcpp.com/2017/04/14/understand-ranges-better-with-the-new-cartesian-product-adaptor/\">笛卡尔积区间适配器（Cartesian product range adaptor）</a>，</li>\n<li>实现你自己的新区间适配器！</li>\n</ul>\n<p>是否完美，是否完整或者是否遵从上述指示都不重要，重要的是你要去<strong>试验</strong>。但是上面这些任务能给你带来的是：</p>\n<ul>\n<li>明确理解区间，而区间是当下一个非常流行的 C++ 特性，</li>\n<li>练习变参模板（variadic templates）的使用，</li>\n<li>初步接触模板元编程（template metaprogramming），</li>\n</ul>\n<p>并且这些都是逐渐才能体会到的。</p>\n<p>如果你在这种项目上有任何需要帮助的地方，我都愿意效劳。另外我在这个项目上的所有尝试都写在 <a href=\"https://github.com/joboccara/ranges\">GitHub 的代码仓库</a>中了，希望对你们有用。</p>\n<h3>2）读一本好书</h3>\n<p>我会发布一个 C++ 的书单，但是我现在要给你一个选择。我认为作为一个程序员要读的第一本书就是 Steve McConnell 的《<a href=\"https://www.amazon.cn/gp/product/B0061XKRXA/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B0061XKRXA&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">代码大全</a>》。尽管这本书不是专注于 C++ 的，但是它把写好代码要注意的几乎所有方面都教给你了。从写一个 if 语句（没错，有好多方法把 if 语句搞砸）到分配类责任，再到代码审查，《代码大全》涵盖了软件架构的所有方面。在读完这本书以后你永远不会还用一样的方法来编程。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/9a741bac0b81b0471c32da6d8611496f.jpg\"><img class=\"aligncenter wp-image-112252 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/9a741bac0b81b0471c32da6d8611496f.jpg\" alt=\"Code-complete-246x300\" width=\"246\" height=\"300\"></a></p>\n<p>如果你还没有读过《代码大全》，你应该去看看 Scott Meyers 的《<a href=\"https://www.amazon.cn/gp/product/B004G72P24/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B004G72P24&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">Effective C++</a>》。我建议《Effective C++》要读<strong>两遍</strong>。我已经读过三遍了，但是我想两遍的效果应该一样好。尽管这本书是在 C++11 之前写的，但是大部分内容在今天也仍然是有用的。而且《<a href=\"https://www.amazon.cn/gp/product/B016OFO492/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B016OFO492&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">Effective Modern C++</a>》涵盖了C++11 和 C++14 中的特性，可以作为这本书的补充材料。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/59eb3be85b04e023cb4b9a0561c76068.jpg\"><img class=\"aligncenter wp-image-112253 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/59eb3be85b04e023cb4b9a0561c76068.jpg\" alt=\"Code-complete-246x300\" width=\"243\" height=\"300\"></a></p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/3efe96caf01c1d258a4158313c5ba2c6.png\"><img class=\"aligncenter wp-image-112255 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/3efe96caf01c1d258a4158313c5ba2c6.png\" alt=\"Effective-modern-C-249x300\" width=\"249\" height=\"300\"></a></p>\n<p>今年夏天我要看的是 Eric Evans 的著名书籍——《<a href=\"https://www.amazon.cn/gp/product/B01GZ6T12K/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B01GZ6T12K&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">领域驱动设计</a>》（Domain Driven Design）。《领域驱动设计》涵盖了领域专家和开发人员之间的密集交流，建立领域模型以及在讨论模型与代码时使用<strong>同一种语言</strong>。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/ee2d35e20bea6c8b6dba2692c6d53deb.jpg\"><img class=\"aligncenter wp-image-112256 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/ee2d35e20bea6c8b6dba2692c6d53deb.jpg\" alt=\"Code-complete-246x300\" width=\"227\" height=\"300\"></a></p>\n<p>尽管这本书的内容很有价值，但是读起来并不容易。我发现一个有用的小技巧：对每一小节<strong>先读第一段，再读最后一段，最后读其余部分</strong>。这样你能更好地理解作者的写作方向，节省时间。</p>\n<p>我希望通过显示代码中的域，来找到使代码具有表达性的灵感。当然啦，我会在博客上分享这些灵感的。</p>\n<p>这只是一个选择，我还会做一个更全面的书单。</p>\n<h3>3）学习一个新的语言</h3>\n<p>虽然听起来很稀奇，但是学习一种新的语言可以让你对你所的专注语言获得更深层次的理解，而且是最有效的方法之一。并且新的语言和你自己使用的语言差别越大，效果越好。</p>\n<p>新的观点认为，其他编程语言会让你对编程有更一般的理解。由于你太熟悉自己所用的语言，往往会忽略它的特性，而用不同的方法解决问题能够使这些特性凸显出来。即使你不会使用新语言来写产品代码，所接触到的新概念也能为你提供可以应用到主语言中的思路。</p>\n<p>如果你用的是 C++，那么我推荐你去学习一下 Haskell 语言。Haskell 是一种<strong>函数型编程</strong>语言。如果你还没有试用过函数型编程，那么你能从它的概念中获得启发，并从新的角度看待 C++，尤其是 STL。</p>\n<p>我已经花了很长时间比较网络上各种学习 Haskell 的资源。2013 年（单指那一年）<a href=\"http://www.seas.upenn.edu/~cis194/spring13/lectures.html\">宾夕法尼亚大学的课程</a>是我找到的最好的资源。它解释得很清楚，没有太多理论，课程练习也很良心而且有指导性，并且它还是免费的。</p>\n<p>一旦你学完这门课程，你可以在<a href=\"https://github.com/tonymorris/fp-course\"> data61 课程</a>中获得很多 Haskell 的练习，包括填空补充代码。你能够通过这些练习来整理不寻常的函数型编程的相关知识。</p>\n<p>如果你想了解更多函数型编程语言以及它们在 C++中的应用，我推荐 Quentin Duval 的博客：<a href=\"https://deque.blog/\">deque.blog</a>。</p>\n<p>今年夏天我要学习的语言是 <strong>Lisp</strong> 。我明白它是一种非常强大的语言，能够全面提升对编程的理解。一些语言是从它衍生出来的。它不会消失一定是有原因的！</p>\n<p>我还没有完成对网上资源的调查，但是我计划使用《<a href=\"https://www.amazon.cn/gp/product/B0011AP7RY/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B0011AP7RY&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">计算机程序的构造和解释</a>》（Structure and Interpretation of Computer Programs）。如果你有任何关于学习 Lisp 的想法，请告诉我！</p>\n<h3>4）提升使用 STL 的能力</h3>\n<p>STL 是 C++ 中处理容器和算法的部分。它很强大而且并不难用，却没有它应有的名气。要想掌握 STL 需要有相当的知识积累，但是这是值得的。它是一个神奇的方法，能使你的 C++ 代码更具有表达性也更健壮。</p>\n<p>我正在整理帮你掌握 STL 的资料，叫做 <a href=\"http://www.fluentcpp.com/stl/\">STL 学习资源</a>。还没有完成，但是有很大一部分已经做完了，我想足够让你在这个夏天的大部分时间都很充实了。</p>\n<h3>5）紧跟现代C++的特性</h3>\n<p>C++11，C++14 和C++17给C++ 和标准库带来了很多新的特性。即使你现在，比如今年夏天，没有在产品代码中使用它们，它们也都来了。并且你可以立即把它们应用在你的项目中（看上面的第1条）。</p>\n<p>有些特性很好掌握，比如 <strong>lambdas</strong>。尽管精通 lambda 表达式需要掌握很多细节上的东西，但是学会它们的基础用法不需要花太多精力。</p>\n<p>所以部分特性很好理解，只需要一些好资源和时间来熟悉它们。比如 Scott Meyers 的《<a href=\"https://www.amazon.cn/gp/product/B016OFO492/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B016OFO492&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">Effective Modern C++</a>》（见上面的第2点）涵盖了 C++11和 C++14 的大部分特性。</p>\n<p>我特别喜欢Bartek博客上的一份 <a href=\"http://www.bfilipek.com/2017/01/cpp17features.html\">C++17 特性列表</a>，它可以帮你快速上手 C++17 新特性。内容详实，而且你可以通过给一个特定的特性添加信息来贡献自己的一份力量。Bartolomiej 提供了所有的资源和 Github 权限，所以你能够非常轻松地添加信息。这样即使你还不了解 C++17 也能够贡献自己的力量，并且<strong>在这个过程中学到很多东西</strong>。</p>\n<p>如果你不练习的话，是无法理解很多特性的。尤其是<strong>变参模板</strong>，它是现代标准 C++ 的一个重要特性。上面第一点中的项目和其他任何包含变参模板的项目都可以作为练习。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/f468e87715fe3659f2a508a9c5ef91ed.jpg\"><img class=\"aligncenter wp-image-112257 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/f468e87715fe3659f2a508a9c5ef91ed.jpg\" alt=\"Code-complete-246x300\" width=\"640\" height=\"360\"></a></p>\n<h3>6）提高你对 boost 的了解</h3>\n<p>Boost 是设计良好的 C++ 库的集合，可移植且开源。很多现代 C++ 的特性都源自 Boost。</p>\n<p>了解 Boost 的内容很重要。有两个原因：第一，在代码中确实需要它们，因为 boost 主要应用于综合使用；第二，更重要的原因是即使你在产品代码中没有使用 boost，它可以给你一个通用的精心设计的 API 和 C++ 代码模型。<strong>留心 boost 中的内容可以给你自己的设计带来灵感</strong>。</p>\n<p>学习大量的 boost 库的一个方法是阅读 Boris Schäling 的书——《<a href=\"https://www.amazon.cn/gp/product/0982219199/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=0982219199&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">The boost C++ Libraries</a>》。这本书有<a href=\"https://theboostcpplibraries.com/\">电子版</a>，但是纸质版可以放进沙滩包供你躺在沙滩上阅读（真的，我去年夏天就读的这本书）。不过这本书是基于 boost 1.55.0 的，所以它包含了很多库，但并不是所有。</p>\n<p>特别地，它没有包含 Boost Hana。Boost Hana 是一个流行的现代 C++ 元程序库。实际上，学习 Boost Hana 可以作为今年夏天的一个目标。</p>\n<p>我询问了 Louis Dionne（Boost Hana 的创始人）怎么样才能有效地学习 Boost Hana。从<a href=\"http://www.boost.org/doc/libs/1_61_0/libs/hana/doc/html/index.html\">官方指导</a>入手是一个好的开始，而且你可以看他的<a href=\"https://youtu.be/Oc4enqNH-Mc\"> ACCU 演讲</a>（或者<a href=\"https://www.youtube.com/watch?v=X_p9X5RzBJE\">Meeting C++ keynote</a>，内容相似）来获取初步的介绍。这里是<a href=\"http://ldionne.com/talks/\"> Louis 的所有演讲</a>，大多数都与元编程和 HANA 有关，可以帮助加深你的了解。</p>\n<h3>7）观看网络视频</h3>\n<p>C++ 社区上有超多网络视频，尤其是年会的视频。今年夏天是观看这些视频的好时机。</p>\n<p>下面是一些我觉得有近期指导性的演讲：</p>\n<ul>\n<li>Patrice Roy – <a href=\"https://youtu.be/Fno6suiXLPs\">异常处理（The Exception Situation）</a>。这个演讲让你对在 C++ 中使用异常处理对你的代码意味着什么有一个大致了解。该演讲结构合理，而且 Patrice 的演讲风格很让人愉快。</li>\n<li>Arthur O’Dwyer – <a href=\"https://youtu.be/vwrXHznaYLA\">Template Normal Programming</a>。在这个演讲中，Arthur 在不用模板元编程的情况下，展示了关于模板的所有知识，同样有板有眼。</li>\n<li>Stephan T. Lavave  – <a href=\"https://www.youtube.com/watch?v=JhgWFYfdIho\"> tuple＜＞：新特点以及它的用法（tuple＜＞: What’s New and How it Works）</a>。这里有很多关于 tuples 的有用信息和练习帮助你更了解标准库。</li>\n<li>Howard Hinnant – <a href=\"https://youtu.be/P32hvk8b13M\">chrono 导论（A ＜chrono＞ Tutorial）</a>。这个演讲教你使用 chrono 库，告诉你它是怎么用强类型来完成安全又表达清楚的代码。</li>\n<li>David Sankel –<a href=\"https://youtu.be/DiisKQAkGM4\"> Monoids, Monads, and Applicative Functors: Repeated Software Patterns</a>。David Sankel 展示了纯函数概念如何应用于 C++。</li>\n<li>David Sankel – <a href=\"https://youtu.be/k3O4EKX4z1c\">Variants：过去，现在和未来（Variants: Past, Present, and Future）</a>。一个关于 variant 的优秀展示，并且 variant 在 C++17 中被放进标准库里了。</li>\n<li>Dietmar Kühl – <a href=\"https://youtu.be/xWmdcvTedbc\">Constant Fun</a>。一个关于 constexpr 的优秀展示。</li>\n<li>Jason Turner –<a href=\"https://www.youtube.com/channel/UCxHAlbZQNFU2LgEtiqd2Maw\"> C++周刊（C++ Weekly）</a>。在这个周系列中，Jason 制作了一些短视频（5 到 10 分钟），每个视频都展示了一个 C++ 的精彩应用。我通常把这系列视频描述为“精彩 5 分钟”。</li>\n</ul>\n<p>这个列表绝没有包括所有优秀的视频。我看到过其他好视频，并且会有很多我没看过的。但是我觉得这个列表里的视频是个好开始。</p>\n<h3>实现你的夏季目标</h3>\n<p>现在已经有<strong>很多事要做</strong>啦。一个夏天之内不可能做完这些所有事情。所以你应该选择其中一部分来做，并且<strong>提前定好目标</strong>。不要从一件事情跳到另一件事情上，否则夏天会很快过去而且你也完不成任何一件事。</p>\n<p>此外，要想完成你的目标，你需要<strong>集中注意力</strong>。一个实用的方法是使用<a href=\"https://en.wikipedia.org/wiki/Pomodoro_Technique\">番茄工作法</a>，我是用 <a href=\"https://kanbanflow.com/\">kanbanflow</a> 来实现的。我现在就在使用这个方法而且结果也不错。</p>\n<p>我今年夏天的目标是读完《领域驱动设计》并且对 Lisp 有适当的理解。你的目标是什么呢？</p>\n<p>现在就选择<strong>两个目标</strong>吧，写在评论区内让我了解一下你们的选择。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112246\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112246votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112246\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 9 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 3 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui\">精算狗</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            简介还没来得及写 :）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/chenyahui\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/chenyahui/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/chenyahui/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 11</a> · <a title=\"QQ：564968845\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：564968845\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "最实用的 Linux 命令行使用技巧", "url": "http://blog.jobbole.com/112265/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/05/77d80105fd15f2465894827e23cc4842.jpeg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 9, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://dzone.com/articles/most-useful-linux-command-line-tricks\">Seco Max</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/most-useful-linux-command-line-tricks\">开源中国 - leoxu</a>   </div><p>我们可能每天都会要使用到很多的 <a href=\"https://likegeeks.com/main-linux-commands-easy-guide/\" target=\"_blank\" rel=\"nofollow\">Linux 命令行</a>。 我们也会网络上知晓一些使用它们的小技巧，但是如果我们没有时常来进行练习，就有可能会忘掉怎么去使用它们。 所以我就决定把那些你可能会忘记的小提示和小技巧，或者对你而言可能是全新的东西都列表来。</p>\n<h3>将输出内容以表格的形式显示出来</h3>\n<p>有时，在你看到命令行执行的输出时，因为字符串过度拥挤（比如说 mount 命令的输出）导致输出内容难以识别。如果我们看到的内容是一张表格会如何呢？其实这是很容易做到的！</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb3e56b7438882893\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmount | column –t:</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb3e56b7438882893-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb3e56b7438882893-1\"><span class=\"crayon-i\">mount</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-i\">column</span> –<span class=\"crayon-v\">t</span><span class=\"crayon-o\">:</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/8105f229bd5aab1933e69a673b050b77.png\"></p>\n<p>在此例中，由于内容中留了空格，所以输出的形式就美观了起来。 那如果想要的分隔符是别的什么符号，比如说冒号，又该怎么去做呢？ （例如，在 cat/etc/passwd 的输出内容中使用）</p>\n<p>这时候只需要使用 -s 参数指定分隔符就行了，像下面这样。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb3e56c1877346793\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncat /etc/passwd | column -t -s:</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb3e56c1877346793-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb3e56c1877346793-1\"><span class=\"crayon-i\">cat</span> <span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">passwd</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-i\">column</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span> <span class=\"crayon-o\">-</span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">:</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/ef22e95df16fb93a17c96954e6950305.png\"></p>\n<h3>重复执行一个命令，直到它运行成功</h3>\n<p>如果在 Google 上搜索这个功能，你会发现很多人都问到了如何重复执行命令，直到这个命令成功返回并且运行正常。 Google上的建议里就包括 ping 服务器，直到它变得空闲为止，还有就是检查是否有向特定的目录上传了具有特定扩展名的文件，还有就是检查特定的URL是否已经存在，诸如此类的办法。</p>\n<p>其实你还可以使用 while true 的循环来实现来实现这个功能：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/aa7339a9cd7cf1369192fd1007cb76cc.png\"></p>\n<p>在上面这个示例中，&gt;/dev/null 2&gt;＆1 会让程序的输出重定向到 /dev/ null。标准错误和标准输出都会被包含进去。</p>\n<p>这是我认为最酷的Linux命令行技巧之一。</p>\n<h3>按内存资源的使用量对进程进行排序</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb3e56c5636829680\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nps aux | sort -rnk 4:</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb3e56c5636829680-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb3e56c5636829680-1\"><span class=\"crayon-i\">ps</span> <span class=\"crayon-i\">aux</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-i\">sort</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">rnk</span> <span class=\"crayon-cn\">4</span><span class=\"crayon-o\">:</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/02ff6a80a4e1632d459fbe1ff580d8fb.png\"></p>\n<h3>按 CPU 资源的使用量对进程进行排序</h3>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb3e56c8123223246\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nps aux | sort -nk 3:</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb3e56c8123223246-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb3e56c8123223246-1\"><span class=\"crayon-i\">ps</span> <span class=\"crayon-i\">aux</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-i\">sort</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">nk</span> <span class=\"crayon-cn\">3</span><span class=\"crayon-o\">:</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/a71a5974b1fbae9a9614f2f65d66bfdd.png\"></p>\n<p>如果想要检查你的机器架构，那就执行 getconf LONG_BIT。</p>\n<h3>可以同时查看多个日志文件</h3>\n<p>毫无疑问，你可能已经会使用 tail  命令来查看日志文件了，但可能有时候你还想着能同时查看多个日志文件。 使用 multi-tail 命令就支持支持文本的高亮显示，内容过滤以及更多你可能需要的功能：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/ba6ceb511883799d251d17f9b4e28f0e.png\"><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/d81c3712dd9b9986860c3e89467852fb.png\"></p>\n<p>如果系统里还没有这个命令，运行 apt-get install multitail 命令就可以把它给装上。</p>\n<h3>回到你操作过的上一个目录去</h3>\n<p>只需敲入 cd – 就会返回到你操作过的上一个目录中去。</p>\n<h3>让非交互式 Shell 会话可进行交互</h3>\n<p>想要这样做，那就把设置从 ~/.bashrc 改成 ~/.bash_profile 吧。</p>\n<h3>定时的监视性命令输出</h3>\n<p>使用 watch 命令（watch df -h），你就可以查看到任何命令的任何输出。例如，你可以查看可用空间以及它的使用量增长情况。</p>\n<p>通过利用 watch 命令来操作会变化的数据，你可以尽情想象自己能拿这个来做些什么哦。</p>\n<h3>在会话关掉以后继续运行程序</h3>\n<p>如果你在后台运行了什么程序，然后你关掉了的 shell 会话，那么这个后台运行的程序就会被你的 shell 杀掉。关闭 shell 以后怎么让程序继续运行下去呢？</p>\n<p>这个可以用 nohup 命令做到 – 该指令表示不做挂断操作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb3e56cd533755702\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnohup wget site.com/file.zip</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb3e56cd533755702-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb3e56cd533755702-1\"><span class=\"crayon-i\">nohup</span> <span class=\"crayon-i\">wget</span> <span class=\"crayon-v\">site</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">zip</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>此命令是最容易被遗忘的 Linux 命令行技巧之一，因为我们许多人都会使用另外一个类命令的 screen 环境：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/8e6ac97ad36188d5a566a851d1e2c8c5.png\"></p>\n<p>这样会在同一个目录下生成一个名称为 nohup.out 的文件，其中包含了正在运行的程序的输出内容：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/73f4a9d25594c685db6714ee46d96810.png\"></p>\n<p>命令很酷，对吧？</p>\n<h3>自动对任何命令回答 Yes 或者 No</h3>\n<p>如果你想自动化需要向用户说的 Yes 的过程，可以使用 yes 命令来实现：yes | apt-get update。</p>\n<p>也许你想做的是自动地说“No”。这个可以使用 yes no | 命令来实现。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/9d3ada6e55c6b9738b0dc40667db4c50.png\"></p>\n<h3>创建具有指定大小的文件</h3>\n<p>可以使用 dd 命令来创建出具有指定大小的文件：dd if=/dev/zero of=out.txt bs=1M count=10。</p>\n<p>这样就会创建出一个 10 MB 的文件，填充零作为内容：</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/caf1d4163993de8e51e0eb04e45c59d6.png\"></p>\n<h3>以根目录用户来运行最后一个命令</h3>\n<p>有时，你会忘记在需要 root 权限的命令之前敲入 sudo。这时候你没必要去重写命令; 只要输入 sudo 就行了！</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/1f79f8f42fcd5f08552b17cc3398d258.png\"></p>\n<h3>对命令行会话进行记录</h3>\n<p>如果想要把自己在 shell 屏幕上敲的内容记录下来，可以使用 script 命令将所有敲写的内容保存到一个名为 typescriptscript 的文件中去。</p>\n<p>等你敲入 exit 命令以后，所有命令就都会被写入该文件，以便你事后再回过头去查看。</p>\n<h3>用标签符号替换空格符</h3>\n<p>可以使用 tr 命令替换任何字符，这个用起来非常方便：cat geeks.txt | tr ‘:[space]:’ ‘\\t’ &gt; out.txt.</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/7dcc5cc23045ed18fd3ed993c3065028.png\"></p>\n<h3>将文件内容转换为大写或者小写</h3>\n<p>可以这样实现：cat myfile | tr a-z A-Z&gt; output.txt。</p>\n<h3>强大的 Xargs 命令</h3>\n<p>xargs 命令是最重要的 Linux 命令行技巧之一。你可以使用这个命令将命令的输出作为参数传递给另一个命令。例如，搜索 png 文件然后对其进行压缩或者其它操作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb3e56d1172583525\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfind. -name *.png -type f -print | xargs tar -cvzf images.tar.gz</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb3e56d1172583525-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb3e56d1172583525-1\"><span class=\"crayon-v\">find</span><span class=\"crayon-sy\">.</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">name</span> <span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">png</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">type</span> <span class=\"crayon-i\">f</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">print</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-i\">xargs</span> <span class=\"crayon-i\">tar</span> <span class=\"crayon-o\">-</span><span class=\"crayon-i\">cvzf</span> <span class=\"crayon-v\">images</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">tar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">gz</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>又或者你的文件中有一个 URL 的列表，而你想要做的是以不同的方式下载或者处理这些 URL，可以这样做：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb3e56d4445101152\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncat urls.txt | xargs wget</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb3e56d4445101152-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb3e56d4445101152-1\"><span class=\"crayon-i\">cat</span> <span class=\"crayon-v\">urls</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-i\">xargs</span> <span class=\"crayon-v\">wget</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/219b583b1bb3cac2c59130e9bb7e62bf.png\"></p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/fc0b4e63f0d1e1009371efcca207fb23.png\" alt=\"xargs command\" width=\"881\" height=\"119\"></p>\n<p>请你要记得，第一个命令的输出会在 xargs 命令结尾处传递。</p>\n<p>那如果命令需要中间过程的输出，该怎么办呢？这个简单！</p>\n<p>只需要使用 {} 并结合 -i 参数就行了。如下所示，替换在第一个命令的输出应该去的地方的参数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb3e56d8917940939\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nls /etc/*.conf | xargs -i cp {} /home/likegeeks/Desktop/out</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb3e56d8917940939-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb3e56d8917940939-1\"><span class=\"crayon-i\">ls</span> <span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">conf</span> <span class=\"crayon-o\">|</span> <span class=\"crayon-e\">xargs</span> <span class=\"crayon-o\">-</span><span class=\"crayon-e\">i</span> <span class=\"crayon-e\">cp</span> <span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span> <span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">likegeeks</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Desktop</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">out</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>这只是 Linux 命令行技巧其中的几个而已。你可以使用其他命令来做一些更 HAPPY 的事情，比如 awk 命令和 sed 命令！</p>\n<p>如果你知道一些我在这里没有提到的任何其它的极客命令，欢迎评论。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112265\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112265votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112265\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 9 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "Linux 开机引导和启动过程详解", "url": "http://blog.jobbole.com/112277/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 2, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/2/linux-boot-and-startup\">David Both</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8807-1.html\">Linux中国/penghuster</a>   </div><blockquote><p>你是否曾经对操作系统为何能够执行应用程序而感到疑惑？那么本文将为你揭开操作系统引导与启动的面纱。</p></blockquote>\n<p>理解操作系统开机引导和启动过程对于配置操作系统和解决相关启动问题是至关重要的。该文章陈述了 <a href=\"https://en.wikipedia.org/wiki/GNU_GRUB\">GRUB2 引导装载程序</a>开机引导装载内核的过程和 <a href=\"https://en.wikipedia.org/wiki/Systemd\">systemd 初始化系统</a>执行开机启动操作系统的过程。</p>\n<p>事实上，操作系统的启动分为两个阶段：引导boot和启动startup。引导阶段开始于打开电源开关，结束于内核初始化完成和 systemd 进程成功运行。启动阶段接管了剩余工作，直到操作系统进入可操作状态。</p>\n<p>总体来说，Linux 的开机引导和启动过程是相当容易理解，下文将分节对于不同步骤进行详细说明。</p>\n<ul>\n<li>BIOS 上电自检（POST）</li>\n<li>引导装载程序 (GRUB2)</li>\n<li>内核初始化</li>\n<li>启动 systemd，其是所有进程之父。</li>\n</ul>\n<p>注意，本文以 GRUB2 和 systemd 为载体讲述操作系统的开机引导和启动过程，是因为这二者是目前主流的 linux 发行版本所使用的引导装载程序和初始化软件。当然另外一些过去使用的相关软件仍然在一些 Linux 发行版本中使用。</p>\n<h3 id=\"toc_1\">引导过程</h3>\n<p>引导过程能以两种方式之一初始化。其一，如果系统处于关机状态，那么打开电源按钮将开启系统引导过程。其二，如果操作系统已经运行在一个本地用户（该用户可以是 root 或其他非特权用户），那么用户可以借助图形界面或命令行界面通过编程方式发起一个重启操作，从而触发系统引导过程。重启包括了一个关机和重新开始的操作。</p>\n<h4 id=\"toc_2\">BIOS 上电自检（POST）</h4>\n<p>上电自检过程中其实 Linux 没有什么也没做，上电自检主要由硬件的部分来完成，这对于所有操作系统都一样。当电脑接通电源，电脑开始执行 BIOS（基本输入输出系统Basic I/O System）的 POST（上电自检Power On Self Test）过程。</p>\n<p>在 1981 年，IBM 设计的第一台个人电脑中，BIOS 被设计为用来初始化硬件组件。POST 作为 BIOS 的组成部分，用于检验电脑硬件基本功能是否正常。如果 POST 失败，那么这个电脑就不能使用，引导过程也将就此中断。</p>\n<p>BIOS 上电自检确认硬件的基本功能正常，然后产生一个 BIOS <a href=\"https://en.wikipedia.org/wiki/BIOS_interrupt_call\">中断</a> INT 13H，该中断指向某个接入的可引导设备的引导扇区。它所找到的包含有效的引导记录的第一个引导扇区将被装载到内存中，并且控制权也将从引导扇区转移到此段代码。</p>\n<p>引导扇区是引导加载器真正的第一阶段。大多数 Linux 发行版本使用的引导加载器有三种：GRUB、GRUB2 和 LILO。GRUB2 是最新的，也是相对于其他老的同类程序使用最广泛的。</p>\n<h4 id=\"toc_3\">GRUB2</h4>\n<p>GRUB2 全称是 GRand Unified BootLoader，Version 2（第二版大一统引导装载程序）。它是目前流行的大部分 Linux 发行版本的主要引导加载程序。GRUB2 是一个用于计算机寻找操作系统内核并加载其到内存的智能程序。由于 GRUB 这个单词比 GRUB2 更易于书写和阅读，在下文中，除特殊指明以外，GRUB 将代指 GRUB2。</p>\n<p>GRUB 被设计为兼容操作系统<a href=\"https://en.wikipedia.org/wiki/Multiboot_Specification\">多重引导规范</a>，它能够用来引导不同版本的 Linux 和其他的开源操作系统；它还能链式加载专有操作系统的引导记录。</p>\n<p>GRUB 允许用户从任何给定的 Linux 发行版本的几个不同内核中选择一个进行引导。这个特性使得操作系统，在因为关键软件不兼容或其它某些原因升级失败时，具备引导到先前版本的内核的能力。GRUB 能够通过文件 <code>/boot/grub/grub.conf</code> 进行配置。（LCTT 译注：此处指 GRUB1）</p>\n<p>GRUB1 现在已经逐步被弃用，在大多数现代发行版上它已经被 GRUB2 所替换，GRUB2 是在 GRUB1 的基础上重写完成。基于 Red Hat 的发行版大约是在 Fedora 15 和 CentOS/RHEL 7 时升级到 GRUB2 的。GRUB2 提供了与 GRUB1 同样的引导功能，但是 GRUB2 也是一个类似主框架（mainframe）系统上的基于命令行的前置操作系统（Pre-OS）环境，使得在预引导阶段配置更为方便和易操作。GRUB2 通过 <code>/boot/grub2/grub.cfg</code> 进行配置。</p>\n<p>两个 GRUB 的最主要作用都是将内核加载到内存并运行。两个版本的 GRUB 的基本工作方式一致，其主要阶段也保持相同，都可分为 3 个阶段。在本文将以 GRUB2 为例进行讨论其工作过程。GRUB 或 GRUB2 的配置，以及 GRUB2 的命令使用均超过本文范围，不会在文中进行介绍。</p>\n<p>虽然 GRUB2 并未在其三个引导阶段中正式使用这些阶段stage名词，但是为了讨论方便，我们在本文中使用它们。</p>\n<h5 id=\"toc_4\">阶段 1</h5>\n<p>如上文 POST（上电自检）阶段提到的，在 POST 阶段结束时，BIOS 将查找在接入的磁盘中查找引导记录，其通常位于 MBR（主引导记录Master Boot Record），它加载它找到的第一个引导记录中到内存中，并开始执行此代码。引导代码（及阶段 1 代码）必须非常小，因为它必须连同分区表放到硬盘的第一个 512 字节的扇区中。 在<a href=\"https://en.wikipedia.org/wiki/Master_boot_record\">传统的常规 MBR</a> 中，引导代码实际所占用的空间大小为 446 字节。这个阶段 1 的 446 字节的文件通常被叫做引导镜像（boot.img），其中不包含设备的分区信息，分区是一般单独添加到引导记录中。</p>\n<p>由于引导记录必须非常的小，它不可能非常智能，且不能理解文件系统结构。因此阶段 1 的唯一功能就是定位并加载阶段 1.5 的代码。为了完成此任务，阶段 1.5 的代码必须位于引导记录与设备第一个分区之间的位置。在加载阶段 1.5 代码进入内存后，控制权将由阶段 1 转移到阶段 1.5。</p>\n<h5 id=\"toc_5\">阶段 1.5</h5>\n<p>如上所述，阶段 1.5 的代码必须位于引导记录与设备第一个分区之间的位置。该空间由于历史上的技术原因而空闲。第一个分区的开始位置在扇区 63 和 MBR（扇区 0）之间遗留下 62 个 512 字节的扇区（共 31744 字节），该区域用于存储阶段 1.5 的代码镜像 core.img 文件。该文件大小为 25389 字节，故此区域有足够大小的空间用来存储 core.img。</p>\n<p>因为有更大的存储空间用于阶段 1.5，且该空间足够容纳一些通用的文件系统驱动程序，如标准的 EXT 和其它的 Linux 文件系统，如 FAT 和 NTFS 等。GRUB2 的 core.img 远比更老的 GRUB1 阶段 1.5 更复杂且更强大。这意味着 GRUB2 的阶段 2 能够放在标准的 EXT 文件系统内，但是不能放在逻辑卷内。故阶段 2 的文件可以存放于 <code>/boot</code> 文件系统中，一般在 <code>/boot/grub2</code> 目录下。</p>\n<p>注意 <code>/boot</code> 目录必须放在一个 GRUB 所支持的文件系统（并不是所有的文件系统均可）。阶段 1.5 的功能是开始执行存放阶段 2 文件的 <code>/boot</code> 文件系统的驱动程序，并加载相关的驱动程序。</p>\n<h5 id=\"toc_6\">阶段 2</h5>\n<p>GRUB 阶段 2 所有的文件都已存放于 <code>/boot/grub2</code> 目录及其几个子目录之下。该阶段没有一个类似于阶段 1 与阶段 1.5 的镜像文件。相应地，该阶段主要需要从 <code>/boot/grub2/i386-pc</code> 目录下加载一些内核运行时模块。</p>\n<p>GRUB 阶段 2 的主要功能是定位和加载 Linux 内核到内存中，并转移控制权到内核。内核的相关文件位于 <code>/boot</code> 目录下，这些内核文件可以通过其文件名进行识别，其文件名均带有前缀 vmlinuz。你可以列出 <code>/boot</code> 目录中的内容来查看操作系统中当前已经安装的内核。</p>\n<p>GRUB2 跟 GRUB1 类似，支持从 Linux 内核选择之一引导启动。Red Hat 包管理器（DNF）支持保留多个内核版本，以防最新版本内核发生问题而无法启动时，可以恢复老版本的内核。默认情况下，GRUB 提供了一个已安装内核的预引导菜单，其中包括问题诊断菜单（recuse）以及恢复菜单（如果配置已经设置恢复镜像）。</p>\n<p>阶段 2 加载选定的内核到内存中，并转移控制权到内核代码。</p>\n<h4 id=\"toc_7\">内核</h4>\n<p>内核文件都是以一种自解压的压缩格式存储以节省空间，它与一个初始化的内存映像和存储设备映射表都存储于 <code>/boot</code> 目录之下。</p>\n<p>在选定的内核加载到内存中并开始执行后，在其进行任何工作之前，内核文件首先必须从压缩格式解压自身。一旦内核自解压完成，则加载 <a href=\"https://en.wikipedia.org/wiki/Systemd\">systemd</a> 进程（其是老式 System V 系统的 <a href=\"https://en.wikipedia.org/wiki/Init#SysV-style\">init</a> 程序的替代品)，并转移控制权到 systemd。</p>\n<p>这就是引导过程的结束。此刻，Linux 内核和 systemd 处于运行状态，但是由于没有其他任何程序在执行，故其不能执行任何有关用户的功能性任务。</p>\n<h3 id=\"toc_8\">启动过程</h3>\n<p>启动过程紧随引导过程之后，启动过程使 Linux 系统进入可操作状态，并能够执行用户功能性任务。</p>\n<h4 id=\"toc_9\">systemd</h4>\n<p>systemd 是所有进程的父进程。它负责将 Linux 主机带到一个用户可操作状态（可以执行功能任务）。systemd 的一些功能远较旧式 init 程序更丰富，可以管理运行中的 Linux 主机的许多方面，包括挂载文件系统，以及开启和管理 Linux 主机的系统服务等。但是 systemd 的任何与系统启动过程无关的功能均不在此文的讨论范围。</p>\n<p>首先，systemd 挂载在 <code>/etc/fstab</code> 中配置的文件系统，包括内存交换文件或分区。据此，systemd 必须能够访问位于 <code>/etc</code> 目录下的配置文件，包括它自己的。systemd 借助其配置文件 <code>/etc/systemd/system/default.target</code> 决定 Linux 系统应该启动达到哪个状态（或目标态target）。<code>default.target</code> 是一个真实的 target 文件的符号链接。对于桌面系统，其链接到 <code>graphical.target</code>，该文件相当于旧式 systemV init 方式的 <strong>runlevel 5</strong>。对于一个服务器操作系统来说，<code>default.target</code> 更多是默认链接到 <code>multi-user.target</code>， 相当于 systemV 系统的 <strong>runlevel 3</strong>。 <code>emergency.target</code> 相当于单用户模式。</p>\n<p>（LCTT 译注：“target” 是 systemd 新引入的概念，目前尚未发现有官方的准确译名，考虑到其作用和使用的上下文环境，我们认为翻译为“目标态”比较贴切。以及，“unit” 是指 systemd 中服务和目标态等各个对象/文件，在此依照语境译作“单元”。）</p>\n<p>注意，所有的目标态target和服务service均是 systemd 的单元unit。</p>\n<p>如下表 1 是 systemd 启动的目标态target和老版 systemV init 启动运行级别runlevel的对比。这个 <strong>systemd 目标态别名</strong> 是为了 systemd 向前兼容 systemV 而提供。这个目标态别名允许系统管理员（包括我自己）用 systemV 命令（例如 <code>init 3</code>）改变运行级别。当然，该 systemV 命令是被转发到 systemd 进行解释和执行的。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>SystemV 运行级别</th>\n<th>systemd 目标态</th>\n<th>systemd 目标态别名</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td></td>\n<td><code>halt.target</code></td>\n<td></td>\n<td>停止系统运行但不切断电源。</td>\n</tr>\n<tr>\n<td>0</td>\n<td><code>poweroff.target</code></td>\n<td><code>runlevel0.target</code></td>\n<td>停止系统运行并切断电源.</td>\n</tr>\n<tr>\n<td>S</td>\n<td><code>emergency.target</code></td>\n<td></td>\n<td>单用户模式，没有服务进程运行，文件系统也没挂载。这是一个最基本的运行级别，仅在主控制台上提供一个 shell 用于用户与系统进行交互。</td>\n</tr>\n<tr>\n<td>1</td>\n<td><code>rescue.target</code></td>\n<td><code>runlevel1.target</code></td>\n<td>挂载了文件系统，仅运行了最基本的服务进程的基本系统，并在主控制台启动了一个 shell 访问入口用于诊断。</td>\n</tr>\n<tr>\n<td>2</td>\n<td></td>\n<td><code>runlevel2.target</code></td>\n<td>多用户，没有挂载 NFS 文件系统，但是所有的非图形界面的服务进程已经运行。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><code>multi-user.target</code></td>\n<td><code>runlevel3.target</code></td>\n<td>所有服务都已运行，但只支持命令行接口访问。</td>\n</tr>\n<tr>\n<td>4</td>\n<td></td>\n<td><code>runlevel4.target</code></td>\n<td>未使用。</td>\n</tr>\n<tr>\n<td>5</td>\n<td><code>graphical.target</code></td>\n<td><code>runlevel5.target</code></td>\n<td>多用户，且支持图形界面接口。</td>\n</tr>\n<tr>\n<td>6</td>\n<td><code>reboot.target</code></td>\n<td><code>runlevel6.target</code></td>\n<td>重启。</td>\n</tr>\n<tr>\n<td></td>\n<td><code>default.target</code></td>\n<td></td>\n<td>这个目标态target是总是 <code>multi-user.target</code> 或 <code>graphical.target</code> 的一个符号链接的别名。systemd 总是通过 <code>default.target</code> 启动系统。<code>default.target</code> 绝不应该指向 <code>halt.target</code>、 <code>poweroff.target</code> 或 <code>reboot.target</code>。</td>\n</tr>\n</tbody>\n</table>\n<p><em>表 1 老版本 systemV 的 运行级别与 systemd 与目标态target或目标态别名的比较</em></p>\n<p>每个目标态target有一个在其配置文件中描述的依赖集，systemd 需要首先启动其所需依赖，这些依赖服务是 Linux 主机运行在特定的功能级别所要求的服务。当配置文件中所有的依赖服务都加载并运行后，即说明系统运行于该目标级别。</p>\n<p>systemd 也会查看老式的 systemV init 目录中是否存在相关启动文件，若存在，则 systemd 根据这些配置文件的内容启动对应的服务。在 Fedora 系统中，过时的网络服务就是通过该方式启动的一个实例。</p>\n<p>如下图 1 是直接从 bootup 的 man 页面拷贝而来。它展示了在 systemd 启动过程中一般的事件序列和确保成功的启动的基本的顺序要求。</p>\n<p><code>sysinit.target</code> 和 <code>basic.target</code> 目标态可以被视作启动过程中的状态检查点。尽管 systemd 的设计初衷是并行启动系统服务，但是部分服务或功能目标态是其它服务或目标态的启动的前提。系统将暂停于检查点直到其所要求的服务和目标态都满足为止。</p>\n<p><code>sysinit.target</code> 状态的到达是以其所依赖的所有资源模块都正常启动为前提的，所有其它的单元，如文件系统挂载、交换文件设置、设备管理器的启动、随机数生成器种子设置、低级别系统服务初始化、加解密服务启动（如果一个或者多个文件系统加密的话）等都必须完成，但是在 <strong>sysinit.target</strong> 中这些服务与模块是可以并行启动的。</p>\n<p><code>sysinit.target</code> 启动所有的低级别服务和系统初具功能所需的单元，这些都是进入下一阶段 basic.target 的必要前提。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/944467b0a5e4a593baaedea046cb4522.jpg\"></p>\n<p style=\"text-align: center\"><em>图 1：systemd 的启动流程</em></p>\n<p>在 <code>sysinit.target</code> 的条件满足以后，systemd 接下来启动 <code>basic.target</code>，启动其所要求的所有单元。 <code>basic.target</code> 通过启动下一目标态所需的单元而提供了更多的功能，这包括各种可执行文件的目录路径、通信 sockets，以及定时器等。</p>\n<p>最后，用户级目标态（<code>multi-user.target</code> 或 <code>graphical.target</code>） 可以初始化了，应该注意的是 <code>multi-user.target</code> 必须在满足图形化目标态 <code>graphical.target</code> 的依赖项之前先达成。</p>\n<p>图 1 中，以 <code>*</code> 开头的目标态是通用的启动状态。当到达其中的某一目标态，则说明系统已经启动完成了。如果 <code>multi-user.target</code> 是默认的目标态，则成功启动的系统将以命令行登录界面呈现于用户。如果 <code>graphical.target</code> 是默认的目标态，则成功启动的系统将以图形登录界面呈现于用户，界面的具体样式将根据系统所配置的<a href=\"https://opensource.com/article/16/12/yearbook-best-couple-2016-display-manager-and-window-manager\">显示管理器</a>而定。</p>\n<h3 id=\"toc_10\">故障讨论</h3>\n<p>最近我需要改变一台使用 GRUB2 的 Linux 电脑的默认引导内核。我发现一些 GRUB2 的命令在我的系统上不能用，也可能是我使用方法不正确。至今，我仍然不知道是何原因导致，此问题需要进一步探究。</p>\n<p><code>grub2-set-default</code> 命令没能在配置文件 <code>/etc/default/grub</code> 中成功地设置默认内核索引，以至于期望的替代内核并没有被引导启动。故在该配置文件中我手动更改 <code>GRUB_DEFAULT=saved</code> 为 <code>GRUB_DEFAULT=2</code>，2 是我需要引导的安装好的内核文件的索引。然后我执行命令 <code>grub2-mkconfig &gt; /boot/grub2/grub.cfg</code> 创建了新的 GRUB 配置文件，该方法如预期的规避了问题，并成功引导了替代的内核。</p>\n<h3 id=\"toc_11\">结论</h3>\n<p>GRUB2、systemd 初始化系统是大多数现代 Linux 发行版引导和启动的关键组件。尽管在实际中，systemd 的使用还存在一些争议，但是 GRUB2 与 systemd 可以密切地配合先加载内核，然后启动一个业务系统所需要的系统服务。</p>\n<p>尽管 GRUB2 和 systemd 都比其前任要更加复杂，但是它们更加容易学习和管理。在 man 页面有大量关于 systemd 的帮助说明，freedesktop.org 也在线收录了完整的此<a href=\"https://www.freedesktop.org/software/systemd/man/index.html\">帮助说明</a>。下面有更多相关信息链接。</p>\n<h3 id=\"toc_12\">附加资源</h3>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/GNU_GRUB\">GNU GRUB</a> (Wikipedia)</li>\n<li><a href=\"https://www.gnu.org/software/grub/manual/grub.html\">GNU GRUB Manual</a> (GNU.org)</li>\n<li><a href=\"https://en.wikipedia.org/wiki/Master_boot_record\">Master Boot Record</a> (Wikipedia)</li>\n<li><a href=\"https://en.wikipedia.org/wiki/Multiboot_Specification\">Multiboot specification</a> (Wikipedia)</li>\n<li><a href=\"https://en.wikipedia.org/wiki/Systemd\">systemd</a> (Wikipedia)</li>\n<li><a href=\"https://www.freedesktop.org/software/systemd/man/bootup.html\">systemd bootup process</a> (Freedesktop.org)</li>\n<li><a href=\"https://www.freedesktop.org/software/systemd/man/index.html\">systemd index of man pages</a> (Freedesktop.org)</li>\n</ul>\n<hr>\n<p>作者简介：</p>\n<p>David Both 居住在美国北卡罗纳州的首府罗利，是一个 Linux 开源贡献者。他已经从事 IT 行业 40 余年，在 IBM 教授 OS/2 20余年。1981 年，他在 IBM 开发了第一个关于最初的 IBM 个人电脑的培训课程。他也曾在 Red Hat 教授 RHCE 课程，也曾供职于 MCI worldcom，Cico 以及北卡罗纳州等。他已经为 Linux 开源社区工作近 20 年。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112277\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112277votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112277\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "一个时代的结束：Solaris 系统的那些年，那些事", "url": "http://blog.jobbole.com/112268/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/4a1407530d4f2086a8ce08b899773549.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.phoronix.com/scan.php?page=news_item&amp;px=Solaris-2017-Look-Back\">Michael Larabel</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8803-1.html\">Linux中国/MonkeyDEcho</a>   </div><p>现在看来，Oracle 公司正在通过取消 Solaris 12 而终止 Solaris 的功能开发，这里我们要回顾下多年来在 Phoronix 上最受欢迎的 Solaris 重大事件和新闻。</p>\n<p>这里有许多关于 Solaris 的有趣／重要的回忆。<img src=\"../../upload/2017_08/170823192136556.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\"><img class=\"alignnone size-full wp-image-112270\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/93e6343916d6c39535b8e3d60d32842b.jpg\" alt=\"170823192136556\"></p>\n<p>在 Sun Microsystems 时期，我真的对 Solaris 很感兴趣。在 Phoronix 上我们一直重点关注 Linux 的同时，经常也有 Solaris 的文章出现。 Solaris 玩起来很有趣，OpenSolaris／SXCE 是伟大的产物，我将 Phoronix 测试套件移植到 Solaris 上，我们与 Sun Microsystems 人员有密切的联系，也出现在 Sun 的许多活动中。</p>\n<p style=\"text-align: center\"><img class=\"alignnone size-full wp-image-112271\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/1cd3d84a19148210405ea50c5cb700d6.jpg\" alt=\"170823192136551\"></p>\n<p style=\"text-align: center\"><em>在那些日子里 Sun 有一些相当独特的活动…</em></p>\n<p>不幸的是，自从 Oracle 公司收购了 Sun 公司， Solaris 就如坠入深渊一样。最大的打击大概是 Oracle 结束了 OpenSolaris ，并将所有 Solaris 的工作转移到专有模式…<img src=\"../../upload/2017_08/170823192136552.jpg\" alt=\"\"></p>\n<p style=\"text-align: center\"><img class=\"alignnone size-full wp-image-112272\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/8f35c72754a3ff32e7d0a0bbc13f3000.jpg\" alt=\"170823192136552\"></p>\n<p>在 Sun 时代的 Solaris 有很多美好的回忆，所以 Oracle 在其计划中抹去了 Solaris 12 之后，我经常在 Phoronix 上翻回去看一些之前 Solaris 的经典文章，期待着能从 Oracle 听到 “Solaris 11” 下一代的消息，重启 Solaris 项目的开发。</p>\n<p style=\"text-align: center\"><img src=\"../../upload/2017_08/170823192136553.jpg\" alt=\"\"><img class=\"alignnone size-full wp-image-112273\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/afbcf1ab8db3a502f127d7208a1ffd08.jpg\" alt=\"170823192136553\"></p>\n<p>虽然在后 Solaris 的世界中，看到 Oracle 对 ZFS 所做的事情以及他们在基于 RHEL 的 Oracle Enterprise Linux 上下的重注将会很有趣，但时间将会告诉我们一切。</p>\n<p style=\"text-align: center\"><img src=\"../../upload/2017_08/170823192136554.jpg\" alt=\"\"><img class=\"alignnone size-full wp-image-112274\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/8fef927af40aa7f7db5a27dc2d0be68c.jpg\" alt=\"170823192136554\"></p>\n<p>无论如何，这是回顾自 2004 年以来我们最受欢迎的 Solaris 文章：</p>\n<h4 id=\"toc_1\">2016/12/1 Oracle 或许会罐藏 Solaris</h4>\n<p>Oracle 可能正在拔掉 Solaris 的电源插头，据一些新的传闻说。</p>\n<h4 id=\"toc_2\">2013/6/9 OpenSXCE 2013.05 拯救 Solaris 社区</h4>\n<p>作为 Solaris 社区版的社区复兴，OpenSXCE 2013.05 出现在网上。</p>\n<h4 id=\"toc_3\">2013/2/2 Solaris 12 可能最终带来 Radeon KMS 驱动程序</h4>\n<p>看起来，Oracle 可能正在准备发布自己的 AMD Radeon 内核模式设置（KMS）驱动程序，并引入到 Oracle Solaris 12 中。</p>\n<h4 id=\"toc_4\">2012/10/4 Oracle Solaris 11.1 提供 300 个以上增强功能</h4>\n<p>Oracle昨天在旧金山的 Oracle OpenWorld 会议上发布了 Solaris 11.1 。</p>\n<p style=\"text-align: center\"><img src=\"../../upload/2017_08/170823192136555.jpg\" alt=\"\"><img class=\"alignnone size-full wp-image-112275\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/4a1407530d4f2086a8ce08b899773549.jpg\" alt=\"170823192136555\"></p>\n<h4 id=\"toc_5\">2012/1/9 Oracle 尚未澄清 Solaris 11 内核来源</h4>\n<p>一个月前，Phoronix 是第一个注意到 Solaris 11 内核源代码通过 Torrent 站点泄漏到网上的信息。一个月后，甲骨文还没有正式评论这个情况。</p>\n<h4 id=\"toc_6\">2011/12/19 Oracle Solaris 11 内核源代码泄漏</h4>\n<p>似乎 Solaris 11的内核源代码在过去的一个周末被泄露到了网上。</p>\n<h4 id=\"toc_7\">2011/8/25 对于 BSD，Solaris 的 GPU 驱动程序的悲惨状态</h4>\n<p>昨天在邮件列表上出现了关于干掉所有旧式 Mesa 驱动程序的讨论。这些旧驱动程序没有被积极维护，支持复古的图形处理器，并且没有更新支持新的 Mesa 功能。英特尔和其他开发人员正在努力清理 Mesa 核心，以将来增强这一开源图形库。这种清理 Mesa，对 BSD 和 Solaris 用户也有一些影响。</p>\n<h4 id=\"toc_8\">2010/8/13 告别 OpenSolaris，Oracle 刚刚把它干掉</h4>\n<p>Oracle 终于宣布了他们对 Solaris 操作系统和 OpenSolaris 平台的计划，而且不是好消息。OpenSolaris 将实际死亡，未来将不会有更多的 Solaris 版本出现 – 包括长期延期的 2010 年版本。Solaris 仍然会继续存在，现在 Oracle 正在忙于明年发布的 Solaris 11，但仅在 Oracle 的企业版之后才会发布 “Solaris 11 Express” 作为 OpenSolaris 的类似产品。</p>\n<h4 id=\"toc_9\">2010/2/22 Oracle 仍然要对 OpenSolaris 进行更改</h4>\n<p>自从 Oracle 完成对 Sun Microsystems 的收购以来，已经有了许多变化，这个 Sun 最初支持的开源项目现在已经不再被 Oracle 支持，并且对其余的开源产品进行了重大改变。 Oracle 表现出并不太开放的意图的开源项目之一是 OpenSolaris 。 Solaris Express 社区版（SXCE）上个月已经关闭，并且也没有预计 3 月份发布的下一个 OpenSolaris 版本（OpenSolaris 2010.03）的信息流出。</p>\n<h4 id=\"toc_10\">2007/9/10 Solaris Express 社区版 Build 72</h4>\n<p>对于那些想要在 “印第安纳项目” 发布之前尝试 OpenSolaris 软件中最新最好的软件的人来说，现在可以使用 Solaris Express 社区版 Build 72。Solaris Express 社区版（SXCE）Build 72 可以从 OpenSolaris.org 下载。同时，预计将在下个月推出 Sun 的 “印第安纳项目” 项目的预览版。</p>\n<h4 id=\"toc_11\">2007/9/6 ATI R500/600 驱动要支持 Solaris 了?</h4>\n<p>虽然没有可用于 Solaris/OpenSolaris 或 * BSD 的 ATI fglrx 驱动程序，现在 AMD 将向 X.Org 开发人员和开源驱动程序交付规范，但对于任何使用 ATI 的 Radeon X1000 “R500” 或者 HD 2000“R600” 系列的 Solaris 用户来说，这肯定是有希望的。将于下周发布的开源 X.Org 驱动程序距离成熟尚远，但应该能够相对容易地移植到使用 X.Org 的 Solaris 和其他操作系统上。 AMD 今天宣布的针对的是 Linux 社区，但它也可以帮助使用 ATI 硬件的 Solaris/OpenSolaris 用户。特别是随着印第安纳项目的即将推出，开源 R500/600 驱动程序移植就只是时间问题了。</p>\n<h4 id=\"toc_12\">2007/9/5 Solaris Express 社区版 Build 71</h4>\n<p>Solaris Express 社区版（SXCE）现已推出 Build 71。您可以在 OpenSolaris.org 中找到有关 Solaris Express 社区版 Build 71 的更多信息。另外，在 Linux 内核峰会上，AMD 将提供 GPU 规格的消息，由此产生的 X.Org 驱动程序将来可能会导致 ATI 硬件上 Solaris/OpenSolaris 有所改善。</p>\n<h4 id=\"toc_13\">2007/8/27 Linux 的 Solaris 容器</h4>\n<p>Sun Microsystems 已经宣布，他们将很快支持适用于 Linux 应用程序的 Solaris 容器。这样可以在 Solaris 下运行 Linux 应用程序，而无需对二进制包进行任何修改。适用于 Linux 的 Solaris 容器将允许从 Linux 到 Solaris 的平滑迁移，协助跨平台开发以及其他优势。当该支持到来时，这个时代就“快到了”。</p>\n<h4 id=\"toc_14\">2007/8/23 OpenSolaris 开发者峰会</h4>\n<p>今天早些时候在 OpenSolaris 论坛上发布了第一次 OpenSolaris 开发人员峰会的消息。这次峰会将在十月份在加州大学圣克鲁斯分校举行。 Sara Dornsife 将这次峰会描述为“不是与演示文稿或参展商举行会议，而是一个亲自参与的协作工作会议，以计划下一期的印第安纳项目。” 伊恩·默多克（Ian Murdock） 将在这个“印第安纳项目”中进行主题演讲，但除此之外，该计划仍在计划之中。 Phoronix 可能会继续跟踪此事件，您可以在 Solaris 论坛上讨论此次峰会。</p>\n<h4 id=\"toc_15\">2007/8/18 Solaris Express 社区版 Build 70</h4>\n<p>名叫 “Nevada” 的 Solaris Express 社区版 Build 70 (SXCE snv_70) 现在已经发布。有关下载链接的通知可以在 OpenSolaris 论坛中找到。还有公布了其网络存储的 Build 71 版本，包括来自 Qlogic 的光纤通道 HBA 驱动程序的源代码。</p>\n<h4 id=\"toc_16\">2007/8/16 IBM 使用 Sun Solaris 的系统</h4>\n<p>Sun Microsystems 和 IBM正在举行电话会议，他们刚刚宣布，IBM 将开始在服务器上使用 Sun 的 Solaris 操作系统。这些 IBM 服务器包括基于 x86 的服务器系统以及 Blade Center 服务器。官方新闻稿刚刚发布，可以在 sun 新闻室阅读。</p>\n<h4 id=\"toc_17\">2007/8/9 OpenSolaris 不会与 Linux 合并</h4>\n<p>在旧金山的 LinuxWorld 2007 上，Andrew Morton 在主题演讲中表示， OpenSolaris 的关键组件不会出现在 Linux 内核中。事实上，莫顿甚至表示 “非常遗憾 OpenSolaris 活着”。OpenSolaris 的一些关键组件包�� Zones、ZFS 和 DTrace 。虽然印第安纳州项目有可能将这些项目转变为 GPLv3 项目… 更多信息参见 ZDNET。</p>\n<h4 id=\"toc_18\">2007/7/27 Solaris Xen 已经更新</h4>\n<p>已经有一段时间了，Solaris Xen 终于更新了。约翰·莱文（John Levon）表示，这一最新版本基于 Xen 3.0.4 和 Solaris “Nevada” Build 66。这一最新版本的改进包括 PAE 支持、HVM 支持、新的 virt-manager 工具、改进的调试支持以及管理域支持。可以在 Sun 的网站上找到 2007 年 7 月 Solaris Xen 更新的下载。</p>\n<h4 id=\"toc_19\">2007/7/25 Solaris 10 7/07 HW 版本</h4>\n<p>Solaris 10 7/07 HW 版本的文档已经上线。如 Solaris 发行注记中所述，Solaris 10 7/07 仅适用于 SPARC Enterprise M4000-M9000 服务器，并且没有 x86/x64 版本可用。所有平台的最新 Solaris 更新是 Solaris 10 11/06 。您可以在 Phoronix 论坛中讨论 Solaris 7/07。</p>\n<h4 id=\"toc_20\">2007/7/16 来自英特尔的 Solaris 电信服务器</h4>\n<p>今天宣布推出符合 NEBS、ETSI 和 ATCA 合规性的英特尔体系的 Sun Solaris 电信机架服务器和刀片服务器。在这些新的运营商级平台中，英特尔运营商级机架式服务器 TIGW1U 支持 Linux 和 Solaris 10，而 Intel NetStructure MPCBL0050 SBC 也将支持这两种操作系统。今天的新闻稿可以在这里阅读。</p>\n<p>然后是 Solaris 分类中最受欢迎的特色文章：</p>\n<h4 id=\"toc_21\">Ubuntu vs. OpenSolaris vs. FreeBSD 基准测试</h4>\n<p>在过去的几个星期里，我们提供了几篇关于 Ubuntu Linux 性能的深入文章。我们已经开始提供 Ubuntu 7.04 到 8.10 的基准测试，并且发现这款受欢迎的 Linux 发行版的性能随着时间的推移而变慢，随之而来的是 Mac OS X 10.5 对比 Ubuntu 8.10 的基准测试和其他文章。在本文中，我们正在比较 Ubuntu 8.10 的 64 位性能与 OpenSolaris 2008.11 和 FreeBSD 7.1 的最新测试版本。</p>\n<h4 id=\"toc_22\">NVIDIA 的性能：Windows vs. Linux vs. Solaris</h4>\n<p>本周早些时候，我们预览了 Quadro FX1700，它是 NVIDIA 的中端工作站显卡之一，基于 G84GL 内核，而 G84GL 内核又源于消费级 GeForce 8600 系列。该 PCI Express 显卡提供 512MB 的视频内存，具有两个双链路 DVI 连接，并支持 OpenGL 2.1 ，同时保持最大功耗仅为 42 瓦。正如我们在预览文章中提到的，我们将不仅在 Linux 下查看此显卡的性能，还要在 Microsoft Windows 和 Sun 的 Solaris 中测试此工作站解决方案。在今天的这篇文章中，我们正在这样做，因为我们测试了 NVIDIA Quadro FX1700 512MB 与这些操作系统及其各自的二进制显示驱动程序。</p>\n<h4 id=\"toc_23\">FreeBSD 8.0 对比 Linux、OpenSolaris</h4>\n<p>在 FreeBSD 8.0 的稳定版本发布的上周，我们终于可以把它放在测试台上，并用 Phoronix 测试套件进行了全面的了解。我们将 FreeBSD 8.0 的性能与早期的 FreeBSD 7.2 版本以及 Fedora 12 和 Ubuntu 9.10 还有 Sun OS 端的 OpenSolaris 2010.02 b127 快照进行了比较。</p>\n<h4 id=\"toc_24\">Fedora、Debian、FreeBSD、OpenBSD、OpenSolaris 基准测试</h4>\n<p>上周我们发布了第一个 Debian GNU/kFreeBSD 基准测试，将 FreeBSD 内核捆绑在 Debian GNU 用户的 Debian GNU/Linux 上，比较了这款 Debian 系统的 32 位和 64 位性能。 我们现在扩展了这个比较，使许多其他操作系统与 Debian GNU/Linux 和 Debian GNU/kFreeBSD 的 6.0 Squeeze 快照直接进行比较，如 Fedora 12，FreeBSD 7.2，FreeBSD 8.0，OpenBSD 4.6 和 OpenSolaris 2009.06 。</p>\n<h4 id=\"toc_25\">AMD 上海皓龙：Linux vs. OpenSolaris 基准测试</h4>\n<p>1月份，当我们研究了四款皓龙 2384 型号时，我们在 Linux 上发布了关于 AMD 上海皓龙 CPU 的综述。与早期的 AMD 巴塞罗那处理器 Ubuntu Linux 相比，这些 45nm 四核工作站服务器处理器的性能非常好，但是在运行 Sun OpenSolaris 操作系统时，性能如何？今天浏览的是 AMD 双核的基准测试，运行 OpenSolaris 2008.11、Ubuntu 8.10 和即将推出的 Ubuntu 9.04 版本。</p>\n<h4 id=\"toc_26\">OpenSolaris vs. Linux 内核基准</h4>\n<p>本周早些时候，我们提供了 Ubuntu 9.04 与 Mac OS X 10.5.6 的基准测试，发现 Leopard 操作系统（Mac）在大多数测试中的表现要优于 Jaunty Jackalope （Ubuntu），至少在 Ubuntu 32 位是这样的。我们今天又回过来进行更多的操作系统基准测试，但这次我们正在比较 Linux 和 Sun OpenSolaris 内核的性能。我们使用的 Nexenta Core 2 操作系统将 OpenSolaris 内核与 GNU/Ubuntu 用户界面组合在同一个 Ubuntu 软件包中，但使用了 Linux 内核的 32 位和 64 位 Ubuntu 服务器安装进行测试。</p>\n<h4 id=\"toc_27\">Netbook 性能：Ubuntu vs. OpenSolaris</h4>\n<p>过去，我们已经发布了 OpenSolaris vs. Linux Kernel 基准测试以及类似的文章，关注 Sun 的 OpenSolaris 与流行的 Linux 发行版的性能。我们已经看过高端 AMD 工作站的性能，但是我们从来没有比较上网本上的 OpenSolaris 和 Linux 性能。直到今天，在本文中，我们将比较戴尔 Inspiron Mini 9 上网本上的 OpenSolaris 2009.06 和 Ubuntu 9.04 的结果。</p>\n<h4 id=\"toc_28\">NVIDIA 图形：Linux vs. Solaris</h4>\n<p>在 Phoronix，我们不断探索 Linux 下的不同显示驱动程序，在我们评估了 Sun 的检查工具并测试了 Solaris 主板以及覆盖其他几个领域之后，我们还没有执行图形驱动程序 Linux 和 Solaris 之间的比较。直到今天。由于印第安纳州项目，我们对 Solaris 更感兴趣，我们决定终于通过 NVIDIA 专有驱动程序提供我们在 Linux 和 Solaris 之间的第一次定量图形比较。</p>\n<h4 id=\"toc_29\">OpenSolaris 2008.05 向 Solaris 提供了一个新面孔</h4>\n<p>2月初，Sun Microsystems 发布了印第安纳项目的第二个预览版本。对于那些人来说，印第安纳州项目是 Sun 的 Ian Murdock 领导的项目的代号，旨在通过解决 Solaris 的长期可用性问题，将 OpenSolaris 推向更多的台式机和笔记本电脑。我们没有对预览 2 留下什么深刻印象，因为它没有比普通用户感兴趣的 GNU/Linux 桌面更有优势。然而，随着 5 月份推出的 OpenSolaris 2008.05 印第安纳项目发布，Sun Microsystems 今天发布了该操作系统的最终测试副本。当最后看到项目印第安纳时， 我们对这个新的 OpenSolaris 版本的最初体验是远远优于我们不到三月前的体验的。</p>\n<h4 id=\"toc_30\">快速概览 Oracle Solaris 11</h4>\n<p>Solaris 11 在周三发布，是七年来这个前 Sun 操作系统的第一个主要更新。在过去七年中，Solaris 家族发生了很大变化，OpenSolaris 在那个时候已经到来，但在本文中，简要介绍了全新的 Oracle Solaris 11 版本。</p>\n<h4 id=\"toc_31\">OpenSolaris、BSD &amp; Linux 的新基准测试</h4>\n<p>今天早些时候，我们对以原生的内核模块支持的 Linux 上的 ZFS 进行了基准测试，该原生模块将被公开提供，以将这个 Sun/Oracle 文件系统覆盖到更多的 Linux 用户。现在，尽管作为一个附加奖励，我们碰巧有了基于 OpenSolaris 的最新发行版的新基准，包括 OpenSolaris、OpenIndiana 和 Augustiner-Schweinshaxe，与 PC-BSD、Fedora 和 Ubuntu相比。</p>\n<h4 id=\"toc_32\">FreeBSD/PC-BSD 9.1 针对 Linux、Solaris、BSD 的基准</h4>\n<p>虽然 FreeBSD 9.1 尚未正式发布，但是基于 FreeBSD 的 PC-BSD 9.1 “Isotope”版本本月已经可用。本文中的性能指标是 64 位版本的 PC-BSD 9.1 与 DragonFlyBSD 3.0.3、Oracle Solaris Express 11.1、CentOS 6.3、Ubuntu 12.10 以及 Ubuntu 13.04 开发快照的比较。</p>\n<hr>\n<p>作者简介：</p>\n<p>Michael Larabel 是 Phoronix.com 的作者，并于 2004 年创立了该网站，该网站重点是丰富多样的 Linux 硬件体验。 Michael 撰写了超过10,000 篇文章，涵盖了 Linux 硬件支持，Linux 性能，图形驱动程序等主题。 Michael 也是 Phoronix 测试套件、 Phoromatic 和 OpenBenchmarking.org 自动化基准测试软件的主要开发人员。可以通过 Twitter 关注他或通过 MichaelLarabel.com 联系他。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112268\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112268votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112268\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "Linux 包管理基础：apt、yum、dnf 和 pkg", "url": "http://blog.jobbole.com/112219/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/05/77d80105fd15f2465894827e23cc4842.jpeg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 10, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://www.digitalocean.com/community/tutorials/package-management-basics-apt-yum-dnf-pkg\">Brennen Bearnes</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8782-1.html\">Linux中国/Snapcrafter</a>   </div><h3 id=\"toc_1\">介绍</h3>\n<p>大多数现代的类 Unix 操作系统都提供了一种中心化的机制用来搜索和安装软件。软件通常都是存放在存储库中，并通过包的形式进行分发。处理包的工作被称为包管理。包提供了操作系统的基本组件，以及共享的库、应用程序、服务和文档。</p>\n<p>包管理系统除了安装软件外，它还提供了工具来更新已经安装的包。包存储库有助于确保你的系统中使用的代码是经过审查的，并且软件的安装版本已经得到了开发人员和包维护人员的认可。</p>\n<p>在配置服务器或开发环境时，我们最好了解下包在官方存储库之外的情况。某个发行版的稳定版本中的包有可能已经过时了，尤其是那些新的或者快速迭代的软件。然而，包管理无论对于系统管理员还是开发人员来说都是至关重要的技能，而已打包的软件对于主流 Linux 发行版来说也是一笔巨大的财富。</p>\n<p>本指南旨在快速地介绍下在多种 Linux 发行版中查找、安装和升级软件包的基础知识，并帮助您将这些内容在多个系统之间进行交叉对比。</p>\n<h3 id=\"toc_2\">包管理系统：简要概述</h3>\n<p>大多数包系统都是围绕包文件的集合构建的。包文件通常是一个存档文件，它包含已编译的二进制文件和软件的其他资源，以及安装脚本。包文件同时也包含有价值的元数据，包括它们的依赖项，以及安装和运行它们所需的其他包的列表。</p>\n<p>虽然这些包管理系统的功能和优点大致相同，但打包格式和工具却因平台而异：</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>操作系统</th>\n<th>格式</th>\n<th>工具</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian</td>\n<td><code>.deb</code></td>\n<td><code>apt</code>, <code>apt-cache</code>, <code>apt-get</code>, <code>dpkg</code></td>\n</tr>\n<tr>\n<td>Ubuntu</td>\n<td><code>.deb</code></td>\n<td><code>apt</code>, <code>apt-cache</code>, <code>apt-get</code>, <code>dpkg</code></td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>.rpm</code></td>\n<td><code>yum</code></td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>.rpm</code></td>\n<td><code>dnf</code></td>\n</tr>\n<tr>\n<td>FreeBSD</td>\n<td>Ports, <code>.txz</code></td>\n<td><code>make</code>, <code>pkg</code></td>\n</tr>\n</tbody>\n</table>\n<p>Debian 及其衍生版，如 Ubuntu、Linux Mint 和 Raspbian，它们的包格式是 <code>.deb</code>。APT 这款先进的包管理工具提供了大多数常见的操作命令：搜索存储库、安装软件包及其依赖项，并管理升级。在本地系统中，我们还可以使用 <code>dpkg</code> 程序来安装单个的 <code>deb</code> 文件，APT 命令作为底层 <code>dpkg</code> 的前端，有时也会直接调用它。</p>\n<p>最近发布的 debian 衍生版大多数都包含了 <code>apt</code> 命令，它提供了一个简洁统一的接口，可用于通常由 <code>apt-get</code> 和 <code>apt-cache</code> 命令处理的常见操作。这个命令是可选的，但使用它可以简化一些任务。</p>\n<p>CentOS、Fedora 和其它 Red Hat 家族成员使用 RPM 文件。在 CentOS 中，通过 <code>yum</code> 来与单独的包文件和存储库进行交互。</p>\n<p>在最近的 Fedora 版本中，<code>yum</code> 已经被 <code>dnf</code> 取代，<code>dnf</code> 是它的一个现代化的分支，它保留了大部分 <code>yum</code> 的接口。</p>\n<p>FreeBSD 的二进制包系统由 <code>pkg</code> 命令管理。FreeBSD 还提供了 <code>Ports</code> 集合，这是一个存在于本地的目录结构和工具，它允许用户获取源码后使用 Makefile 直接从源码编译和安装包。</p>\n<h3 id=\"toc_3\">更新包列表</h3>\n<p>大多数系统在本地都会有一个和远程存储库对应的包数据库，在安装或升级包之前最好更新一下这个数据库。另外，<code>yum</code> 和 <code>dnf</code> 在执行一些操作之前也会自动检查更新。当然你可以在任何时候对系统进行更新。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>sudo apt-get update</code></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt update</code></td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>yum check-update</code></td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>dnf check-update</code></td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>sudo pkg update</code></td>\n</tr>\n<tr>\n<td>FreeBSD Ports</td>\n<td><code>sudo portsnap fetch update</code></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_4\">更新已安装的包</h3>\n<p>在没有包系统的情况下，想确保机器上所有已安装的软件都保持在最新的状态是一个很艰巨的任务。你将不得不跟踪数百个不同包的上游更改和安全警报。虽然包管理器并不能解决升级软件时遇到的所有问题，但它确实使你能够使用一些命令来维护大多数系统组件。</p>\n<p>在 FreeBSD 上，升级已安装的 ports 可能会引入破坏性的改变，有些步骤还需要进行手动配置，所以在通过 <code>portmaster</code> 更新之前最好阅读下 <code>/usr/ports/UPDATING</code> 的内容。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>sudo apt-get upgrade</code></td>\n<td>只更新已安装的包</td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt-get dist-upgrade</code></td>\n<td>可能会增加或删除包以满足新的依赖项</td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt upgrade</code></td>\n<td>和 <code>apt-get upgrade</code> 类似</td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt full-upgrade</code></td>\n<td>和 <code>apt-get dist-upgrade</code> 类似</td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>sudo yum update</code></td>\n<td></td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>sudo dnf upgrade</code></td>\n<td></td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>sudo pkg upgrade</code></td>\n<td></td>\n</tr>\n<tr>\n<td>FreeBSD Ports</td>\n<td><code>less /usr/ports/UPDATING</code></td>\n<td>使用 <code>less</code> 来查看 ports 的更新提示（使用上下光标键滚动，按 q 退出）。</td>\n</tr>\n<tr>\n<td></td>\n<td><code>cd /usr/ports/ports-mgmt/portmaster &amp;&amp; sudo make install &amp;&amp; sudo portmaster -a</code></td>\n<td>安装 <code>portmaster</code> 然后使用它更新已安装的 ports</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_5\">搜索某个包</h3>\n<p>大多数发行版都提供针对包集合的图形化或菜单驱动的工具，我们可以分类浏览软件，这也是一个发现新软件的好方法。然而，查找包最快和最有效的方法是使用命令行工具进行搜索。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>apt-cache search search_string</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>apt search search_string</code></td>\n<td></td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>yum search search_string</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>yum search all search_string</code></td>\n<td>搜索所有的字段，包括描述</td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>dnf search search_string</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>dnf search all search_string</code></td>\n<td>搜索所有的字段，包括描述</td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>pkg search search_string</code></td>\n<td>通过名字进行搜索</td>\n</tr>\n<tr>\n<td></td>\n<td><code>pkg search -f search_string</code></td>\n<td>通过名字进行搜索并返回完整的描述</td>\n</tr>\n<tr>\n<td></td>\n<td><code>pkg search -D search_string</code></td>\n<td>搜索描述</td>\n</tr>\n<tr>\n<td>FreeBSD Ports</td>\n<td><code>cd /usr/ports &amp;&amp; make search name=package</code></td>\n<td>通过名字进行搜索</td>\n</tr>\n<tr>\n<td></td>\n<td><code>cd /usr/ports &amp;&amp; make search key=search_string</code></td>\n<td>搜索评论、描述和依赖</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_6\">查看某个软件包的信息</h3>\n<p>在安装软件包之前，我们可以通过仔细阅读包的描述来获得很多有用的信息。除了人类可读的文本之外，这些内容通常包括像版本号这样的元数据和包的依赖项列表。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>apt-cache show package</code></td>\n<td>显示有关包的本地缓存信息</td>\n</tr>\n<tr>\n<td></td>\n<td><code>apt show package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>dpkg -s package</code></td>\n<td>显示包的当前安装状态</td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>yum info package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>yum deplist package</code></td>\n<td>列出包的依赖</td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>dnf info package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>dnf repoquery --requires package</code></td>\n<td>列出包的依赖</td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>pkg info package</code></td>\n<td>显示已安装的包的信息</td>\n</tr>\n<tr>\n<td>FreeBSD Ports</td>\n<td><code>cd /usr/ports/category/port &amp;&amp; cat pkg-descr</code></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_7\">从存储库安装包</h3>\n<p>知道包名后，通常可以用一个命令来安装它及其依赖。你也可以一次性安装多个包，只需将它们全部列出来即可。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>sudo apt-get install package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt-get install package1 package2 ...</code></td>\n<td>安装所有列出来的包</td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt-get install -y package</code></td>\n<td>在 <code>apt</code> 提示是否继续的地方直接默认 <code>yes</code></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt install package</code></td>\n<td>显示一个彩色的进度条</td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>sudo yum install package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo yum install package1 package2 ...</code></td>\n<td>安装所有列出来的包</td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo yum install -y package</code></td>\n<td>在 <code>yum</code> 提示是否继续的地方直接默认 <code>yes</code></td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>sudo dnf install package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo dnf install package1 package2 ...</code></td>\n<td>安装所有列出来的包</td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo dnf install -y package</code></td>\n<td>在 <code>dnf</code> 提示是否继续的地方直接默认 <code>yes</code></td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>sudo pkg install package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo pkg install package1 package2 ...</code></td>\n<td>安装所有列出来的包</td>\n</tr>\n<tr>\n<td>FreeBSD Ports</td>\n<td><code>cd /usr/ports/category/port &amp;&amp; sudo make install</code></td>\n<td>从源码构建安装一个 port</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_8\">从本地文件系统安装一个包</h3>\n<p>对于一个给定的操作系统，有时有些软件官方并没有提供相应的包，那么开发人员或供应商将需要提供包文件的下载。你通常可以通过 web 浏览器检索这些包，或者通过命令行 <code>curl</code> 来检索这些信息。将包下载到目标系统后，我们通常可以通过单个命令来安装它。</p>\n<p>在 Debian 派生的系统上，<code>dpkg</code> 用来处理单个的包文件。如果一个包有未满足的依赖项，那么我们可以使用 <code>gdebi</code> 从官方存储库中检索它们。</p>\n<p>在 CentOS 和 Fedora 系统上，<code>yum</code> 和 <code>dnf</code> 用于安装单个的文件，并且会处理需要的依赖。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>sudo dpkg -i package.deb</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt-get install -y gdebi &amp;&amp; sudo gdebi package.deb</code></td>\n<td>安装 <code>gdebi</code>，然后使用 <code>gdebi</code> 安装 <code>package.deb</code> 并处理缺失的依赖</td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>sudo yum install package.rpm</code></td>\n<td></td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>sudo dnf install package.rpm</code></td>\n<td></td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>sudo pkg add package.txz</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo pkg add -f package.txz</code></td>\n<td>即使已经安装的包也会重新安装</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_9\">删除一个或多个已安装的包</h3>\n<p>由于包管理器知道给定的软件包提供了哪些文件，因此如果某个软件不再需要了，它通常可以干净利落地从系统中清除这些文件。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>sudo apt-get remove package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt remove package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo apt-get autoremove</code></td>\n<td>删除不需要的包</td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>sudo yum remove package</code></td>\n<td></td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>sudo dnf erase package</code></td>\n<td></td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>sudo pkg delete package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>sudo pkg autoremove</code></td>\n<td>删除不需要的包</td>\n</tr>\n<tr>\n<td>FreeBSD Ports</td>\n<td><code>sudo pkg delete package</code></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><code>cd /usr/ports/path_to_port &amp;&amp; make deinstall</code></td>\n<td>卸载 port</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_10\"><code>apt</code> 命令</h3>\n<p>Debian 家族发行版的管理员通常熟悉 <code>apt-get</code> 和 <code>apt-cache</code>。较少为人所知的是简化的 <code>apt</code> 接口，它是专为交互式使用而设计的。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>传统命令</th>\n<th>等价的 <code>apt</code> 命令</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>apt-get update</code></td>\n<td><code>apt update</code></td>\n</tr>\n<tr>\n<td><code>apt-get dist-upgrade</code></td>\n<td><code>apt full-upgrade</code></td>\n</tr>\n<tr>\n<td><code>apt-cache search string</code></td>\n<td><code>apt search string</code></td>\n</tr>\n<tr>\n<td><code>apt-get install package</code></td>\n<td><code>apt install package</code></td>\n</tr>\n<tr>\n<td><code>apt-get remove package</code></td>\n<td><code>apt remove package</code></td>\n</tr>\n<tr>\n<td><code>apt-get purge package</code></td>\n<td><code>apt purge package</code></td>\n</tr>\n</tbody>\n</table>\n<p>虽然 <code>apt</code> 通常是一个特定操作的快捷方式，但它并不能完全替代传统的工具，它的接口可能会随着版本的不同而发生变化，以提高可用性。如果你在脚本或 shell 管道中使用包管理命令，那么最好还是坚持使用 <code>apt-get</code> 和 <code>apt-cache</code>。</p>\n<h3 id=\"toc_11\">获取帮助</h3>\n<p>除了基于 web 的文档，请记住我们可以通过 shell 从 Unix 手册页（通常称为 man 页面）中获得大多数的命令。比如要阅读某页，可以使用 <code>man</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cbb29d178513054627\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nman page\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cbb29d178513054627-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cbb29d178513054627-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cbb29d178513054627-1\"><span class=\"crayon-e\">man </span><span class=\"crayon-i\">page</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cbb29d178513054627-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>在 <code>man</code> 中，你可以用箭头键导航。按 <code>/</code> 搜索页面内的文本，使用 <code>q</code> 退出。</p>\n<table cellpadding=\"4\">\n<thead>\n<tr>\n<th>系统</th>\n<th>命令</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Debian / Ubuntu</td>\n<td><code>man apt-get</code></td>\n<td>更新本地包数据库以及与包一起工作</td>\n</tr>\n<tr>\n<td></td>\n<td><code>man apt-cache</code></td>\n<td>在本地的包数据库中搜索</td>\n</tr>\n<tr>\n<td></td>\n<td><code>man dpkg</code></td>\n<td>和单独的包文件一起工作以及能查询已安装的包</td>\n</tr>\n<tr>\n<td></td>\n<td><code>man apt</code></td>\n<td>通过更简洁，用户友好的接口进行最基本的操作</td>\n</tr>\n<tr>\n<td>CentOS</td>\n<td><code>man yum</code></td>\n<td></td>\n</tr>\n<tr>\n<td>Fedora</td>\n<td><code>man dnf</code></td>\n<td></td>\n</tr>\n<tr>\n<td>FreeBSD Packages</td>\n<td><code>man pkg</code></td>\n<td>和预先编译的二进制包一起工作</td>\n</tr>\n<tr>\n<td>FreeBSD Ports</td>\n<td><code>man ports</code></td>\n<td>和 Ports 集合一起工作</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"toc_12\">结论和进一步的阅读</h3>\n<p>本指南通过对多个系统间进行交叉对比概述了一下包管理系统的基本操作，但只涉及了这个复杂主题的表面。对于特定系统更详细的信息，可以参考以下资源：</p>\n<ul>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/ubuntu-and-debian-package-management-essentials\">这份指南</a> 详细介绍了 Ubuntu 和 Debian 的软件包管理。</li>\n<li>这里有一份 CentOS 官方的指南 <a href=\"https://www.centos.org/docs/5/html/yum/\">使用 yum 管理软件</a></li>\n<li>这里有一个有关 Fedora 的 <code>dnf</code> 的 <a href=\"https://fedoraproject.org/wiki/Dnf\">wifi 页面</a> 以及一份有关 <code>dnf</code> <a href=\"https://dnf.readthedocs.org/en/latest/index.html\">官方的手册</a></li>\n<li><a href=\"https://www.digitalocean.com/community/tutorials/how-to-manage-packages-on-freebsd-10-1-with-pkg\">这份指南</a> 讲述了如何使用 <code>pkg</code> 在 FreeBSD 上进行包管理</li>\n<li>这本 <a href=\"https://www.freebsd.org/doc/handbook/\">FreeBSD Handbook</a> 有一节讲述了<a href=\"https://www.freebsd.org/doc/handbook/ports-using.html\">如何使用 Ports 集合</a></li>\n</ul>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112219\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112219votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112219\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 10 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "6 个理由，为什么 GNOME 仍然是最好的 Linux 桌面环境", "url": "http://blog.jobbole.com/112167/", "front_image_url": ["http://wx1.sinaimg.cn/mw690/7cc829d3gy1filbc2mwdfj218g0nywhd.jpg"], "praise_nums": "1", "comment_nums": 1, "fav_nums": 5, "tags": "IT技术,GNOME,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/8/reasons-i-come-back-gnome\">Jay LaCroix</a>   译文出处：<a target=\"_blank\" href=\"https://my.oschina.net/editorial-story/blog/1510722\">开源中国</a>   </div><p>摘要: 一位资深 Linux 用户告诉你为什么 GNOME 仍然是最好的 Linux 桌面环境</p>\n<p><img class=\"alignnone\" src=\"http://wx1.sinaimg.cn/mw690/7cc829d3gy1filbc2mwdfj218g0nywhd.jpg\" width=\"690\" height=\"372\"></p>\n<blockquote><p>关于本文作者 Jay LaCroix</p>\n<p>Jay LaCroix 是来自密歇根州的技术专家，专注于 Linux 和开源软件。自 2002 年使用 Linux 以来，Jay 一直是它的“死忠粉”。他目前是云计算系统工程师和自由的咨询顾问，乐于教授他人使用 Linux，以充分利用这个优秀的系统。在空闲时间，Jay 会撰写图书，他是 Linux Mint Essentials, Mastering Linux Network Administration 这些书的作者，最近他成为了 Ubuntu Server 的会员。</p></blockquote>\n<p>我使用 Linux 大概已经有 15 年的时间了，在这期间一直都在尝试使用各种桌面环境。在我职业生涯的大部分时间里，我一直是一个坚定的 KDE Plasma 用户（从 2.x 版开始使用），一直坚持使用 Plasma 至 4.x 系列的大部分版本，最终由于稳定性问题，选择了迁移到其他的桌面环境。此后，我尝试过使用 Xfce, MATE, Openbox 等桌面环境。但自从我选择投入 <a href=\"https://www.gnome.org/gnome-3/\" target=\"_blank\" rel=\"nofollow\">GNOME 3</a> 的怀抱后，我就再没有离开过它了。GNOME 是一个稳定且反应灵敏的桌面环境，它使得我可以专注于自己的工作而尽可能少地受到干扰。</p>\n<p>下面说一下我彻底沉醉于 GNOME 3 Shell 的六个原因。</p>\n<h3 id=\"h2_0\">1. 智能且稳定</h3>\n<p>自从切换到 GNOME 3 以来，我并没有遇到过任何稳定性方面的问题。我已经在三台 System76 机器和两台戴尔 Latitude 笔记本电脑上运行 GNOME 3 了，而且它在每台机器上的表现都十分优秀。总之，在 GNOME 上的体验不能更好了 —— 它十分稳定并且永远不会崩溃，这是十分重要的。</p>\n<p>虽然我使用 GNOME 3 的体验一直都很稳定，但在使用测试的 beta 版时，仍然会遇到一些崩溃的场景。当出现这些通常由错误的 beta 版驱动引起的崩溃时（而不是 GNOME 本身），GNOME 3 的恢复功能仍能允许我从锁定中恢复。如果 shell 已经停止响应，我所要做的是按下 ALT+F2，然后按下 R 和 Enter 来重新启动会话，而这不会丢失正在运行的应用程序。事实上，即使强制重新启动 GNOME Shell，它不仅会把应用程序带回来，还会把它们放回到重新启动之前的同一个显示器/工作区上。</p>\n<p>上面的案例只是想告诉大家 GNOME 是如此的智能和稳定 —— 使用它的期间，我确实没遇到过崩溃的场景。而且 GNOME 内置的恢复功能，使得我可以重启整个会话而不用担心丢失正在运行的作业。</p>\n<h3 id=\"h2_1\">2. 不影响我的使用体验</h3>\n<p>我听过对于 GNOME 3 的一个抱怨是它的桌面组件太大，并且在显示器上占用了太多的空间。但我认为，相比其他的桌面环境，GNOME 3 拥有一个更干净的界面。它的大多数桌面组件都包含在 Activities 的概览中，屏幕顶部只有一个非常窄的面板，让桌面的其余部分用于任何正在进行的工作。GNOME 2.x 和 MATE 的默认布局都有两个面板，因此占用了两倍的空间。虽然可以像 MATE 一样自定义环境来使用单个面板。但 GNOME 3.x 不使用旧的两个面板的布局，为应用程序留出了更多的空间。</p>\n<p>由于 GNOME 的大部分桌面组件都包含在 Activities 概览中，所以它永远不会影响我的使用。如果我想更加专注于某些东西，我可以在使用 GNOME 的终端时按下 F11，使其占满整个屏幕。如果我想再次访问 GNOME 界面，我只需按下 <a href=\"https://help.gnome.org/users/gnome-help/stable/keyboard-key-super.html.en\" target=\"_blank\" rel=\"nofollow\">Super</a> 键。在我尝试过的所有桌面环境中（事实上我已经尝试过所有的桌面环境），GNOME 更能提高我的生产力，并且给我的显示屏留下更多的空间这个特性对我来说真的十分重要。</p>\n<h3>3. 显示器的切换能保持正常工作</h3>\n<p>多年以来，我都是使用一个带有扩展坞的笔记本电脑连接到双显示器，这是使用 Linux 唯一的最令人沮丧的地方。我也数不清丢失作业的次数了，因为我的笔记本电脑使用扩展坞与显示器进行连接时会出现死机的情况，或 Xorg Server 崩溃。我几乎习惯了 Linux 上混乱的扩展坞使用体验，直到切换至 GNOEM 3。</p>\n<p>到目前为止，GNOME 3 是我使用过的唯一一个对扩展坞是完全可靠的桌面环境。当我卸下扩展坞时，GNOME 会切换回笔记本电脑，并将所有在两个显示器上运行的应用程序移至单个的内置显示器上，GNOME 不仅可以在不锁定的情况下处理扩展坞，还可以在锁定前十分智能地将应用程序重新移动至启动的显示器上。对我而言，这是十分完美的 —— 没有死机或崩溃。因为我使用扩展坞，所以 GNOME 似乎是我最好的选择。</p>\n<h3 id=\"h2_3\">4. 大量的扩展</h3>\n<p>有人说 GNOME 3 的默认界面是十分有限的，你不能做太多的工作来进行定制。但是默认的设置已经可以很好地为我服务了，不能说 GNOME 不可以定制。它的界面可以通过扩展进行自定义，允许你按照自己的喜欢的方式调整桌面环境。这些扩展可以显示当前的天气状况，在 NetworkManager 的无线网络列表中添加一个刷新图标，插入新菜单，以及更多的其他事情。可通过 <a href=\"https://extensions.gnome.org/\" target=\"_blank\" rel=\"nofollow\">extensions.gnome.org</a> 获取扩展，也可以通过 <a href=\"https://git.gnome.org/browse/gnome-tweak-tool/\" target=\"_blank\" rel=\"nofollow\">GNOME Tweak</a> 工具来管理他们。</p>\n<p>但扩展既是天使也是魔鬼，因为不同的扩展有不同的程度的稳定性和质量。<a href=\"https://opensource.com/article/17/2/top-gnome-shell-extensions\" target=\"_blank\" rel=\"nofollow\">最好的扩展</a>能帮助你完成一些通常不能完成的事情，而糟糕的扩展可能会拖慢桌面环境的运行速度或导致其崩溃。我的建议是适量地使用扩展（质量比数量重要），因为太多的扩展可能会导致稳定性问题或混论的桌面环境。平均来说，我尽量不会安装超过三个以上的扩展。因为我发现大多数扩展只是稍微增强了使用的体验，并不是必需品。我个人最喜欢的三个扩展是 OpenWeather, TopIcons Plus, 和 Workspace Indicator。虽然 Dash to Dock 可能是最受欢迎的扩展，但我不使用它，因为 GNOME 3 默认的体验已经足够满足我的使用需求。</p>\n<p>虽然扩展可以使得体验更好，但在大多数情况下，我并不是真的需要它们。GNOME 3 的默认布局不仅适合我的需要，而且我安装的任何扩展只是增强了体验，但不是我完成工作所必需的。</p>\n<h3 id=\"h2_4\">5. 动态的工作区</h3>\n<p>动态的工作区(workspaces)是使我离不开 GNOME 3 的功能之一。它的概念十分简单，你可以从单个工作区开始，然后会根据需要自动添加更多的工作区。你可以通过按下 Super 键轻松查看在工作区上运行的所有应用程序。看起来这并没解决什么大的问题，但如果你是那种在将一个又一个的窗口叠加在一起的人，你可以使用此功能轻松查看正在运行的内容，并关闭未使用的应用程序。按住 Ctrl+Alt 键并同时按向上或向下的箭头可以在活动的工作区之间切换。当在工作区上打开应用时，会自动创建一个新的空白工作区以便开始使用。当关闭工作区中的所有应用程序时，它们也将被删除。</p>\n<p>这似乎与我们一直以来管理运行的应用程序的方式有很大的区别，但如果你尝试过之后，你可能会喜欢这种方式。我通常在每个工作区中运行一个应用程序，因为我发现使用 Ctrl+Alt+上/下箭头来进行切换比单击面板中的应用程序要快得多，而且效率更高。如果我需要在工作区中运行多个应用程序，我会将它们贴在显示器的左右边缘。</p>\n<p>关于 GNOME 3 处理工作区的方式的另一件事是，如果有多个显示器连接到计算机，默认情况下只有一个显示器启用了工作区。这意味着当我切换工作区时，只有左侧的显示器在它们之间循环，右侧的显示器则保持静止。这允许我在右边的显示器打开一个终端窗口，当我想检查我的消息时，我可以切换工作区以使用我的电子邮件客户端，而不会错过终端中发生的情况。</p>\n<h3 id=\"h2_5\">6. 自定义主题</h3>\n<p>老实说，GNOME 3 的默认主题不是我用过的桌面环境中最好看的（当然也不是最差的）。它的简洁性很好，但对于像我这种喜欢主题并修饰主题的人，可以自定义视觉效果以适应我的口味是十分重要的。</p>\n<p>幸运的是，在 GNOME 中安装主题十分容易。要安装新的主题，只需下载主题（<a href=\"https://www.opendesktop.org/s/Gnome\" target=\"_blank\" rel=\"nofollow\">gnome-look.org</a> 是一个不错的下载源），并将下载的文件解压到主目录的 <strong>.themes </strong>目录中。通过使用 GNOME Tweak 工具，可以在安装的主题之间进行循环。它允许你更改应用程序的外观以及 GNOME Shell 本身。</p>\n<p>最近还没有太多可用的 GNOME 3 主题，Arc 和 Numix 主题几乎占据了所有的焦点。这些主题当然是很好的，但有更多的选择就更好了。幸运的是，自从 Ubuntu 宣布将 GNOME 切换为默认的桌面环境之后，主题社区似乎正在加班工作，现在出现了更多的主题。我个人最喜欢的主题是 Vimix Dark，你的是什么？</p>\n<p>虽然我通常会尝试其他的桌面环境以与桌面 Linux 的发展同步，但我最后总会回归到 GNOME。GNOME 3.x 可能不适用于每个人，但我建议可以给它一次尝试的机会。GNOME 处理某些问题的方式初次看起来可能很奇怪，但它是一个很好的桌面环境，与其他我使用过的任何图形用户界面相比，它使得我更高效地完成我的工作。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112167\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112167votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112167\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "CoreOS，一款 Linux 容器发行版", "url": "http://blog.jobbole.com/112189/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,Linux,容器", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://medium.com/linode-cube/the-what-why-and-wow-behind-the-coreos-container-linux-fa7ceae5593c\">Steven J. Vaughan-nichols</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8768-1.html\">Linux中国/toyijiu</a>   </div><blockquote><p>CoreOS，一款最新的 Linux 发行版本，支持自动升级内核软件，提供各集群间配置的完全控制。</p></blockquote>\n<p>关于使用哪个版本的 Linux 服务器系统的争论，常常是以这样的话题开始的：</p>\n<blockquote><p>你是喜欢基于 <a href=\"https://www.redhat.com/en/technologies/linux-platforms/enterprise-linux\">Red Hat Enterprise Linux （RHEL）</a> 的 <a href=\"https://www.centos.org/\">CentOS</a> 或者 <a href=\"https://getfedora.org/\">Fedora</a>，还是基于 <a href=\"https://www.debian.org/\">Debian</a> 的 <a href=\"https://www.ubuntu.com/\">Ubuntu</a>，抑或 <a href=\"https://www.suse.com/\">SUSE</a> 呢？</p></blockquote>\n<p>但是现在，一款名叫 <a href=\"https://coreos.com/os/docs/latest\">CoreOS 容器 Linux</a> 的 Linux 发行版加入了这场“圣战”。<a href=\"https://www.linode.com/docs/platform/use-coreos-container-linux-on-linode\">这个最近在 Linode 服务器上提供的 CoreOS</a>，和它的老前辈比起来，它使用了完全不同的实现方法。</p>\n<p>你可能会感到不解，这里有这么多成熟的 Linux 发行版本，为什么要选择用 CoreOS ？借用 Linux 主干分支的维护者，也是 CoreOS 顾问的 Greg Kroah-Hartman 先生的一句话：</p>\n<blockquote><p>CoreOS 可以控制发行版的升级（基于 ChromeOS 代码），并结合了 Docker 和潜在的核对/修复功能，这意味着不用停止或者重启你的相关进程，就可以<a href=\"https://plus.google.com/+gregkroahhartman/posts/YvWFmPa9kVf\">在线升级</a>。测试版本已经支持此功能，这是史无前例的。</p></blockquote>\n<p>当 Greg Kroah-Hartman 做出这段评价时，CoreOS 还处于 α 测试阶段，当时也许就是在硅谷的一个车库当中，<a href=\"https://www.wired.com/2013/08/coreos-the-new-linux/\">开发团队正在紧锣密鼓地开发此产品</a>，但 CoreOS 不像最开始的苹果或者惠普，其在过去的四年当中一直稳步发展。</p>\n<p>当我参加在旧金山举办的 <a href=\"https://coreos.com/fest/\">2017 CoreOS 大会</a>时，CoreOS 已经支持谷歌云、IBM、AWS 和微软的相关服务。现在有超过 1000 位开发人员参与到这个项目中，并为能够成为这个伟大产品的一员而感到高兴。</p>\n<p>究其原因，CoreOS 从开始就是为容器而设计的轻量级 Linux 发行版，其起初是作为一个 <a href=\"https://www.docker.com/\">Docker</a> 平台，随着时间的推移， CoreOS 在容器方面走出了自己的道路，除了 Docker 之外，它也支持它自己的容器 <a href=\"https://coreos.com/rkt\">rkt</a> （读作 rocket ）。</p>\n<p>不像大多数其他的 Linux 发行版，CoreOS 没有包管理器，取而代之的是通过 Google ChromeOS 的页面自动进行软件升级，这样能提高在集群上运行的机器/容器的安全性和可靠性。不用通过系统管理员的干涉，操作系统升级组件和安全补丁可以定期推送到 CoreOS 容器。</p>\n<p>你可以通过 <a href=\"https://coreos.com/products/coreupdate/\">CoreUpdate 和它的 Web 界面</a>上来修改推送周期，这样你就可以控制你的机器何时更新，以及更新以多快的速度滚动分发到你的集群上。</p>\n<p>CoreOS 通过一种叫做 <a href=\"https://github.com/coreos/etcd\">etcd</a> 的分布式配置服务来进行升级，etcd 是一种基于 <a href=\"http://yaml.org/\">YAML</a> 的开源的分布式哈希存储系统，它可以为 Linux 集群容器提供配置共享和服务发现等功能。</p>\n<p>此服务运行在集群上的每一台服务器上，当其中一台服务器需要下线升级时，它会发起领袖选举，以便服务器更新时整个Linux 系统和容器化的应用可以继续运行。</p>\n<p>对于集群管理，CoreOS 之前采用的是 <a href=\"https://github.com/coreos/fleet\">fleet</a> 方法，这将 etcd 和 <a href=\"https://www.freedesktop.org/wiki/Software/systemd/\">systemd</a> 结合到分布式初始化系统中。虽然 fleet 仍然在使用，但 CoreOS 已经将 etcd 加入到 <a href=\"https://kubernetes.io/\">Kubernetes</a> 容器编排系统构成了一个更加强有力的管理工具。</p>\n<p>CoreOS 也可以让你定制其它的操作系统相关规范，比如用 <a href=\"https://coreos.com/os/docs/latest/cloud-config.html\">cloud-config</a> 的方式管理网络配置、用户账号和 systemd 单元等。</p>\n<p>综上所述，CoreOS 可以不断地自行升级到最新版本，能让你获得从单独系统到集群等各种场景的完全控制。如 CoreOS 宣称的，你再也不用为了改变一个单独的配置而在每一台机器上运行 <a href=\"https://insights.hpe.com/articles/what-is-chef-a-primer-for-devops-newbies-1704.html\">Chef</a> 了。</p>\n<p>假如说你想进一步的扩展你的 DevOps 控制，<a href=\"https://blogs.dxc.technology/2017/06/08/coreos-moves-in-on-cloud-devops-with-kubernetes/\">CoreOS 能够轻松地帮助你部署 Kubernetes</a>。</p>\n<p>CoreOS 从一开始就是构建来易于部署、管理和运行容器的。当然，其它的 Linux　发行版，比如 RedHat 家族的<a href=\"http://www.projectatomic.io/\">原子项目</a>也可以达到类似的效果，但是对于那些发行版而言是以附加组件的方式出现的，而 CoreOS 从它诞生的第一天就是为容器而设计的。</p>\n<p>当前<a href=\"http://www.zdnet.com/article/what-is-docker-and-why-is-it-so-darn-popular/\">容器和 Docker 已经逐渐成为商业系统的主流</a>，如果在可预见的未来中你要在工作中使用容器，你应该考虑下 CoreOS，不管你的系统是在裸机硬件上、虚拟机还是云上。</p>\n<p>如果有任何关于 CoreOS 的观点或者问题，还请在评论栏中留言。如果你觉得这篇博客还算有用的话，还请分享一下~</p>\n<hr>\n<p>关于博主：Steven J. Vaughan-Nichols 是一位经验丰富的 IT 记者，许多网站中都刊登有他的文章，包括 <a href=\"http://www.zdnet.com/meet-the-team/us/steven-j-vaughan-nichols/\">ZDNet.com</a>、<a href=\"http://www.pcmag.com/author-bio/steven-j.-vaughan-nichols\">PC Magazine</a>、<a href=\"http://www.infoworld.com/author/Steven-J.-Vaughan_Nichols/\">InfoWorld</a>、<a href=\"http://www.computerworld.com/author/Steven-J.-Vaughan_Nichols/\">ComputerWorld</a>、<a href=\"http://www.linuxtoday.com/author/Steven+J.+Vaughan-Nichols/\">Linux Today</a> 和 <a href=\"http://www.eweek.com/cp/bio/Steven-J.-Vaughan-Nichols/\">eWEEK</a> 等。他拥有丰富的 IT 知识 – 而且他曾参加过智力竞赛节目 Jeopardy ！他的相关观点都是自身思考的结果，并不代表 Linode 公司，我们对他做出的贡献致以最真诚的感谢。如果想知道他更多的信息，可以关注他的 Twitter <a href=\"http://www.twitter.com/sjvn\"><em>@sjvn</em></a>。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112189\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112189votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112189\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "决策树算法及实现", "url": "http://blog.jobbole.com/112206/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/d5e765a446f9f0cf17c21b596186d3b9.png"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 5, "tags": "IT技术,决策树,算法", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jianshu.com/p/c4d0837e9439\">ZPPenny</a>   </div><p>在计算机科学中，树是一种很重要的数据结构，比如我们最为熟悉的二叉查找树（Binary Search Tree），红黑树（Red-Black Tree）等，通过引入树这种数据结构，我们可以很快地缩小问题规模，实现高效的查找。</p>\n<p>在监督学习中，面对样本中复杂多样的特征，选取什么样的策略可以实现较高的学习效率和较好的分类效果一直是科学家们探索的目标。那么，树这种结构到底可以如何用于机器学习中呢？我们先从一个游戏开始。</p>\n<p>我们应该都玩过或者听过这么一种游戏：游戏中，出题者写下一个明星的名字，其他人需要猜出这个人是谁。当然，如果游戏规则仅此而已的话，几乎是无法猜出来的，因为问题的规模太大了。为了降低游戏的难度，答题者可以向出题者问问题，而出题者必须准确回答是或者否，答题者依据回答提出下一个问题，如果能够在指定次数内确定谜底，即为胜出。加入了问答规则之后，我们是否有可能猜出谜底呢？我们先实验一下，现在我已经写下了一个影视明星的名字，而你和我的问答记录如下：</p>\n<ol>\n<li>是男的吗？Y</li>\n<li>是亚洲人吗？Y</li>\n<li>是中国人吗？N</li>\n<li>是印度人吗？Y</li>\n<li> ……</li>\n</ol>\n<p>虽然只有短短四个问题，但是我们已经把答案的范围大大缩小了，那么接下，第5个问题你应该如何问呢？我相信你应该基本可以锁定答案了，因为我看过的印度电影就那么几部。我们将上面的信息结构化如下图所示：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/d5e765a446f9f0cf17c21b596186d3b9.png\"><img class=\"aligncenter wp-image-112208 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/d5e765a446f9f0cf17c21b596186d3b9.png\" alt=\"2119554-bfc7f93e51ee6786\" width=\"521\" height=\"257\"></a></p>\n<p>在上面的游戏中，我们针对性的提出问题，每一个问题都可以将我们的答案范围缩小，在提问中和回答者有相同知识背景的前提下，得出答案的难度比我们想象的要小很多。</p>\n<p>回到我们最初的问题中，如何将树结构用于机器学习中？结合上面的图，我们可以看出，在每一个节点，依据问题答案，可以将答案划分为左右两个分支，左分支代表的是Yes，右分支代表的是No，虽然为了简化，我们只画出了其中的一条路径，但是也可以明显看出这是一个树形结构，这便是决策树的原型。</p>\n<h1>1. 决策树算法简介</h1>\n<p>我们面对的样本通常具有很多个特征，正所谓对事物的判断不能只从一个角度，那如何结合不同的特征呢？决策树算法的思想是，先从一个特征入手，就如同我们上面的游戏中一样，既然无法直接分类，那就先根据一个特征进行分类，虽然分类结果达不到理想效果，但是通过这次分类，我们的问题规模变小了，同时分类后的子集相比原来的样本集更加易于分类了。然后针对上一次分类后的样本子集，重复这个过程。在理想的情况下，经过多层的决策分类，我们将得到完全纯净的子集，也就是每一个子集中的样本都属于同一个分类。<a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/4e67fca8490cef73a42855761c896291.png\"><img class=\"aligncenter wp-image-112209 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/4e67fca8490cef73a42855761c896291.png\" alt=\"2119554-bfc7f93e51ee6786\" width=\"395\" height=\"376\"></a>比如上图中，平面坐标中的六个点，我们无法通过其x坐标或者y坐标直接就将两类点分开。采用决策树算法思想：我们先依据y坐标将六个点划分为两个子类（如水平线所示），水平线上面的两个点是同一个分类，但是水平线之下的四个点是不纯净的。但是没关系，我们对这四个点进行再次分类，这次我们以x左边分类（见图中的竖线），通过两层分类，我们实现了对样本点的完全分类。这样，我们的决策树的伪代码实现如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d27b31e2b065593011\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif y &gt; a:\r\n    output dot\r\nelse:\r\n    if x &lt; b:\r\n          output cross\r\n    else:\r\n          output dot</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e2b065593011-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e2b065593011-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e2b065593011-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e2b065593011-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e2b065593011-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e2b065593011-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e2b065593011-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d27b31e2b065593011-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e2b065593011-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">output </span><span class=\"crayon-e\">dot</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e2b065593011-3\"><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e2b065593011-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e2b065593011-5\"><span class=\"crayon-h\">          </span><span class=\"crayon-e\">output </span><span class=\"crayon-e\">cross</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e2b065593011-6\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e2b065593011-7\"><span class=\"crayon-h\">          </span><span class=\"crayon-e\">output </span><span class=\"crayon-v\">dot</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>由这个分类的过程形成一个树形的判决模型，树的每一个非叶子节点都是一个特征分割点，叶子节点是最终的决策分类。如下图所示：<a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/7c7879e3286895e28cdd65ffa0da4740.png\"><img class=\"aligncenter wp-image-112210 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/7c7879e3286895e28cdd65ffa0da4740.png\" alt=\"2119554-bfc7f93e51ee6786\" width=\"423\" height=\"298\"></a>将新样本输入决策树进行判决时，就是将样本在决策树上自顶向下，依据决策树的节点规则进行遍历，最终落入的叶子节点就是该样本所属的分类。</p>\n<h1>2 决策树算法流程</h1>\n<p>上面我们介绍决策树算法的思想，可以简单归纳为如下两点：</p>\n<ol>\n<li>每次选择其中一个特征对样本集进行分类</li>\n<li>对分类后的子集递归进行步骤1</li>\n</ol>\n<p>看起来是不是也太简单了呢？实际上每一个步骤我们还有很多考虑的。在第一个步骤中，我们需要考虑的一个最重要的策略是，选取什么样的特征可以实现最好的分类效果，而所谓的分类效果好坏，必然也需要一个评价的指标。在上文中，我们都用纯净来说明分类效果好，那何为纯净呢？直观来说就是集合中样本所属类别比较集中，最理想的是样本都属于同一个分类。样本集的纯度可以用<a href=\"https://en.wikipedia.org/wiki/Entropy_(information_theory)\" target=\"_blank\">熵</a>来进行衡量。</p>\n<p>在信息论中，熵代表了一个系统的混乱程度，熵越大，说明我们的数据集纯度越低，当我们的数据集都是同一个类别的时候，熵为0，熵的计算公式如下：</p>\n<p><a href=\"https://wikimedia.org/api/rest_v1/media/math/render/svg/9017e7f5171f1770f8bd702487f297b77df8a907\"><img class=\"aligncenter\" src=\"https://wikimedia.org/api/rest_v1/media/math/render/svg/9017e7f5171f1770f8bd702487f297b77df8a907\" width=\"390\" height=\"56\"></a></p>\n<p>其中，P(xi)表示概率，b在此处取2。比如抛硬币的时候，正面的概率就是1/2，反面的概率也是1/2，那么这个过程的熵为：<a href=\"https://wikimedia.org/api/rest_v1/media/math/render/svg/0d5eab2ab8165e547d69a5fb49db1c18cb1518ef\"><img class=\"aligncenter\" src=\"https://wikimedia.org/api/rest_v1/media/math/render/svg/0d5eab2ab8165e547d69a5fb49db1c18cb1518ef\" width=\"649\" height=\"59\"></a>可见，由于抛硬币是一个完全随机事件，其结果正面和反面是等概率的，所以具有很高的熵。假如我们观察的是硬币最终飞行的方向，那么硬币最后往下落的概率是1，往天上飞的概率是0，带入上面的公式中，可以得到这个过程的熵为0，所以，熵越小，结果的可预测性就越强。在决策树的生成过程中，我们的目标就是要划分后的子集中其熵最小，这样后续的的迭代中，就更容易对其进行分类。</p>\n<p>既然是递归过程，那么就需要制定递归的停止规则。在两种情况下我们停止进一步对子集进行划分，其一是划分已经达到可以理想效果了，另外一种就是进一步划分收效甚微，不值得再继续了。用专业术语总结终止条件有以下几个：</p>\n<ol>\n<li>子集的熵达到阈值</li>\n<li>子集规模够小</li>\n<li>进一步划分的增益小于阈值</li>\n</ol>\n<p style=\"text-align: left\">其中，条件3中的增益代表的是一次划分对数据纯度的提升效果，也就是划分以后，熵减少越多，说明增益越大，那么这次划分也就越有价值，增益的计算公式如下：<a href=\"//upload-images.jianshu.io/upload_images/2119554-ed959b962943ebaf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\"><img class=\"aligncenter\" src=\"//upload-images.jianshu.io/upload_images/2119554-ed959b962943ebaf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240\" alt=\"Gain\" width=\"316\" height=\"60\"></a></p>\n<p style=\"text-align: center\">Gain</p>\n<p>上述公式可以理解为：计算这次划分之后两个子集的熵之和相对划分之前的熵减少了多少，需要注意的是，计算子集的熵之和需要乘上各个子集的权重，权重的计算方法是子集的规模占分割前父集的比重，比如划分前熵为e，划分为子集A和B，大小分别为m和n，熵分别为e1和e2，那么增益就是<strong><span style=\"color: #ff0000\"><code>e - m/(m + n) * e1 - n/(m + n) * e2</code>。</span></strong></p>\n<h1>3. 决策树算法实现</h1>\n<p>有了上述概念，我们就可以开始开始决策树的训练了，训练过程分为：</p>\n<ol>\n<li>选取特征，分割样本集</li>\n<li>计算增益，如果增益够大，将分割后的样本集作为决策树的子节点，否则停止分割</li>\n<li>递归执行上两步</li>\n</ol>\n<p>上述步骤是依照ID3的算法思想（依据信息增益进行特征选取和分裂），除此之外还有C4.5以及CART等决策树算法。</p>\n<p>算法框架如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d27b31e39696620093\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass DecisionTree(object):\r\n    def fit(self, X, y):\r\n        # 依据输入样本生成决策树\r\n        self.root = self._build_tree(X, y)\r\n\r\n    def _build_tree(self, X, y, current_depth=0):\r\n        #1. 选取最佳分割特征，生成左右节点\r\n        #2. 针对左右节点递归生成子树\r\n      \r\n    def predict_value(self, x, tree=None):\r\n        # 将输入样本传入决策树中，自顶向下进行判定\r\n        # 到达叶子节点即为预测值</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e39696620093-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e39696620093-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e39696620093-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e39696620093-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e39696620093-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e39696620093-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e39696620093-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e39696620093-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e39696620093-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e39696620093-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e39696620093-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e39696620093-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d27b31e39696620093-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DecisionTree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e39696620093-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">fit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e39696620093-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 依据输入样本生成决策树</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e39696620093-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_build_tree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e39696620093-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e39696620093-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_build_tree</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">current_depth</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e39696620093-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\">#1. 选取最佳分割特征，生成左右节点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e39696620093-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\">#2. 针对左右节点递归生成子树</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e39696620093-9\"><span class=\"crayon-h\">      </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e39696620093-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">predict_value</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e39696620093-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 将输入样本传入决策树中，自顶向下进行判定</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e39696620093-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 到达叶子节点即为预测值</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>在上述代码中，实现决策树的关键是递归构造子树的过程，为了实现这个过程，我们需要做好三件事：分别是节点的定义，最佳分割特征的选择，递归生成子树。</p>\n<h2>3.1 节点定义</h2>\n<p>决策树的目的是用于分类预测，即各个节点需要选取输入样本的<strong>特征</strong>，进行<strong>规则</strong>判定，最终决定样本归属到哪一棵<strong>子树</strong>，基于这个目的，决策树的每一个节点需要包含以下几个关键信息：</p>\n<ol>\n<li>判决特征：当前节点针对哪一个特征进行判决</li>\n<li>判决规则：对于二类问题，这个规则一般是一个布尔表达式</li>\n<li>左子树：判决为TRUE的样本</li>\n<li>右子树：判决为FALSE的样本</li>\n</ol>\n<p>决策树节点的定义代码如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d27b31e3e697159826\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass DecisionNode():\r\n    \r\n    def __init__(self, feature_i=None, threshold=None,\r\n                 value=None, true_branch=None, false_branch=None):\r\n        self.feature_i = feature_i  # 用于测试的特征对应的索引\r\n        self.threshold = threshold  # 判断规则：&gt;=threshold为true\r\n        self.value = value  # 如果是叶子节点，用于保存预测结果\r\n        self.true_branch = true_branch  # 左子树\r\n        self.false_branch = false_branch  # 右子树</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e3e697159826-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e3e697159826-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e3e697159826-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e3e697159826-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e3e697159826-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e3e697159826-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e3e697159826-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e3e697159826-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e3e697159826-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d27b31e3e697159826-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">DecisionNode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e3e697159826-2\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e3e697159826-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">threshold</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e3e697159826-4\"><span class=\"crayon-h\">                 </span><span class=\"crayon-v\">value</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">true_branch</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">false_branch</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e3e697159826-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># 用于测试的特征对应的索引</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e3e697159826-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">threshold</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">threshold</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># 判断规则：&gt;=threshold为true</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e3e697159826-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># 如果是叶子节点，用于保存预测结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e3e697159826-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">true_branch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">true_branch</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># 左子树</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e3e697159826-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">false_branch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">false_branch</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># 右子树</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p></p>\n<h2>3.2 特征选取</h2>\n<p>特征选取是构造决策树最关键的步骤，其目的是选出能够实现分割结果最纯净的那个特征，其操作流程的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d27b31e42711974182\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 遍历样本集中的所有特征，针对每一个特征计算最佳分割点\r\n# 再选取最佳的分割特征\r\nfor feature_i in range(n_features):\r\n    # 遍历集合中某个特征的所有取值\r\n    for threshold in unique_values:\r\n        # 以当前特征值作为阈值进行分割\r\n        Xy1, Xy2 = divide_on_feature(X_y, feature_i, threshold)\r\n        # 计算分割后的增益\r\n        gain = gain(y, y1, y2)\r\n        # 记录最佳分割特征，最佳分割阈值\r\n        if gain &gt; largest_gain:\r\n        largest_gain = gain\r\n            best_criteria = {\r\n                \"feature_i\": feature_i, \r\n                \"threshold\": threshold \r\n                }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e42711974182-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e42711974182-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e42711974182-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e42711974182-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e42711974182-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e42711974182-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e42711974182-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e42711974182-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e42711974182-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e42711974182-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e42711974182-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e42711974182-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e42711974182-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e42711974182-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e42711974182-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e42711974182-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d27b31e42711974182-1\"><span class=\"crayon-p\"># 遍历样本集中的所有特征，针对每一个特征计算最佳分割点</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e42711974182-2\"><span class=\"crayon-p\"># 再选取最佳的分割特征</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e42711974182-3\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">feature_i </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n_features</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e42711974182-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 遍历集合中某个特征的所有取值</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e42711974182-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">threshold </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">unique_values</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e42711974182-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 以当前特征值作为阈值进行分割</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e42711974182-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">Xy1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Xy2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">divide_on_feature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X_y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">threshold</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e42711974182-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 计算分割后的增益</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e42711974182-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">gain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e42711974182-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 记录最佳分割特征，最佳分割阈值</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e42711974182-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">largest_gain</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e42711974182-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">largest_gain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gain</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e42711974182-13\"><span class=\"crayon-e\">            </span><span class=\"crayon-v\">best_criteria</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e42711974182-14\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"feature_i\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e42711974182-15\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">\"threshold\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">threshold</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e42711974182-16\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p></p>\n<h2>3.3 节点分裂</h2>\n<p>节点分裂的时候有两条处理分支，如果增益够大，就分裂为左右子树，如果增益很小，就停止分裂，将这个节点直接作为叶子节点。节点分裂和Gain（分割后增益）的计算可以做一个优化，在上一个步骤中，我们寻找最优分割点的时候其实就可以将最佳分裂子集和Gain计算并保存下来，将上一步中的for循环改写为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d27b31e46113371565\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 以当前特征值作为阈值进行分割\r\nXy1, Xy2 = divide_on_feature(X_y, feature_i, threshold)\r\n# 计算分割后的熵\r\ngain = gain(y, y1, y2)\r\n# 记录最佳分割特征，最佳分割阈值\r\nif gain &gt; largest_gain:\r\n    largest_gain = gain\r\n        best_criteria = {\r\n        \"feature_i\": feature_i, \r\n        \"threshold\": threshold ,\r\n        }\r\n    best_sets = {\r\n        \"left\": Xy1,\r\n        \"right\": Xy2,\r\n        \"gain\": gain\r\n        }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e46113371565-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e46113371565-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e46113371565-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e46113371565-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e46113371565-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e46113371565-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e46113371565-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e46113371565-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e46113371565-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e46113371565-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e46113371565-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e46113371565-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e46113371565-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e46113371565-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e46113371565-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e46113371565-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d27b31e46113371565-1\"><span class=\"crayon-p\"># 以当前特征值作为阈值进行分割</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e46113371565-2\"><span class=\"crayon-v\">Xy1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Xy2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">divide_on_feature</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X_y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">threshold</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e46113371565-3\"><span class=\"crayon-p\"># 计算分割后的熵</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e46113371565-4\"><span class=\"crayon-v\">gain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e46113371565-5\"><span class=\"crayon-p\"># 记录最佳分割特征，最佳分割阈值</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e46113371565-6\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">largest_gain</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e46113371565-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">largest_gain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gain</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e46113371565-8\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">best_criteria</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e46113371565-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"feature_i\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e46113371565-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"threshold\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">threshold</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e46113371565-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e46113371565-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">best_sets</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e46113371565-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"left\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Xy1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e46113371565-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"right\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Xy2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e46113371565-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"gain\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">gain</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e46113371565-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>为了防止过拟合，需要设置合适的停止条件，比如设置Gain的阈值，如果Gain比较小，就没有必要继续进行分割，所以接下来，我们就可以依据gain来决定分割策略：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d27b31e4a592598528\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif best_sets[\"gain\"] &gt; MIN_GAIN:\r\n    # 对best_sets[\"left\"]进一步构造子树，并作为父节点的左子树\r\n    # 对best_sets[\"right\"]进一步构造子树，并作为父节点的右子树\r\n    ...\r\nelse:\r\n    # 直接将父节点作为叶子节点\r\n    ...</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e4a592598528-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e4a592598528-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e4a592598528-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e4a592598528-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e4a592598528-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e4a592598528-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e4a592598528-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d27b31e4a592598528-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">best_sets</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"gain\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MIN_GAIN</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e4a592598528-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 对best_sets[\"left\"]进一步构造子树，并作为父节点的左子树</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e4a592598528-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 对best_sets[\"right\"]进一步构造子树，并作为父节点的右子树</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e4a592598528-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e4a592598528-5\"><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e4a592598528-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># 直接将父节点作为叶子节点</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e4a592598528-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>下面，我们结合一组实验数据来学习决策树的训练方法。实验数据来源于<a href=\"http://www.onlamp.com/pub/a/python/2006/02/09/ai_decision_trees.html\" target=\"_blank\">这里</a>，下表中的数据是一组消费调查结果，我们训练决策树的目的，就是构造一个分类算法，使得有新的用户数据时，我们依据训练结果去推断一个用户是否购买这个商品：</p>\n<table>\n<thead>\n<tr>\n<th>AGE</th>\n<th>EDUCATION</th>\n<th>INCOME</th>\n<th>MARITAL STATUS</th>\n<th>PURCHASE?</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>36-55</td>\n<td>master’s</td>\n<td>high</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>18-35</td>\n<td>high school</td>\n<td>low</td>\n<td>single</td>\n<td>no</td>\n</tr>\n<tr>\n<td>36-55</td>\n<td>master’s</td>\n<td>low</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>18-35</td>\n<td>bachelor’s</td>\n<td>high</td>\n<td>single</td>\n<td>no</td>\n</tr>\n<tr>\n<td> &lt; 18</td>\n<td>high school</td>\n<td>low</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>18-35</td>\n<td>bachelor’s</td>\n<td>high</td>\n<td>married</td>\n<td>no</td>\n</tr>\n<tr>\n<td>36-55</td>\n<td>bachelor’s</td>\n<td>low</td>\n<td>married</td>\n<td>no</td>\n</tr>\n<tr>\n<td>&gt; 55</td>\n<td>bachelor’s</td>\n<td>high</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>36-55</td>\n<td>master’s</td>\n<td>low</td>\n<td>married</td>\n<td>no</td>\n</tr>\n<tr>\n<td>&gt; 55</td>\n<td>master’s</td>\n<td>low</td>\n<td>married</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>36-55</td>\n<td>master’s</td>\n<td>high</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>&gt; 55</td>\n<td>master’s</td>\n<td>high</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>18</td>\n<td>high school</td>\n<td>high</td>\n<td>single</td>\n<td>no</td>\n</tr>\n<tr>\n<td>36-55</td>\n<td>master’s</td>\n<td>low</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>36-55</td>\n<td>high school</td>\n<td>low</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td> &lt; 18</td>\n<td>high school</td>\n<td>low</td>\n<td>married</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>18-35</td>\n<td>bachelor’s</td>\n<td>high</td>\n<td>married</td>\n<td>no</td>\n</tr>\n<tr>\n<td>&gt; 55</td>\n<td>high school</td>\n<td>high</td>\n<td>married</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>&gt; 55</td>\n<td>bachelor’s</td>\n<td>low</td>\n<td>single</td>\n<td>yes</td>\n</tr>\n<tr>\n<td>36-55</td>\n<td>high school</td>\n<td>high</td>\n<td>married</td>\n<td>no</td>\n</tr>\n</tbody>\n</table>\n<p>从表中可以看出，我们一共有20组调查样本，每一组样本包含四个特征，分别是年龄段，学历，收入，婚姻状况，而最后一列是所属分类，在这个问题中就代表是否购买了该产品。</p>\n<p>监督学习就是在每一个样本都有正确答案的前提下，用算法预测结果，然后根据预测情况的好坏，调整算法参数。在决策树中，预测的过程就是依据各个特征划分样本集，评价预测结果的好坏标准是划分结果的纯度。</p>\n<p>为了方便处理，我们对样本数据进行了简化，将年龄特征按照样本的特点，转化为离散的数据，比如小于18对应0，18对应1，18-35对应2，36-55对应3，大于55对应4，以此类推，同样其他的特征也一样最数字化处理，教育水平分别映射为0(hight school)，1(bachelor’s)，2(master’s)，收入映射为0(low)和1(hight), 婚姻状况同样映射为0(single), 1(married)，最终处理后的样本，放到一个numpy矩阵中，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d27b31e4f187419930\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nX_y = np.array(\r\n        [[3, 2, 1, 0, 1],\r\n         [2, 0, 0, 0, 0],\r\n         [3, 2, 0, 0, 1],\r\n         [2, 1, 1, 0, 0],\r\n         [0, 0, 0, 0, 1],\r\n         [2, 1, 1, 1, 0],\r\n         [3, 1, 0, 1, 0],\r\n         [4, 1, 1, 0, 1],\r\n         [3, 2, 0, 1, 0],\r\n         [4, 2, 0, 1, 1],\r\n         [3, 2, 1, 0, 1],\r\n         [4, 2, 1, 0, 1],\r\n         [1, 0, 1, 0, 0],\r\n         [3, 2, 0, 0, 1],\r\n         [3, 0, 0, 0, 1],\r\n         [0, 0, 0, 1, 1],\r\n         [2, 1, 1, 1, 0],\r\n         [4, 0, 1, 1, 1],\r\n         [4, 1, 0, 0, 1],\r\n         [3, 0, 1, 1, 0]]\r\n    )</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e4f187419930-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e4f187419930-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e4f187419930-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e4f187419930-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e4f187419930-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e4f187419930-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e4f187419930-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e4f187419930-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e4f187419930-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e4f187419930-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e4f187419930-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e4f187419930-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e4f187419930-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e4f187419930-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e4f187419930-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e4f187419930-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e4f187419930-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e4f187419930-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e4f187419930-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e4f187419930-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e4f187419930-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e4f187419930-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d27b31e4f187419930-1\"><span class=\"crayon-v\">X_y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e4f187419930-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e4f187419930-3\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e4f187419930-4\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e4f187419930-5\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e4f187419930-6\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e4f187419930-7\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e4f187419930-8\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e4f187419930-9\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e4f187419930-10\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e4f187419930-11\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e4f187419930-12\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e4f187419930-13\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e4f187419930-14\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e4f187419930-15\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e4f187419930-16\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e4f187419930-17\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e4f187419930-18\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e4f187419930-19\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e4f187419930-20\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e4f187419930-21\"><span class=\"crayon-h\">         </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e4f187419930-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0062 seconds] -->\r\n<p></p>\n<h1>4. 新样本预测</h1>\n<p>依照上面的算法构造决策树，我们将决策树打印出来，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d27b31e55115877224\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n-- Classification Tree --\r\n0 : 4? \r\n   T -&gt; 1\r\n   F -&gt; 3 : 1? \r\n      T -&gt; 0 : 2? \r\n            T -&gt; 0\r\n            F -&gt; 1\r\n      F -&gt; 0 : 3? \r\n            T -&gt; 1\r\n            F -&gt; 0 : 1? \r\n                        T -&gt; 0\r\n                        F -&gt; 1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e55115877224-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e55115877224-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e55115877224-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e55115877224-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e55115877224-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e55115877224-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e55115877224-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e55115877224-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e55115877224-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e55115877224-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e55115877224-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e55115877224-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d27b31e55115877224-1\"><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Classification </span><span class=\"crayon-v\">Tree</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e55115877224-2\"><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e55115877224-3\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e55115877224-4\"><span class=\"crayon-h\">   </span><span class=\"crayon-v\">F</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e55115877224-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e55115877224-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e55115877224-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">F</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e55115877224-8\"><span class=\"crayon-h\">      </span><span class=\"crayon-v\">F</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e55115877224-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e55115877224-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">F</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e55115877224-11\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e55115877224-12\"><span class=\"crayon-h\">                        </span><span class=\"crayon-v\">F</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>其中，冒号前代表选择的分割特征，冒号后面代表判别规则，二者组合起来就是一个决策树的非叶子节点，每个非叶子节点进一步分割为分为True和False分支，对于叶子节点箭头后面表示最终分类，0表示不购买，1表示购买。由于我们的数据做过简化，所以上述结果不太直观，我们将对应的特征以及判断规则翻译一下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d27b31e58154208573\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n年龄 : 大于55? \r\n   是 -&gt; 购买\r\n   否 -&gt; 收入 : 高? \r\n      是 -&gt; 年龄 : 大于18? \r\n            是 -&gt; 不购买\r\n            否 -&gt; 购买\r\n      否 -&gt; 年龄 : 大于36? \r\n            是 -&gt; 购买\r\n            否 -&gt; 年龄 : 大于等于18? \r\n                        是 -&gt; 不购买\r\n                        否 -&gt; 购买</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e58154208573-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e58154208573-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e58154208573-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e58154208573-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e58154208573-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e58154208573-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e58154208573-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e58154208573-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e58154208573-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e58154208573-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e58154208573-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d27b31e58154208573-1\">年龄<span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>大于<span class=\"crayon-cn\">55</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e58154208573-2\"><span class=\"crayon-h\">   </span>是<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>购买</div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e58154208573-3\"><span class=\"crayon-h\">   </span>否<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>收入<span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>高<span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e58154208573-4\"><span class=\"crayon-h\">      </span>是<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>年龄<span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>大于<span class=\"crayon-cn\">18</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e58154208573-5\"><span class=\"crayon-h\">            </span>是<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>不购买</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e58154208573-6\"><span class=\"crayon-h\">            </span>否<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>购买</div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e58154208573-7\"><span class=\"crayon-h\">      </span>否<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>年龄<span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>大于<span class=\"crayon-cn\">36</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e58154208573-8\"><span class=\"crayon-h\">            </span>是<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>购买</div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e58154208573-9\"><span class=\"crayon-h\">            </span>否<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>年龄<span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>大于等于<span class=\"crayon-cn\">18</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e58154208573-10\"><span class=\"crayon-h\">                        </span>是<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>不购买</div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e58154208573-11\"><span class=\"crayon-h\">                        </span>否<span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span>购买</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>决策树构造完之后，我们就可以用来进行新样本的分类了。决策树的预测过程十分容易理解，只需要将从根节点开始，按照节点定义的规则进行判决，选择对应的子树，并重复这个过程，直到叶子节点即可。决策树的预测功能实现代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d27b31e5c463887409\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef predict_value(self, x, tree=None):\r\n        # 如果当前节点是叶子节点，直接输出其值\r\n        if tree.value is not None:\r\n            return tree.value\r\n        # 否则将x按照当前节点的规则进行判决\r\n        # 如果判决为true选择左子树，否则选择右子树，\r\n        feature_value = x[tree.feature_i]\r\n        if feature_value &gt;= tree.threshold:\r\n            branch = tree.true_branch\r\n        else:\r\n            branch = tree.false_branch\r\n        # 在选中的子树上递归进行判断\r\n        return self.predict_value(x, branch)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e5c463887409-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e5c463887409-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e5c463887409-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e5c463887409-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e5c463887409-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e5c463887409-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e5c463887409-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e5c463887409-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e5c463887409-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e5c463887409-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e5c463887409-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d27b31e5c463887409-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9d27b31e5c463887409-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d27b31e5c463887409-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">predict_value</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e5c463887409-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 如果当前节点是叶子节点，直接输出其值</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e5c463887409-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">value </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e5c463887409-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">value</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e5c463887409-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 否则将x按照当前节点的规则进行判决</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e5c463887409-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 如果判决为true选择左子树，否则选择右子树，</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e5c463887409-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">feature_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">feature_i</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e5c463887409-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">feature_value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">threshold</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e5c463887409-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">branch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">true_branch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e5c463887409-10\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e5c463887409-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">branch</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tree</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">false_branch</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d27b31e5c463887409-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 在选中的子树上递归进行判断</span></div><div class=\"crayon-line\" id=\"crayon-59b9d27b31e5c463887409-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">predict_value</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">branch</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p></p>\n<h1>5. 总结</h1>\n<p>决策树是一种简单常用的分类器，通过训练好的决策树可以实现对未知的数据进行高效分类。从我们的例子中也可以看出，决策树模型具有较好的可读性和描述性，有助于辅助人工分析；此外，决策树的分类效率高，一次构建后可以反复使用，而且每一次预测的计算次数不超过决策树的深度。</p>\n<p>当然，决策树也有其缺点。对于连续的特征，比较难以处理，对于多分类问题，计算量和准确率都不理想。此外，在实际应用中，由于其最底层叶子节点是通过父节点中的单一规则生成的，所以通过手动修改样本特征比较容易欺骗分类器，比如在拦击邮件识别系统中，用户可能通过修改某一个关键特征，就可以骗过垃圾邮件识别系统。从实现上来讲，由于树的生成采用的是递归，随着样本规模的增大，计算量以及内存消耗会变得越来越大。</p>\n<p>此外，过拟合也是决策树面临的一个问题，完全训练的决策树(未进行剪纸，未限制Gain的阈值)能够100%准确地预测训练样本，因为其是对训练样本的完全拟合，但是，对与训练样本以外的样本，其预测效果可能会不理想，这就是过拟合。解决决策树的过拟合，除了上文说到的通过设置Gain的阈值作为停止条件之外，通常还需要对决策树进行剪枝，常用的剪枝策略有：</p>\n<ol>\n<li>Pessimistic Error Pruning：悲观错误剪枝</li>\n<li>Minimum Error Pruning：最小误差剪枝</li>\n<li>Cost-Complexity Pruning：代价复杂剪枝</li>\n<li> Error-Based Pruning：基于错误的剪枝，即对每一个节点，都用一组测试数据集进行测试，如果分裂之后，能够降低错误率，再继续分裂为两棵子树，否则直接作为叶子节点。</li>\n<li>Critical Value Pruning：关键值剪枝，这就是上文中提到的设置Gain的阈值作为停止条件。</li>\n</ol>\n<p>我们以最简单的方式展示了ID3决策树的实现方式，如果想要了解不同类型的决策树的差别，可以参考<a href=\"https://www.quora.com/What-are-the-differences-between-ID3-C4-5-and-CART\" target=\"_blank\">这个链接</a>。</p>\n<p>另外，关于各种机器学习算法的实现，强烈推荐参考Github仓库<a href=\"https://github.com/eriklindernoren/ML-From-Scratch.git\" target=\"_blank\">ML-From-Scratch</a>，下载代码之后，通过<strong><span style=\"color: #ff0000\"><code>pip install -r requirements.txt</code></span></strong>安装依赖库即可运行代码。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112206\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112206votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112206\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "从集装箱历史看 DevOps 的发展进程", "url": "http://blog.jobbole.com/112115/", "front_image_url": ["http://insights.thoughtworkers.org/wp-content/uploads/2017/08/productivity-technology-1024x564.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,DevOps", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>什么样的技术会带来生产力的极大提升？技术含量是否与生产力提升成正比关系？</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/productivity-technology.jpg\"><img class=\"aligncenter\" src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/productivity-technology-1024x564.jpg\" alt=\"\" width=\"700\" height=\"386\"></a></p>\n<p>带着问题，我们先看一个例子：在工业革命时期，瓦特用于“改良”蒸汽机的技术，就是极大提升效率的技术。</p>\n<p>这里有一个误解，有人认为瓦特发明了蒸汽机。其实不然，瓦特只是改良了纽卡门蒸汽机，通过橡胶增加密闭性同时优化机械结构，使得原本只能用于提水的笨重机器，变得能被广泛应用，为第一次工业革命的兴起奠定了重要基础。</p>\n<p>从上面的例子可以看出技术含量的高低与带来生产力的大小并没有直接关系。</p>\n<h3>传奇的集装箱</h3>\n<p>我们来看另外一个有趣的故事，希望你能从中得到启发。那就是改变运输业、对制造业有着深远影响的一项革命性技术——集装箱（英文container，你没看错，它的名字和现在火的一塌糊涂的“容器技术”同名 ）。</p>\n<p>说到集装箱不能不提马尔科姆·麦克莱恩（1915—2001），20世纪四十年代美国一家运输公司的老板，由于改造（改造不是发明）了集装箱、提高了集装箱的便利性，推动了整个运输行业的巨大变革，而被尊称为“集装箱运输之父”。</p>\n<p>那么问题来了：改造蒸汽机也许有些技术含量，但是技术含量连罐头都不如（抽真空和密封技术）的集装箱怎么可能有这么大的影响呢？</p>\n<p style=\"text-align: center;\"><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/1-Malcolm-McDowell-1.png\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/1-Malcolm-McDowell-1.png\" alt=\"\" width=\"482\" height=\"325\"></a></p>\n<p style=\"text-align: center;\">（集装箱之父麦克莱恩：改造不仅限于集装箱本身，还包括港口和货轮等运输环节）</p>\n<p>我们知道工业社会最重要的竞争来自于节约成本，如果一个技术可以节省95%的成本就相当于带来20倍的效率提升。这种技术可以说是颠覆性的，而集装箱就是这样的技术。</p>\n<p>麦克莱恩在纽约港第一次做的集装箱运输实验就实现了20倍的效率提升：使用集装箱运输啤酒，将每吨啤酒的运输成本从4美金变成20美分。</p>\n<p>过程是这样的：从啤酒工厂把啤酒装入集装箱开始，通过陆路转海路运输到目的地，省去了工厂到陆路运输、再到海洋运输的中间人力搬运过程，因此从工厂到码头的装卸时间大大缩短，由数天压缩到数小时，从而使得美国到欧洲的货运时间足足减少了4周。并且由于集装箱的堆叠使得每一艘船只的储运量比以前提高了6倍。</p>\n<p>在传统运输过程，货物没有统一的包装标准，这既限制了运输工具的运载量，又增加了货物在从陆路运输到海路运输低效的手工搬运过程。集装箱这个标准化的运输单元，就为在整个运输系统优化中间流转效率提供了一种可能。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/2-transportation-system.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/2-transportation-system.jpg\" alt=\"\" width=\"975\" height=\"198\"></a></p>\n<p>（运输体系中间环节）</p>\n<p>看到这里，我不由得联想到传统软件研发测试与发布的过程。虽然每个过程内部自动化程度很高，但是部门之间的流转却依靠低效的手工操作，这些过程大大降低了整体效率。</p>\n<h3>系统性创新的窘境</h3>\n<p>但是非常意外的是，麦克莱恩在接下来10多年的航运生意中不仅没赚到钱，反而是亏损了。这就太奇怪了，一个能让效率提升20倍的技术，为什么会不赚钱呢？</p>\n<p>原因在于，在当时的运输行业，大部分货物并没有使用集装箱，大量的手工搬运使得船只装卸货物并没有节省多少时间，还有集装箱运到目的地后，箱内的货物需要分别运到不同的地方等等。</p>\n<p>因此集装箱技术并不在于“箱子”本身，而在于需要整个运输系统的创新——在道路、桥梁、卡车、码头和吊装设备等基础设施没有针对“箱子”进行优化的情况下，集装箱技术无法发挥出原有的效能。</p>\n<p>让我们回到最开始的问题：“什么样的技术会带来生产力的极大提升呢?”</p>\n<p><strong>那些创新了人与事物连接方式，且极大降低这种连接成本的技术，才能真正促进生产力的提升。</strong></p>\n<p><strong><a href=\"https://baike.baidu.com/item/devops/2613029?fr=aladdin\">DevOps</a>正是这样的技术，它是针对研发系统的一次系统性创新。其创新性在于针对整个研发系统中的各个子系统进行交付与反馈的优化，从而有效提升整体效率。</strong></p>\n<p>相对于传统软件6个月发布一次，2009年<a href=\"https://conferences.oreilly.com/velocity/velocity2009/public/schedule/detail/7641\">John Allspaw 和Paul Hammond在Flickr</a>可以实现每天发布10次，将软件发布频率提升了将近两千倍，极大地降低了软件发布的成本。</p>\n<p>但是大部分公司在实施DevOps的过程中，并没有有效提升发布频率，这一点与集装箱在最开始的10年内并不赚钱的道理是相似的。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/3-development-platform.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/3-development-platform.jpg\" alt=\"\" width=\"975\" height=\"208\"></a></p>\n<p>（应用研发平台：描述构建软件包，在不同的环境进行测试、最终发布生产环境的过程）</p>\n<p>问题在于系统性创新初期，各个环节没有对新技术进行优化，部分环节甚至会阻碍新技术发展，导致新技术无法提升效能。</p>\n<h3>转机带来的启示</h3>\n<p>一切直到1967年才出现转机。美国发动了越南战争，美军需要将大量物资运输到亚洲。在长期的优化实践中，美军得出高效运用集装箱的3C原则：<strong>一种货物、一个地址、一个客户</strong>。</p>\n<p>从此，集装箱的时代到来了。只在1967年一年的时间里，麦克莱恩就从美国国防部赚了4.5亿美金。低廉的海运成本、大大缩短的运输时间以及到货时间的可预期，让全球制造业的分工协作效率得到极大的提高。行驶在大洋上的货轮，就像在生产车间里运输原材料的叉车一样，使得制造业不必大量囤积原材料，后来丰田的“零库存”计划更是将原料的管控能力发挥到了极致。</p>\n<p>为什么3C原则可以极大提升效率？它正是通过解决运输“中间环节”过程的低效问题，使得总体效率得到极大提升。下面分别加以说明：</p>\n<ul>\n<li><strong>一种货物</strong>：在货物“装箱”过程，统一货物的来源与种类，标准化货物装箱过程。</li>\n<li><strong>一个地址：</strong>在货物“分拣”过程中，不会打开集装箱，只做一次装箱。</li>\n<li><strong>一个客户：</strong>在货物“送货”过程，只有一个客户，简化送货的过程。</li>\n</ul>\n<h3>DevOps流程的3D原则</h3>\n<p>与如何高效利用集装箱类似，在DevOps实施过程中，通过优化流水线中间流转过程，提升总体效率。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/0%E7%9A%84%E5%89%AF%E6%9C%AC-1.jpeg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/08/0%E7%9A%84%E5%89%AF%E6%9C%AC-1-1024x557.jpeg\" alt=\"\" width=\"700\" height=\"381\"></a></p>\n<p>下面举出与3C原则对应的3D原则：</p>\n<ul>\n<li><strong>一键式部署(Automatic Deploy)：</strong>部署过程中，标准化部署过程，实现一键式部署</li>\n<li><strong>一次构建打包（Automatic Delivery）：</strong>在测试环境、UAT环境和生产环境的流转过程中，只打包一次，软件包按顺序自动交付到各个环境，最终发布到生产环境</li>\n<li><strong>一次配置分发（Automatic Distribution)：</strong>在生产环境发布过程，建立统一的配置分发管理，将繁琐的分布式环境配置一次分发到各个数据中心，简化发布过程。</li>\n</ul>\n<p>“科技是第一生产力！”如果我们以技术含量来衡量一个创新会很容易走入误区。集装箱发展历史告诉我们，从状态的流转环节入手，降低流转成本是提高总体效能的另外一个途径。</p>\n<p>集装箱发展历史的前十年完成了道路、桥梁、隧道、卡车、码头设施、吊装设备的优化，以适应集装箱的发展。这个进程的难点在于，以一家运输企业推进整个运输体系针对集装箱的优化。</p>\n<p>随着技术的发展，DevOps的周边环节正在逐步完善，DevOps实施的3D原则，也让我们走入故事的后半段，就像集装箱的故事那样。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112115\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112115votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112115\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 72</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "如何做有效的Code Review？我有这些建议", "url": "http://blog.jobbole.com/112050/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/8d67b7db1e9704c55aad01b886ec4c46.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 4, "tags": "IT技术,Code Review", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/maifansnet\">maifans</a> 翻译，<a href=\"http://www.jobbole.com/members/hearingdog\">BEASTQ</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://codeahoy.com/2016/04/03/effective-code-reviews/\">codeahoy</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>代码评审（Code review）是保证代码质量的一种有效手段，做得好的话，对公司来讲是一笔收益颇高的时间投资。但实践起来往往变成了炫耀编程技能、固执己见、恶言相向、同事关系恶化的事，这该如何是好？</p>\n<p>往往代码评审过程中，评审者（Reviewer）往往会过于关心旁枝末节，而忽视主要问题，也就是所谓的自行车棚效应。在批准价值百亿的核电站的建设提案中，专家们往往会浪费大量时间纠结于厂内自行车棚（bikeshed）的颜色；因为核电站太大、太复杂，“专家们”未必真懂，但总不能不说话啊，那就从无关痛痒的自行车棚挑毛病吧。</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2013/02/how-to-code-review.jpg\" width=\"400\" height=\"649\"></p>\n<h3>有效的代码评审</h3>\n<p>代码评审是开发人员编写的代码由另一个人检查以查找缺陷和改进的过程。换句话说，开发人员大部分都是独立编写代码的，当代码完成之后，他们会召集一次评审。</p>\n<p>代码评审是提高软件质量的有效途径。在Google，所有代码都要经过同行评审。引用《<a href=\"https://www.amazon.cn/gp/product/B0061XKRXA/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B0061XKRXA&amp;linkCode=as2&amp;tag=vastwork-23\" target=\"_blank\">代码大全（第2版）</a>》中的几个例子：</p>\n<blockquote>\n<ul>\n<li>IBM 的 Orbit 项目有 50 万行代码，使用了 11 级的检查。它提前交付，并且只有通常预期错误的百分之一。</li>\n<li>一份对 AT＆T 的一个 200 多人组织的研究报告显示，在引入评审后，生产率提高了14％，缺陷减少了90％。</li>\n<li>喷气推进实验室估计，通过早期发现和修复缺陷，每次评审节省约 25,000 美元。</li>\n</ul>\n</blockquote>\n<p>然而，不少团队在有效的代码评审争论中，失去了原本的效益。在功能失调的团队和组织中，对所有参与者来说它可以迅速变成一个<b>令人不快的经历</b>：</p>\n<ul>\n<li>它成为评审人员来展示技能的平台。他们在别人的代码中指出“错误”，并强加自己没有价值的“意见”。</li>\n<li>在代码完全就绪前，开发人员会非常抗拒别人审查他们的代码 ——可以说这可能是一件好事，但他没有真正理解评审的意义。</li>\n<li>开发人员放弃代码所有权，并开始依赖他人查找问题。</li>\n</ul>\n<p>在这篇文章中，我将讨论团队和组织可以做的一些事情，让代码评审为所有参与者带来愉快的体验。</p>\n<h3>对管理层的建议：营造健康文化</h3>\n<p><strong>有效的代码评审，需要一个重视质量和卓越的健康文化。</strong>如果团队不以提供高质量的产品为信仰，代码评审将不会给您所期望的结果。你需要一个人人参与的积极文化—立足于建设性批评，智者胜。</p>\n<p><strong>除了创造一个健康文化，并允许花时间和资源进行评审，管理者在代码评审中应保持低姿态。</strong>大多数人不想在上司面前暴露自己的秘密，这已是一种文化。代码评审最好由同行进行，管理层不应该询问可以用来评价人的细节<span style=\"font-family: Helvetica, sans-serif;\">。</span>的确有一些管理人员索要检查表和成绩，以便他们可以<span style=\"font-family: Helvetica, sans-serif;\">“</span>衡量<span style=\"font-family: Helvetica, sans-serif;\">”</span>并评价人。</p>\n<p><strong>可能你已经有一个健康的文化（算你幸运）。</strong>这还不够，营造健康的文化取决于许多因素（团队和组织内部）。这是非常具有挑战性的，没有灵丹妙药。没有正确的文化，代码评审不会带来期望的收获，甚至在极端情况下可能会适得其反。</p>\n<h3>对个人的建议：换位思考</h3>\n<p>Karl Wiegers 在他的《Peer Reviews in Software: A Practical Guide》中写道：</p>\n<blockquote><p>产品的作者与评审者之间的互动至关重要。<span style=\"color: #515151;\">作者必须足够信任和尊重评审者才能接受他们的意见。</span> <span style=\"color: #515151;\">同样，评审者必须尊重作者的才华和辛勤工作。评审者应谨慎选择他们用来提出问题的词汇，重点关注他们对产品的观察。说『我没有看到这些变量被初始化</span> <span style=\"color: #515151;\">』可能会引发建设性的反馈</span>， 而『你没有初始化这些变量』可能会让作者非常不爽。</p></blockquote>\n<p>关注代码很容易，但不要忘记，桌子（或计算机）的另一端有一个人。他有主见有<span style=\"font-family: Helvetica, sans-serif;\">“</span>自我<span style=\"font-family: Helvetica, sans-serif;\">”</span>。请记住，解决问题的方式有很多。</p>\n<ul>\n<li><strong>要谦虚。</strong>我既见过非常高效的评审，也见过因为吹毛求疵而非常低效的评审<span style=\"font-family: Helvetica, sans-serif;\">。</span>不要吹毛求疵<span style=\"font-family: Helvetica, sans-serif;\">！！！</span></li>\n<li><strong>确保您有编码标准<span style=\"font-family: Helvetica, sans-serif;\">。</span></strong>编码标准是在组织中共享的人人都认同的一套准则。如果你没有编码标准，那么不要让讨论变成一个比较编码风格的比赛（大括号 <span style=\"font-family: Helvetica, sans-serif;\"><strong><span style=\"color: #ff0000;\">{</span></strong> </span>在同一行还是下一行！）如果你遇到这样的情况，请在编码标准论坛上离线讨论<span style=\"font-family: Helvetica, sans-serif;\">。</span></li>\n<li><strong>学会良好地沟通。</strong>你必须能够清楚地表达想法和理由。</li>\n<li><strong>编程策略是一个仁者见仁智者见智的问题。</strong>评审者和开发人员应该寻求理解彼此的观点，而不应该成为哲学辩论</li>\n</ul>\n<h3>对评审者的建议：谦虚</h3>\n<ul>\n<li><strong>开发者不是冤大头。</strong>评审的目的不是证明谁是更优秀的程序员而是查找缺陷，并确保代码是简单和可维护的。</li>\n<li><strong>问问题。</strong>不要提出可能听起来带指责的要求或言论。例如，不要说：『你没有遵循标准<span style=\"font-family: Helvetica, sans-serif;\">XYZ</span>』。更好的方式是真正寻求理解开发者的观点：『你对标准 <span style=\"font-family: Helvetica, sans-serif;\">XYZ </span>有什么看法，它是否适用于这里？』，这可以引到我的下一个观点。</li>\n<li><strong>避免『你为什么』，『你为什么不』风格的问题。</strong>它会使人对立。 『为什么把它声明为全局变量？』可以更好地表达为『我不明白为什么这里用一个全局变量』。寻找方法来简化代码。代码评审的目标之一是创建<span style=\"font-family: Helvetica, sans-serif;\">“</span>可维护<span style=\"font-family: Helvetica, sans-serif;\">”</span>软件。</li>\n<li><strong>记住要欣赏并感谢对方。</strong>人们经常忘记一句简单的『干得好』或『它看起来很棒』的影响有多大。</li>\n</ul>\n<p>有些事情，如果看起来像排练过的或以讽刺的语气说出来，就不会奏效。像正常对话一样对待代码评审。你正在聆听他人，应该真正寻求理解他们的观点。需要时提供建议和提示。如果代码很棒，不要强迫找一些消极的来说。</p>\n<h3>对开发者的建议：它不是个人的事情</h3>\n<ul>\n<li><strong>不要感情用事。</strong>记住，别人说的不是，是代码中的缺陷或不足，而不是你。</li>\n<li><strong>意识到你和你的代码是捆绑在一起是正常的事情。</strong>如果你为自己的工作感到自豪，那是一个很好的迹象，说明你是一个关心作品的人。</li>\n<li><strong>有适当的自我。</strong><span style=\"font-family: Helvetica, sans-serif;\">足够信任和捍卫自己的观点，但又不至于盲目拒绝对方的好建议和意见</span>。</li>\n<li><strong>人非圣贤孰能无过。</strong>评审者作为第二双眼，可以指出你可能忽略的事情。问题与具体建议一样有价值。</li>\n<li><strong>提问题要有针对性。</strong>『将所有这些类纳入它们自己的软件包中是否更有意义』</li>\n<li><strong>感谢审稿人的时间和他们可能提供的任何反馈。</strong></li>\n</ul>\n<h3>总结</h3>\n<p><span style=\"font-family: Helvetica, sans-serif;\">同行评审是人们互相交流，而无效（ineffectiveness）则源于社会学问题。然而，管理者花费大量时间在操心使用哪些惊艳的工具。</span>工具会有所帮助，但只有工具并不会神奇地带来结果。立足于正确的文化同时<span style=\"font-family: Helvetica, sans-serif;\">…</span>换位思考，以人为本！<span style=\"font-family: Helvetica, sans-serif;\"> :-)</span></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112050\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112050votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112050\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/maifansnet\">maifans</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/maifansnet\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            软件工程师，关注人工智能，关注医疗器械。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/maifansnet\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/maifansnet/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/maifansnet/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 13</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "150 多个 ML、NLP 和 Python 相关的教程", "url": "http://blog.jobbole.com/112185/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/dbe885c03af6141ab8f7f68f5778895d.png"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 21, "tags": "工具与资源,nlp,Python,人工智能,机器学习,深度学习", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/shaozhengjiang\">iPytLab</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://unsupervisedmethods.com/over-150-of-the-best-machine-learning-nlp-and-python-tutorials-ive-found-ffce2939bd78\">Robbie Allen</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>机器学习已经发展了很久，它的<a href=\"https://en.wikipedia.org/wiki/Machine_learning#History_and_relationships_to_other_fields\" target=\"_blank\" rel=\"external\">历史</a>可以追溯到1959年，但是如今此领域的发展速度可以说是空前的。在最近的几篇文章中，我讨论了人工智能领域为何会在现在以及不久的将来持续蓬勃发展。如今很多对机器学习感兴趣的同学都普遍表示入门很难。</p>\n<p>在准备博士课题的期间，我尝试在网络上搜索与机器学习和自然语言处理相关的优秀资源。当我找了一个有趣的教程或者视频，从这个教程或者视频出发我又可以找到三四个更多的教程或视频，最终就会出现的画面就是我还没有开始认真研究第一个找到的教程，浏览器已经打开了 20 个标签等待我去浏览了。（注: <a href=\"https://www.tabbundler.com/\" target=\"_blank\" rel=\"external\">Tab Bundler</a> 可以帮助让我们的标签更有条理）。</p>\n<p>在找到了超过 25 个与机器学习相关的速查表后，<a href=\"http://blog.jobbole.com/112009/\" target=\"_blank\">我写了篇文章, 在里面整理了所有优秀的速查表</a>。</p>\n<p>为了给后面学习的童鞋铺路，我将我找到的最好的一些教程内容整理成了一份列表。这份列表并没有包含所有网上能找到的与机器学习相关的教程，否则这份列表将会过于臃肿。我的目标就是将我在机器学习和自然语言处理领域各个方面找到的我认为最好的教程整理出来。</p>\n<p>在教程中，为了能够更好的让读者理解其中的概念，我将避免罗列书中每章的详细内容，而是总结一些概念性的介绍内容。为什么不直接去买本书？当你想要对某些特定的主题或者不同方面进行了初步了解时，我相信这些教程对你可能帮助更大。</p>\n<p>本文中我将分四个主题进行整理：机器学习、自然语言处理、Python 和数学。在每个主题中我将包含一个例子和多个资源。当然我不可能完全覆盖所有的主题啦。</p>\n<p>在将来，我也将会整理一系列类似的资源列表，包括书籍，视频和代码项目等。因为我目前也的确正在编译这些资源。</p>\n<p>如果你发现我在这里遗漏了好的教程资源，请联系告诉我。为了避免资源重复罗列，我在每个主题下只列出了5、6个教程。下面的每个链接都应该链接了和其他链接不同的资源，也会通过不同的方式（例如幻灯片代码段)或者不同的角度呈现出这些内容。</p>\n<h3 id=\"机器学习\">机器学习</h3>\n<ul>\n<li><a href=\"https://medium.com/@ageitgey/machine-learning-is-fun-80ea3ec3c471\" target=\"_blank\" rel=\"external\">Machine Learning is Fun!</a> (medium.com/@ageitgey)</li>\n<li>Machine Learning Crash Course: <a href=\"https://ml.berkeley.edu/blog/2016/11/06/tutorial-1/\" target=\"_blank\" rel=\"external\">Part I</a>, <a href=\"https://ml.berkeley.edu/blog/2016/12/24/tutorial-2/\" target=\"_blank\" rel=\"external\">Part II</a>, <a href=\"https://ml.berkeley.edu/blog/2017/02/04/tutorial-3/\" target=\"_blank\" rel=\"external\">Part III</a> (Machine Learning at Berkeley)</li>\n<li><a href=\"https://www.toptal.com/machine-learning/machine-learning-theory-an-introductory-primer\" target=\"_blank\" rel=\"external\">An Introduction to Machine Learning Theory and Its Applications: A Visual Tutorial with Examples</a>(toptal.com)</li>\n<li><a href=\"https://monkeylearn.com/blog/a-gentle-guide-to-machine-learning/\" target=\"_blank\" rel=\"external\">A Gentle Guide to Machine Learning</a> (monkeylearn.com)</li>\n<li><a href=\"https://blogs.sas.com/content/subconsciousmusings/2017/04/12/machine-learning-algorithm-use/\" target=\"_blank\" rel=\"external\">Which machine learning algorithm should I use?</a> (sas.com)</li>\n</ul>\n<h4 id=\"激活函数和损失函数\">激活函数和损失函数</h4>\n<ul>\n<li><a href=\"http://neuralnetworksanddeeplearning.com/chap1.html#sigmoid_neurons\" target=\"_blank\" rel=\"external\">Sigmoid neurons</a> (neuralnetworksanddeeplearning.com)</li>\n<li><a href=\"https://www.quora.com/What-is-the-role-of-the-activation-function-in-a-neural-network\" target=\"_blank\" rel=\"external\">What is the role of the activation function in a neural network?</a> (quora.com)</li>\n<li><a href=\"https://stats.stackexchange.com/questions/115258/comprehensive-list-of-activation-functions-in-neural-networks-with-pros-cons\" target=\"_blank\" rel=\"external\">Comprehensive list of activation functions in neural networks with pros/cons</a> (stats.stackexchange.com)</li>\n<li><a href=\"https://medium.com/towards-data-science/activation-functions-and-its-types-which-is-better-a9a5310cc8f\" target=\"_blank\" rel=\"external\">Activation functions and it’s types-Which is better?</a> (medium.com)</li>\n<li><a href=\"http://www.exegetic.biz/blog/2015/12/making-sense-logarithmic-loss/\" target=\"_blank\" rel=\"external\">Making Sense of Logarithmic Loss</a> (exegetic.biz)</li>\n<li><a href=\"http://cs231n.github.io/neural-networks-2/#losses\" target=\"_blank\" rel=\"external\">Loss Functions</a> (Stanford CS231n)</li>\n<li><a href=\"http://rishy.github.io/ml/2015/07/28/l1-vs-l2-loss/\" target=\"_blank\" rel=\"external\">L1 vs. L2 Loss function</a> (rishy.github.io)</li>\n<li><a href=\"http://neuralnetworksanddeeplearning.com/chap3.html#the_cross-entropy_cost_function\" target=\"_blank\" rel=\"external\">The cross-entropy cost function</a> (neuralnetworksanddeeplearning.com)</li>\n</ul>\n<h4 id=\"偏差\">偏差</h4>\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/2480650/role-of-bias-in-neural-networks/2499936#2499936\" target=\"_blank\" rel=\"external\">Role of Bias in Neural Networks</a> (stackoverflow.com)</li>\n<li><a href=\"http://makeyourownneuralnetwork.blogspot.com/2016/06/bias-nodes-in-neural-networks.html\" target=\"_blank\" rel=\"external\">Bias Nodes in Neural Networks</a> (makeyourownneuralnetwork.blogspot.com)</li>\n<li><a href=\"https://www.quora.com/What-is-bias-in-artificial-neural-network\" target=\"_blank\" rel=\"external\">What is bias in artificial neural network?</a> (quora.com)</li>\n</ul>\n<h4 id=\"感知器\">感知器</h4>\n<ul>\n<li><a href=\"http://neuralnetworksanddeeplearning.com/chap1.html#perceptrons\" target=\"_blank\" rel=\"external\">Perceptrons</a> (neuralnetworksanddeeplearning.com)</li>\n<li><a href=\"http://natureofcode.com/book/chapter-10-neural-networks/#chapter10_figure3\" target=\"_blank\" rel=\"external\">The Perception</a> (natureofcode.com)</li>\n<li><a href=\"http://computing.dcu.ie/~humphrys/Notes/Neural/single.neural.html\" target=\"_blank\" rel=\"external\">Single-layer Neural Networks (Perceptrons)</a> (dcu.ie)</li>\n<li><a href=\"https://www.toptal.com/machine-learning/an-introduction-to-deep-learning-from-perceptrons-to-deep-networks\" target=\"_blank\" rel=\"external\">From Perceptrons to Deep Networks</a> (toptal.com)</li>\n</ul>\n<h4 id=\"回归\">回归</h4>\n<ul>\n<li><a href=\"http://people.duke.edu/~rnau/regintro.htm\" target=\"_blank\" rel=\"external\">Introduction to linear regression analysis</a> (duke.edu)</li>\n<li><a href=\"http://ufldl.stanford.edu/tutorial/supervised/LinearRegression/\" target=\"_blank\" rel=\"external\">Linear Regression</a> (ufldl.stanford.edu)</li>\n<li><a href=\"http://ml-cheatsheet.readthedocs.io/en/latest/linear_regression.html\" target=\"_blank\" rel=\"external\">Linear Regression</a> (readthedocs.io)</li>\n<li><a href=\"http://ml-cheatsheet.readthedocs.io/en/latest/logistic_regression.html\" target=\"_blank\" rel=\"external\">Logistic Regression</a> (readthedocs.io)</li>\n<li><a href=\"http://machinelearningmastery.com/simple-linear-regression-tutorial-for-machine-learning/\" target=\"_blank\" rel=\"external\">Simple Linear Regression Tutorial for Machine Learning</a> (machinelearningmastery.com)</li>\n<li><a href=\"http://machinelearningmastery.com/logistic-regression-tutorial-for-machine-learning/\" target=\"_blank\" rel=\"external\">Logistic Regression Tutorial for Machine Learning</a> (machinelearningmastery.com)</li>\n<li><a href=\"http://ufldl.stanford.edu/tutorial/supervised/SoftmaxRegression/\" target=\"_blank\" rel=\"external\">Softmax Regression</a> (ufldl.stanford.edu)</li>\n</ul>\n<h4 id=\"梯度下降\">梯度下降</h4>\n<ul>\n<li><a href=\"http://neuralnetworksanddeeplearning.com/chap1.html#learning_with_gradient_descent\" target=\"_blank\" rel=\"external\">Learning with gradient descent</a> (neuralnetworksanddeeplearning.com)</li>\n<li><a href=\"http://iamtrask.github.io/2015/07/27/python-network-part2/\" target=\"_blank\" rel=\"external\">Gradient Descent</a> (iamtrask.github.io)</li>\n<li><a href=\"http://www.kdnuggets.com/2017/04/simple-understand-gradient-descent-algorithm.html\" target=\"_blank\" rel=\"external\">How to understand Gradient Descent algorithm</a> (kdnuggets.com)</li>\n<li><a href=\"http://sebastianruder.com/optimizing-gradient-descent/\" target=\"_blank\" rel=\"external\">An overview of gradient descent optimization algorithms</a> (sebastianruder.com)</li>\n<li><a href=\"http://cs231n.github.io/optimization-1/\" target=\"_blank\" rel=\"external\">Optimization: Stochastic Gradient Descent</a> (Stanford CS231n)</li>\n</ul>\n<h4 id=\"生成学习\">生成学习</h4>\n<ul>\n<li><a href=\"http://cs229.stanford.edu/notes/cs229-notes2.pdf\" target=\"_blank\" rel=\"external\">Generative Learning Algorithms</a> (Stanford CS229)</li>\n<li><a href=\"https://monkeylearn.com/blog/practical-explanation-naive-bayes-classifier/\" target=\"_blank\" rel=\"external\">A practical explanation of a Naive Bayes classifier</a> (monkeylearn.com)</li>\n</ul>\n<h4 id=\"支持向量机\">支持向量机</h4>\n<ul>\n<li><a href=\"https://monkeylearn.com/blog/introduction-to-support-vector-machines-svm/\" target=\"_blank\" rel=\"external\">An introduction to Support Vector Machines (SVM)</a> (monkeylearn.com)</li>\n<li><a href=\"http://cs229.stanford.edu/notes/cs229-notes3.pdf\" target=\"_blank\" rel=\"external\">Support Vector Machines</a> (Stanford CS229)</li>\n<li><a href=\"http://cs231n.github.io/linear-classify/\" target=\"_blank\" rel=\"external\">Linear classification: Support Vector Machine, Softmax</a> (Stanford 231n)</li>\n</ul>\n<h4 id=\"反向传播\">反向传播</h4>\n<ul>\n<li><a href=\"https://medium.com/@karpathy/yes-you-should-understand-backprop-e2f06eab496b\" target=\"_blank\" rel=\"external\">Yes you should understand backprop</a> (medium.com/@karpathy)</li>\n<li><a href=\"https://github.com/rasbt/python-machine-learning-book/blob/master/faq/visual-backpropagation.md\" target=\"_blank\" rel=\"external\">Can you give a visual explanation for the back propagation algorithm for neural networks?</a>(github.com/rasbt)</li>\n<li><a href=\"http://neuralnetworksanddeeplearning.com/chap2.html\" target=\"_blank\" rel=\"external\">How the backpropagation algorithm works</a> (neuralnetworksanddeeplearning.com)</li>\n<li><a href=\"http://www.wildml.com/2015/10/recurrent-neural-networks-tutorial-part-3-backpropagation-through-time-and-vanishing-gradients/\" target=\"_blank\" rel=\"external\">Backpropagation Through Time and Vanishing Gradients</a> (wildml.com)</li>\n<li><a href=\"http://machinelearningmastery.com/gentle-introduction-backpropagation-time/\" target=\"_blank\" rel=\"external\">A Gentle Introduction to Backpropagation Through Time</a> (machinelearningmastery.com)</li>\n<li><a href=\"http://cs231n.github.io/optimization-2/\" target=\"_blank\" rel=\"external\">Backpropagation, Intuitions</a> (Stanford CS231n)</li>\n</ul>\n<h4 id=\"深度学习\">深度学习</h4>\n<ul>\n<li><a href=\"http://nikhilbuduma.com/2014/12/29/deep-learning-in-a-nutshell/\" target=\"_blank\" rel=\"external\">Deep Learning in a Nutshell</a> (nikhilbuduma.com)</li>\n<li><a href=\"http://ai.stanford.edu/~quocle/tutorial1.pdf\" target=\"_blank\" rel=\"external\">A Tutorial on Deep Learning</a> (Quoc V. Le)</li>\n<li><a href=\"http://machinelearningmastery.com/what-is-deep-learning/\" target=\"_blank\" rel=\"external\">What is Deep Learning?</a> (machinelearningmastery.com)</li>\n<li><a href=\"https://blogs.nvidia.com/blog/2016/07/29/whats-difference-artificial-intelligence-machine-learning-deep-learning-ai/\" target=\"_blank\" rel=\"external\">What’s the Difference Between Artificial Intelligence, Machine Learning, and Deep Learning?</a> (nvidia.com)</li>\n</ul>\n<h4 id=\"优化和降维\">优化和降维</h4>\n<ul>\n<li><a href=\"https://www.knime.org/blog/seven-techniques-for-data-dimensionality-reduction\" target=\"_blank\" rel=\"external\">Seven Techniques for Data Dimensionality Reduction</a> (knime.org)</li>\n<li><a href=\"http://cs229.stanford.edu/notes/cs229-notes10.pdf\" target=\"_blank\" rel=\"external\">Principal components analysis</a> (Stanford CS229)</li>\n<li><a href=\"http://videolectures.net/site/normal_dl/tag=741100/nips2012_hinton_networks_01.pdf\" target=\"_blank\" rel=\"external\">Dropout: A simple way to improve neural networks</a> (Hinton @ NIPS 2012)</li>\n<li><a href=\"http://rishy.github.io/ml/2017/01/05/how-to-train-your-dnn/\" target=\"_blank\" rel=\"external\">How to train your Deep Neural Network</a> (rishy.github.io)</li>\n</ul>\n<h4 id=\"长短期记忆-LSTM\">长短期记忆(LSTM)</h4>\n<ul>\n<li><a href=\"http://machinelearningmastery.com/gentle-introduction-long-short-term-memory-networks-experts/\" target=\"_blank\" rel=\"external\">A Gentle Introduction to Long Short-Term Memory Networks by the Experts</a> (machinelearningmastery.com)</li>\n<li><a href=\"http://colah.github.io/posts/2015-08-Understanding-LSTMs/\" target=\"_blank\" rel=\"external\">Understanding LSTM Networks</a> (colah.github.io)</li>\n<li><a href=\"http://blog.echen.me/2017/05/30/exploring-lstms/\" target=\"_blank\" rel=\"external\">Exploring LSTMs</a> (echen.me)</li>\n<li><a href=\"http://iamtrask.github.io/2015/11/15/anyone-can-code-lstm/\" target=\"_blank\" rel=\"external\">Anyone Can Learn To Code an LSTM-RNN in Python</a> (iamtrask.github.io)</li>\n</ul>\n<h4 id=\"卷积神经网络-CNNs\">卷积神经网络(CNNs)</h4>\n<ul>\n<li><a href=\"http://neuralnetworksanddeeplearning.com/chap6.html#introducing_convolutional_networks\" target=\"_blank\" rel=\"external\">Introducing convolutional networks</a> (neuralnetworksanddeeplearning.com)</li>\n<li><a href=\"https://medium.com/@ageitgey/machine-learning-is-fun-part-3-deep-learning-and-convolutional-neural-networks-f40359318721\" target=\"_blank\" rel=\"external\">Deep Learning and Convolutional Neural Networks</a> (medium.com/@ageitgey)</li>\n<li><a href=\"http://colah.github.io/posts/2014-07-Conv-Nets-Modular/\" target=\"_blank\" rel=\"external\">Conv Nets: A Modular Perspective</a> (colah.github.io)</li>\n<li><a href=\"http://colah.github.io/posts/2014-07-Understanding-Convolutions/\" target=\"_blank\" rel=\"external\">Understanding Convolutions</a> (colah.github.io)</li>\n</ul>\n<h4 id=\"循环神经网络-RNNs\">循环神经网络(RNNs)</h4>\n<p><a href=\"http://www.wildml.com/2015/09/recurrent-neural-networks-tutorial-part-1-introduction-to-rnns/\" target=\"_blank\" rel=\"external\">Recurrent Neural Networks Tutorial</a> (wildml.com)<br>\n<a href=\"http://distill.pub/2016/augmented-rnns/\" target=\"_blank\" rel=\"external\">Attention and Augmented Recurrent Neural Networks</a> (distill.pub)<br>\n<a href=\"http://karpathy.github.io/2015/05/21/rnn-effectiveness/\" target=\"_blank\" rel=\"external\">The Unreasonable Effectiveness of Recurrent Neural Networks</a> (karpathy.github.io)<br>\n<a href=\"http://nikhilbuduma.com/2015/01/11/a-deep-dive-into-recurrent-neural-networks/\" target=\"_blank\" rel=\"external\">A Deep Dive into Recurrent Neural Nets</a> (nikhilbuduma.com)</p>\n<h4 id=\"增强学习\">增强学习</h4>\n<ul>\n<li><a href=\"https://www.analyticsvidhya.com/blog/2017/01/introduction-to-reinforcement-learning-implementation/\" target=\"_blank\" rel=\"external\">Simple Beginner’s guide to Reinforcement Learning &amp; its implementation</a> (analyticsvidhya.com)</li>\n<li><a href=\"https://web.mst.edu/~gosavia/tutorial.pdf\" target=\"_blank\" rel=\"external\">A Tutorial for Reinforcement Learning</a> (mst.edu)</li>\n<li><a href=\"http://www.wildml.com/2016/10/learning-reinforcement-learning/\" target=\"_blank\" rel=\"external\">Learning Reinforcement Learning</a> (wildml.com)</li>\n<li><a href=\"http://karpathy.github.io/2016/05/31/rl/\" target=\"_blank\" rel=\"external\">Deep Reinforcement Learning: Pong from Pixels</a> (karpathy.github.io)</li>\n</ul>\n<h4 id=\"生成对抗网络-GANs\">生成对抗网络(GANs)</h4>\n<ul>\n<li><a href=\"https://blogs.nvidia.com/blog/2017/05/17/generative-adversarial-network/\" target=\"_blank\" rel=\"external\">What’s a Generative Adversarial Network?</a> (nvidia.com)</li>\n<li><a href=\"https://medium.com/@ageitgey/abusing-generative-adversarial-networks-to-make-8-bit-pixel-art-e45d9b96cee7\" target=\"_blank\" rel=\"external\">Abusing Generative Adversarial Networks to Make 8-bit Pixel Art</a> (medium.com/@ageitgey)</li>\n<li><a href=\"http://blog.aylien.com/introduction-generative-adversarial-networks-code-tensorflow/\" target=\"_blank\" rel=\"external\">An introduction to Generative Adversarial Networks (with code in TensorFlow)</a> (aylien.com)</li>\n<li><a href=\"https://www.oreilly.com/learning/generative-adversarial-networks-for-beginners\" target=\"_blank\" rel=\"external\">Generative Adversarial Networks for Beginners</a> (oreilly.com)</li>\n</ul>\n<h4 id=\"多任务学习\">多任务学习</h4>\n<ul>\n<li><a href=\"http://sebastianruder.com/multi-task/index.html\" target=\"_blank\" rel=\"external\">An Overview of Multi-Task Learning in Deep Neural Networks</a> (sebastianruder.com)</li>\n</ul>\n<h3 id=\"自然语言处理-NLP\">自然语言处理(NLP)</h3>\n<ul>\n<li><a href=\"http://u.cs.biu.ac.il/~yogo/nnlp.pdf\" target=\"_blank\" rel=\"external\">A Primer on Neural Network Models for Natural Language Processing</a> (Yoav Goldberg)</li>\n<li><a href=\"https://monkeylearn.com/blog/the-definitive-guide-to-natural-language-processing/\" target=\"_blank\" rel=\"external\">The Definitive Guide to Natural Language Processing</a> (monkeylearn.com)</li>\n<li><a href=\"https://blog.algorithmia.com/introduction-natural-language-processing-nlp/\" target=\"_blank\" rel=\"external\">Introduction to Natural Language Processing</a> (algorithmia.com)</li>\n<li><a href=\"http://www.vikparuchuri.com/blog/natural-language-processing-tutorial/\" target=\"_blank\" rel=\"external\">Natural Language Processing Tutorial</a> (vikparuchuri.com)</li>\n<li><a href=\"https://arxiv.org/pdf/1103.0398.pdf\" target=\"_blank\" rel=\"external\">Natural Language Processing (almost) from Scratch</a> (arxiv.org)</li>\n</ul>\n<h4 id=\"深度学习与NLP\">深度学习与NLP</h4>\n<ul>\n<li><a href=\"https://arxiv.org/pdf/1703.03091.pdf\" target=\"_blank\" rel=\"external\">Deep Learning applied to NLP</a> (arxiv.org)</li>\n<li><a href=\"https://nlp.stanford.edu/courses/NAACL2013/NAACL2013-Socher-Manning-DeepLearning.pdf\" target=\"_blank\" rel=\"external\">Deep Learning for NLP (without Magic)</a> (Richard Socher)</li>\n<li><a href=\"http://www.wildml.com/2015/11/understanding-convolutional-neural-networks-for-nlp/\" target=\"_blank\" rel=\"external\">Understanding Convolutional Neural Networks for NLP</a> (wildml.com)</li>\n<li><a href=\"http://colah.github.io/posts/2014-07-NLP-RNNs-Representations/\" target=\"_blank\" rel=\"external\">Deep Learning, NLP, and Representations</a> (colah.github.io)</li>\n<li><a href=\"https://explosion.ai/blog/deep-learning-formula-nlp\" target=\"_blank\" rel=\"external\">Embed, encode, attend, predict: The new deep learning formula for state-of-the-art NLP models</a>(explosion.ai)</li>\n<li><a href=\"https://devblogs.nvidia.com/parallelforall/understanding-natural-language-deep-neural-networks-using-torch/\" target=\"_blank\" rel=\"external\">Understanding Natural Language with Deep Neural Networks Using Torch</a> (nvidia.com)</li>\n<li><a href=\"http://pytorch.org/tutorials/beginner/deep_learning_nlp_tutorial.html\" target=\"_blank\" rel=\"external\">Deep Learning for NLP with Pytorch</a> (pytorich.org)</li>\n</ul>\n<h4 id=\"词向量\">词向量</h4>\n<ul>\n<li><a href=\"https://www.kaggle.com/c/word2vec-nlp-tutorial\" target=\"_blank\" rel=\"external\">Bag of Words Meets Bags of Popcorn</a> (kaggle.com)</li>\n<li>On word embeddings <a href=\"http://sebastianruder.com/word-embeddings-1/index.html\" target=\"_blank\" rel=\"external\">Part I</a>, <a href=\"http://sebastianruder.com/word-embeddings-softmax/index.html\" target=\"_blank\" rel=\"external\">Part II</a>, <a href=\"http://sebastianruder.com/secret-word2vec/index.html\" target=\"_blank\" rel=\"external\">Part III</a> (sebastianruder.com)</li>\n<li><a href=\"https://blog.acolyer.org/2016/04/21/the-amazing-power-of-word-vectors/\" target=\"_blank\" rel=\"external\">The amazing power of word vectors</a> (acolyer.org)</li>\n<li><a href=\"https://arxiv.org/pdf/1411.2738.pdf\" target=\"_blank\" rel=\"external\">word2vec Parameter Learning Explained</a> (arxiv.org)</li>\n<li>Word2Vec Tutorial — <a href=\"http://mccormickml.com/2016/04/19/word2vec-tutorial-the-skip-gram-model/\" target=\"_blank\" rel=\"external\">The Skip-Gram Model</a>, <a href=\"http://mccormickml.com/2017/01/11/word2vec-tutorial-part-2-negative-sampling/\" target=\"_blank\" rel=\"external\">Negative Sampling</a> (mccormickml.com)</li>\n</ul>\n<h4 id=\"编码器-解码器\">编码器-解码器</h4>\n<ul>\n<li><a href=\"http://www.wildml.com/2016/01/attention-and-memory-in-deep-learning-and-nlp/\" target=\"_blank\" rel=\"external\">Attention and Memory in Deep Learning and NLP</a> (wildml.com)</li>\n<li><a href=\"https://www.tensorflow.org/tutorials/seq2seq\" target=\"_blank\" rel=\"external\">Sequence to Sequence Models</a> (tensorflow.org)</li>\n<li><a href=\"https://papers.nips.cc/paper/5346-sequence-to-sequence-learning-with-neural-networks.pdf\" target=\"_blank\" rel=\"external\">Sequence to Sequence Learning with Neural Networks</a> (NIPS 2014)</li>\n<li><a href=\"https://medium.com/@ageitgey/machine-learning-is-fun-part-5-language-translation-with-deep-learning-and-the-magic-of-sequences-2ace0acca0aa\" target=\"_blank\" rel=\"external\">Machine Learning is Fun Part 5: Language Translation with Deep Learning and the Magic of Sequences</a>(medium.com/@ageitgey)</li>\n<li><a href=\"http://machinelearningmastery.com/how-to-use-an-encoder-decoder-lstm-to-echo-sequences-of-random-integers/\" target=\"_blank\" rel=\"external\">How to use an Encoder-Decoder LSTM to Echo Sequences of Random Integers</a>(machinelearningmastery.com)</li>\n<li><a href=\"https://google.github.io/seq2seq/\" target=\"_blank\" rel=\"external\">tf-seq2seq</a> (google.github.io)</li>\n</ul>\n<h3 id=\"Python\">Python</h3>\n<ul>\n<li><a href=\"http://www.kdnuggets.com/2015/11/seven-steps-machine-learning-python.html\" target=\"_blank\" rel=\"external\">7 Steps to Mastering Machine Learning With Python</a> (kdnuggets.com)</li>\n<li><a href=\"http://nbviewer.jupyter.org/github/rhiever/Data-Analysis-and-Machine-Learning-Projects/blob/master/example-data-science-notebook/Example%20Machine%20Learning%20Notebook.ipynb\" target=\"_blank\" rel=\"external\">An example machine learning notebook</a> (nbviewer.jupyter.org)</li>\n</ul>\n<h4 id=\"例子\">例子</h4>\n<ul>\n<li><a href=\"http://machinelearningmastery.com/implement-perceptron-algorithm-scratch-python/\" target=\"_blank\" rel=\"external\">How To Implement The Perceptron Algorithm From Scratch In Python</a> (machinelearningmastery.com)</li>\n<li><a href=\"http://www.wildml.com/2015/09/implementing-a-neural-network-from-scratch/\" target=\"_blank\" rel=\"external\">Implementing a Neural Network from Scratch in Python</a> (wildml.com)</li>\n<li><a href=\"http://iamtrask.github.io/2015/07/12/basic-python-network/\" target=\"_blank\" rel=\"external\">A Neural Network in 11 lines of Python</a> (iamtrask.github.io)</li>\n<li><a href=\"http://www.kdnuggets.com/2016/01/implementing-your-own-knn-using-python.html\" target=\"_blank\" rel=\"external\">Implementing Your Own k-Nearest Neighbour Algorithm Using Python</a> (kdnuggets.com)</li>\n<li><a href=\"http://machinelearningmastery.com/memory-in-a-long-short-term-memory-network/\" target=\"_blank\" rel=\"external\">Demonstration of Memory with a Long Short-Term Memory Network in Python</a>(machinelearningmastery.com)</li>\n<li><a href=\"http://machinelearningmastery.com/learn-echo-random-integers-long-short-term-memory-recurrent-neural-networks/\" target=\"_blank\" rel=\"external\">How to Learn to Echo Random Integers with Long Short-Term Memory Recurrent Neural Networks</a>(machinelearningmastery.com)</li>\n<li><a href=\"http://pytlab.org/2017/08/12/%E8%B6%85%E8%BF%87150%E4%B8%AA%E6%9C%80%E5%A5%BD%E7%9A%84%E4%B8%8E%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E5%92%8CPython%E7%9B%B8%E5%85%B3%E7%9A%84%E6%95%99%E7%A8%8B/How%20to%20Learn%20to%20Add%20Numbers%20with%20seq2seq%20Recurrent%20Neural%20Networks\">How to Learn to Add Numbers with seq2seq Recurrent Neural Networks</a> (machinelearningmastery.com)</li>\n</ul>\n<h4 id=\"Numpy和Scipy\">Numpy和Scipy</h4>\n<ul>\n<li><a href=\"http://www.scipy-lectures.org/\" target=\"_blank\" rel=\"external\">Scipy Lecture Notes</a> (scipy-lectures.org)</li>\n<li><a href=\"http://cs231n.github.io/python-numpy-tutorial/\" target=\"_blank\" rel=\"external\">Python Numpy Tutorial</a> (Stanford CS231n)</li>\n<li><a href=\"https://engineering.ucsb.edu/~shell/che210d/numpy.pdf\" target=\"_blank\" rel=\"external\">An introduction to Numpy and Scipy</a> (UCSB CHE210D)</li>\n<li><a href=\"http://nbviewer.jupyter.org/gist/rpmuller/5920182#ii.-numpy-and-scipy\" target=\"_blank\" rel=\"external\">A Crash Course in Python for Scientists</a> (nbviewer.jupyter.org)</li>\n</ul>\n<h4 id=\"scikit-learn\">scikit-learn</h4>\n<ul>\n<li><a href=\"http://nbviewer.jupyter.org/github/jakevdp/sklearn_pycon2015/blob/master/notebooks/Index.ipynb\" target=\"_blank\" rel=\"external\">PyCon scikit-learn Tutorial Index</a> (nbviewer.jupyter.org)</li>\n<li><a href=\"https://github.com/mmmayo13/scikit-learn-classifiers/blob/master/sklearn-classifiers-tutorial.ipynb\" target=\"_blank\" rel=\"external\">scikit-learn Classification Algorithms</a> (github.com/mmmayo13)</li>\n<li><a href=\"http://scikit-learn.org/stable/tutorial/index.html\" target=\"_blank\" rel=\"external\">scikit-learn Tutorials</a> (scikit-learn.org)</li>\n<li><a href=\"https://github.com/mmmayo13/scikit-learn-beginners-tutorials\" target=\"_blank\" rel=\"external\">Abridged scikit-learn Tutorials</a> (github.com/mmmayo13)</li>\n</ul>\n<h4 id=\"Tensorflow\">Tensorflow</h4>\n<ul>\n<li><a href=\"https://www.tensorflow.org/tutorials/\" target=\"_blank\" rel=\"external\">Tensorflow Tutorials</a> (tensorflow.org)</li>\n<li><a href=\"https://medium.com/@erikhallstrm/hello-world-tensorflow-649b15aed18c\" target=\"_blank\" rel=\"external\">Introduction to TensorFlow — CPU vs GPU</a> (medium.com/@erikhallstrm)</li>\n<li><a href=\"https://blog.metaflow.fr/tensorflow-a-primer-4b3fa0978be3\" target=\"_blank\" rel=\"external\">TensorFlow: A primer</a> (metaflow.fr)</li>\n<li><a href=\"http://www.wildml.com/2016/08/rnns-in-tensorflow-a-practical-guide-and-undocumented-features/\" target=\"_blank\" rel=\"external\">RNNs in Tensorflow</a> (wildml.com)</li>\n<li><a href=\"http://www.wildml.com/2015/12/implementing-a-cnn-for-text-classification-in-tensorflow/\" target=\"_blank\" rel=\"external\">Implementing a CNN for Text Classification in TensorFlow</a> (wildml.com)</li>\n<li><a href=\"http://pavel.surmenok.com/2016/10/15/how-to-run-text-summarization-with-tensorflow/\" target=\"_blank\" rel=\"external\">How to Run Text Summarization with TensorFlow</a> (surmenok.com)</li>\n</ul>\n<h4 id=\"PyTorch\">PyTorch</h4>\n<ul>\n<li><a href=\"http://pytorch.org/tutorials/\" target=\"_blank\" rel=\"external\">PyTorch Tutorials</a> (pytorch.org)</li>\n<li><a href=\"http://blog.gaurav.im/2017/04/24/a-gentle-intro-to-pytorch/\" target=\"_blank\" rel=\"external\">A Gentle Intro to PyTorch</a> (gaurav.im)</li>\n<li><a href=\"https://iamtrask.github.io/2017/01/15/pytorch-tutorial/\" target=\"_blank\" rel=\"external\">Tutorial: Deep Learning in PyTorch</a> (iamtrask.github.io)</li>\n<li><a href=\"https://github.com/jcjohnson/pytorch-examples\" target=\"_blank\" rel=\"external\">PyTorch Examples</a> (github.com/jcjohnson)</li>\n<li><a href=\"https://github.com/MorvanZhou/PyTorch-Tutorial\" target=\"_blank\" rel=\"external\">PyTorch Tutorial</a> (github.com/MorvanZhou)</li>\n<li><a href=\"http://pytlab.org/2017/08/12/%E8%B6%85%E8%BF%87150%E4%B8%AA%E6%9C%80%E5%A5%BD%E7%9A%84%E4%B8%8E%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E5%92%8CPython%E7%9B%B8%E5%85%B3%E7%9A%84%E6%95%99%E7%A8%8B/PyTorch%20Tutorial%20for%20Deep%20Learning%20Researchers\">PyTorch Tutorial for Deep Learning Researchers</a> (github.com/yunjey)</li>\n</ul>\n<h3 id=\"Math\">Math</h3>\n<ul>\n<li><a href=\"https://people.ucsc.edu/~praman1/static/pub/math-for-ml.pdf\" target=\"_blank\" rel=\"external\">Math for Machine Learning</a> (ucsc.edu)</li>\n<li><a href=\"http://www.umiacs.umd.edu/~hal/courses/2013S_ML/math4ml.pdf\" target=\"_blank\" rel=\"external\">Math for Machine Learning</a> (UMIACS CMSC422)</li>\n</ul>\n<h4 id=\"线性代数\">线性代数</h4>\n<ul>\n<li><a href=\"https://betterexplained.com/articles/linear-algebra-guide/\" target=\"_blank\" rel=\"external\">An Intuitive Guide to Linear Algebra</a> (betterexplained.com)</li>\n<li><a href=\"https://betterexplained.com/articles/matrix-multiplication/\" target=\"_blank\" rel=\"external\">A Programmer’s Intuition for Matrix Multiplication</a> (betterexplained.com)</li>\n<li><a href=\"https://betterexplained.com/articles/cross-product/\" target=\"_blank\" rel=\"external\">Understanding the Cross Product</a> (betterexplained.com)</li>\n<li><a href=\"https://betterexplained.com/articles/vector-calculus-understanding-the-dot-product/\" target=\"_blank\" rel=\"external\">Understanding the Dot Product</a> (betterexplained.com)</li>\n<li><a href=\"http://www.cedar.buffalo.edu/~srihari/CSE574/Chap1/LinearAlgebra.pdf\" target=\"_blank\" rel=\"external\">Linear Algebra for Machine Learning</a> (U. of Buffalo CSE574)</li>\n<li><a href=\"https://medium.com/towards-data-science/linear-algebra-cheat-sheet-for-deep-learning-cd67aba4526c\" target=\"_blank\" rel=\"external\">Linear algebra cheat sheet for deep learning</a> (medium.com)</li>\n<li><a href=\"http://cs229.stanford.edu/section/cs229-linalg.pdf\" target=\"_blank\" rel=\"external\">Linear Algebra Review and Reference</a> (Stanford CS229)</li>\n</ul>\n<h4 id=\"概率论\">概率论</h4>\n<ul>\n<li><a href=\"https://betterexplained.com/articles/understanding-bayes-theorem-with-ratios/\" target=\"_blank\" rel=\"external\">Understanding Bayes Theorem With Ratios</a> (betterexplained.com)</li>\n<li><a href=\"http://cs229.stanford.edu/section/cs229-prob.pdf\" target=\"_blank\" rel=\"external\">Review of Probability Theory</a> (Stanford CS229)</li>\n<li><a href=\"https://see.stanford.edu/materials/aimlcs229/cs229-prob.pdf\" target=\"_blank\" rel=\"external\">Probability Theory Review for Machine Learning</a> (Stanford CS229)</li>\n<li><a href=\"http://www.cedar.buffalo.edu/~srihari/CSE574/Chap1/Probability-Theory.pdf\" target=\"_blank\" rel=\"external\">Probability Theory</a> (U. of Buffalo CSE574)</li>\n<li><a href=\"http://www.cs.toronto.edu/~urtasun/courses/CSC411_Fall16/tutorial1.pdf\" target=\"_blank\" rel=\"external\">Probability Theory for Machine Learning</a> (U. of Toronto CSC411)</li>\n</ul>\n<h4 id=\"微积分\">微积分</h4>\n<ul>\n<li><a href=\"https://betterexplained.com/articles/how-to-understand-derivatives-the-quotient-rule-exponents-and-logarithms/\" target=\"_blank\" rel=\"external\">How To Understand Derivatives: The Quotient Rule, Exponents, and Logarithms</a> (betterexplained.com)</li>\n<li><a href=\"https://betterexplained.com/articles/derivatives-product-power-chain/\" target=\"_blank\" rel=\"external\">How To Understand Derivatives: The Product, Power &amp; Chain Rules</a> (betterexplained.com)</li>\n<li><a href=\"https://betterexplained.com/articles/vector-calculus-understanding-the-gradient/\" target=\"_blank\" rel=\"external\">Vector Calculus: Understanding the Gradient</a> (betterexplained.com)</li>\n<li><a href=\"http://web.stanford.edu/class/cs224n/lecture_notes/cs224n-2017-review-differential-calculus.pdf\" target=\"_blank\" rel=\"external\">Differential Calculus</a> (Stanford CS224n)</li>\n<li><a href=\"http://ml-cheatsheet.readthedocs.io/en/latest/calculus.html\" target=\"_blank\" rel=\"external\">Calculus Overview</a> (readthedocs.io)</li>\n</ul>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/c3d3aeee3e50259c10c3524201fc68db.jpg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112185\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112185votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112185\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 21 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang\">iPytLab</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/d3f741a9dd5c4194b365e95b06a56c09.jpeg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            喜欢写程序的计算化学狗，Python/C/C++/Fortran, 个人博客 http://pytlab.org        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/shaozhengjiang\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/shaozhengjiang/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 15</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://pytlab.org\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/shaowugui\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/PytLab\"><i class=\"fa fa-github\"></i></a> <a title=\"Stack Overflow主页\" target=\"_blank\" href=\"http://stackoverflow.com/users/4014840/pytlab\"><i class=\"fa fa-stack-overflow\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "你的时间值多少钱？", "url": "http://blog.jobbole.com/112127/", "front_image_url": ["http://wx4.sinaimg.cn/large/7cc829d3gy1ficm10dakhj20m80ciq37.jpg"], "praise_nums": "3", "comment_nums": 2, "fav_nums": 7, "tags": "其他,时间", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/wx879560138\">碎美</a> 翻译，<a href=\"http://www.jobbole.com/members/randomli\">欣仔</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://jamesclear.com/value-of-time\">James Clear</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【导读】：本文介绍了几种估算你每小时值多少钱的方法，方便你判断值不值得花时间做某事，比如：值得为了省 $95 的机票而花 5 小时转机 2 次么？值得花 2 小时与某人吃顿饭？值得花半小时回某封邮件么？</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1ficm10dakhj20m80ciq37.jpg\"></p>\n<p>并非所有对时间的利用都是均等的，而且这个简单的道理可以让生活大为不同。明白怎样充分利用自己的时间，始于了解到（准确地说是）你的时间价值多少。本文讲述如何系统计算你时间的价值。</p>\n<p>把时间花在更有利可图的事上的人，能赚更多的钱。把时间投注在他人身上的人，能建立良好的人际关系。把时间花在创建灵活的事业上的人，能享受更多自由。把时间花在具有高影响力的项目上的人，能为社会带来更多贡献。不论你想要更多财富，更多友谊，更多自由，还是更多影响力，问题都会回归到你如何支配自己的时间。</p>\n<p>如果你和我一样，你可能会想要上面提到的东西（友谊，自由，影响力），也许还有其他（健康）。但是，你不可能同时拥有所有东西，所以你需要明白日常生活中如何有效地权衡这些问题。本文告诉你如何计算时间的价值，以及如何利用这些信息来更有效地利用时间。</p>\n<h2>时间的价值：一小时值多少？</h2>\n<p>在动笔写这篇文章的几周前，我正想买一个小的旅行包。搜索了半天，我找到一个我喜欢并且只要 19 美元的包，价格很实惠。问题在于：这包是一个英国公司产的，寄到美国要收 45 美元运费。</p>\n<p>我立即打消了花 45 美元运费拿到一个 19 美元的包的念头，所以我开始搜索零售店的位置。这家公司在纽约市有一间店，而我恰好打算几周后去一趟纽约。我找到了店址，发现假如我旅途中特地去一下这间店，要花一小时。</p>\n<p>那时我脑海中出现了促使我写这篇文章的问题：“我的一小时值 45 美元吗？”</p>\n<p>我应该节省时间，花 45 美元，让他们把包直接寄给我，还是应该省下钱，花一小时自己去店里买？我完全不知道去店里买或者额外花运费，哪一种是对于时间和钱更好的利用。</p>\n<h2>时间 VS 金钱的两难</h2>\n<p>我们或多或少都对自己时间的价值有个内在判断。比如说，如果有人提供你每小时 0.07 美元薪水的工作，你肯定会立刻回绝。但如果有人愿意付你每小时 7000 美元，你会立刻接受这份工作。</p>\n<p>在这个范围的两端，你很容易判断一件事是否值得花费时间去做。但当你向时间-价值比的中间档滑动，某一任务是否值得花费时间就变得不那么明朗。问题就在此：生活的多数时间，我们都处在时间-价值比的灰色区域。</p>\n<p>例如：</p>\n<ul>\n<li>    应当购买直飞航班，节省两小时，还是选择有一次经停的航班，节省 90 美元？</li>\n<li>    要不要花 20 美元请邻居的小孩帮忙除草，以享用周末额外的一小时？</li>\n<li>    这一周，应当服务一个会立刻付你 2000 美元的客户，还是挖掘一个能在明年产生 20000 美元利润的商业构想？</li>\n</ul>\n<p>每一天我们都会做出类似的选择，但大多数人都是依直觉或猜测行事，而不去计算他们时间的实际价值。每个人都有一个每小时（时间）价值，但很少有人能确切地告诉你这个数字是多少。在此之前，我也不例外。</p>\n<h2>如何计算你的时间的实际价值</h2>\n<p>这个时间 vs 金钱的难题促使我询问了各种我能接触的这个话题上的专家。我和企业家、生产力顾问、企业教练甚至是职业扑克玩家都聊过怎样计算时间价值，以及怎样利用这一点来更好地做决策。</p>\n<p>然后，我记录了三个月中，每一小时我都做了什么，并用六种不同的方法计算了一小时的价值。别担心，我已经把这些研究和实验精简成了一个相对简单的过程，接下来就讲。</p>\n<p>本文剩余内容分为两部分。</p>\n<ul>\n<li><strong>第一部分快捷易懂，基本涵盖了大部分人需要的东西。</strong>在 15 分钟内，第一部分能帮助你建立一份合理的评估，你能通过这份对你时间价值的评估做出更明智的决策。我推荐所有人都读一下第一部分。</li>\n<li><strong>第二部分要花费一些时间，但也值得一看。</strong>企业家和管理者会发现第二部分尤其有用。第二部分建立在第一部分的基础上，能帮你评估不同时间用途的期望价值，以便你做出更好的战略决策，获得长期回报。</li>\n</ul>\n<p>在我们开始第一部分之前，我想先分享一个免费的表格，里面有关于本文中所有计算公式的例子。你可以将你的数据填入表格，它会算出你的时间价值。余下的内容中，我会经常提及这个表格。</p>\n<blockquote><p>时间价值表，下载链接：<a href=\"https://docs.google.com/spreadsheets/d/1xJm9BIpuf0Cu4P01YJQ_PNam7fds31KaDXgwxJaJWxc/edit?usp=sharing\">Google Docs</a>、百度网盘：<a href=\"https://pan.baidu.com/s/1i5ta2SP\" target=\"_blank\">https://pan.baidu.com/s/1i5ta2SP</a></p></blockquote>\n<h2><span style=\"color: #ff0000;\">第一部分：实际收入法</span></h2>\n<p>我们先讲讲怎样用实际收入法来计算你的时间价值。这些计算主要基于你实际得到（或实现）的收入，所以叫实际收入法。此法可以帮你优化日常花费的决策（例如上述的例子，花 45 美元网购或开车去店里）。</p>\n<p>首先，你需要两个数字：</p>\n<ul>\n<li>    你花了多少时间赚钱。</li>\n<li>    利用这些时间你赚了多少钱。</li>\n</ul>\n<p>我们来聊聊怎样估算这两项数据，以及怎样快速用这两个数据得出一个对你时间价值的估计。</p>\n<h3>第 1 步：如何追踪你的时间</h3>\n<p>第一步是估算你投资了多少时间在赚钱上，而不是你有多少小时在工作岗位上。举例来说，假如每天你有一小时在路途中，另有八小时在工作，那么实际上你每天花费了九小时在赚钱上。同样，你也应该算上你搞副业或者送孩子去日托中心的时间。我们将用这些数字来全面地了解一年中你花在赚钱上的总时间。</p>\n<p>不止你一个人会觉得估算时间有点困难。大部分人对于自己一天 24 小时做了什么只有一种模糊的意识。如果你不确定你花了多少时间工作，我推荐用一年 2500 小时作为起点。理由：假设你一天花了 10 小时工作、通勤或者做工作相关的事。一周工作五天，那就是每周 50 小时。再假设你每年工作 50 周（两周休假），那就是每年 2500 小时。你可以根据自己的实际情况调整，不过对于大多数全职员工或企业家来说，我觉得 2500 小时是一个基本准确的估计。</p>\n<h3>追踪时间：我是如何做的</h3>\n<p>我是个网络创业者，多数时间我都在电脑上工作。当我开始估算时间时，我安装了一个叫 <a href=\"https://www.rescuetime.com/\">RescueTime</a> 的软件。它能准确记录我在每件事上花费的时间：用了多久看每个网站、用每个软件、浏览社交媒体等等。</p>\n<p>在我完成三个月的收集后，我还整合了从其他应用中得到的数字，以完善我的估算。比如说，我算出了在 <a href=\"https://www.amazon.com/gp/product/B00NB86OYE/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=B00NB86OYE&amp;linkCode=as2&amp;tag=jamesclear-20&amp;linkId=IEHSPLRV25VARHV7\">Audible</a> 上面听有声书的时间，就得到了我花费在“读书”上的时间。</p>\n<p>利用从 RescueTime 获得的数字，加上几个合理的推算，我得出我每年工作 2742 小时的结论。</p>\n<p>RecueTime 是分类记录事件的，所以我还能分别了解我在写作、阅读、网站设计、市场营销等事上分别花了多少时间。这么细的分类其实不是很必要，不过在本文的第二部分中能派上用场。目前，你只需要对你每年花在赚钱上的总时间有一个合理的估计就好了。</p>\n<h3>第 2 步：如何记录你赚了多少钱</h3>\n<p>第二步你需要知道利用工作时间你赚了多少钱。</p>\n<p>这项非常简单。如果你是个小时工或赚薪水的职员，看看你最新的工资支票，乘上每年获取的支票数即可。如果你今年的薪水变化不大，还可以看看去年退了多少税。你还要加上从副业和自由工作中得到的钱，因为花在这些事情上的时间在第一步中已经包含在内了。</p>\n<p>我们现在计算的是你的税后收入，即扣除税款后得到的钱。对于多数职员来说，税款在工资支票中就已经扣除了，所以你的税后收入就是付给你的钱。如果你是个企业主，那你就需要从总收入中扣掉税款和其他业务支出。</p>\n<h3>追踪收入：我是如何做的</h3>\n<p>我用了一个叫 <a href=\"https://bench.co/?fbuy_ref_code=bnbQH\">Bench Accounting</a> 的服务来记录我生意的收入和开支。Bench 是一个在线的记账服务，可以自动从我的企业账户自动提取数据，然后会计就会将所有东西整理在一个算好税的财务报表中。点击几下，我就能看到在上个月、上个季度或者上一年中我赚了多少钱。</p>\n<p>如果你和我一样是一个小企业主，自由职业者或企业家，我推荐你使用全年的收入来做计算，因为小公司的月收入可能会波动（有时是激烈波动）。查看一段更长时期的收入可以消除这些差异，让你对时间价值有个更实际的估算。</p>\n<h3>第 3 步：计算你的时间价值</h3>\n<p>最后一步，用你的总收入（得自第二步）除以你总共花费的时间（得自第一步）即可。</p>\n<p>举例说明，假设你每年花了 2500 小时来赚钱：</p>\n<ul>\n<li>如果你的收入是 12316 美元/年，你的时间价值 4.93 美元/小时。这是 2014 年全美个人收入的贫困线。</li>\n<li>如果你的收入是 46226 美元/年，你的时间价值 18.49 美元/小时。这是 2014 年全美女性收入的中位数。</li>\n<li>如果你的收入是 62455 美元/年，你的时间价值 24.98 美元/小时。这是 2014 年全美男性收入的中位数。</li>\n<li>如果你的收入是 10 万美元/年，你的时间价值 40 美元/小时。</li>\n<li>如果你的收入是 100 万美元/年，你的时间价值 400 美元/小时。</li>\n</ul>\n<p>当然啦，这些都是假设你每年花费了 2500 小时在工作上。计算结果会随着不同的工作时间而改变。</p>\n<h3>这些数字精确吗？</h3>\n<p>当我第一次做这个计算的时候我很惊讶。我一小时的价值比我想象的低得多。</p>\n<p>想想有多少自由职业者每小时收费40美元，一年赚不到 10 万美元。或者想想多少顾问每小时收费 400 美元，一年却赚不到 100 万美元。怎么会这样呢？答案是，他们只是在部分工作时间获得 40 或 400 美元一小时的薪酬，而非所有的时间。当我们用他们的总收入除以总工作时间时，每小时的价值比他们每小时向顾客收的费用低得多。</p>\n<p>此外，虽然我们知道自己每小时收多少佣金，但我们很少会计算除了工作时间外还有多少时间也是花费在赚钱上。搞清楚到底多少时间投资在赚钱上，我们就对自己时间的实际价值有一个更清楚的认识——通常这个数字比你每小时收的佣金低得多。</p>\n<p>呐，如果你和我一样，你可能会想核实一下计算的准确度。有几种快速检查你计算的小时价值是否准确的方法。我们现在来看一下。</p>\n<h3>支票和余额</h3>\n<p>我们刚刚用的计算方法是税后实得法，因为它是根据你的税后收入算的。还有另外两种实际收入方法，可以用来和税后实得法对照。下面我会简单地介绍一下这两种方法，不过最简单的学习方法是参照时间价值表的步骤3.</p>\n<h3>市场价格法</h3>\n<p>市场价格法是第一种检查的方法。这个方法用的是一个估价，即假设你接受了另一个公司的一个你能胜任的职位，所预期能挣到的钱。举例来说，我花很多时间在写作上，所以我可以胜任一个“内容创造者”的职位。我还花时间来扩展业务，所以我也可能胜任一个业务拓展的职位。我查了一下我可能胜任的每个职位的薪水，按照我在每种工作上投入的时间进行划分，就得到了对于我时间价值的另一种估算。你可以把这种方法想成在就业市场上你的时间的价值。</p>\n<h3>基于成本的方法</h3>\n<p>基于成本的方法是另一种核实方法。这个方法用的是一个估价，即你会付多少钱来让另一个人做你的工作。换句话说，想象你是老板，需要雇人代替你工作。我先是把我的工作分成了具体的任务（写作，市场营销等等），然后估算了花费在每项任务上的时间。然后，我代入了我会付别人全职做这项工作的薪水。之后，我计算了所有任务放在一起的加权平均数，得出了我愿意支付给别人做我每天做的工作的价格。最后，我用这个价格除以总的工作小时数。</p>\n<p>我用这三种方法算出了三个数值，得到了我的时间价值的平均值。我料到我可能会用一种方法得到高一些的结果，而用另一种得到低一些的结果，但是当我们用三种方法来取平均值，得到的时间价值可能更精确一些。重申一次，在时间价值表中，你可以看到每一种方法。</p>\n<h3>怎样利用这项信息</h3>\n<p>我们已经完成了第一部分。有了上面的计算结果，我们对你的时间价值有了一个快捷准确的估计。现在，我们可以缩小不确定的范围，做出更好的决策。</p>\n<p>例如：</p>\n<ul>\n<li>    如果你的时间值 25 美元一小时，那就不该排半小时队来领取 10 美元的礼品卡。</li>\n<li>    如果你的时间值 60 美元一小时，那你就应该花 49 美元网购而不是花一小时去店里。</li>\n<li>    如果你的时间值 80 美元一小时，那你就应该买直飞航班，而不是花两小时等待转机，只为节省 150 美元。</li>\n</ul>\n<p>当你精确地知道你的一小时到底值多少钱时，你每天都可以做出更好的决策。</p>\n<p>至此，我们知道你的时间<u>至少</u>值你刚刚算出来的那么多，因为实际收入法只能计算你已经获得的收入。准备好来看看你的时间是否值更多了吗？我们来看第二部分。</p>\n<h2><span style=\"color: #ff0000;\">第二部分：期望值法</span></h2>\n<p>现在来看第二种方法：期望值法。这种计算法基于你对于一小时的工作在长远来看能创造的价值的期望。</p>\n<p>期望值法可以帮助你在重大的、战略性的决策中决定要把时间花在哪里。你的公司今年应该专注于哪个项目？哪些事务没什么效率，应当从你的日常工作中取消？你应该开创一项十年后会获得巨大成功，但不能即刻为你带来收入的事业，还是找一份有可靠收入的稳定工作？管理这些权衡的最佳方法是什么？</p>\n<p>让我们从最简单的期望值法开始吧。</p>\n<h3>增长倍数法</h3>\n<p>有一种简单的方法，可以解释你的决策带来的期望收入。将你前几年的净收入乘以一个合理的增长倍数。</p>\n<p>关键当然在于选择一个合适的增长倍数。举个例子，我的生意从去年到今年翻了一番，所以我选择 2× 作为我的增长倍数。用这种方法实际上相当于说，“你今年的行动会持续推动下一年的增长，所以你的时间的真实价值其实是高于你现在的实际收入。”</p>\n<p>增长倍数法能让你简单估算今天的工作在长远看来能获得多少回报，但它并不能告诉你如何更高效地利用你的时间。要获知这一点，我们需要使用完整的期望值法。</p>\n<h3>期望值法</h3>\n<p>期望值法是最终也是最难的计算时间价值的方法。我会努力用最简单的话来解释，但我想最简单的学习方法就是来看时间价值表中的步骤4。</p>\n<p>基本逻辑如下：</p>\n<p>首先按不同工作来分类时间。你越能具体地说出每份时间用来做了什么，你就越能分辨哪些工作驱动了最多利益。</p>\n<p>选择一个可以将每项工作和收入连接在一起的测量单位。对于大部分企业主来说，这意味着你需要知道你的生意中一个“引子”的价值。就我自己来说，我用的是邮件订阅数，因为我知道平均每个新的订阅者能带来的收益，并且我大部分的工作内容都可以关联到获取更多地邮件订阅上。</p>\n<ul>\n<li>估算每项工作的价值。假设我花一小时工作，获得 50 个新的邮件订阅。如果每个订阅者的总价值是 1 美元，那么这项工作的期望价值就是 50 美元一小时。重复估算你的每一项工作的价值。</li>\n<li>把所有期望值加在一起，获得总的期望值。</li>\n<li>如有需要，加上其他变量。期望值法可以像你希望的一样复杂。你可以处理一些因素，像是某项工作可以带给你的生活多少幸福感，或者现在一小时的工作有多少可能性在之后的几年持续给你回报。</li>\n</ul>\n<p>期望值法是高度个性化的，你可能需要多斟酌一番这些公式，来让它们满足你的需求。当然啦，最简单的还是从数字层面看这个方法是怎么用的。你可以在<a href=\"https://docs.google.com/spreadsheets/d/1xJm9BIpuf0Cu4P01YJQ_PNam7fds31KaDXgwxJaJWxc/edit#gid=0\">时间-价值表</a>的步骤4中看到所有加入计算的因子。</p>\n<h2>补充说明</h2>\n<p>其实这些计算的幕后还有很多其他的想法。如下是另外一些我在思考我的时间价值时一直惦记的因素。</p>\n<h3>误入歧途的成功</h3>\n<p>不要把时间浪费于在错误的事情上取得成功。简单地了解你时间的价值是有帮助的，但你仍需明白你想要怎样的生活，以获取最精确的对于时间价值的概念。太多人追逐金钱、权利或认同，因为他们身边的每个人都一样。倘若这不是你真正想要的呢？没错，你可以找到增加时间价值的方法，但如果你宁愿有更多空闲时间而非钞票呢？这就是为什么弄明白你的<a href=\"http://jamesclear.com/core-values\">核心价值观</a>，做<a href=\"http://jamesclear.com/integrity\">诚实报告</a>，弄清楚什么对你来说最重要，都是有用的。</p>\n<h3>权衡和机会加成</h3>\n<p>比尔·盖茨多次被被称为世界上最富有的人。在 2015 年，他以 727 亿美元净资产再次排在首位。根据一个分析师的推算，“有 720 亿美元，6%的回报率大概能让盖茨活着的每秒赚 114.15 美元。一张 100 美元的纸币掉在地上，都不值得他花时间捡起来。”</p>\n<p>虽然有趣又值得引用，但是这个掉在地上的 100 美元钞票不值得盖茨弯腰捡起来的想法是错的。为什么？因为捡起这 100 美元不妨碍盖茨在同时赚 114.16 美元。不管他捡不捡这 100 美元，他总归在赚钱。实际上，捡起这 100 美元，在那一秒他就赚了 214.16 美元，而不是常规的 114.16 美元。</p>\n<p>捡起 100 美元并不需要比尔·盖茨付出停止赚钱的代价。这是在他已获得的收入之上的机会加成。机会加成，指的是那种如果你把所有时间花在上面会使你减少时间价值，但如果你在有机会的时候才去做，却会增加时间价值的选择。举例来说，试想那种有时会做演讲的作家。如果他们把所有时间都花在演讲上，会减少他们的时间价值，因为这样一来他们就没法写新书了，这会导致他们逐渐过气，演讲的出场费也会降低。但是，偶尔做一些演讲——比如一月一两次——许多作家就可以在净收入中增加几千美元，并仍能保持足够的时间来写新书。</p>\n<h3>不能商量的空闲时间</h3>\n<p>计算你的时间价值有一个危险之处，即你可能会说服自己多一个“创造价值”的小时，就能增加总的时间价值了。引自<a href=\"https://www.wsj.com/articles/do-you-know-what-your-time-is-really-worth-1437500727\">华尔街日报</a>的一篇文章，“一些研究人员表示，给时间标注经济价值，有损害人们生活质量的风险。那些被怂恿而只专注于时间的金钱价值的人，倾向于变得不耐烦而且压力大，Jeffery Pfeffer，一个斯坦福商学院组织行为学教授说到，这些人工作太多，花太少的时间做一些奖励自己的事，例如参加志愿活动或享受音乐。”</p>\n<p>对我来说，我决定记录我的空闲时间，来看看相较于工作我有多少闲暇，但我不会给空闲时间标注金钱价值。相反，我决定我的空闲时间是不能商量的。空闲时我可以放松减压，让我可以在工作时间保持高效。你应当重视你的空闲时间、停工时间、休闲活动，因为它们能为你的生活提供全面的身心健康。</p>\n<h3>你应当再工作一小时吗?</h3>\n<p>想不想知道你是否应该再工作一小时？如下是我从 <a href=\"http://sebastianmarshall.com/\">Sebastian Marshall</a> 那里学来的一个很好的经验法则：想想你一天中的每个小时。早上 9 点到 10 点，10 点到 11 点，以此类推。平均下来，那一个小时中，你的净收益是正的还是负的？例如如果你工作到比较晚，晚上 9 点到 10 点那一小时的成果平均下来是正向的吗？还是说那一小时的工作出的错比完成的内容多？那一小时是拖延还是高产？如果这一小时总的来说是负产出，那你就该停止工作了。努力做一个项目是好的，但如果接下来下一小时的工作会让你筋疲力尽，而非创造价值，那么在此之前就该停下来。</p>\n<h3>幸福和意义</h3>\n<p>如果你想的话，你可以将一项工作带给你的幸福或意义之类的因素也加入考虑。不过，我没有把这些变量放入我的计算公式中，而是对于每项工作，将这些因素进行了基于实现程度的1到10的排序。虽然这些排序没有放入任何公式中，但是当几项工作的期望值很接近时，这些排序就可以作为决胜属性。</p>\n<h3>下一步去哪儿</h3>\n<p>计算时间的真实价值实际上比听上去难得多，也比看上去有用得多。</p>\n<p>你的时间价值可能每年都有变化，甚至变化得更快。本文中我列出的这些方法都很灵活，可以修改。如果你在某件事上花费了更多时间，或者有了更多的收入，仅需将新的数字代入表格中，就能得到新的结果。</p>\n<p>我希望本文分享的策略，随着时间的推移，还会一直对你有所帮助。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112127\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112127votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112127\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx879560138\">碎美</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx879560138\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/05/14c9242bd4336d2c12ac8ba7e56bd6c8.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            University at Buffalo IE Human Factors PhD program 在读        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/wx879560138\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/wx879560138/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/wx879560138/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 12</a> · <a title=\"QQ：274121119\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"Facebook主页\" target=\"_blank\" href=\"https://www.facebook.com/profile.php?id=100009659581170&amp;ref=bookmarks\"><i class=\"fa fa-facebook\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "PHP实现定时任务（非linux-shell方式，与操作系统无关）", "url": "http://blog.jobbole.com/112214/", "front_image_url": ["http://www.tkc8.com/images/sucai/img_crontab_1.png"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 2, "tags": "IT技术", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/u/3381391/blog/1510260\">大弹簧</a>   </div><p id=\"h3_0\">页面交互效果</p>\n<p>下面是写好的示例前端交互页面，主要是列表页面，编辑页面。</p>\n<p>主要交互有：</p>\n<p>1 开启定时任务进程<br>\n2 关闭定时任务进程<br>\n3 新增一项定时任务<br>\n4 编辑已有的定时任务<br>\n5 删除定时任务<br>\n6 开始一项定时任务<br>\n7 停止一项定时任务</p>\n<p>定时任务分两种：</p>\n<p>1 执行一次<br>\n2 循环执行</p>\n<p>定时任务执行的内容：</p>\n<p>定时任务执行的内容其实还是一个http请求。 通过定时的方式，指定时间执行或者循执行。</p>\n<h4 id=\"h4_1\">1 列表页面</h4>\n<p><img class=\"aligncenter\" src=\"http://www.tkc8.com/images/sucai/img_crontab_1.png\" alt=\"图片名称\"></p>\n<h4 id=\"h4_2\">2 新建\\编辑页面</h4>\n<p><img class=\"aligncenter\" src=\"http://www.tkc8.com/images/sucai/img_crontab_2.png\" alt=\"图片名称\"></p>\n<h3 id=\"h3_3\">代码地址，演示地址</h3>\n<p>示例代码是基于Laravel，Alpaca-spa框架编写，并且作为 ‘Alpaca-Spa-Laravel后台管理平台’的一个模块儿集成于系统中。</p>\n<p>代码 ： <a href=\"http://git.oschina.net/cc-sponge/Alpaca-Spa-Laravel\">http://git.oschina.net/cc-sponge/Alpaca-Spa-Laravel</a></p>\n<p>代码 ： <a href=\"https://github.com/big-sponge/Alpaca-Spa-Laravel\">https://github.com/big-sponge/Alpaca-Spa-Laravel</a></p>\n<p>Alpaca-Spa-Laravel ： <a href=\"http://full.tkc8.com/\">http://full.tkc8.com</a></p>\n<p>Alpaca-Spa ： <a href=\"http://www.tkc8.com/\">http://www.tkc8.com</a></p>\n<h3 id=\"h3_4\">适用范围</h3>\n<p>定时精确时间不低于1秒。web服务重启、或者php重启。该定时任务不会自动重启。</p>\n<h3 id=\"h3_5\">实现原理</h3>\n<p>用PHP实现定时任务（非linux-shell方式，与操作系统平台无关），主要两个技术点：</p>\n<p>1）PHP后台进程<br>\n2）PHP异步处理</p>\n<h4 id=\"h4_6\">1 PHP后台进程</h4>\n<p>一般情况，用命令行可以开启一个php后台进程。而在浏览器中通过HTTP请求一个php处理，会因为浏览器关闭，或者请求超时，使得后台的php处理中断。但是php提供了两个方法可以会忽略浏览器关闭、请求超时：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9df46da3ec458958588\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nignore_user_abort(true);     // 忽略客户端断开\r\nset_time_limit(0);           // 设置执行不超时</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9df46da3ec458958588-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da3ec458958588-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9df46da3ec458958588-1\"><span class=\"crayon-e\">ignore_user_abort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">// 忽略客户端断开</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da3ec458958588-2\"><span class=\"crayon-e\">set_time_limit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">           </span><span class=\"crayon-c\">// 设置执行不超时</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>因此，我们可以使用这两个函数从浏览器以HTTP请求的方式开启一个php后台进程。</p>\n<h4 id=\"h4_7\">2 PHP异步处理</h4>\n<p>php语言本身没有可以跨平台好用异步处理方法，但是可以通过curl或者fsockopen创建一个请求来实现异步处理。这里我们用fsockopen方法实现：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9df46da3f8217960684\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$fp = fsockopen(\"$ip\", $port, $errno, $errstr,1);\r\n        if (!$fp) {\r\n            return 'worker error:'.\"$errstr ($errno)&lt;br /&gt;\\n\";\r\n        } else {\r\n            $out = \"POST $url HTTP/1.1\\r\\n\";\r\n            $out .= \"Host: $ip\\r\\n\";\r\n            $out .= \"Content-Type:application/x-www-form-urlencoded; charset=UTF-8\\r\\n\";\r\n            $out .= \"Content-Length: \" . strlen($postData) . \"\\r\\n\";\r\n            $out .= \"Connection: close\\r\\n\";\r\n            $out .=\"\\r\\n\";\r\n            $out .=$postData;\r\n            fputs($fp, $out);\r\n            fclose($fp);\r\n        }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9df46da3f8217960684-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da3f8217960684-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da3f8217960684-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da3f8217960684-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da3f8217960684-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da3f8217960684-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da3f8217960684-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da3f8217960684-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da3f8217960684-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da3f8217960684-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da3f8217960684-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da3f8217960684-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da3f8217960684-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da3f8217960684-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9df46da3f8217960684-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fsockopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"$ip\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">errno</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">errstr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da3f8217960684-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da3f8217960684-3\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'worker error:'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\"$errstr ($errno)&lt;br /&gt;\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da3f8217960684-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da3f8217960684-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"POST $url HTTP/1.1\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da3f8217960684-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Host: $ip\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da3f8217960684-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Content-Type:application/x-www-form-urlencoded; charset=UTF-8\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da3f8217960684-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Content-Length: \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strlen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">postData</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da3f8217960684-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Connection: close\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da3f8217960684-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da3f8217960684-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">postData</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da3f8217960684-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">fputs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da3f8217960684-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da3f8217960684-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p></p>\n<h3 id=\"h3_8\">前台交互控制器</h3>\n<p>为了在前端界面方便控制定时任务的开启关闭，新增、编辑、删除，查看执行状态。 同时也可以添加权限控制。 主要有8个操作接口(下面是以Laravel 路由示例)：</p>\n<p>1 查看定时任务进程状态<br>\n2 开始定时任务进程 3 停止定时任务进程<br>\n4 添加,或者编辑定时任务<br>\n5 设置定时任务状态<br>\n6 获取指定定时任务明细<br>\n7 删除定时任务<br>\n8 获取定时任务列表</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9df46da3fc131486929\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/* crontab - status 查看定时任务守护进程状态 */\r\nRoute::any('crontab/status', \"CrontabController@status\");\r\n\r\n/* crontab - start 开始定时任务 */\r\nRoute::any('crontab/start', \"CrontabController@start\");\r\n\r\n/* crontab - stop  停止定时任务守护进程*/\r\nRoute::any('crontab/stop', \"CrontabController@stop\");\r\n\r\n/* crontab - editTask  添加,或者编辑定时任务*/\r\nRoute::any('crontab/editTask', \"CrontabController@editTask\");\r\n\r\n/* crontab - changeTaskStatus  设置定时任务状态 */\r\nRoute::any('crontab/changeTaskStatus', \"CrontabController@changeTaskStatus\");\r\n\r\n/* crontab - getIndexTask  获取指定定时任务 */\r\nRoute::any('crontab/getIndexTask', \"CrontabController@getIndexTask\");\r\n\r\n/* crontab - removeTask  删除定时任务 */\r\nRoute::any('crontab/removeTask', \"CrontabController@removeTask\");\r\n\r\n/* crontab - listTask  获取定时任务列表 */\r\nRoute::any('crontab/listTask', \"CrontabController@listTask\");</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9df46da3fc131486929-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da3fc131486929-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da3fc131486929-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da3fc131486929-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da3fc131486929-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da3fc131486929-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da3fc131486929-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da3fc131486929-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da3fc131486929-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da3fc131486929-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da3fc131486929-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da3fc131486929-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da3fc131486929-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da3fc131486929-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da3fc131486929-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da3fc131486929-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da3fc131486929-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da3fc131486929-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da3fc131486929-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da3fc131486929-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da3fc131486929-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da3fc131486929-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da3fc131486929-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9df46da3fc131486929-1\"><span class=\"crayon-c\">/* crontab - status 查看定时任务守护进程状态 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da3fc131486929-2\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/status'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@status\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da3fc131486929-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da3fc131486929-4\"><span class=\"crayon-c\">/* crontab - start 开始定时任务 */</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da3fc131486929-5\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/start'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@start\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da3fc131486929-6\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da3fc131486929-7\"><span class=\"crayon-c\">/* crontab - stop  停止定时任务守护进程*/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da3fc131486929-8\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/stop'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@stop\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da3fc131486929-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da3fc131486929-10\"><span class=\"crayon-c\">/* crontab - editTask  添加,或者编辑定时任务*/</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da3fc131486929-11\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/editTask'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@editTask\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da3fc131486929-12\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da3fc131486929-13\"><span class=\"crayon-c\">/* crontab - changeTaskStatus  设置定时任务状态 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da3fc131486929-14\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/changeTaskStatus'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@changeTaskStatus\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da3fc131486929-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da3fc131486929-16\"><span class=\"crayon-c\">/* crontab - getIndexTask  获取指定定时任务 */</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da3fc131486929-17\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/getIndexTask'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@getIndexTask\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da3fc131486929-18\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da3fc131486929-19\"><span class=\"crayon-c\">/* crontab - removeTask  删除定时任务 */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da3fc131486929-20\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/removeTask'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@removeTask\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da3fc131486929-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da3fc131486929-22\"><span class=\"crayon-c\">/* crontab - listTask  获取定时任务列表 */</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da3fc131486929-23\"><span class=\"crayon-v\">Route</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">any</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'crontab/listTask'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"CrontabController@listTask\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>完整的类代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9df46da400190739766\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?php\r\n\r\nnamespace App\\Modules\\Manage\\Controllers;\r\n\r\nuse Crontab\\Library\\Crontab\\AlpacaCrontab;\r\nuse Crontab\\Library\\Crontab\\AlpacaDaemon;\r\nuse Crontab\\Library\\Crontab\\AlpacaWorker;\r\nuse App\\Modules\\Manage\\Controllers\\Base\\BaseController;\r\nuse App\\Common\\Code;\r\nuse App\\Common\\Msg;\r\n\r\n/**\r\n * 定时任务管理控制器\r\n * @author Chengcheng\r\n * @date 2016-10-19 15:50:00\r\n */\r\nclass CrontabController extends BaseController\r\n{\r\n    /**\r\n     * 设置不需要登录的的Action,不加Action前缀\r\n     * @author Chengcheng\r\n     * @date   2016年10月23日 20:39:25\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    protected function noLogin()\r\n    {\r\n        return [];\r\n    }\r\n\r\n    /**\r\n     * 设置不需要权限验证的Action,不加Action前缀\r\n     * @author Chengcheng\r\n     * @date   2016年10月23日 20:39:25\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    protected function noAuth()\r\n    {\r\n        // 以下Action不需要角色权限\r\n        return [];\r\n    }\r\n\r\n    /**\r\n     * 查看定时任务守护进程状态\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function status()\r\n    {\r\n        //查看守护进程状态\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = AlpacaDaemon::daemon()-&gt;status();\r\n\r\n        //返回结果\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 开始定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function start()\r\n    {\r\n        //异步开启守护进程\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = AlpacaWorker::worker()-&gt;action(['REQUEST_URI' =&gt; \"/crontab/index/start\"]);\r\n\r\n        //返回结果\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 停止定时任务守护进程\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function stop()\r\n    {\r\n        //停止守护进程\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = AlpacaDaemon::daemon()-&gt;stop();\r\n\r\n        //返回结果\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 添加,或者编辑定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function editTask()\r\n    {\r\n        /*\r\n         * 1 获取输入参数\r\n         * BEGIN_TIME        开始时间\r\n         * END_TIME          结束时间\r\n         * INTERVAL          时间间隔\r\n         * NAME              名称\r\n         * STATUS            状态 1-ENABLED,   2-DISABLE\r\n         * TASK_TYPE         类型 1-ONCE,      2-LOOP\r\n         * ACTION            要执行的Action\r\n         * INDEX             索引，null或者0时候，表示新建\r\n         * */\r\n        $this-&gt;requestData['NAME']       = $this-&gt;input('NAME', null);\r\n        $this-&gt;requestData['BEGIN_TIME'] = $this-&gt;input('BEGIN_TIME', null);\r\n        $this-&gt;requestData['END_TIME']   = $this-&gt;input('END_TIME', null);\r\n        $this-&gt;requestData['INTERVAL']   = $this-&gt;input('INTERVAL', null);\r\n        $this-&gt;requestData['TASK_TYPE']  = $this-&gt;input('TASK_TYPE', '1');\r\n        $this-&gt;requestData['ACTION']     = $this-&gt;input('ACTION', null);\r\n        $this-&gt;requestData['STATUS']     = $this-&gt;input('STATUS', '2');\r\n        $this-&gt;requestData['INDEX']      = $this-&gt;input('INDEX', null);\r\n        $this-&gt;requestData['LAST_TIME']  = $this-&gt;input('LAST_TIME', null);\r\n\r\n        //2 检查参数\r\n        if (empty($this-&gt;requestData['BEGIN_TIME'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'BEGIN_TIME');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n        if ($this-&gt;requestData['TASK_TYPE'] == 2 &amp;&amp; empty($this-&gt;requestData['END_TIME'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'END_TIME');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n        if (empty($this-&gt;requestData['ACTION'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'ACTION');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n        if ($this-&gt;requestData['TASK_TYPE'] == 2 &amp;&amp; empty($this-&gt;requestData['INTERVAL'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'INTERVAL');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n\r\n        //3 设置结束时间\r\n        $now      = date('Y-m-d H:i:s', time());\r\n        $nextTime = date('Y-m-d H:i:s', strtotime($this-&gt;requestData['INTERVAL'], strtotime($this-&gt;requestData['BEGIN_TIME'])));\r\n        if ($this-&gt;requestData['TASK_TYPE'] == \"1\" || strtotime($now) &lt; strtotime($this-&gt;requestData['BEGIN_TIME'])) {\r\n            $nextTime = $this-&gt;requestData['BEGIN_TIME'];\r\n        }\r\n\r\n        //4 创建任务\r\n        $task = array(\r\n            'NAME'       =&gt; $this-&gt;requestData['NAME'],           //NAME\r\n            'STATUS'     =&gt; $this-&gt;requestData['STATUS'],         // 1-ENABLED,   2-DISABLE\r\n            'TYPE'       =&gt; $this-&gt;requestData['TASK_TYPE'],      // 1-ONCE,      2-LOOP\r\n            'INTERVAL'   =&gt; $this-&gt;requestData['INTERVAL'],       //year（年），month（月），hour（小时）minute（分），second（秒）\r\n            'BEGIN_TIME' =&gt; $this-&gt;requestData['BEGIN_TIME'],     //开始时间\r\n            'NEXT_TIME'  =&gt; $nextTime,                            //下次执行时间\r\n            'LAST_TIME'  =&gt; $this-&gt;requestData['LAST_TIME'],      //上次执行时间\r\n            'ACTION'     =&gt; $this-&gt;requestData['ACTION'],         //执行的ACTION\r\n            'END_TIME'   =&gt; $this-&gt;requestData['END_TIME'],       //截止时间2\r\n        );\r\n\r\n        //5 判断是新建还是修改\r\n        if (empty($this-&gt;requestData['INDEX'])) {\r\n            //新建\r\n            $info = AlpacaCrontab::crontab()-&gt;addTask($task);\r\n        } else {\r\n            $this-&gt;requestData['INDEX'] -= 1;\r\n            $info = AlpacaCrontab::crontab()-&gt;editTask($this-&gt;requestData['INDEX'], $task);\r\n        }\r\n\r\n        //5 返回结果\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = $info;\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 设置定时任务状态\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function changeTaskStatus()\r\n    {\r\n        /*\r\n         * 1 获取输入参数\r\n         * STATUS            状态 1-ENABLED,   2-DISABLE\r\n         * INDEX             索引\r\n         * */\r\n        $this-&gt;requestData['STATUS'] = $this-&gt;input('STATUS', '2');\r\n        $this-&gt;requestData['INDEX']  = $this-&gt;input('INDEX', null);\r\n\r\n        //2 检查参数\r\n        if (empty($this-&gt;requestData['STATUS'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'STATUS');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n        if (empty($this-&gt;requestData['INDEX'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'INDEX');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n\r\n        //3 修改状态\r\n        $this-&gt;requestData['INDEX'] -= 1;\r\n        $data = AlpacaCrontab::crontab()-&gt;editTaskStatus($this-&gt;requestData['INDEX'], $this-&gt;requestData['STATUS']);\r\n\r\n        //4 返回结果\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = $data;\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 查找单条定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function getIndexTask()\r\n    {\r\n        /*\r\n         * 1 获取输入参数\r\n         * INDEX             索引\r\n         * */\r\n        $this-&gt;requestData['INDEX'] = $this-&gt;input('INDEX', null);\r\n\r\n        //2 检查参数\r\n        if (empty($this-&gt;requestData['INDEX'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'INDEX');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n\r\n        //3 删除\r\n        $this-&gt;requestData['INDEX'] -= 1;\r\n        $data = AlpacaCrontab::crontab()-&gt;getIndexTask($this-&gt;requestData['INDEX']);\r\n\r\n        //4 返回结果\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = $data;\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 删除定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function removeTask()\r\n    {\r\n        /*\r\n         * 1 获取输入参数\r\n         * INDEX             索引\r\n         * */\r\n        $this-&gt;requestData['INDEX'] = $this-&gt;input('INDEX', null);\r\n\r\n        //2 检查参数\r\n        if (empty($this-&gt;requestData['INDEX'])) {\r\n            $result[\"code\"] = Code::SYSTEM_PARAMETER_NULL;\r\n            $result[\"msg\"]  = sprintf(Msg::SYSTEM_PARAMETER_NULL, 'INDEX');\r\n            return $this-&gt;ajaxReturn($result);\r\n        }\r\n\r\n        //3 删除\r\n        $this-&gt;requestData['INDEX'] -= 1;\r\n        $data = AlpacaCrontab::crontab()-&gt;removeTask($this-&gt;requestData['INDEX']);\r\n\r\n        //4 返回结果\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = $data;\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 查看定时任务列表\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function listTask()\r\n    {\r\n        //查找\r\n        $data['task']   = AlpacaCrontab::crontab()-&gt;listTask();\r\n        $data['total']  = count($data['task']);\r\n        $data['status'] = AlpacaDaemon::daemon()-&gt;status();\r\n\r\n        //返回结果\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = $data;\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-139\">139</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-140\">140</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-141\">141</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-142\">142</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-143\">143</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-144\">144</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-145\">145</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-146\">146</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-147\">147</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-148\">148</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-149\">149</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-150\">150</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-151\">151</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-152\">152</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-153\">153</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-154\">154</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-155\">155</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-156\">156</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-157\">157</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-158\">158</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-159\">159</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-160\">160</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-161\">161</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-162\">162</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-163\">163</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-164\">164</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-165\">165</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-166\">166</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-167\">167</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-168\">168</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-169\">169</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-170\">170</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-171\">171</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-172\">172</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-173\">173</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-174\">174</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-175\">175</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-176\">176</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-177\">177</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-178\">178</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-179\">179</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-180\">180</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-181\">181</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-182\">182</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-183\">183</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-184\">184</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-185\">185</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-186\">186</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-187\">187</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-188\">188</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-189\">189</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-190\">190</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-191\">191</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-192\">192</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-193\">193</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-194\">194</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-195\">195</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-196\">196</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-197\">197</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-198\">198</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-199\">199</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-200\">200</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-201\">201</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-202\">202</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-203\">203</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-204\">204</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-205\">205</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-206\">206</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-207\">207</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-208\">208</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-209\">209</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-210\">210</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-211\">211</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-212\">212</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-213\">213</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-214\">214</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-215\">215</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-216\">216</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-217\">217</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-218\">218</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-219\">219</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-220\">220</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-221\">221</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-222\">222</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-223\">223</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-224\">224</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-225\">225</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-226\">226</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-227\">227</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-228\">228</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-229\">229</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-230\">230</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-231\">231</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-232\">232</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-233\">233</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-234\">234</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-235\">235</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-236\">236</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-237\">237</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-238\">238</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-239\">239</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-240\">240</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-241\">241</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-242\">242</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-243\">243</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-244\">244</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-245\">245</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-246\">246</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-247\">247</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-248\">248</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-249\">249</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-250\">250</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-251\">251</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-252\">252</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-253\">253</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-254\">254</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-255\">255</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-256\">256</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-257\">257</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-258\">258</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-259\">259</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-260\">260</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-261\">261</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-262\">262</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-263\">263</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-264\">264</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-265\">265</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-266\">266</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-267\">267</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-268\">268</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-269\">269</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-270\">270</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-271\">271</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-272\">272</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-273\">273</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-274\">274</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-275\">275</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-276\">276</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-277\">277</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-278\">278</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-279\">279</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-280\">280</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-281\">281</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-282\">282</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-283\">283</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-284\">284</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-285\">285</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-286\">286</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-287\">287</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-288\">288</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-289\">289</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-290\">290</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-291\">291</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-292\">292</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da400190739766-293\">293</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da400190739766-294\">294</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-e\">php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-2\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-3\"><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">App</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Modules</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Manage</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Controllers</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-4\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-5\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-6\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-7\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">AlpacaWorker</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-8\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">App</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Modules</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Manage</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Controllers</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Base</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">BaseController</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-9\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">App</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Common</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Code</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-10\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">App</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Common</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-12\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-13\"><span class=\"crayon-c\"> * 定时任务管理控制器</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-14\"><span class=\"crayon-c\"> * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-15\"><span class=\"crayon-c\"> * @date 2016-10-19 15:50:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-16\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-17\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">CrontabController</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BaseController</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-18\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-20\"><span class=\"crayon-c\">     * 设置不需要登录的的Action,不加Action前缀</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-21\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-22\"><span class=\"crayon-c\">     * @date   2016年10月23日 20:39:25</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-23\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-24\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">noLogin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-31\"><span class=\"crayon-c\">     * 设置不需要权限验证的Action,不加Action前缀</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-32\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-33\"><span class=\"crayon-c\">     * @date   2016年10月23日 20:39:25</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-34\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-35\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">noAuth</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">// 以下Action不需要角色权限</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-41\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-43\"><span class=\"crayon-c\">     * 查看定时任务守护进程状态</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-44\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-45\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-46\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-48\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//查看守护进程状态</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">daemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-53\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//返回结果</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-57\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-59\"><span class=\"crayon-c\">     * 开始定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-60\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-61\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-62\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-63\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-65\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//异步开启守护进程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-68\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaWorker</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">worker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">action</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_URI'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"/crontab/index/start\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-69\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-70\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//返回结果</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-71\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-72\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-73\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-74\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-75\"><span class=\"crayon-c\">     * 停止定时任务守护进程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-76\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-77\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-78\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-79\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-80\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-81\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//停止守护进程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-82\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-83\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-84\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">daemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-85\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-86\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//返回结果</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-87\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-88\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-89\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-90\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-91\"><span class=\"crayon-c\">     * 添加,或者编辑定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-92\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-93\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-94\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-95\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">editTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-96\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-97\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-98\"><span class=\"crayon-c\">         * 1 获取输入参数</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-99\"><span class=\"crayon-c\">         * BEGIN_TIME        开始时间</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-100\"><span class=\"crayon-c\">         * END_TIME          结束时间</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-101\"><span class=\"crayon-c\">         * INTERVAL          时间间隔</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-102\"><span class=\"crayon-c\">         * NAME              名称</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-103\"><span class=\"crayon-c\">         * STATUS            状态 1-ENABLED,   2-DISABLE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-104\"><span class=\"crayon-c\">         * TASK_TYPE         类型 1-ONCE,      2-LOOP</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-105\"><span class=\"crayon-c\">         * ACTION            要执行的Action</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-106\"><span class=\"crayon-c\">         * INDEX             索引，null或者0时候，表示新建</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-107\"><span class=\"crayon-c\">         * */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-108\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NAME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">       </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'NAME'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-109\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-110\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-111\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-112\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TASK_TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'TASK_TYPE'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-113\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'ACTION'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'ACTION'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-114\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-115\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-116\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'LAST_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'LAST_TIME'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-117\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-118\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//2 检查参数</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-119\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-120\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-121\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-122\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-123\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-124\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TASK_TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-125\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-126\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-127\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-128\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-129\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'ACTION'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-130\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-131\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ACTION'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-132\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-133\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-134\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TASK_TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-135\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-136\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-137\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-138\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-139\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-140\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//3 设置结束时间</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-141\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Y-m-d H:i:s'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-142\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">nextTime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Y-m-d H:i:s'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-143\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TASK_TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-144\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">nextTime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-145\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-146\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-147\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//4 创建任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-148\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-149\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'NAME'</span><span class=\"crayon-h\">       </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NAME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">           </span><span class=\"crayon-c\">//NAME</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-150\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">         </span><span class=\"crayon-c\">// 1-ENABLED,   2-DISABLE</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-151\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'TYPE'</span><span class=\"crayon-h\">       </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TASK_TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">      </span><span class=\"crayon-c\">// 1-ONCE,      2-LOOP</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-152\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">       </span><span class=\"crayon-c\">//year（年），month（月），hour（小时）minute（分），second（秒）</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-153\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">//开始时间</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-154\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">nextTime</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">                            </span><span class=\"crayon-c\">//下次执行时间</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-155\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'LAST_TIME'</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'LAST_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">      </span><span class=\"crayon-c\">//上次执行时间</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-156\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'ACTION'</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'ACTION'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">         </span><span class=\"crayon-c\">//执行的ACTION</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-157\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">       </span><span class=\"crayon-c\">//截止时间2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-158\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-159\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-160\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//5 判断是新建还是修改</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-161\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-162\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">//新建</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-163\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">addTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-164\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-165\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-166\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">editTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-167\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-168\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-169\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//5 返回结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-170\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-171\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-172\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">info</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-173\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-174\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-175\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-176\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-177\"><span class=\"crayon-c\">     * 设置定时任务状态</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-178\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-179\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-180\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-181\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">changeTaskStatus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-182\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-183\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-184\"><span class=\"crayon-c\">         * 1 获取输入参数</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-185\"><span class=\"crayon-c\">         * STATUS            状态 1-ENABLED,   2-DISABLE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-186\"><span class=\"crayon-c\">         * INDEX             索引</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-187\"><span class=\"crayon-c\">         * */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-188\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-189\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-190\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-191\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//2 检查参数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-192\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-193\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-194\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-195\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-196\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-197\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-198\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-199\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-200\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-201\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-202\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-203\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//3 修改状态</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-204\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-205\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">editTaskStatus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-206\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-207\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//4 返回结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-208\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-209\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-210\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-211\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-212\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-213\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-214\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-215\"><span class=\"crayon-c\">     * 查找单条定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-216\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-217\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-218\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-219\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getIndexTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-220\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-221\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-222\"><span class=\"crayon-c\">         * 1 获取输入参数</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-223\"><span class=\"crayon-c\">         * INDEX             索引</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-224\"><span class=\"crayon-c\">         * */</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-225\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-226\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-227\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//2 检查参数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-228\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-229\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-230\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-231\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-232\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-233\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-234\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//3 删除</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-235\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-236\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">getIndexTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-237\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-238\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//4 返回结果</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-239\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-240\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-241\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-242\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-243\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-244\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-245\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-246\"><span class=\"crayon-c\">     * 删除定时任务</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-247\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-248\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-249\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-250\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">removeTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-251\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-252\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">/*</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-253\"><span class=\"crayon-c\">         * 1 获取输入参数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-254\"><span class=\"crayon-c\">         * INDEX             索引</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-255\"><span class=\"crayon-c\">         * */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-256\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-257\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-258\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//2 检查参数</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-259\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-260\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-261\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"msg\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sprintf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_PARAMETER_NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-262\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-263\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-264\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-265\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//3 删除</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-266\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-267\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">removeTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">requestData</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INDEX'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-268\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-269\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//4 返回结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-270\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-271\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-272\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-273\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-274\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-275\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-276\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-277\"><span class=\"crayon-c\">     * 查看定时任务列表</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-278\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-279\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-280\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-281\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">listTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-282\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-283\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//查找</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-284\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'task'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">listTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-285\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'total'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'task'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-286\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'status'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">daemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-287\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-288\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//返回结果</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-289\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-290\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-291\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-292\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da400190739766-293\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da400190739766-294\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0399 seconds] -->\r\n<p></p>\n<h3 id=\"h3_9\">实现后台进程类</h3>\n<p>使用 ignore_user_abort(true); set_time_limit(0); 可以从浏览器开启一个php后台进程。为了避免出现多个后台进程，需要借助一个配置来标识该后台进程是否已经启动</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9df46da411252202997\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\"code\":\"1001\",\"message\":\"Stop at:2017-02-24 11:29:43\"}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9df46da411252202997-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9df46da411252202997-1\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"code\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"1001\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"message\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"Stop at:2017-02-24 11:29:43\"</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>当code是1001时候，表示后台进程未启动，这时通过http请求开启后台进程时，正常启动</p>\n<p>当code是1000时候，表示后台进程已经启动，这时通过http请求开启后台进程时，不做任何操作，以为进程已经启动</p>\n<p>当开启后台进程的请求到达后台时候，读取配置文件，如果code是1001，则启动进程，并且设置code为1000，保存配置文件。</p>\n<p>当关闭后台进程的请求到达后台时候，读取配置文件，设置code为1001，保存配置文件。</p>\n<p>后台进程在运行时候，每隔一秒读取配置文件，判断code状态，如果是1001，则结束执行； 如果是1000，则继续执行</p>\n<p>完整类的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9df46da415043415648\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?php\r\n\r\nnamespace Crontab\\Library\\Crontab;\r\n/**\r\n * 守护进程\r\n * @author Chengcheng\r\n * @date 2016年10月21日 17:04:44\r\n */\r\nclass AlpacaDaemon\r\n{\r\n    private $daemon_json = __DIR__ . '/deamon.json';\r\n\r\n    private static $instance;\r\n\r\n    private $events = [];\r\n\r\n    public static function daemon()\r\n    {\r\n        return self::getInstance();\r\n    }\r\n\r\n    private static function getInstance()\r\n    {\r\n        if(!self::$instance){\r\n            self::$instance = new self();\r\n            self::$instance-&gt;daemon_json = base_path('storage') . '/crontab/deamon.json';\r\n        }\r\n        return self::$instance;\r\n    }\r\n\r\n    public function setDaemon($daemon_json)\r\n    {\r\n        $this-&gt;daemon_json = $daemon_json;\r\n        return $this;\r\n    }\r\n\r\n    public function setEvents(array $events)\r\n    {\r\n        $this-&gt;events = $events;\r\n        return $this;\r\n    }\r\n\r\n    public function status()\r\n    {\r\n        $data = json_decode(file_get_contents($this-&gt;daemon_json),true);\r\n        if(empty($data)){\r\n            $data = array();\r\n        }\r\n        return $data;\r\n    }\r\n\r\n    public function stop()\r\n    {\r\n        $data =new \\stdClass();\r\n        $data-&gt;code=\"1001\";\r\n        $data-&gt;message=\"Stop at:\".date(\"Y-m-d H:i:s\" ,time());\r\n        file_put_contents($this-&gt;daemon_json,json_encode($data),LOCK_EX);\r\n\r\n        $result[\"result_code\"] = \"1\";\r\n        $result[\"result_message\"] = \"操作成功\";\r\n        return $result;\r\n    }\r\n\r\n    public function start()\r\n    {\r\n        $data = json_decode(file_get_contents($this-&gt;daemon_json) , true);\r\n        if(empty($data)){\r\n            $data['code']=\"1001\";\r\n        }\r\n\r\n        if($data['code'] == \"1000\" ){\r\n            //die(\"Error - exit,   Already running !\");\r\n            return;\r\n        }\r\n\r\n        $data['code']=\"1000\";\r\n        $data['message']=\"Start\";\r\n        file_put_contents($this-&gt;daemon_json,json_encode($data),LOCK_EX);\r\n\r\n        ignore_user_abort(true);     // 忽略客户端断开\r\n        set_time_limit(0);           // 设置执行不超时\r\n\r\n\r\n        while(true){\r\n            $data = json_decode(file_get_contents($this-&gt;daemon_json) , true);\r\n            if(empty($data) || empty($data['code']) || $data['code'] == \"1001\" ){\r\n                break;\r\n            }\r\n\r\n            if(!empty($this-&gt;events)){\r\n                foreach ($this-&gt;events as $e){\r\n                    $e();\r\n                }\r\n            }\r\n\r\n            $data['message'] = date(\"Y-m-d H:i:s\" ,time()).\" : Working ...\";\r\n            file_put_contents($this-&gt;daemon_json, json_encode($data), LOCK_EX);\r\n            sleep(1);\r\n        }\r\n        $this-&gt;stop();\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da415043415648-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da415043415648-102\">102</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-e\">php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-2\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-3\"><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-4\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-5\"><span class=\"crayon-c\"> * 守护进程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-6\"><span class=\"crayon-c\"> * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-7\"><span class=\"crayon-c\"> * @date 2016年10月21日 17:04:44</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-8\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-9\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AlpacaDaemon</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-10\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__DIR_</span><span class=\"crayon-sy\">_</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/deamon.json'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-12\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-14\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-16\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">daemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">getInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-26\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">base_path</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'storage'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/crontab/deamon.json'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-30\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">setDaemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-32\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-36\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">setEvents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-38\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-42\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">status</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-47\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-50\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-51\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span><span class=\"crayon-e\">stdClass</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">code</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"1001\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-56\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">message</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"Stop at:\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Y-m-d H:i:s\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-58\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-59\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_message\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"操作成功\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-63\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-65\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-68\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"1001\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-69\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-70\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-71\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1000\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-72\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">//die(\"Error - exit,   Already running !\");</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-73\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-74\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-75\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-76\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"1000\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-77\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'message'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"Start\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-78\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-79\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-80\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">ignore_user_abort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">// 忽略客户端断开</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-81\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">set_time_limit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">           </span><span class=\"crayon-c\">// 设置执行不超时</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-82\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-83\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-84\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-85\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-86\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1001\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-87\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-88\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-89\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-90\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-91\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">events </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">e</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-92\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">e</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-93\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-94\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-95\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-96\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'message'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Y-m-d H:i:s\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\" : Working ...\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-97\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">daemon_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-98\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-99\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-100\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da415043415648-101\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da415043415648-102\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0123 seconds] -->\r\n<p></p>\n<h3 id=\"h3_10\">实现异步处理的类</h3>\n<p>完整类的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9df46da41b472119927\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?php\r\n\r\nnamespace Crontab\\Library\\Crontab;\r\nclass AlpacaWorker\r\n{        \r\n    private static $instance;\r\n\r\n    private $accessToken = '';\r\n\r\n    public static function worker()\r\n    {\r\n        return self::getInstance();\r\n    }\r\n\r\n    private static function getInstance()\r\n    {\r\n        if(!self::$instance){\r\n            self::$instance = new self();\r\n            self::$instance-&gt;accessToken= 'VyKfohBbwlkTOqp2jvIWPW92';\r\n        }\r\n        return self::$instance;\r\n    }\r\n\r\n    public function action(array $worker = null)\r\n    {\r\n        //获取参数\r\n        $ip   = empty($worker['SERVER_ADDR']) ? $_SERVER['SERVER_NAME'] : $worker['SERVER_ADDR'];     //服务器IP地址\r\n        $port = empty($worker['SERVER_PORT']) ? $_SERVER['SERVER_PORT'] : $worker['SERVER_PORT'];     //服务器端口\r\n        $url  = empty($worker['REQUEST_URI']) ? '/' :$worker['REQUEST_URI'];                          //服务器URL\r\n        $data = empty($worker['REQUEST_DATA']) ? '' :$worker['REQUEST_DATA'];                         //请求参数\r\n\r\n        //格式化请求参数\r\n        $postData = \"\";\r\n        $needChar = false;\r\n        if(is_array($data)){\r\n            foreach($data as $key =&gt; $val) {\r\n                $postData .= ($needChar ? \"&amp;\" : \"\") . urlencode($key) . \"=\" . urlencode($val);\r\n                $needChar = true;\r\n            }\r\n        }else{\r\n            $postData = $data;\r\n        }\r\n\r\n        $url=$url.\"?accessToken=\".$this-&gt;accessToken;\r\n\r\n        //使用fsockopen方式异步调用action\r\n        $fp = fsockopen(\"$ip\", $port, $errno, $errstr,1);\r\n        if (!$fp) {\r\n            return 'worker error:'.\"$errstr ($errno)&lt;br /&gt;\\n\";\r\n        } else {\r\n            $out = \"POST $url HTTP/1.1\\r\\n\";\r\n            $out .= \"Host: $ip\\r\\n\";\r\n            $out .= \"Content-Type:application/x-www-form-urlencoded; charset=UTF-8\\r\\n\";\r\n            $out .= \"Content-Length: \" . strlen($postData) . \"\\r\\n\";\r\n            $out .= \"Connection: close\\r\\n\";\r\n            $out .=\"\\r\\n\";\r\n            $out .=$postData;\r\n            fputs($fp, $out);\r\n            fclose($fp);\r\n        }       \r\n        return 'worker success!';\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da41b472119927-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da41b472119927-63\">63</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-e\">php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-2\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-3\"><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-4\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AlpacaWorker</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-5\"><span class=\"crayon-sy\">{</span><span class=\"crayon-h\">        </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">accessToken</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">worker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">getInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-14\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">accessToken</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'VyKfohBbwlkTOqp2jvIWPW92'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">action</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//获取参数</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">ip</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'SERVER_ADDR'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">_SERVER</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'SERVER_NAME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'SERVER_ADDR'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">//服务器IP地址</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'SERVER_PORT'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">_SERVER</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'SERVER_PORT'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'SERVER_PORT'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">     </span><span class=\"crayon-c\">//服务器端口</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">url</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_URI'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_URI'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                          </span><span class=\"crayon-c\">//服务器URL</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_DATA'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">worker</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_DATA'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">                         </span><span class=\"crayon-c\">//请求参数</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-31\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//格式化请求参数</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">postData</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">needChar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">is_array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-36\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">data </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-37\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">postData</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">needChar</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&amp;\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">urlencode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"=\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">urlencode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">val</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-38\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">needChar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-39\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-st\">else</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-41\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">postData</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-43\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-44\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\"?accessToken=\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">accessToken</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-45\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//使用fsockopen方式异步调用action</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fsockopen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"$ip\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">errno</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">errstr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-49\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'worker error:'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\"$errstr ($errno)&lt;br /&gt;\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-51\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"POST $url HTTP/1.1\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-52\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Host: $ip\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-53\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Content-Type:application/x-www-form-urlencoded; charset=UTF-8\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-54\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Content-Length: \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strlen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">postData</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-55\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Connection: close\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-56\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\\r\\n\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-57\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-i\">out</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">postData</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-58\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">fputs</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-59\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">fclose</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">fp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">       </span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'worker success!'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da41b472119927-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da41b472119927-63\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0109 seconds] -->\r\n<p></p>\n<h3 id=\"h3_11\">定时任务处理类</h3>\n<p>定时任务处理类 主要是实现新增、编辑、删除定时任务，执行定时任务要处理的方法</p>\n<p>定时任务的信息以json格式存放在下面的配置文件中</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9df46da421034836815\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[{\"NAME\":\"\\u6d4b\\u8bd5\\u5b9a\\u65f6\\u4efb\\u52a12\",\"STATUS\":\"2\",\"TYPE\":\"1\",\"INTERVAL\":\"5 second\",\"BEGIN_TIME\":\"2017-02-21 11:55:00\",\"NEXT_TIME\":\"2017-02-21 11:55:00\",\"LAST_TIME\":null,\"ACTION\":\"\\/main\\/crontab\\/index2\",\"END_TIME\":\"2017-02-10 15:55:00\"},{\"NAME\":\"TEST - log\",\"STATUS\":\"2\",\"TYPE\":\"2\",\"INTERVAL\":\"5 second\",\"BEGIN_TIME\":\"2017-08-10 09:00:53\",\"NEXT_TIME\":\"2017-08-10 09:59:00\",\"LAST_TIME\":\"2017-08-10 09:58:55\",\"ACTION\":\"\\/crontab\\/task\\/test\",\"END_TIME\":\"2017-08-11 09:25:53\"}]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9df46da421034836815-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9df46da421034836815-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"NAME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"\\u6d4b\\u8bd5\\u5b9a\\u65f6\\u4efb\\u52a12\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"STATUS\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"TYPE\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"INTERVAL\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"5 second\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"BEGIN_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2017-02-21 11:55:00\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"NEXT_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2017-02-21 11:55:00\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"LAST_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">null</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"ACTION\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"\\/main\\/crontab\\/index2\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"END_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2017-02-10 15:55:00\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"NAME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"TEST - log\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"STATUS\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"TYPE\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"INTERVAL\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"5 second\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"BEGIN_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2017-08-10 09:00:53\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"NEXT_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2017-08-10 09:59:00\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"LAST_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2017-08-10 09:58:55\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"ACTION\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"\\/crontab\\/task\\/test\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"END_TIME\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"2017-08-11 09:25:53\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>主要的字段为：</p>\n<p>INDEX 索引<br>\nBEGIN_TIME 开始时间<br>\nEND_TIME 结束时间<br>\nINTERVAL 时间间隔<br>\nNAME 名称<br>\nSTATUS 状态 1-ENABLED, 2-DISABLE<br>\nTASK_TYPE 类型 1-ONCE, 2-LOOP<br>\nACTION 要执行的Action</p>\n<p>类中主要有7个方法：</p>\n<p>listTask() 查看定时任务列表 addTask() 添加定时任务 editTask() 编辑定时任务 editTaskStatus() 编辑定时任务状态 getIndexTask() 获取指定定时任务信息 removeTask() 删除定时任务 doTask() 执行定时任务指定的任务</p>\n<p>完整类的代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9df46da425101026683\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?php\r\n\r\nnamespace Crontab\\Library\\Crontab;\r\n/**\r\n * 定时任务\r\n * @author Chengcheng\r\n * @date 2016年10月21日 17:04:44\r\n */\r\nclass AlpacaCrontab\r\n{\r\n    //定时任务文件\r\n    private $task_json = __DIR__ .'/crontab.json';\r\n\r\n    //单例\r\n    private static $instance;\r\n\r\n    //单例\r\n    public static function crontab()\r\n    {\r\n        return self::getInstance();\r\n    }\r\n\r\n    //单例\r\n    private static function getInstance()\r\n    {\r\n        if(!self::$instance){\r\n            self::$instance = new self();\r\n            self::$instance-&gt;task_json = base_path('storage') . '/crontab/crontab.json';\r\n        }\r\n        return self::$instance;\r\n    }\r\n\r\n    /**\r\n     * 配置\r\n     * @author Chengcheng\r\n     * @param array $crontab\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function setConfig($crontab)\r\n    {\r\n        $this-&gt;task_json = $crontab;\r\n        return $this;\r\n    }\r\n\r\n    /**\r\n     * 查看定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function listTask()\r\n    {\r\n        $tasks = json_decode(file_get_contents($this-&gt;task_json));\r\n        $i = 0;\r\n        foreach ($tasks as $task)\r\n        {\r\n            $tasks[$i]-&gt;INTERVAL = $this-&gt;timeToStr($tasks[$i]-&gt;INTERVAL);\r\n            $i++;\r\n        }\r\n        return $tasks;\r\n    }\r\n\r\n    /**\r\n     * 添加定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function addTask($task)\r\n    {\r\n        $result[\"result_code\"] = \"1\";\r\n        $result[\"result_message\"] = \"添加成功\";\r\n        $tasks = json_decode(file_get_contents($this-&gt;task_json),true);\r\n        $tasks[count($tasks)] = $task;\r\n        file_put_contents($this-&gt;task_json, json_encode($tasks), LOCK_EX);\r\n        return $result;\r\n    }\r\n\r\n    /**\r\n     * 编辑定时任务\r\n     * @author Chengcheng\r\n     * @param string $index\r\n     * @param string $task\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function editTask($index,$task)\r\n    {\r\n        $result[\"result_code\"] = \"1\";\r\n        $result[\"result_message\"] = \"修改成功\";\r\n        $tasks = json_decode(file_get_contents($this-&gt;task_json));\r\n        $tasks[$index] = $task;\r\n        file_put_contents($this-&gt;task_json, json_encode($tasks), LOCK_EX);\r\n        return $result;\r\n    }\r\n\r\n    /**\r\n     * 编辑定时任务状态\r\n     * @author Chengcheng\r\n     * @param string $index\r\n     * @param string $status\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function editTaskStatus($index,$status)\r\n    {\r\n        $result_data[\"result_code\"] = \"1\";\r\n        $result_data[\"result_message\"] = \"修改状态成功[\".$status.\"]\";\r\n        $tasks = json_decode(file_get_contents($this-&gt;task_json));\r\n        $tasks[$index]-&gt;STATUS = $status;\r\n        file_put_contents($this-&gt;task_json, json_encode($tasks), LOCK_EX);\r\n        return $result_data;\r\n    }\r\n\r\n    /**\r\n     * 获取定时任务\r\n     * @author Chengcheng\r\n     * @param string $index\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function getIndexTask($index)\r\n    {\r\n        $result_data[\"result_code\"] = \"1\";\r\n        $result_data[\"result_message\"] = \"获取任务成功【\".$index.\"】\";\r\n        $tasks = json_decode(file_get_contents($this-&gt;task_json));\r\n        $result_data[\"result_data\"] = $tasks[$index];\r\n        return $result_data;\r\n    }\r\n\r\n    /**\r\n     * 删除定时任务\r\n     * @author Chengcheng\r\n     * @param string $index\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function removeTask($index)\r\n    {\r\n        $result_data[\"result_code\"] = \"1\";\r\n        $result_data[\"result_message\"] = \"删除任务【\".$index.\"】成功\";\r\n        $tasks = json_decode(file_get_contents($this-&gt;task_json));\r\n        array_splice($tasks, $index, 1);\r\n        file_put_contents($this-&gt;task_json, json_encode($tasks), LOCK_EX);\r\n        return $result_data;\r\n    }\r\n\r\n    /**\r\n     * 执行定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    public function doTask()\r\n    {\r\n        $tasks = json_decode(file_get_contents($this-&gt;task_json) ,true);      \r\n        if(empty($tasks)){ return ;}\r\n\r\n        $now = date('Y-m-d H:i:s',time());\r\n        foreach ($tasks as &amp;$task){\r\n            if(empty($task['STATUS']) || empty($task['TYPE'])  || empty($task['BEGIN_TIME']) || empty($task['ACTION']) )\r\n            {\r\n                continue;\r\n            }\r\n\r\n            if($task['STATUS'] != 1)\r\n            {\r\n                continue;\r\n            }\r\n\r\n            if(!empty($task['END_TIME']) &amp;&amp; strtotime($now)&gt;=strtotime($task['END_TIME'])){\r\n                $task['NEXT_TIME']='END';\r\n                continue;\r\n            }\r\n\r\n            if($task['TYPE'] == 1 &amp;&amp; empty($task['NEXT_TIME']) )\r\n            {\r\n                continue;\r\n            }\r\n\r\n            if($task['TYPE'] == 2 &amp;&amp; empty($task['INTERVAL']) )\r\n            {\r\n                continue;\r\n            }\r\n\r\n            if(!empty($task['NEXT_TIME']) &amp;&amp; $task['NEXT_TIME']=='END' )\r\n            {\r\n                continue;\r\n            }\r\n\r\n            if($task['TYPE'] == 1 &amp;&amp; (strtotime($now)&gt;=strtotime($task['NEXT_TIME'])))\r\n            {\r\n                $task['LAST_TIME']= $now;\r\n                $task['NEXT_TIME']='END';\r\n                $task['STATUS']=2;\r\n                AlpacaWorker::worker()-&gt;action(['REQUEST_URI'=&gt;\"{$task['ACTION']}\"]);\r\n                continue;\r\n            }\r\n\r\n            if($task['TYPE'] == 2)\r\n            {\r\n                if(empty($task['NEXT_TIME'])){\r\n                    $task['NEXT_TIME'] = $task['BEGIN_TIME'];\r\n                }\r\n\r\n                if(strtotime($now)&gt;=strtotime($task['NEXT_TIME'])){\r\n                    $task['LAST_TIME']= $now;\r\n                    $task['NEXT_TIME']= date('Y-m-d H:i:s',strtotime($task['INTERVAL']));\r\n                    AlpacaWorker::worker()-&gt;action(['REQUEST_URI'=&gt;\"{$task['ACTION']}\"]);\r\n                }\r\n                continue;\r\n            }\r\n        }\r\n\r\n        file_put_contents($this-&gt;task_json, json_encode($tasks), LOCK_EX);\r\n        return $tasks;\r\n    }\r\n\r\n    /**\r\n     * 格式化时间\r\n     * @author Chengcheng\r\n     * @param string $interval\r\n     * @date 2016-10-23 20:34:00\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    private function timeToStr($interval)\r\n    {\r\n        $result = \"\";\r\n        if($interval != null &amp;&amp; $interval != \"\"){\r\n            $temp = explode(\" \", $interval);\r\n            $iNumTemp = $temp[0];\r\n            $iType = $temp[1];\r\n            $iNum = str_replace(\"+\", \"\", $iNumTemp);\r\n            $str = \"\";\r\n            switch ($iType){\r\n                case \"year\":\r\n                    $str = \"（年）\";\r\n                    break;\r\n                case \"month\":\r\n                    $str = \"（月）\";\r\n                    break;\r\n                case \"day\":\r\n                    $str = \"（日）\";\r\n                    break;\r\n                case \"hour\":\r\n                    $str = \"（小时）\";\r\n                    break;\r\n                case \"minute\":\r\n                    $str = \"（分）\";\r\n                    break;\r\n                case \"second\":\r\n                    $str = \"（秒）\";\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n           $result = $iNum. $str;\r\n        }\r\n        return $result;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-139\">139</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-140\">140</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-141\">141</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-142\">142</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-143\">143</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-144\">144</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-145\">145</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-146\">146</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-147\">147</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-148\">148</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-149\">149</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-150\">150</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-151\">151</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-152\">152</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-153\">153</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-154\">154</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-155\">155</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-156\">156</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-157\">157</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-158\">158</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-159\">159</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-160\">160</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-161\">161</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-162\">162</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-163\">163</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-164\">164</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-165\">165</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-166\">166</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-167\">167</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-168\">168</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-169\">169</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-170\">170</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-171\">171</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-172\">172</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-173\">173</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-174\">174</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-175\">175</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-176\">176</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-177\">177</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-178\">178</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-179\">179</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-180\">180</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-181\">181</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-182\">182</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-183\">183</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-184\">184</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-185\">185</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-186\">186</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-187\">187</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-188\">188</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-189\">189</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-190\">190</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-191\">191</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-192\">192</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-193\">193</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-194\">194</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-195\">195</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-196\">196</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-197\">197</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-198\">198</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-199\">199</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-200\">200</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-201\">201</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-202\">202</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-203\">203</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-204\">204</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-205\">205</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-206\">206</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-207\">207</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-208\">208</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-209\">209</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-210\">210</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-211\">211</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-212\">212</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-213\">213</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-214\">214</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-215\">215</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-216\">216</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-217\">217</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-218\">218</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-219\">219</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-220\">220</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-221\">221</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-222\">222</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-223\">223</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-224\">224</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-225\">225</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-226\">226</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-227\">227</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-228\">228</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-229\">229</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-230\">230</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-231\">231</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-232\">232</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-233\">233</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-234\">234</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-235\">235</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-236\">236</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-237\">237</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-238\">238</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-239\">239</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-240\">240</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-241\">241</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-242\">242</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-243\">243</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-244\">244</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-245\">245</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-246\">246</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-247\">247</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-248\">248</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-249\">249</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-250\">250</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-251\">251</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-252\">252</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-253\">253</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-254\">254</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-255\">255</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-256\">256</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-257\">257</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-258\">258</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-259\">259</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-260\">260</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da425101026683-261\">261</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da425101026683-262\">262</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-e\">php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-2\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-3\"><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-4\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-5\"><span class=\"crayon-c\"> * 定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-6\"><span class=\"crayon-c\"> * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-7\"><span class=\"crayon-c\"> * @date 2016年10月21日 17:04:44</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-8\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-9\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AlpacaCrontab</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-10\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//定时任务文件</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__DIR_</span><span class=\"crayon-sy\">_</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">'/crontab.json'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//单例</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-16\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//单例</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">getInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-22\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//单例</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-27\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">base_path</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'storage'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/crontab/crontab.json'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-o\">::</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">instance</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-32\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-34\"><span class=\"crayon-c\">     * 配置</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-35\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-36\"><span class=\"crayon-c\">     * @param array $crontab</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-37\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-38\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-39\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">setConfig</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">crontab</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">crontab</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-45\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-47\"><span class=\"crayon-c\">     * 查看定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-48\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-49\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-50\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-51\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-52\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">listTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-55\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-56\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">tasks </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-57\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-58\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">INTERVAL</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">timeToStr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">INTERVAL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-59\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-62\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-63\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-64\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-65\"><span class=\"crayon-c\">     * 添加定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-66\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-67\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-68\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-69\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-70\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">addTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-71\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-72\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-73\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_message\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"添加成功\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-74\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-75\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">count</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-76\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-77\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-78\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-79\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-80\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-81\"><span class=\"crayon-c\">     * 编辑定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-82\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-83\"><span class=\"crayon-c\">     * @param string $index</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-84\"><span class=\"crayon-c\">     * @param string $task</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-85\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-86\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-87\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-88\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">editTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-89\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-90\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-91\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_message\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"修改成功\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-92\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-93\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-94\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-95\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-96\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-97\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-98\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-99\"><span class=\"crayon-c\">     * 编辑定时任务状态</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-100\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-101\"><span class=\"crayon-c\">     * @param string $index</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-102\"><span class=\"crayon-c\">     * @param string $status</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-103\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-104\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-105\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-106\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">editTaskStatus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-107\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-108\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-109\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_message\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"修改状态成功[\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\"]\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-110\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-111\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">STATUS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-112\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-113\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-114\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-115\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-116\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-117\"><span class=\"crayon-c\">     * 获取定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-118\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-119\"><span class=\"crayon-c\">     * @param string $index</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-120\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-121\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-122\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-123\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getIndexTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-124\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-125\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-126\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_message\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"获取任务成功【\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\"】\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-127\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-128\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_data\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-129\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-130\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-131\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-132\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-133\"><span class=\"crayon-c\">     * 删除定时任务</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-134\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-135\"><span class=\"crayon-c\">     * @param string $index</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-136\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-137\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-138\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-139\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">removeTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-140\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-141\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_code\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"1\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-142\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"result_message\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"删除任务【\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">.</span><span class=\"crayon-s\">\"】成功\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-143\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-144\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">array_splice</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-145\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-146\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result_data</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-147\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-148\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-149\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-150\"><span class=\"crayon-c\">     * 执行定时任务</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-151\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-152\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-153\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-154\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-155\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">doTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-156\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-157\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">file_get_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\">      </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-158\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-159\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-160\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Y-m-d H:i:s'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-161\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">foreach</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">tasks </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-162\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'ACTION'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-163\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-164\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-165\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-166\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-167\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-168\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-169\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-170\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-171\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-172\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'END_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-173\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'END'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-174\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-175\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-176\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-177\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-178\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-179\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-180\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-181\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-182\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-183\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-184\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-185\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-186\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-187\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">==</span><span class=\"crayon-s\">'END'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-188\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-189\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-190\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-191\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-192\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-193\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-194\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'LAST_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-195\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'END'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-196\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'STATUS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-197\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">AlpacaWorker</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">worker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">action</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_URI'</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-s\">\"{$task['ACTION']}\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-198\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-199\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-200\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-201\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TYPE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-202\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-203\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">empty</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-204\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'BEGIN_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-205\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-206\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-207\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-208\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'LAST_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">now</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-209\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'NEXT_TIME'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Y-m-d H:i:s'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-e\">strtotime</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">task</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'INTERVAL'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-210\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">AlpacaWorker</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">worker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">action</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_URI'</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-s\">\"{$task['ACTION']}\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-211\"><span class=\"crayon-h\">                </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-212\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-213\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-214\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-215\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-216\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">file_put_contents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-v\">task_json</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOCK_EX</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-217\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-218\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-219\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-220\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-221\"><span class=\"crayon-c\">     * 格式化时间</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-222\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-223\"><span class=\"crayon-c\">     * @param string $interval</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-224\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-225\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-226\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-227\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">timeToStr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">interval</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-228\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-229\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-230\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">interval</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">null</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">interval</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-231\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">explode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">interval</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-232\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iNumTemp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-233\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iType</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-234\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iNum</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str_replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"+\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iNumTemp</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-235\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-236\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">switch</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iType</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-237\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"year\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-238\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"（年）\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-239\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-240\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"month\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-241\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"（月）\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-242\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-243\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"day\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-244\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"（日）\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-245\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-246\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"hour\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-247\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"（小时）\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-248\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-249\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"minute\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-250\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"（分）\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-251\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-252\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">case</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"second\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-253\"><span class=\"crayon-h\">                    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"（秒）\"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-254\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-255\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">default</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-256\"><span class=\"crayon-h\">                    </span><span class=\"crayon-st\">break</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-257\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-258\"><span class=\"crayon-h\">           </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">iNum</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">str</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-259\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-260\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da425101026683-261\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da425101026683-262\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0299 seconds] -->\r\n<p></p>\n<h3 id=\"h3_12\">定时任务进程入口控制器</h3>\n<p>主要是为了实现异步开启后台进程</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9df46da430499941916\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;?php\r\n\r\nnamespace Crontab\\Controllers;\r\n\r\nuse Crontab\\Common\\Code;\r\nuse Crontab\\Common\\Msg;\r\nuse Crontab\\Controllers\\Base\\BaseController;\r\nuse Crontab\\Library\\Crontab\\AlpacaCrontab;\r\nuse Crontab\\Library\\Crontab\\AlpacaDaemon;\r\nuse Crontab\\Library\\Crontab\\AlpacaWorker;\r\n\r\n/**\r\n * index\r\n * @author Chengcheng\r\n * @date 2017-02-22 15:50:00\r\n */\r\nclass IndexController extends BaseController\r\n{\r\n    /**\r\n     * 设置不需要登录的的Action,不加Action前缀\r\n     * @author Chengcheng\r\n     * @date   2016年10月23日 20:39:25\r\n     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array\r\n     */\r\n    protected function withoutLoginActions()\r\n    {\r\n\r\n    }\r\n\r\n    /**\r\n     * 开始定时任务的守护进程\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function start()\r\n    {\r\n\r\n        //开始守护进程\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n\r\n        //在守护进程中注入定时任务\r\n        $events = ['0'=&gt;function(){\r\n            AlpacaWorker::worker()-&gt;action(['REQUEST_URI'=&gt;\"/crontab/index/task\"]);\r\n        }];\r\n        AlpacaDaemon::daemon()-&gt;setEvents($events);\r\n        AlpacaDaemon::daemon()-&gt;start();\r\n\r\n        //返回结果\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 停止定时任务的守护进程\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function stop()\r\n    {\r\n        //停止守护进程\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = AlpacaDaemon::daemon()-&gt;stop();\r\n\r\n        //返回结果\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n\r\n    /**\r\n     * 执行定时任务\r\n     * @author Chengcheng\r\n     * @date 2016-10-23 20:34:00\r\n     */\r\n    public function task()\r\n    {\r\n        //执行定时任务\r\n        $result['code'] = Code::SYSTEM_OK;\r\n        $result['msg']  = Msg::SYSTEM_OK;\r\n        $result['data'] = AlpacaCrontab::crontab()-&gt;doTask();\r\n\r\n        //返回结果\r\n        return $this-&gt;ajaxReturn($result);\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-59b9df46da430499941916-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9df46da430499941916-84\">84</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-sy\">?</span><span class=\"crayon-e\">php</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-2\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-3\"><span class=\"crayon-t\">namespace</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Controllers</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-4\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-5\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Common</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Code</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-6\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Common</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Msg</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-7\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Controllers</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Base</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">BaseController</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-8\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-9\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-10\"><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Library</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">Crontab</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">AlpacaWorker</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-12\"><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-13\"><span class=\"crayon-c\"> * index</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-14\"><span class=\"crayon-c\"> * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-15\"><span class=\"crayon-c\"> * @date 2017-02-22 15:50:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-16\"><span class=\"crayon-c\"> */</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-17\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IndexController</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">extends</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BaseController</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-18\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-20\"><span class=\"crayon-c\">     * 设置不需要登录的的Action,不加Action前缀</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-21\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-22\"><span class=\"crayon-c\">     * @date   2016年10月23日 20:39:25</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-23\"><span class=\"crayon-c\">     * &lt;a href='http://www.jobbole.com/members/wx1409399284'&gt;@return&lt;/a&gt; array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-24\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">protected</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">withoutLoginActions</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-27\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-31\"><span class=\"crayon-c\">     * 开始定时任务的守护进程</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-32\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-33\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-34\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-37\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//开始守护进程</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-41\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//在守护进程中注入定时任务</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'0'</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-t\">function</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-44\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">AlpacaWorker</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">worker</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">action</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'REQUEST_URI'</span><span class=\"crayon-o\">=</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-s\">\"/crontab/index/task\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">daemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">setEvents</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">daemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">start</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-48\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//返回结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-51\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-52\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-54\"><span class=\"crayon-c\">     * 停止定时任务的守护进程</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-55\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-56\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-57\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-58\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-59\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//停止守护进程</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-62\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-63\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaDaemon</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">daemon</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">stop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-64\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-65\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//返回结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-67\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-68\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-69\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">/**</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-70\"><span class=\"crayon-c\">     * 执行定时任务</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-71\"><span class=\"crayon-c\">     * @author Chengcheng</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-72\"><span class=\"crayon-c\">     * @date 2016-10-23 20:34:00</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-73\"><span class=\"crayon-c\">     */</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-74\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">task</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-75\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-76\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//执行定时任务</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-77\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'code'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Code</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-78\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'msg'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Msg</span><span class=\"crayon-o\">::</span><span class=\"crayon-v\">SYSTEM_OK</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-79\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'data'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AlpacaCrontab</span><span class=\"crayon-o\">::</span><span class=\"crayon-e\">crontab</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">doTask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-80\"> </div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-81\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\">//返回结果</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-82\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-r\">this</span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-e\">ajaxReturn</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">result</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9df46da430499941916-83\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9df46da430499941916-84\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0072 seconds] -->\r\n<p>以上是PHP实现定时任务的核心类与方法， 完整的代码请参看代码服务器中提供的源码。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112214\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112214votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112214\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "编写高质量代码的思考", "url": "http://blog.jobbole.com/112139/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/06/real-programmers-code-in-binary.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 2, "tags": "开发,代码质量", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/Yonah\">肖汉松</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<h2 id=\"u524D_u8A00\">前言</h2>\n<p>最近在看《代码大全》，可以说是一本软件开发的百科全书，特别厚，但是干货也很多。平时写代码，代码规范是一个最低的要求（很多老代码连最低要求都达不到），为什么要这样规定代码要这么写，而不是那么写？这是一个值得深究的问题。而不是说我照着代码规范写代码就算完了，高质量的代码是一个专业工程师的追求。要知其然知其所以然，最近写发票解析的代码，因为涉及带解析PDF的算法，复杂度比较高，所以花了很多时间在重构，学以致用的时候积累了一些心得。</p>\n<h2 id=\"u4FE1_u606F_u9690_u85CF_u539F_u5219\">信息隐藏原则</h2>\n<p>信息隐藏是面向对象设计的一个原则，是对封装和模块化的一个更高维度的概括。从Java的整个访问限制设计就体现了信息隐藏的原则，各种访问修饰符：<code>public,protect,private</code>，在类设计的时候，我们就要决定什么暴露给外部，什么隐藏起来。</p>\n<p>举一个例子下面的代码表示一个有自增ID的<code>Person</code>类。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9aa324fec2254273610\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class Person {\r\n    int id;\r\n    private static int G_MAX_ID = 0;\r\n    public Person() {\r\n      this.id = ++G_MAX_ID;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9aa324fec2254273610-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9aa324fec2254273610-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9aa324fec2254273610-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9aa324fec2254273610-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9aa324fec2254273610-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9aa324fec2254273610-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9aa324fec2254273610-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9aa324fec2254273610-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Person</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9aa324fec2254273610-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9aa324fec2254273610-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">G_MAX_ID</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9aa324fec2254273610-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Person</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9aa324fec2254273610-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-v\">G_MAX_ID</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9aa324fec2254273610-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9aa324fec2254273610-7\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p><span style=\"font-weight: normal;\">上面的类设计有什么问题呢？它违反了信息隐藏的原则，直接将ID分配的方式暴露了，这会给后面的维护带来很多问题：当你想给id的范围做出限制的时候怎么办？当你在所有代码中使用</span><code style=\"font-style: inherit;\">++G_MAX_ID</code><span style=\"font-weight: normal;\">分配ID时突然需要修改ID分配的算法怎么办？是不是需要去改所有</span><code style=\"font-style: inherit;\">++G_MAX_ID</code><span style=\"font-weight: normal;\">出现的地方？更好的设计是将ID的分配算法隐藏起来。</span></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9aa324fecc788086221\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npublic class Person {\r\n    int id;\r\n    private static int G_MAX_ID = 0;\r\n    public Person() {\r\n      this.id = NewId();\r\n    }\r\n    private int NewId() {\r\n      return ++G_MAX_ID;\r\n    }\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9aa324fecc788086221-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9aa324fecc788086221-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9aa324fecc788086221-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9aa324fecc788086221-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9aa324fecc788086221-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9aa324fecc788086221-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9aa324fecc788086221-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9aa324fecc788086221-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9aa324fecc788086221-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9aa324fecc788086221-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9aa324fecc788086221-1\"><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Person</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9aa324fecc788086221-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9aa324fecc788086221-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-m\">static</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">G_MAX_ID</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9aa324fecc788086221-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">public</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Person</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9aa324fecc788086221-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NewId</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9aa324fecc788086221-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9aa324fecc788086221-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-m\">private</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">NewId</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9aa324fecc788086221-8\"><span class=\"crayon-h\">      </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">++</span><span class=\"crayon-v\">G_MAX_ID</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9aa324fecc788086221-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9aa324fecc788086221-10\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p><span style=\"font-weight: normal;\">咋一看只是将</span><code style=\"font-style: inherit;\">++G_MAX_ID</code><span style=\"font-weight: normal;\">写到一个方法里面而已，但是它隐藏了ID分配的算法，让调用者不需要关心里面的实现，同时控制了变化，不管ID分配算法怎么变，都不会影响其他的代码。调用者了解的信息越多，受到的影响就越大，信息隐藏可以降低复杂度，控制变化的范围。</span></p>\n<p>上面的例子只是信息隐藏的一个简单应用，下面我们来举几个其他的应用例子：</p>\n<ul>\n<li>为什么不推荐使用魔法值（即未经定义的常量）？：这个明显违反了信息隐藏的原则，当你将字面量直接写在代码里面时，就将信息直接暴露了，后面需要修改的时候，一旦少改了某个地方的字面量，bug就出现了。</li>\n<li>循环依赖（即A调用B，B调用A的情况）：类或方法之间的循环依赖会破坏信息隐藏，一个很直接的影响就是在测试的时候，A，B都需要同时准备好才能进行测试，而无法mock任意一方。</li>\n<li>使用全局变量：这个就不用说了，所有人都可以访问你的时候信息就暴露无疑了，全局变量能不用就不用。</li>\n<li>考虑性能损失：有时候我们为了一些性能上的考虑就破坏信息隐藏原则，将一些变量全局化，这样性能提高得不多，维护成本却上升不少，完全是得不偿失。</li>\n</ul>\n<p>最后总结一下信息隐藏的好处：</p>\n<ul>\n<li>隐藏信息即隐藏了复杂度，降低了编程的负担。</li>\n<li>隐藏信息即隐藏了底层变化，以便于在局部控制变化。</li>\n</ul>\n<h2 id=\"u4E00_u4E9B_u4E0D_u592A_u5E38_u89C1_u7684_u7F16_u7A0B_u6280_u5DE7\">一些不太常见的编程技巧</h2>\n<h3 id=\"u51FD_u6570_28function_29_u4E0E_u8FC7_u7A0B_28procedure_29_u7684_u9009_u62E9\">函数(function)与过程(procedure)的选择</h3>\n<p>我们先来看看函数与过程区别：</p>\n<ul>\n<li>Function：有返回值的方法</li>\n<li>Procedure：没有返回值的方法</li>\n</ul>\n<p>平时我们编程其实没有太区别函数与过程，什么时候用函数，什么时候用过程其实没有过多的考虑，感觉都可以用。一个选择的规则就是<strong>当你的方法的目的是想返回跟你方法名称相符的值的时候用函数，否则用过程</strong></p>\n<p>举个例子，我看过很多<code>XXProcessor</code>接口里面的方法都是<code>XX process()</code>，严格来讲，这样的命名是不符合上面的规则的，<code>process</code>是一个没有含义的命名，但是却有返回值，如果没有返回值那它的命名才是合理的。</p>\n<p>当然了，上面的规则仅供参考，世事无绝对，具体情况具体分析，当你不清楚用函数还是用过程的时候，可以参考这个规则。</p>\n<h3 id=\"u4F7F_u7528boolean_u503C_u6765_u7ED9_u7A0B_u5E8F_u505A_u6CE8_u91CA\">使用boolean值来给程序做注释</h3>\n<p>相信大家看到一个if语句有很多条件的时候都会特别头痛，因为很难理解。例如下面的例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9aa324fed2625215659\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif ( ( elementIndex &lt; 0 ) || ( MAX_ELEMENTS &lt; elementIndex ) || elementIndex == lastElementIndex) {\r\n  do....\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9aa324fed2625215659-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9aa324fed2625215659-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9aa324fed2625215659-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9aa324fed2625215659-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">elementIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MAX_ELEMENTS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">elementIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">elementIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lastElementIndex</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9aa324fed2625215659-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">do</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59b9aa324fed2625215659-3\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p><span style=\"font-weight: normal;\">但如果换成下面的写法，用boolean值的名字来给if语句注释，看起来就很好理解了。</span></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9aa324fed6905233170\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfinished = ( ( elementIndex &lt; 0 ) || ( MAX_ELEMENTS &lt; elementIndex ) );\r\nrepeatedEntry = ( elementIndex == lastElementIndex );\r\nif ( finished || repeatedEntry ) {\r\n...\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9aa324fed6905233170-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9aa324fed6905233170-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9aa324fed6905233170-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9aa324fed6905233170-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9aa324fed6905233170-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9aa324fed6905233170-1\"><span class=\"crayon-v\">finished</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">elementIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MAX_ELEMENTS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">elementIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9aa324fed6905233170-2\"><span class=\"crayon-v\">repeatedEntry</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">elementIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">lastElementIndex</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9aa324fed6905233170-3\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">finished</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">||</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">repeatedEntry</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9aa324fed6905233170-4\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59b9aa324fed6905233170-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n<p><span style=\"font-family: 'Microsoft YaHei', 宋体, 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 24px; font-style: normal; font-weight: normal;\">总结</span></p>\n<p>怎么写高质量的代码是一个很大的话题，这里只是抛砖引玉，其实面向对象设计的很多原则都能够给我们写代码的时候提供指导，写代码的时候要时刻记得学以致用，而不是敷衍了事，专业的软件工程师必然要能写得一手好代码。</p>\n</div>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我写出更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏作者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我写出更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/5bf123eeb2d2e5d53b487415f6c0555c.png\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/c7fcb7a46ab889ed5518728242187ab5.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112139\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112139votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112139\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/Yonah\">肖汉松</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/Yonah\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/2015/10/b312ba4ffd5245fa2a1ab819ec0d0347.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            热爱阅读，喜欢挑战。热衷尝试新的技术，关注技术背后的原理。关注领域：Java 服务端开发，网络编程。关注语言：Java, C, Python。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/Yonah\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/yonah/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/Yonah/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 39</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://blog.xiaohansong.com\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/xiaohansong\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/x-hansong\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "程序员的自我修养：温故而知新", "url": "http://blog.jobbole.com/112161/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/fd582ce02602d145acd4982f8b868c92.png"], "praise_nums": "2", "comment_nums": 1, "fav_nums": 15, "tags": "职场,程序员", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.cnblogs.com/Tan-sir/p/7272652.html\">目不识丁</a>   </div><h2>1.1从Hello World说起</h2>\n<p>目的：从最基本的编译，静态链接到操作系统如何转载程序，动态链接及运行库和标准库的实现，和一些操作系统的机制。了解计算机上程序运行的一个基本脉络。</p>\n<h2>1.2变不离其宗</h2>\n<p>计算机最关键的三个部分：CPU,内存,I/O控制芯片。</p>\n<ul>\n<li>早期的计算机：没有复杂的图形功能，CPU和内存频率一样，都连接在同一个总线上。</li>\n<li>CPU频率提升：内存跟不上CPU，产生了和内存频率一致的系统总线，CPU使用倍频的方式和总线通信。</li>\n<li>图形界面的出现：图形芯片需要和内存和CPU大量交换数据，慢速的I/O总线无法满足图形设备的巨大需求。为了高效处理数据，设计了一个高速的北桥芯片。后来有设计处理低速处理设备南桥芯片，磁盘，USB，键盘都是连接在南桥上。在由南桥将它们汇总到北桥上。</li>\n</ul>\n<h5><strong>北桥</strong></h5>\n<ul>\n<li>北桥左边CPU和cache：CPU负责所有控制和运算。</li>\n<li>北桥下面PCI总线</li>\n<li>北桥右边memory</li>\n</ul>\n<h5>SMP和多核</h5>\n<p>现在CPU已经达到物理极限，被4GHz所限制，于是，开始通过增加CPU数量来提高计算机速度。<br>\n<strong>对称多处理器（SMP）</strong>：最常见的一种形式。每个CPU在系统中所处的地位和所发挥的功能是一样，是相互对称的。但在处理程序时，我们并不能把他们分成若干个不相干的子问题，所以，使得多处理器速度实际提高得并没有理论上那么高。当对于相互独立的问题，多处理器就能最大效能的发挥威力了（比如：大型数据库,网络服务等）。<br>\n对处理器由于造价比较高昂，主要用在商用电脑上，对于个人电脑，主要是<strong>多核处理器</strong>。<br>\n多核处理器：其实际上是(SMP)的简化版，思想是将多个处理器合并在一起打包出售，它们之间共享比较昂贵的缓存部件，只保留了多个核心。在逻辑上看，它们和SMP完全相同。</p>\n<h2>1.3站得高,看得远</h2>\n<p><strong>系统软件</strong>：一般用于管理计算机本地的软件。</p>\n<p>主要分为两块：</p>\n<ul>\n<li>平台性的：操作系统内核，驱动程序，运行库。</li>\n<li>程序开发：编译器，汇编器，链接器。</li>\n</ul>\n<p>计算机系统软件体系结构采用一种<strong>层</strong>的结构。<br>\n每个层次之间都需要相互通信，那么它们之间就有通信协议，我们将它称为接口，接口下层是提供者，定义接口。上层是使用者，使用接口实现所需功能。<br>\n除了硬件和应用程序，其他的都是中间层，每个中间层都是对它下面的那层的包装和扩展。它们使得应用程序和硬件之间保持相对独立。<br>\n从整个层次结构来看，开发工具与应用程序属于同一个层次，因为它们都使用同一个接口—操作系统<strong>应用程序编程接口</strong>。应用程序接口提供者是运行库，什么样的运行库提供什么样的接口。winsows的运行库提供Windows API，Linux下的Gliba库提供POSIX的API。<br>\n运行库使用操作系统提供的<strong>系统调用接口</strong>。<br>\n系统调用接口在实现中往往以<strong>软件中断</strong>的方式提供。<br>\n操作系统内核层对于硬件层来说是硬件接口的使用者，而硬件是接口的定义者。这种接口叫做<strong>硬件规格</strong>。</p>\n<h2>1.4操作系统做了什么</h2>\n<p>操作系统的一个功能是提供抽象的接口，另外一个主要功能是管理硬件资源。<br>\n一个计算机中的资源主要分CPU,存储器（包括内存和磁盘）和I/O设备。下面从这3个方面来看如何挖机它们。</p>\n<h3>1.4.1不要让CPU打盹</h3>\n<p><strong>多道程序</strong>：编译一个监控程序，当程序不需要使用CPU时，将其他在等待CPU的程序启动。但它的弊端是不分轻重缓急，有时候一个交互操作可能要等待数十分钟。<br>\n改进后<br>\n<strong>分时系统</strong>：每个CPU运行一段时间后，就主动让出给其他CPU使用。完整的操作系统雏形在此时开始出现。但当一个程序死机的时候，无法主动让出CPU，那么，整个系统都无法响应。<br>\n目前操作系统采用的方式<br>\n<strong>多任务系统</strong>：操作系统接管了所有的硬件资源，并且本身运行在一个受硬件保护的级别。所有的应用都以<strong>进程</strong>的方式运行在比操作系统更低的级别，每个进程都有自己独立的地址空间，使得进程之间的地址空间相互隔离。CPU由操作系统进行同一分配，每个进程根据进程优先级的高低都有机会获得CPU，但如果运行超过一定的时间，CPU会将资源分配给其他进程，这种CPU分配方式是<strong>抢占式</strong>。如果操作系统分配每个进程的时间很短，就会造成很多进程都在同时运行的假象，即所谓的<strong>宏观并行，微观串行</strong>。</p>\n<h5><a name=\"%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8\"></a>设备驱动</h5>\n<p>操作系统作为硬件层的上层，它是对硬件的管理和抽象。<br>\n对于操作系统上面的运行库和应用程序来说，它们只希望看到一个统一的硬件访问模式。<br>\n当成熟的操作系统出现后，硬件逐渐成了抽象的概念。在UNIX中，硬件设备的访问形式和访问普通的文件形式一样。在Windows系统中，图形硬件被抽象成GDI，声音和多媒体设备被抽象成DirectX对象，磁盘被抽象成普通文件系统。<br>\n这些繁琐的硬件细节全都交给了操作系统中的硬件驱动。<br>\n文件系统管理这磁盘的存储方式。<br>\n<strong>磁盘的结构</strong>：一个硬盘往往有多个盘片，每个盘片分两面，每面按照同心圆划分为若干磁道，每个磁道划分为若干扇区，每个扇区一般512字节。<br>\n<strong>LBA</strong>：整个硬盘中所有扇区从0开始编号，一直到最后一个扇区，这个扇区编号叫做<strong>逻辑扇区号</strong>。<br>\n文件系统保存了这些文件的存储结构，负责维护这些数据结构并且保证磁盘中的扇区能有效的组织和利用。</p>\n<h2>1.5内存不够怎么办</h2>\n<p>在早期计算机中，程序是直接运行在物理内存上的，程序所访问的都是物理地址。<br>\n那么如何将计算机有限的地址分配给多个程序使用。<br>\n直接按物理内存分配将产生很多问题：</p>\n<ul>\n<li><strong>地址空间不隔离</strong>：所有的程序都直接访问物理地址，导致程序使用的物理地址不是相互隔离的，恶意的程序很容易串改其他程序的内存数据。</li>\n<li><strong>内存使用效率低</strong>：由于没有有效的内存管理机制，通常一个程序执行的时候，监控程序要将整个程序读入。内存不够的时候，需要先将内存中的程序读出，保存在硬盘上，才能将需要运行的程序读入。这样会使得整个过程有大量数据换入换出。</li>\n<li><strong>程序运行地址不确定</strong>：每次程序运行都需要内存分配一块足够大的内存空间，使得这个地址是不确定的。但在程序编写的时候，他访问的数据和指令跳转的目标地址都是固定的，这就涉及到了程序的<strong>重定向</strong>问题。</li>\n</ul>\n<p>一种解决办法：<br>\n<strong>中间层</strong>：使用一种间接的地址访问方法，我们把程序给出的地址看作一种<strong>虚拟地址</strong>。虚拟地址是物理地址的映射，只要处理好这个过程，就可以起到隔离的作用。</p>\n<h3>1.5.1关于隔离</h3>\n<p>普通的程序它只需要一个简单的执行环境，一个单一的地址空间，有自己的CPU。<br>\n地址空间比较抽象，如果把它想象成一个数组，每一个数组是一字节，数组大小就是地址空间的长度，那么32位的地址空间大小就是2^32=4294967296字节，即4G，地址空间有效位是0x00000000~0xFFFFFFFF。<br>\n地址空间分为两种：<br>\n<strong>物理空间</strong>：就是物理内存。32位的机器，地址线就有32条，物理空间4G，但如果值装有512M的内存，那么实际有效的空间地址就是0x00000000~0x1FFFFFFF，其他部分都是无效的。<br>\n虚拟空间：每个进程都有自己独立的虚拟空间，而且每个进程只能访问自己的空间地址，这样就有效的做到了进程隔离。</p>\n<h3>1.5.2分段<a name=\"152%E5%88%86%E6%AE%B5\"></a></h3>\n<p>基本思路：把一段与程序所需要的内存空间大小的虚拟空间映射到某个地址空间。虚拟空间的每个字节对应物理空间的每个字节。这个映射过程由软件来完成。<br>\n分段的方式可以解决之前的第一个（地址空间不隔离）和第三个问题（程序运行地址不确定）<br>\n第二问题内存使用效率问题依旧没有解决。</p>\n<h3>1.5.3分页</h3>\n<p>基本方法：把地址空间人为的分成固定大小的页，每一页大小有硬件决定或硬件支持多种大小的页，由操作系统决定页的大小。<br>\n目前几乎所有的PC上的操作系统都是4KB大小的页。<br>\n我们把进程的虚拟地址空间按页分割，把常用的数据和代码页转载到内存中，把不常用的代码和数据保存到磁盘里，当需要的时候从磁盘取出来。<br>\n虚拟空间的页叫做<strong>虚拟页（VP）</strong>,物理内存中页叫做<strong>物理页</strong>，把磁盘中的页叫做<strong>磁盘页</strong>。虚拟空间的有的页被映射到同一个物理页，这样就可以实现内存共享。<br>\n当进程需要一个页时，这个页是磁盘页时，硬件会捕获到这个消息，就是所谓的<strong>页错误</strong>，然后操作系统接管进程，负责从磁盘中读取内容装入内存中，然后再将内存和这个页建立映射关系。<br>\n<strong>保护</strong>也是页映射的目的之一，每个页都可以设置权限属性，只有操作系统可以修改这些属性，这样操作系统就可以保护自己保护进程。<br>\n<strong>虚拟存储</strong>的实现需要依靠硬件支持，所有硬件都采用一个叫做MMU的部件来进行页映射。<br>\nCPU发出虚拟地址经过MMU转换成物理地址，MMU一般都集成在CPU内部。</p>\n<h2>1.6众人拾柴火焰高</h2>\n<h3>1.6.1线程基础<a name=\"161%E7%BA%BF%E7%A8%8B%E5%9F%BA%E7%A1%80\"></a></h3>\n<p>多线程现在作为实现软件并发执行的一个重要方法，具有越来越重的地位。</p>\n<h5><a name=\"%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%BF%E7%A8%8B\"></a>什么是线程</h5>\n<p><strong>线程</strong>有时被称为轻量级的进程，是程序执行流的最小单位。</p>\n<p>构成：</p>\n<ul>\n<li>线程ID</li>\n<li>当前指令指针</li>\n<li>寄存器集合</li>\n<li>堆栈空间（代码段，数据段，堆）</li>\n<li>进程级的资源（打开文件和信号）</li>\n</ul>\n<p>线程与进程的关系：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/fd582ce02602d145acd4982f8b868c92.png\" alt=\"\"></p>\n<p>多线程可以互不干扰的并发执行，并共享进程的全局变量和堆的数据。<br>\n使用多线程的原因有如下几点：</p>\n<ul>\n<li>某个操作可能会陷入长时间等待，等待的线程会进入睡眠状态，无法继续执行。</li>\n<li>某个操作会消耗大量的时间，如果只有一个线程，程序和用户之间的交互会中断。</li>\n<li>程序逻辑本身就要求并发操作。</li>\n<li>多CPU或多核计算机，本身具备同时执行多个线程的能力。</li>\n<li>相对于多进程应用，多线程在数据共享方面效率要高很多。</li>\n</ul>\n<h5><a name=\"%E7%BA%BF%E7%A8%8B%E7%9A%84%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90\"></a>线程的访问权限</h5>\n<p>线程的访问非常自由，它可以访问进程内存里所有数据，包括其他线程的堆栈（如果知道地址的话，情况很少见）。<br>\n线程自己的私用存储空间：</p>\n<ul>\n<li>栈（并发完全无法被其他线程访问）</li>\n<li>线程局部存储。某些操作系统为线程提供私用空间，但容量有限。</li>\n<li>寄存器。执行流的基本数据，为线程私用。</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>线程私用</th>\n<th>线程间共享（进程所有）</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>局部变量</td>\n<td>全局变量</td>\n</tr>\n<tr>\n<td>函数参数</td>\n<td>堆上数据</td>\n</tr>\n<tr>\n<td>TLS数据</td>\n<td>函数里的静态变量</td>\n</tr>\n<tr>\n<td></td>\n<td>程序代码</td>\n</tr>\n<tr>\n<td></td>\n<td>打开的文件，A线程打开的文件可以由B线程读取</td>\n</tr>\n</tbody>\n</table>\n<h5><a name=\"%E7%BA%BF%E7%A8%8B%E8%B0%83%E5%BA%A6%E4%B8%8E%E4%BC%98%E5%85%88%E7%BA%A7\"></a>线程调度与优先级</h5>\n<p>不论在多处理器还是单处理器上，线程都是“并发”的。<br>\n线程数量小于处理器数量时，是真正并发的。<br>\n单处理器下，并发是模拟的，操作系统会让这些多线程程序轮流执行，每次都只执行一小段时间，这就称为<strong>线程调度</strong>。<br>\n线程调度中，线程拥有三种状态：</p>\n<ul>\n<li>运行：线程正在执行</li>\n<li>就绪：线程可以立刻运行，但CPU被占用</li>\n<li>等待：线程正在等待某一事件发生，无法立即执行。</li>\n</ul>\n<p>处于运行中的线程拥有一段可以执行的时间，这称为<strong>时间片</strong>，当时间片用尽的时候，进程进入就绪状态，如果在用尽之前开始等待某事件，那么它就进入等待状态。每当一个线程离开运行状态的时候，调度系统就会选择一个其他的就绪线程继续执行。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/98d32af045fd36e5fc3477f9fe4a2758.png\" alt=\"\"></p>\n<p>现在的主流调度方法尽管都不一样，但基本都带有<strong>优先级调度</strong>和<strong>轮转法</strong>。<br>\n轮转法：各个线程轮流执行一段时间。<br>\n优先级调度：按线程的优先级来轮流执行，每个线程都拥有各自的线程优先级。<br>\n在win和lin里面，线程优先级不仅可以由用户手动设置，系统还会根据不同线程表现自动调整优先级。<br>\n一般频繁等待的线程称之为<strong>IO密集型线程</strong>，而把很少等待的线程称为<strong>CPU密集型线程</strong>。<br>\n优先级调度下，存在一种<strong>饿死</strong>现象。<br>\n饿死：线程优先级较低，在它执行之前，总是有较高级的线程要执行，所以，低优先级线程总是无法执行的。<br>\n当一个CPU密集型线程获得较高优先级时，许多低优先级线程就可能被饿死。<br>\n为了避免饿死，操作系统常常会逐步提升那些等待时间过长的线程。<br>\n线程优先级改变一般有三种方式：</p>\n<ul>\n<li>用户指定优先级</li>\n<li>根据进入等待状态的频繁程度提升或降低优先级</li>\n<li>长时间得不到执行而被提升优先级</li>\n</ul>\n<h5><a name=\"%E5%8F%AF%E6%8A%A2%E5%8D%A0%E7%BA%BF%E7%A8%8B%E5%92%8C%E4%B8%8D%E5%8F%AF%E6%8A%A2%E5%8D%A0%E7%BA%BF%E7%A8%8B\"></a>可抢占线程和不可抢占线程</h5>\n<p><strong>抢占</strong>：在线程用尽时间片之后被强制剥夺继续执行的权利，而进入就绪状态。<br>\n在早期的系统中，线程是<strong>不可抢占</strong>的，线程必须主动进入就绪状态。<br>\n在不可抢占线程中，线程主动放弃主要是2种：</p>\n<ul>\n<li>当线程试图等待某个事件（I/O）时</li>\n<li>线程主动放弃时间片</li>\n</ul>\n<p>不可抢占线程有一个好处，就是线程调度只会发生在线程主动放弃执行或线程等待某个事件的时候，这样就可以避免一些抢占式线程时间不确定而产生的问题。</p>\n<h5><a name=\"linux%E7%9A%84%E5%A4%9A%E7%BA%BF%E7%A8%8B\"></a>Linux的多线程</h5>\n<p>Linux内核中并不存在真正意义上的线程概念。Linux所有执行实体（线程和进程）都称为<strong>任务</strong>，每一个任务概念上都类似一个单线程的进程，具有内存空间，执行实体，文件资源等。Linux不同任务之间可以选择共享内存空间，相当于同一个内存空间的多个任务构成一个进程，这些任务就是进程中的线程。</p>\n<table>\n<thead>\n<tr>\n<th>系统调用</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>fork</td>\n<td>复制当前线程</td>\n</tr>\n<tr>\n<td>exec</td>\n<td>使用新的可执行映像覆盖当前可执行映像</td>\n</tr>\n<tr>\n<td>clone</td>\n<td>创建子进程并从指定位置开始执行</td>\n</tr>\n</tbody>\n</table>\n<p>fork产生新任务速度非常快，因为fork不复制原任务的内存空间，而是和原任务一起共享一个<strong>写时复制</strong>的内存空间。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/4c89163b6db707d13e93ae4f5ad6fdca.png\" alt=\"\"></p>\n<p>写时复制：两个任务可以同时自由读取内存，当任意一个任务试图对内存进行修改时，内存就会复制一份单独提供给修改方使用。<br>\nfork只能够产生本任务的镜像，因此需要和exec配合才能启动别的新任务。<br>\n而如果要产生新线程，则使用clone。<br>\nclone可以产生一个新的任务，从指定位置开始执行，并且共享当前进程的内存空间和文件等，实际效果就是产生一个线程。</p>\n<h3>1.6.2线程安全</h3>\n<p>多线程程序处于一个多变的环境中，可访问的全局变量和堆数据随时都可能被其他的线程改变。因此多线程程序在并发时数据的一致性变得非常重要。</p>\n<h5><a name=\"%E7%AB%9E%E4%BA%89%E4%B8%8E%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C\"></a>竞争与原子操作</h5>\n<p>++i的实现方法：</p>\n<ul>\n<li>读取i到某个寄存器X</li>\n<li>X++</li>\n<li>将X的内容存储回i<br>\n单条指令的操作称为<strong>原子的</strong>，单挑指令的执行不会被打断。在windows里，有一套API专门进行一些原子操作，这些API称为Interlocked API。</li>\n</ul>\n<h5><a name=\"%E5%90%8C%E6%AD%A5%E4%B8%8E%E9%94%81\"></a>同步与锁</h5>\n<p>为了防止多个线程读取同一个数据产生不可预料结果，我们将各个线程对一个数据的访问同步。<br>\n<strong>同步</strong>：在一个线程对一个数据访问结束的时候，其他线程不能对同一个数据进行访问。对数据的访问被原子化。<br>\n<strong>锁</strong>：锁是一种非强制机制，每一个线程在访问数据或者资源之前会先获取锁，在访问结束后会释放锁。在锁被占用时候试图获取锁时，线程会等待，知道锁可以重新使用。<br>\n<strong>二元信号量</strong>：最简单的锁，它适合只能被唯一一个线程独占访问的资源，它的两种状态：</p>\n<ul>\n<li>非占用状态：第一个获取该二元信号量的线程会获得该锁，并将二元信号量置为占用状态，其他所有访问该二元信号量线程将会等待。</li>\n<li>占用状态</li>\n</ul>\n<p><strong>信号量</strong>：允许多个线程并发访问的资源。一个初始值为N的信号量允许N个线程并发访问。<br>\n操作如下：</p>\n<ul>\n<li>将信号量值键1</li>\n<li>如果信号量值小于0，就进入等待状态。</li>\n</ul>\n<p>访问完资源后，线程释放信号量：</p>\n<ul>\n<li>将信号量加1</li>\n<li>如果信号量的值小于1，唤醒一个等待中的线程。</li>\n</ul>\n<p><strong>互斥量</strong>：和二元信号量很类似，但和信号量不同的是：信号量在一个系统中，可以被任意线程获取或释放。互斥量要求那个线程获取互斥量，那么哪个线程就释放互斥量，其他线程释放无效。<br>\n<strong>临界区</strong>：比互斥量更加严格的手段。把临界区的锁获取称为进入临界区，而把锁的释放称为离开临界区。临界区和互斥量，信号量区别在与互斥量，信号量在系统中任意进程都是可见的。临界区的作用范围仅限于本线程，其他线程无法获取。其他性质与互斥量相同。<br>\n<strong>读写锁</strong>：致力于一种更加特定的场合的同步。如果使用之前使用的信号量、互斥量或临界区中的任何一种进行同步，对于读取频繁，而仅仅是偶尔写入的情况会显得非常低效。读写锁可以避免这个问题。对于同一个锁，读写锁有两种获取方式：</p>\n<ul>\n<li>共享的</li>\n<li>独占的</li>\n</ul>\n<p>读写锁的总结</p>\n<table>\n<thead>\n<tr>\n<th>读写锁状态</th>\n<th>以共享方式获取</th>\n<th>以独占方式获取</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>自由</td>\n<td>成功</td>\n<td>成功</td>\n</tr>\n<tr>\n<td>共享</td>\n<td>成功</td>\n<td>等待</td>\n</tr>\n<tr>\n<td>独占</td>\n<td>等待</td>\n<td>等待</td>\n</tr>\n</tbody>\n</table>\n<p><strong>条件变量</strong>：作为同步的手段，作用类似于一个栅栏。对于条件变量，线程有两个操作：</p>\n<ul>\n<li>线程可以等待条件变量，一个条件变量可以被多个线程等待</li>\n<li>线程可以唤醒条件变量，此时某个或所有等待此条件变量的线程都会被唤醒并继续支持</li>\n</ul>\n<p>使用条件变量可以让许多线程一起等待某个事件的发生，当事件发生时，所有线程可以一起恢复执行。</p>\n<h5><a name=\"%E5%8F%AF%E9%87%8D%E5%85%A5%E4%B8%8E%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8\"></a>可重入与线程安全</h5>\n<p>一个函数被重入，表示这个函数没有执行完成，由于外部因素或内部调用，又一次进入该函数执行。<br>\n一个函数要被重入，只有两种情况：</p>\n<ul>\n<li>多个线程同时执行这个函数</li>\n<li>函数自身（可能经过多层调用之后）调用自身</li>\n</ul>\n<p>一个函数被称为可重入，表示重入之后不会产生任何不良影响</p>\n<p>可重入函数：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9bf6090fc7237697299\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint sqr(int x) \r\n{\r\n    return x * x;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fc7237697299-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fc7237697299-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fc7237697299-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fc7237697299-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9bf6090fc7237697299-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sqr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fc7237697299-2\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fc7237697299-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">x *</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fc7237697299-4\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n\n</div>\n<p>一个函数要成为可重入，必须具有如下特点：</p>\n<ul>\n<li>不使用任何（局部）静态或全局的非const变量</li>\n<li>不返回任何（局部）静态或全部的非const变量的指针</li>\n<li>仅依赖调用方提供的参数</li>\n<li>不依赖任何单个资源的锁</li>\n<li>不调用任何不可重入的函数</li>\n</ul>\n<p>可重入是并发安全的强力保障，一个可重入的函数可以在多程序环境下方向使用</p>\n<h5><a name=\"%E8%BF%87%E5%BA%A6%E4%BC%98%E5%8C%96\"></a>过度优化</h5>\n<p>有时候合理的合理的使用了锁也不一定能保证线程的安全。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9bf6090fd3032280651\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n//Thread1\r\nx=0;\r\nlock();\r\nx++;\r\nunlock();\r\n//Thread2\r\nx=0;\r\nlock();\r\nx++;\r\nunlock();</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fd3032280651-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fd3032280651-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fd3032280651-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fd3032280651-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fd3032280651-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fd3032280651-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fd3032280651-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fd3032280651-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fd3032280651-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fd3032280651-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9bf6090fd3032280651-1\"><span class=\"crayon-c\">//Thread1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fd3032280651-2\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fd3032280651-3\"><span class=\"crayon-e\">lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fd3032280651-4\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fd3032280651-5\"><span class=\"crayon-e\">unlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fd3032280651-6\"><span class=\"crayon-c\">//Thread2</span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fd3032280651-7\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fd3032280651-8\"><span class=\"crayon-e\">lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fd3032280651-9\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fd3032280651-10\"><span class=\"crayon-e\">unlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p>上面X的值应该为2，但如果编译器为了提高X的访问速度，把X放到了某个寄存器里面，不同线程的寄存器是各自独立的，因此，如果Thread1先获得锁，则程序的执行可能会呈现如下：<br>\n[Thread1]读取x的值到某个寄存器R [1] (R[1]=0);<br>\n[Thread1]R[1]++(由于之后可能要访问到x,所以Thread1暂时不将R[1]写回x);<br>\n[Thread2]读取x的值到某个寄存器R[2] (R[2]=0);<br>\n[Thread2]R[2]++(R[2]=1);<br>\n[Thread2]将R[2]写回至x(x=1);<br>\n[Thread1] (很久以后)将R[1]写回至x(x=1);<br>\n如果这样，即使加锁也不能保证线程安全</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9bf6090fd9992819210\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nx=y=0;\r\n//Thread1\r\nx=1;\r\nr1=y;\r\n//Thread2\r\ny=1;\r\nr2=x;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fd9992819210-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fd9992819210-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fd9992819210-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fd9992819210-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fd9992819210-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fd9992819210-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fd9992819210-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9bf6090fd9992819210-1\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">y</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fd9992819210-2\"><span class=\"crayon-c\">//Thread1</span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fd9992819210-3\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fd9992819210-4\"><span class=\"crayon-v\">r1</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fd9992819210-5\"><span class=\"crayon-c\">//Thread2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fd9992819210-6\"><span class=\"crayon-v\">y</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fd9992819210-7\"><span class=\"crayon-v\">r2</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p>上面代码有可能发生r1=r2=0的情况。<br>\n<strong>CPU动态调度</strong>：在执行程序的时候，为了提高效率有可能交换指令的顺序。<br>\n编译器在进行优化的时候，也可能为了效率交换两个毫不相干的相邻指令的执行顺序。<br>\n上面代码执行顺序可能是这样：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9bf6090fdc852154285\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nx=y=0;\r\n[Thread1]\r\nr1=y;\r\nx=1;\r\n[Thread2]\r\ny=1;\r\nr2=x;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fdc852154285-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fdc852154285-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fdc852154285-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fdc852154285-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fdc852154285-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fdc852154285-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fdc852154285-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9bf6090fdc852154285-1\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">y</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fdc852154285-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">Thread1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fdc852154285-3\"><span class=\"crayon-v\">r1</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fdc852154285-4\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fdc852154285-5\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">Thread2</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fdc852154285-6\"><span class=\"crayon-v\">y</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fdc852154285-7\"><span class=\"crayon-v\">r2</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n\n</div>\n<p>使用volatile关键字可以阻止过度优化，colatile可以做两件事情：</p>\n<ul>\n<li>阻止编译器为了提高速度将一个变量缓存到寄存器内而不写回</li>\n<li>阻止编译器调整操作volatile变量的指令顺序</li>\n</ul>\n<p>但volatile无法阻止CPU动态调度换序<br>\nC++中，单例模式。</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9bf6090fe0065236298\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C++</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvolatile T * pInst = 0;\r\nT * GetInstance() \r\n{\r\n    if (pInst == NULL) \r\n    {\r\n        LOCK();\r\n        if (pInst == NULL)\r\n            pInst = new T;\r\n        unlock();\r\n    }\r\n    return pInst;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fe0065236298-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fe0065236298-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fe0065236298-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fe0065236298-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fe0065236298-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fe0065236298-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fe0065236298-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fe0065236298-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fe0065236298-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fe0065236298-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fe0065236298-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fe0065236298-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9bf6090fe0065236298-1\"><span class=\"crayon-m\">volatile</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fe0065236298-2\"><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GetInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fe0065236298-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fe0065236298-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fe0065236298-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fe0065236298-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">LOCK</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fe0065236298-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fe0065236298-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fe0065236298-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">unlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fe0065236298-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fe0065236298-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pInst</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fe0065236298-12\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n\n</div>\n<p>CPU的乱序执行可能会对上面代码照成影响<br>\nC++里的new包含两个步骤：</p>\n<ul>\n<li>分配内存</li>\n<li>调用构造函数</li>\n</ul>\n<p>所以pInst=new T包含三个步骤：</p>\n<ul>\n<li>分配内存</li>\n<li>在内存的位置上调用构造函数</li>\n<li>将内存的地址赋值给pInst</li>\n</ul>\n<p>这三步中2和3的步骤可以颠倒，可能出现这种情况：pInst中的值不是NULL，但对象还是没有构造完成。<br>\n要阻止CPU换序，可以调用一条指令，这条指令常常被称为barrier：它会阻止CPU将该指令之前的指令交换到barrier之后。<br>\n许多体系的CPU都提供了barrier指令，不过，它们的名称各不相同。例如POWERPC提供的指令就叫做lwsync。所以我们可以这样保证线程安全：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9bf6090fe4732972757\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C++</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#define barrier() __asm__ volatile(\"lwsync\")\r\nvolatile T * pInst = 0;\r\nT * GetInstance()\r\n{\r\n    if (pInst == NULL) \r\n    {\r\n        LOCK();\r\n        if (pInst == NULL) \r\n        {\r\n            T * temp = new T;\r\n            barrier();\r\n            pInst = temp;\r\n        }\r\n        unlock();\r\n    }\r\n    return pInst;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fe4732972757-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fe4732972757-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fe4732972757-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fe4732972757-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fe4732972757-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fe4732972757-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fe4732972757-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fe4732972757-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fe4732972757-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fe4732972757-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fe4732972757-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fe4732972757-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fe4732972757-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fe4732972757-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fe4732972757-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bf6090fe4732972757-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9bf6090fe4732972757-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9bf6090fe4732972757-1\"><span class=\"crayon-p\">#define barrier() __asm__ volatile(\"lwsync\")</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fe4732972757-2\"><span class=\"crayon-m\">volatile</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fe4732972757-3\"><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GetInstance</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fe4732972757-4\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fe4732972757-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fe4732972757-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fe4732972757-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">LOCK</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fe4732972757-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fe4732972757-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fe4732972757-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">T</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">T</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fe4732972757-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">barrier</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fe4732972757-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">pInst</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">temp</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fe4732972757-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fe4732972757-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">unlock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fe4732972757-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bf6090fe4732972757-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pInst</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9bf6090fe4732972757-17\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n\n</div>\n<h3>1.6.3多线程的内部情况</h3>\n<p>线程的并发执行是由多处理器或操作系统调度来实现的。windows和linux都在内核中提供线程支持，有多处理器或调度来实现并发。用户实际使用线程并不是内核线程，而是存在于用户态的用户线程。用户线程并不一定在操作系统内核里对应同等数量的内核线程。对用户来说，如果有三个线程同时执行，可能在内核中只有一个线程。</p>\n<h5><a name=\"%E4%B8%80%E5%AF%B9%E4%B8%80%E6%A8%A1%E5%9E%8B\"></a>一对一模型</h5>\n<p>对于直接支持线程的系统，一对一模型始终是最为简单的模型。一个用户使用的线程就唯一对应一个内核使用的线程，但返回来，一个内核里面的线程在用户态不一定有对应的线程存在。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/a5b98d84c57ecfa88795e674e4a711ec.png\" alt=\"\"></p>\n<p>对于一对一模型，线程之间的并发是真正的并发，一个线程因为某个原因阻塞，并不会影响到其他线程。一对一模型也可以让多线程程序在多处理器的系统上有更好的表现。<br>\n一般直接使用API或者系统调用创建的线程均为一对一线程。<br>\n一对一线程的两个缺点：</p>\n<ul>\n<li>由于许多操作系统限制了内核线程数量，因此一对一线程会让用户的线程数量受到限制。</li>\n<li>许多操作系统内核线程调度是，上下文切换的开销较大，导致用户线程的执行效率下降。</li>\n</ul>\n<h5><a name=\"%E5%A4%9A%E5%AF%B9%E4%B8%80%E6%A8%A1%E5%9E%8B\"></a>多对一模型</h5>\n<p>多对一模型将多个用户线程映射到一个内核线程上，线程之间的切换由用户态的代码来进行，相对于一对一模型，多对一模型的线程切换要快速许多。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/4a464ae600296b61c454403e9cab160b.png\" alt=\"\"></p>\n<p>多对一模型的问题就是如果一个用户线程阻塞了，那么所有的线程都将无法执行。在多处理系统上，处理器的增多对多对一模型的线程性能不会有明显帮助。多对一模型得到的好处是高效的上下文切换和几乎无限制的线程数量。</p>\n<h5><a name=\"%E5%A4%9A%E5%AF%B9%E5%A4%9A%E6%A8%A1%E5%9E%8B\"></a>多对多模型</h5>\n<p>多对多模型结合了多对一和一对一的特点，将多个用户线程映射到少数但不止一个内核线程上。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/08/88cf46ce05bf777caef1b92def4dca9d.png\" alt=\"\"></p>\n<p>一个用户线程阻塞并不会使得所有的用户线程阻塞。并且对用户线程数量也没有什么限制，在多处理器系统上，多对多模型的线程也能得到一定的性能提升，不过提升的幅度没有一对一模型高。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112161\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112161votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112161\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 15 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "什么是现代化编程？", "url": "http://blog.jobbole.com/112071/", "front_image_url": ["http://wx3.sinaimg.cn/large/7cc829d3gy1fi7r4f1txqj20hs0cmq4r.jpg"], "praise_nums": "2", "comment_nums": 4, "fav_nums": 0, "tags": "开发,IDE,编程", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/young605867996\">Lada</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://lemire.me/blog/2017/07/15/what-is-modern-programming/\">lemire</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【导读】：现代化编程应该是：不强制用相同的 IDE，统一的代码风格，方便的依赖管理，持续集成，版本控制等。</p>\n<hr>\n<p class=\"\">在我的青少年时期，我涉猎了编程基础和一些汇编。当我学习了 Turbo Pascal 之后这事更进了一步，它<a href=\"https://photos.app.goo.gl/WcxNIutwtWmFTdzL2\">提供了一种最早期的集成开发环境（IDE）</a>。我觉得这下合我心意了。实际上，IDE 是一种让你在一个友好的环境内，方便地编写、编译、调试和运行代码的程序。Turbo Pascal 没有太多的图形界面（它基于文本），但它有菜单和窗口。你可以进入调试模式，跟踪变量的值等等。</p>\n<p class=\"\"><img id=\"pic\" class=\"\" src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fi7r4f1txqj20hs0cmq4r.jpg\"></p>\n<p>然后我转到了 <a href=\"https://photos.app.goo.gl/QnCWPHDcp4Drzev12\">Delphi</a> （一种图形化的 Turbo Pascal），它拥有到今天看来仍然不错的出色 IDE。我用  <a href=\"https://www.youtube.com/watch?v=TgIrzFqGIKM\">Visual Basic</a> 设计了一个“会报时的钟”，当时发表在 Bulletin Board Systems（使用 Windows 3.1 的一个系统）。那之后我发现了 Visual Studio。有好几年我的 C++ 编程都是借用的 Visual Studio。以上就是我一直使用的所有 IDE。</p>\n<p>早在八十年代初，Smalltalk 就有了著名的强大图形化 IDE<a href=\"https://www.youtube.com/watch?v=e0LfndNxqZg\">（Youtube 视频）</a>。</p>\n<p>我认为，使用 IDE 并不代表着“现代化”。现在的 IDE 和过去的 IDE 非常相像。虽然我们编程的内容改变了，但在很多情况下，我们如何编程却没有改变。在我的 Dell 笔记本电脑里装着最新版 Visual Studio。换做 20 年前的我，也能完美地轻松上手它。调试、代码补全、远程代码执行，它和以前很像。事实上，Visual Studio 从未与 Turbo Pascal 相差很大过。而我发现这非常令人沮丧。我以为我们应该取得比这更快的进步。</p>\n<p>我提出了现代化编程在桌面外观上难有作为的观点。图形化用户界面（GUI）只是表层。现代化编程技术都是关于流程和实际工具的，而不是它们之上的表层。我不在乎你是否使用 Eclipse 或 Emacs，这和你如何现代化毫不相关。</p>\n<h2>那么，什么是“现代化”？</h2>\n<h3>编码是社会化的</h3>\n<p>在 20 年前，要求你公司里的每个人都使用相同的 IDE，并且要唯一依赖于这种 IDE 来构建、测试和部署代码，这是很明智的。但在你公司外有很多聪明的人，他们往往不使用你这种 IDE。如今，你可以触及他们了。这意味着对于所采用的工具和流程你必须明智。</p>\n<p>如果你嘲弄使用 Atom 文本编辑器、Visual Studio 或者 Emacs 编程的人，那你就不是社会化的。你需要尽可能的包容，否则就会付出代价。</p>\n<h3>Go 语言有自己的格式化工具</h3>\n<p>我不在乎在你保存的时候，是不是自动重新格式化代码，或者有没有点击重新格式化按钮，或者是不是输入 go fmt，这些都一样。但它无疑是一个卓越的现代化的想法。这就是进步。所有的编程语言都应该为用户强加一个唯一的代码格式。别再 bikeshedding（过于关心旁枝末节，而忽视主要问题）。</p>\n<p>我们很清楚 Java 拥有规范，但规范是不够的。我们需要一个工具，能把代码作为输入，并生成一个唯一定义了的输出，它能处理从行长度到空格的所有问题。</p>\n<p>这个工具的目标是对于应该如何格式化代码，不再有任何可能有的争议，而且产生正确的格式不费吹灰之力。我简直无法告诉你这是多么的重要。</p>\n<h3>像 Rust、Go、Swift 这样的编程语言有自己的程序包管理系统</h3>\n<p>因此，例如在 Swift 中，我可以创建一个名为 Package.swift 的小文本文件，并把它放入我项目的根文件，在那里声明我的依赖。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d1253ace5283191304\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Swift</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport PackageDescription\r\n\r\nlet package = Package(\r\n    name: \"SwiftBitsetBenchmark\",\r\n    dependencies: [\r\n   .Package(url: \"https://github.com/lemire/SwiftBitset.git\",  \r\n          majorVersion: 0),\r\n   .Package(url: \"https://github.com/lemire/Swimsuit.git\",  \r\n          majorVersion: 0)\r\n    ]\r\n)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d1253ace5283191304-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1253ace5283191304-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1253ace5283191304-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1253ace5283191304-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1253ace5283191304-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1253ace5283191304-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1253ace5283191304-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1253ace5283191304-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1253ace5283191304-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d1253ace5283191304-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9d1253ace5283191304-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d1253ace5283191304-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PackageDescription</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1253ace5283191304-2\"> </div><div class=\"crayon-line\" id=\"crayon-59b9d1253ace5283191304-3\"><span class=\"crayon-r\">let</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">package</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">Package</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1253ace5283191304-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"SwiftBitsetBenchmark\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1253ace5283191304-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">dependencies</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1253ace5283191304-6\"><span class=\"crayon-h\">   </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">Package</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"https://github.com/lemire/SwiftBitset.git\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59b9d1253ace5283191304-7\"><span class=\"crayon-h\">          </span><span class=\"crayon-v\">majorVersion</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1253ace5283191304-8\"><span class=\"crayon-h\">   </span><span class=\"crayon-sy\">.</span><span class=\"crayon-e \">Package</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"https://github.com/lemire/Swimsuit.git\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line\" id=\"crayon-59b9d1253ace5283191304-9\"><span class=\"crayon-h\">          </span><span class=\"crayon-v\">majorVersion</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d1253ace5283191304-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9d1253ace5283191304-11\"><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p></p>\n<p style=\"text-align: center;\"><span style=\"color: #999999;\">（源码实例）</span></p>\n<p>然后我可以输入 swift build，软件会自动抓取依赖代码，并构建我的程序。这在 Swift 运行的所有地方通用。你使用哪种文本编辑器和 IDE 都没关系。</p>\n<p>你不想使用文本编辑器，而更喜欢图形界面？可以。都没有区别。</p>\n<p>为什么那样显得现代化？因为自动地解决依赖关系而不费吹灰之力，对于 20 年前的我来说就像魔术。并且自动地、系统地解决依赖关系是极其重要的。我不想永远都不得不手动安装和部署一个依赖项。我希望其他人能够在几秒内把我的库添加到他们项目中，而不是几分钟或是几小时。</p>\n<p>是的,你可以将它添加到现有的语言(如：Java 的 Maven 或是 IED)但需要有一个唯一的方法让它起效。</p>\n<h3>像 Rust、Go、Swift 这样的编程语言，在一开始就支持单元测试。</h3>\n<p>比如在 Go 里，创建一个 filemyproject_test.go，然后添加 func TestMyStuff（t * testing.T）这样的函数，然后输入 go test 既可。</p>\n<p>在 20 年前，几乎没有人测试他们的代码，而今天已经是一个必要要求，您和它需要以一种唯一的方式来做，这样你就可以在项目之间移动，还总是知道如何测试了。</p>\n<p>如果不能在你的代码中立刻认出健全的单元测试，我会设想你的代码严重损坏了。</p>\n<h3>持续集成</h3>\n<p>代码更改时，你想要一个远程工具来获取新代码，并测试它，以便可以提前停止回归。人们可以在你的代码上运行测试还不够，他们还需要看到自动化测试的结果，自行检查最终的故障。</p>\n<p>持续集成是较大规模计划的一部分：你必须在你编程的时候疯狂地自动化程序。体力劳动应该最小化。有时候这意味着你真的应该只是点击一个按钮，无论是通过一个图形化用户界面，还是命令窗口，但它不意味着需要反复地遵循一系列复杂的命令。</p>\n<h3>版本控制</h3>\n<p>20 年前，你在桌面上编写代码，并通过电子邮件发送新代码（作为补丁）是讲得通的。但这只在缓慢的合作节奏中有意义。如今，这么做是愚蠢的。任何差于 Git 的都是落后的。注意，如今甚至微软构建 Windows 也使用 Git。</p>\n<p> </p>\n<p>那么，当你共事于从来没有听过现代编程的聪明学生会发生什么呢？他们看一个类似 go get 的命令，只看得到表层（一个命令行）。他们认为这是落后的。漂亮的图形在哪？</p>\n<p>他们使用一个好看的 IDE 工作，像是 Visual Studio 或 Eclipse，并确信自己是现代化的，完全无视 IDE 可以追溯到几十年前的事实。然后并没有使用 IDE 的优势，比如更好的功能可见性和更快的操作，而是在其他地方使用现代化编程技术。他们坚持守旧派编程：</p>\n<ul>\n<li>没有测试。至少，没有自动化和系统化的测试。</li>\n<li>在一个具体的设置上难以处理依赖关系。</li>\n<li>没有自动化。没有持续集成，没有自动化部署。</li>\n</ul>\n<p>他们编程就像我几十年前使用 Turbo Pascal 入门的时候。尽管 Turbo Pascal 有图形化用户界面（GUI），但它是非常古老的学校。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112071\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112071votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112071\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 4 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/young605867996\">Lada</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/young605867996\">\r\n\t\t\t<img src=\"http://q.qlogo.cn/qqapp/208656/B77EEB9D520DE9C7BD42E89DC348FEC7/100\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            希望了解更多互联网、创业管理、创新思维、前沿技术和设计的知识。渐进明细，持续改进。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/young605867996\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/young605867996/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/young605867996/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 15</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://littlejanery.blog.163.com/\"><i class=\"fa fa-link\"></i></a> <a title=\"QQ：605867996\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：yao605867996\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "一文带你理解深度学习的局限性", "url": "http://blog.jobbole.com/112109/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/08/c4ec441b51f9ac4f55dc702a6ae0e757.jpg"], "praise_nums": "2", "comment_nums": 1, "fav_nums": 2, "tags": "IT技术,深度学习", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://blog.keras.io/the-limitations-of-deep-learning.html\">Francois Chollet</a>   译文出处：<a target=\"_blank\" href=\"http://www.iteye.com/news/32557\">CSDN - 聂震坤</a>   </div><h3><strong>深度学习：几何视图</strong></h3>\n<p>深度学习最令人惊讶的特点便是极易上手。十年以前，没有人可以猜得到经过梯度下降法训练过的简单参数模型可以在机器感知问题上实现如此惊人的结果。现在，事实证明，研究者所需要做的只是使用足够大的梯度下降素材来训练参数模型。正如 Feynman 曾经描述宇宙一样，“它并不复杂，只是里面包含的东西实在太多。”</p>\n<p>在深度学习中，所有的东西都是一个向量（任何的东西都是几何空间中的一个点）。模型的输入（可能是文字，图片，等等）和目标首先被向量化（变成了一些初始输入向量空间和目标向量空间）。深度学习模型中的每个层都对通过它的数据进行一个简单的几何变换。同时，模型的层链形成一个非常复杂的几何变换，分解成一系列简单的几何变换。这种复杂的转换尝试将输入空间映射到目标空间，一次一个点。该变换按层级的比重进行参数化，这些层根据模型当前执行的程度进行迭代更新。这种几何变换的一个关键特征是它必须是可微分的，这是为了使我们能够通过梯度下降来学习来获得其参数。更直接一点，这意味着从输入到输出的几何变形必须是平滑和连续的——这是一个显着的约束。</p>\n<p>这种复杂的几何变换应用到输入数据的整个过程可以理解为一个试图破坏纸球的人在3D中被可视化。褶皱的纸球可以理解为模型开始时的大量输入数据。每一次人的行为则是数据通过不同层级被处理的过程。完整的不起眼的人的手势序列是整个模型的复杂变换。深度学习模型是用于解决高维数据的复杂流形的数学机器。</p>\n<p>这便是深度学习的奥妙：将含义转化为向量，几何空间，然后逐步学习将一个空间映射到另一个空间的复杂几何变换。所以开发者需要有足够高的维度的空间以便拥有原始数据关系的全部范围。</p>\n<p><strong>深度学习的局限性</strong></p>\n<p>可以通过这种简单策略实现的应用程序空间几乎是无限的。然而到目前为止，更多的应用程序对于当前的深入学习技术是完全无法实现的——即使是大量人为注释的数据。例如，你可以组装一个数据，数十万甚至数百万的英文语言描述软件产品的功能。由产品经理编写，由一个团队开发的相应的源代码并且有工程师满足这些要求。即使有这些数据，也不能训练出一个深入的学习模型来简单地阅读产品描述并生成相应的代码库。这只是其中一个例子。</p>\n<p>一般来说，无论投入多少数据，任何需要推理式编程或应用科学方法（长期规划和类似算法的数据操作）都无法使用深度学习模式进行实现。 即使是学习具有深层神经网络的排序算法也是非常困难的。</p>\n<p>这是因为一个深入的学习模型是“简单的”连续的几何变换链，将一个向量空间映射到另一个。他所可以做的是将一个数据包X映射到另一个数据包Y，并假设存在从X到Y的可学习的连续变换与X:Y的秘籍采用可用性作的数据。所以即使一个深入的学习模型可以被解释为一种程序，相反的大多数程序不能表示为深度学习模型 – 对于大多数任务，要么没有相应的实际大小的深层神经网络来解决任务，要么即使存在一个，它也可能不可学习，即相应的几何变换可能太复杂，或者可能没有可用的数据来学习它。通过堆叠更多层次和使用更多的培训数据来扩展当前的深度学习技术，只能表面缓解其中的一些问题。 深度学习模式在可以代表的方面是非常有限的，而且大多数希望学习的程序不能被表达为连续几何变形的数据流。</p>\n<p><strong>拟人化机器学习模型的隐患</strong></p>\n<p>现阶段人工智能的一个不得不面对的问题在于研究者们误解了深度学习模式的做法，并高估了自己的实力。人类思想的一个根本特征是我们的“主观意识”，我们倾向于对我们周围的事物投射意向，信仰和知识。在一个石头上画一个笑脸感觉石头都变高兴了。同样在深度学习中，当我们有能力成功地训练一个模型来创作描述图片的标题时，我们误认为该模型“理解”图片的内容以及它产生的标题。然而，当轻微改变训练数据中存在的图像时，研发者会非常惊讶的发现模型开始创作完全荒谬的字幕。</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/80b358a0334bd3f848b9040a6ecc43b0.png\"></div>\n<h3>通常，这类行为被强调为对抗例子，是通过向深度学习网络输出错误的样本来欺骗模型进行分类。通过梯度上升，可以稍微修改图像，以便最大化给定类的预测。 通过拍摄一只熊猫，并添加一个“长臂猿”梯度，我们可以得到一个神经网络将这只熊猫分类为长臂猿。 这证明了这些模型的脆弱性，以及它们运行的输入到输出映射与我们自己的人类感知之间的深刻差异。</h3>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/28bc6f2c7b510a1638a064d2f67bb284.png\"></div>\n<h3>简而言之，深度学习模式对他们的输入没有任何理解，至少不是从人的意义上来说。我们对图像，声音和语言的理解是基于我们的运动感觉体验。然而机器人却没有这种经验，因此不能以任何以人为本的方式理解他们的驶入。通过输入大量的培训示例来训练我们的模型，我们让他们学习一个几何变换，将数据映射到这个特定的一组示例上的人类概念，但是这个映射只是我们思想中原始模型的简单草图， 从我们的体验中发展出来的假想——就像一面镜子中的一个昏暗的形象。</h3>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/1ed2a28a045dfe53e0409369570c5fb6.png\"></div>\n<h3>作为一名机器学习从业者，始终要注意这一点，不要陷入陷阱，认为神经网络了解他们所执行的任务（并不会） – 至少不会对我们有意义。 他们接受了不同于我们教导，进行了不同的，更窄的任务的训练：即将训练投入与训练目标进行比较。 如果向他们展示偏离训练数据的任何东西，机器将以最荒谬的方式打破以前的结论。</h3>\n<p><strong>局部泛化与极端泛化</strong></p>\n<p>在深度学习模型所做的输入与输出之间的简单的几何变形以及人类思考和学习的方式之间似乎存在着根本的区别。人类不仅仅是从亲身体验中进行学习，还提供了明确的学习方法。除了不同的学习过程外，底层的特性有着根本的却别。</p>\n<p>人类的能力远不止对刺激做出回应，因为深网或者昆虫也可以。人会对目前的情况形成抽象复杂的模型，并根据这些模型来预测不同的未来，且进行长期的规划。人类有能力将已知的概念融合在一起，来表现以前从未经历过的事情，比如穿着牛仔裤的马，或者想象如果中了彩票会做什么。这种处理假设的能力，使我们的心理模型空间远远超过了我们可以直接体验到的一切。这种行为被称为极端泛化。</p>\n<p>这与深层网络的局部泛化形成了鲜明的对比：如果训练时间内新的输入信息差异甚微，则停止从输入到输出的映射。假设使用机器来学习适当的发射参数以解决火箭登陆月球的问题，在使用深网进行此项任务时，无论是使用监督学习还是强化学习进行培训，都需要数以千万次的启动试验作为补充，以便学习从入空间到输出空间的可靠映射。相比之下，人类可以利用抽象能力来提出物理模型——火箭科学，并得到一个精确地解决方案，只需要一次或几次时间即可以让火箭成功登月。同理，如果开发一款控制人体的深网，并希望他学会安全的在城市里行驶。那么在在这种情况下则需要现在各种情况下死掉数千次直到可以推断出危险的行车路线并制定合适的回避行为。当进入一个新的城市，深网有需要重新学习大部分知识。相反，人类能够直接学习安全行为而不用经历死亡，这都要归功于人脑的抽象建模。</p>\n<div><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/cff17cac3a2dbd53c2f8a966899831d1.png\"></div>\n<h3>简而言之，尽管我们在机器感知方面取得了不小的进步，但是我们仍然离人类级别的人工智能有很大区别。我们的模型只能执行局部泛化，在过去中学习来适应最新的情况。而人类可以极端泛化，迅速适应大胆新奇的情况，或为长期未来的情况进行规划。</h3>\n<p><strong>总结</strong></p>\n<p>作为一个开发者应当记住：迄今为止，深入学习的唯一真正的成功是使用大量的人为注释的数据让机器使用连续的几何变换将空间X映射到空间Y。 做好这一切，则可以改变行业的游戏规则。但想让AI拥有人类的智慧，仍然有很长的路要走。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112109\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112109votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112109\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "用 C 语言写一个简单的 Unix Shell（2）", "url": "http://blog.jobbole.com/112126/", "front_image_url": ["https://indradhanush.github.io/images/shell-part-2/execvp.jpg"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 5, "tags": "C/C++,其他,shell,Unix", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/qdoverture\">效楚</a> 翻译，<a href=\"http://www.jobbole.com/members/upanblack\">Panblack</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://indradhanush.github.io/blog/writing-a-unix-shell-part-2/\">indradhanush.github.io</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p><a href=\"http://blog.jobbole.com/111738/\" target=\"_blank\">在第一部分中我们讨论了 <code>fork</code> 系统调用以及它的注意事项</a>。在本文中，我们将研究怎样执行命令。</p>\n<h3>这里将介绍 <code>exec</code> 函数家族。即以下函数：</h3>\n<ul>\n<li><code>execl</code></li>\n<li><code>execv</code></li>\n<li><code>execle</code></li>\n<li><code>execve</code></li>\n<li><code>execlp</code></li>\n<li><code>execvp</code></li>\n</ul>\n<p>为了满足需要，我们将使用 <code>execvp</code>，它的签名看起来像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9ce3a65cb1487999507\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint execvp(const char *file, char *const argv[]);</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cb1487999507-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cb1487999507-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">execvp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">file</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-r\">const</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">argv</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>函数名中的 <code>vp</code> 表明：它接受一个文件名，将在系统 $PATH 变量中搜索此文件名，它还接受将要执行的一组参数。</p>\n<p>你可以阅读 <a href=\"https://linux.die.net/man/3/exec\">exec 的 man 页面</a> 以得到其它函数的更多信息。</p>\n<p>让我们看一下以下代码，它执行命令 <code>ls -l -h -a</code>：</p>\n<p><a href=\"https://indradhanush.github.io/code/shell-part-2/execvp.c\">execvp.c</a></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9ce3a65cbe286004593\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;unistd.h&gt;\r\n\r\nint main() {\r\n    char *argv[] = {\"ls\", \"-l\", \"-h\", \"-a\", NULL};\r\n    execvp(argv[0], argv);\r\n\r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cbe286004593-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cbe286004593-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cbe286004593-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cbe286004593-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cbe286004593-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cbe286004593-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cbe286004593-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cbe286004593-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cbe286004593-1\"><span class=\"crayon-p\">#include &lt;unistd.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cbe286004593-2\"> </div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cbe286004593-3\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cbe286004593-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">argv</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"ls\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"-l\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"-h\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"-a\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cbe286004593-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">execvp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">argv</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">argv</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cbe286004593-6\"> </div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cbe286004593-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cbe286004593-8\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>关于 <code>execvp</code> 函数，有几点需要注意：</p>\n<ol>\n<li>第一个参数是命令名。</li>\n<li>第二个参数由命令名和传递给命令自身的参数组成。并且它必须以 <code>NULL</code> 结束。</li>\n<li>它将当前进程的映像交换为被执行的命令的映像，后面再展开说明。</li>\n</ol>\n<p>如果你编译并执行上面的代码，你会看到类似于下面的输出：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9ce3a65cc2293536395\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntotal 32\r\ndrwxr-xr-x  5 dhanush  staff   170B Jun 11 11:32 .\r\ndrwxr-xr-x  4 dhanush  staff   136B Jun 11 11:30 ..\r\n-rwxr-xr-x  1 dhanush  staff   8.7K Jun 11 11:32 a.out\r\ndrwxr-xr-x  3 dhanush  staff   102B Jun 11 11:32 a.out.dSYM\r\n-rw-r--r--  1 dhanush  staff   130B Jun 11 11:32</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cc2293536395-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cc2293536395-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cc2293536395-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cc2293536395-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cc2293536395-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cc2293536395-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cc2293536395-1\"><span class=\"crayon-i\">total</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cc2293536395-2\"><span class=\"crayon-v\">drwxr</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xr</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dhanush  </span><span class=\"crayon-i\">staff</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">170B</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">32</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cc2293536395-3\"><span class=\"crayon-v\">drwxr</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xr</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dhanush  </span><span class=\"crayon-i\">staff</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">136B</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cc2293536395-4\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rwxr</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xr</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dhanush  </span><span class=\"crayon-i\">staff</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">8.7K</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">32</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">out</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cc2293536395-5\"><span class=\"crayon-v\">drwxr</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xr</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dhanush  </span><span class=\"crayon-i\">staff</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">102B</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">32</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dSYM</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cc2293536395-6\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dhanush  </span><span class=\"crayon-i\">staff</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">130B</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">32</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>它和你在你的主 shell 中手动执行<code>ls -l -h -a</code>的结果完全相同。</p>\n<p>既然我们能执行命令了，我们需要使用在<a href=\"http://blog.jobbole.com/111738/\">第一部分</a>中学到的<code>fork</code> 系统调用构建有用的东西。事实上我们要做到以下这些：</p>\n<ol>\n<li>当用户输入时接受命令。</li>\n<li>调用 <code>fork</code> 以创建一个子进程。</li>\n<li>在子进程中执行命令，同时父进程等待命令完成。</li>\n<li>回到第一步。</li>\n</ol>\n<p>我们看看下面的函数，它接收一个字符串作为<code>输入</code>。我们使用库函数 <code>strtok</code> 以<code>空格</code>分割该字符串，然后返回一个字符串数组，数组也用 <code>NULL</code>来终结。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9ce3a65cc6343404004\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ninclude &lt;stdlib.h&gt;\r\n#include &lt;string.h&gt;\r\n\r\nchar **get_input(char *input) {\r\n    char **command = malloc(8 * sizeof(char *));\r\n    char *separator = \" \";\r\n    char *parsed;\r\n    int index = 0;\r\n\r\n    parsed = strtok(input, separator);\r\n    while (parsed != NULL) {\r\n        command[index] = parsed;\r\n        index++;\r\n\r\n        parsed = strtok(NULL, separator);\r\n    }\r\n\r\n    command[index] = NULL;\r\n    return command;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cc6343404004-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cc6343404004-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cc6343404004-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cc6343404004-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cc6343404004-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cc6343404004-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cc6343404004-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cc6343404004-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cc6343404004-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cc6343404004-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cc6343404004-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cc6343404004-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cc6343404004-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cc6343404004-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cc6343404004-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cc6343404004-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cc6343404004-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cc6343404004-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cc6343404004-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cc6343404004-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cc6343404004-1\"><span class=\"crayon-v\">include</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">stdlib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">h</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cc6343404004-2\"><span class=\"crayon-p\">#include &lt;string.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cc6343404004-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cc6343404004-4\"><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-e\">get_input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">input</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cc6343404004-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">malloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cc6343404004-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">separator</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" \"</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cc6343404004-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">parsed</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cc6343404004-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cc6343404004-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cc6343404004-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">parsed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strtok</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">input</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">separator</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cc6343404004-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">parsed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cc6343404004-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">parsed</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cc6343404004-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">index</span><span class=\"crayon-o\">++</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cc6343404004-14\"> </div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cc6343404004-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">parsed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strtok</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">separator</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cc6343404004-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cc6343404004-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cc6343404004-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cc6343404004-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cc6343404004-20\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>如果该函数的<code>输入</code>是字符串 <code>\"ls -l -h -a\"</code>，那么函数将会创建这样形式的一个数组：<code>[\"ls\", \"-l\", \"-h\", \"-a\", NULL]</code>，并且返回指向此队列的指针。</p>\n<p>现在，我们在<code>主</code>函数中调用 <code>readline</code> 来读取用户的输入，并将它传给我们刚刚在上面定义的 <code>get_input</code>。一旦输入被解析，我们在子进程中调用 <code>fork</code> 和 <code>execvp</code>。在研究代码以前，看一下下面的图片，先理解 <code>execvp</code> 的含义：</p>\n<p><img class=\"aligncenter\" src=\"https://indradhanush.github.io/images/shell-part-2/execvp.jpg\" alt=\"\"></p>\n<p>当 <code>fork</code> 命令完成后，子进程是父进程的一份精确的拷贝。然而，当我们调用 <code>execvp</code> 时，它将当前程序替换为在参数中传递给它的程序。这意味着，虽然进程的当前文本、数据、堆栈段被替换了，进程 id 仍保持不变，但程序完全被覆盖了。如果调用成功了，那么 <code>execvp</code> 将不会返回，并且子进程中在这之后的任何代码都不会被执行。这里是<code>主</code>函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9ce3a65cca451002299\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#include &lt;stdlib.h&gt;\r\n#include &lt;stdio.h&gt;\r\n#include &lt;string.h&gt;\r\n#include &lt;readline/readline.h&gt;\r\n#include &lt;unistd.h&gt;\r\n#include &lt;sys/wait.h&gt;\r\n\r\nint main() {\r\n    char **command;\r\n    char *input;\r\n    pid_t child_pid;\r\n    int stat_loc;\r\n\r\n    while (1) {\r\n        input = readline(\"unixsh&gt; \");\r\n        command = get_input(input);\r\n\r\n        child_pid = fork();\r\n        if (child_pid == 0) {\r\n            /* Never returns if the call is successful */\r\n            execvp(command[0], command);\r\n            printf(\"This won't be printed if execvp is successuln\");\r\n        } else {\r\n            waitpid(child_pid, &amp;stat_loc, WUNTRACED);\r\n        }\r\n\r\n        free(input);\r\n        free(command);\r\n    }\r\n\r\n    return 0;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cca451002299-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cca451002299-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cca451002299-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cca451002299-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cca451002299-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cca451002299-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cca451002299-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cca451002299-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cca451002299-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cca451002299-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cca451002299-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cca451002299-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cca451002299-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cca451002299-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cca451002299-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cca451002299-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cca451002299-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cca451002299-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cca451002299-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cca451002299-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cca451002299-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cca451002299-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cca451002299-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cca451002299-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cca451002299-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cca451002299-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cca451002299-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cca451002299-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cca451002299-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cca451002299-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cca451002299-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cca451002299-32\">32</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cca451002299-1\"><span class=\"crayon-p\">#include &lt;stdlib.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cca451002299-2\"><span class=\"crayon-p\">#include &lt;stdio.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cca451002299-3\"><span class=\"crayon-p\">#include &lt;string.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cca451002299-4\"><span class=\"crayon-p\">#include &lt;readline/readline.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cca451002299-5\"><span class=\"crayon-p\">#include &lt;unistd.h&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cca451002299-6\"><span class=\"crayon-p\">#include &lt;sys/wait.h&gt;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cca451002299-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cca451002299-8\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cca451002299-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cca451002299-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">input</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cca451002299-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">pid_t </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cca451002299-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">stat_loc</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cca451002299-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cca451002299-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cca451002299-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">input</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">readline</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"unixsh&gt; \"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cca451002299-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">input</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cca451002299-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cca451002299-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fork</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cca451002299-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cca451002299-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\">/* Never returns if the call is successful */</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cca451002299-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">execvp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cca451002299-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">printf</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"This won't be printed if execvp is successuln\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cca451002299-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cca451002299-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">waitpid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">stat_loc</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WUNTRACED</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cca451002299-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cca451002299-26\"> </div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cca451002299-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">free</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">input</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cca451002299-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">free</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cca451002299-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cca451002299-30\"> </div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cca451002299-31\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cca451002299-32\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0033 seconds] -->\r\n<p>全部代码可在<a href=\"https://indradhanush.github.io/code/shell-part-2/shell.c\">此处</a>的单个文件中获取。如果你用 <code>gcc -g -lreadline shell.c</code> 编译它，并执行二进制文件，你会得到一个最小的可工作 shell，你可以用它来运行系统命令，比如 <code>pwd</code> 和 <code>ls -lha</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9ce3a65cd0237301794\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nunixsh&gt; pwd\r\n/Users/dhanush/github.com/indradhanush.github.io/code/shell-part-2\r\nunixsh&gt; ls -lha\r\ntotal 28K\r\ndrwxr-xr-x 6 root root  204 Jun 11 18:27 .\r\ndrwxr-xr-x 3 root root 4.0K Jun 11 16:50 ..\r\n-rwxr-xr-x 1 root root  16K Jun 11 18:27 a.out\r\ndrwxr-xr-x 3 root root  102 Jun 11 15:32 a.out.dSYM\r\n-rw-r--r-- 1 root root  130 Jun 11 15:38 execvp.c\r\n-rw-r--r-- 1 root root  997 Jun 11 18:25 shell.c\r\nunixsh&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cd0237301794-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cd0237301794-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cd0237301794-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cd0237301794-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cd0237301794-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cd0237301794-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cd0237301794-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cd0237301794-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cd0237301794-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cd0237301794-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cd0237301794-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cd0237301794-1\"><span class=\"crayon-v\">unixsh</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pwd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cd0237301794-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Users</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dhanush</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">github</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">indradhanush</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">github</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">io</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">code</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">shell</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">part</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cd0237301794-3\"><span class=\"crayon-v\">unixsh</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">lha</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cd0237301794-4\"><span class=\"crayon-i\">total</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">28K</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cd0237301794-5\"><span class=\"crayon-v\">drwxr</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xr</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">204</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">27</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cd0237301794-6\"><span class=\"crayon-v\">drwxr</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xr</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4.0K</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">50</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cd0237301794-7\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rwxr</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xr</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">16K</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">27</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">out</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cd0237301794-8\"><span class=\"crayon-v\">drwxr</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">xr</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">102</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">32</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">out</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dSYM</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cd0237301794-9\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">130</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">38</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">execvp</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">c</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cd0237301794-10\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">rw</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">root </span><span class=\"crayon-i\">root</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">997</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Jun</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">25</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">shell</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">c</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cd0237301794-11\"><span class=\"crayon-v\">unixsh</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0038 seconds] -->\r\n<p>注意：<code>fork</code> 只有在用户输入命令后才被调用，这意味着接受用户输入的用户提示符是父进程。</p>\n<h2>错误处理</h2>\n<p>到目前为止，我们一直假设我们的命令总会完美的运行，还没有处理错误。所以我们要对 <a href=\"https://indradhanush.github.io/code/shell-part-2/shell.c\">shell.c</a>做一点改动：</p>\n<ul>\n<li><strong>fork</strong> – 如果操作系统内存耗尽或是进程数量已经到了允许的最大值，子进程就无法创建，会返回 -1。我们在代码里加上以下内容：</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9ce3a65cd4235616482\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n...\r\n    while (1) {\r\n        input = readline(\"unixsh&gt; \");\r\n        command = get_input(input);\r\n\r\n        child_pid = fork();\r\n        if (child_pid &lt; 0) {\r\n            perror(\"Fork failed\");\r\n            exit(1);\r\n        }\r\n    ...</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cd4235616482-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cd4235616482-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cd4235616482-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cd4235616482-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cd4235616482-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cd4235616482-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cd4235616482-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cd4235616482-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cd4235616482-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cd4235616482-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cd4235616482-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cd4235616482-1\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cd4235616482-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cd4235616482-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">input</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">readline</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"unixsh&gt; \"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cd4235616482-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">input</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cd4235616482-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cd4235616482-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fork</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cd4235616482-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">child_pid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cd4235616482-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Fork failed\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cd4235616482-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">exit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cd4235616482-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cd4235616482-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p></p>\n<ul>\n<li><strong>execvp</strong> – 就像上面解释过的，被成功调用后它不会返回。然而，如果执行失败它会返回 -1。同样地，我们修改 <code>execvp</code> 调用：</li>\n<li>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9ce3a65cd7574977128\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n    ...\r\n        if (execvp(command[0], command) &lt; 0) {\r\n            perror(command[0]);\r\n            exit(1);\r\n        }\r\n...</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cd7574977128-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cd7574977128-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cd7574977128-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cd7574977128-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cd7574977128-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cd7574977128-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cd7574977128-1\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cd7574977128-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">execvp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cd7574977128-3\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cd7574977128-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">exit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cd7574977128-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cd7574977128-6\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<br>\n注意：虽然<code>fork</code>之后的<code>exit</code>调用终止整个程序，但<code>execvp</code>之后的<code>exit</code> 调用只会终止子进程，因为这段代码只属于子进程。</li>\n</ul>\n<ul>\n<li><strong>malloc</strong> – 如果操作系统内存耗尽，它就会失败。在这种情况下，我们应该退出程序：<br>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9ce3a65cdb990268314\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nchar **get_input(char *input) {\r\nchar **command = malloc(8 * sizeof(char *));\r\nif (command == NULL) {\r\nperror(\"malloc failed\");\r\nexit(1);\r\n}\r\n...</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cdb990268314-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cdb990268314-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cdb990268314-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cdb990268314-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cdb990268314-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cdb990268314-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cdb990268314-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cdb990268314-1\"><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-e\">get_input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">input</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cdb990268314-2\"><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">malloc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">sizeof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cdb990268314-3\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cdb990268314-4\"><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"malloc failed\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cdb990268314-5\"><span class=\"crayon-e\">exit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cdb990268314-6\"><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cdb990268314-7\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n\n</li>\n<li><strong>动态内存分配</strong> – 目前我们的命令缓冲区只分配了8个块。如果我们输入的命令超过8个单词，命令就无法像预期的那样工作。这么做是为了让例子便于理解，如何解决这个问题留给读者作为一个练习。</li>\n</ul>\n<p>上面带有错误处理的代码可在<a href=\"https://indradhanush.github.io/code/shell-part-2/shell_with_error_handling.c\">这里</a>获取。</p>\n<h2>内建命令</h2>\n<p>如果你试着执行 <code>cd</code> 命令，你会得到这样的错误：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9ce3a65cde536935589\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncd: No such file or directory\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65cde536935589-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65cde536935589-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9ce3a65cde536935589-1\"><span class=\"crayon-v\">cd</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">No </span><span class=\"crayon-e\">such </span><span class=\"crayon-e\">file </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">directory</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65cde536935589-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>我们的 shell 现在还不能识别<code>cd</code>命令。这背后的原因是：cd不是<code>ls</code>或<code>pwd</code>这样的系统程序。让我们后退一步，暂时假设<code>cd</code> 也是一个系统程序。你认为执行流程会是什么样？在继续阅读之前，你可能想要思考一下。</p>\n<p>流程是这样的：</p>\n<ol>\n<li>用户输入 <code>cd /</code>。</li>\n<li>shell对当前进程作 <code>fork</code>，并在子进程中执行命令。</li>\n<li>在成功调用后，子进程退出，控制权还给父进程。</li>\n<li>父进程的当前工作目录没有改变，因为命令是在子进程中执行的。因此，<code>cd</code> 命令虽然成功了，但并没有产生我们想要的结果。</li>\n</ol>\n<p>因此，要支持 <code>cd</code>，我们必须自己实现它。我们也需要确保，如果用户输入的命令是 <code>cd</code>（或属于预定义的内建命令），我们根本不要 <code>fork</code> 进程。相反地，我们将执行我们对 <code>cd</code>（或任何其它内建命令）的实现，并继续等待用户的下一次输入。<code></code>，幸运的是我们可以利用 <code>chdir</code> 函数调用，它用起来很简单。它接受路径作为参数，如果成功则返回0，失败则返回 -1。我们定义函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9ce3a65ce4465997151\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nint cd(char *path) {\r\n        return chdir(path);\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65ce4465997151-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65ce4465997151-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65ce4465997151-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9ce3a65ce4465997151-1\"><span class=\"crayon-t\">int</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">char</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65ce4465997151-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">chdir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65ce4465997151-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>并且在我们的<code>主</code>函数中为它加入一个检查：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9ce3a65ce7973406306\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">C</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n    while (1) {\r\n        input = readline(\"unixsh&gt; \");\r\n        command = get_input(input);\r\n\r\n            if (strcmp(command[0], \"cd\") == 0) {\r\n            if (cd(command[1]) &lt; 0) {\r\n                perror(command[1]);\r\n            }\r\n\r\n                /* Skip the fork */\r\n            continue;\r\n        }\r\n    ...</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65ce7973406306-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65ce7973406306-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65ce7973406306-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65ce7973406306-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65ce7973406306-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65ce7973406306-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65ce7973406306-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65ce7973406306-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65ce7973406306-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65ce7973406306-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65ce7973406306-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65ce7973406306-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65ce7973406306-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9ce3a65ce7973406306-1\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65ce7973406306-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">input</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">readline</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"unixsh&gt; \"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65ce7973406306-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">command</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">input</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65ce7973406306-4\"> </div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65ce7973406306-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">strcmp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"cd\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65ce7973406306-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">cd</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65ce7973406306-7\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">perror</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65ce7973406306-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65ce7973406306-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65ce7973406306-10\"><span class=\"crayon-h\">                </span><span class=\"crayon-c\">/* Skip the fork */</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65ce7973406306-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">continue</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65ce7973406306-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65ce7973406306-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>带有以上更改的代码可从<a href=\"https://indradhanush.github.io/code/shell-part-2/shell_with_builtin.c\">这里</a>获取，如果你编译并执行它，你将能运行 <code>cd</code> 命令。这里是一个示例输出：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9ce3a65ceb298687432\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Shell</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nunixsh&gt; pwd\r\n/Users/dhanush/github.com/indradhanush.github.io/code/shell-part-2\r\nunixsh&gt; cd /\r\nunixsh&gt; pwd\r\n/\r\nunixsh&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65ceb298687432-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65ceb298687432-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65ceb298687432-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65ceb298687432-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9ce3a65ceb298687432-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9ce3a65ceb298687432-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9ce3a65ceb298687432-1\"><span class=\"crayon-v\">unixsh</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">pwd</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65ceb298687432-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Users</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">dhanush</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">github</span><span class=\"crayon-e\">.com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">indradhanush</span><span class=\"crayon-e\">.github</span><span class=\"crayon-e\">.io</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">code</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">shell</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">part</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65ceb298687432-3\"><span class=\"crayon-v\">unixsh</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65ceb298687432-4\"><span class=\"crayon-v\">unixsh</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">pwd</span></div><div class=\"crayon-line\" id=\"crayon-59b9ce3a65ceb298687432-5\"><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9ce3a65ceb298687432-6\"><span class=\"crayon-v\">unixsh</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>第二部分到此结束。这篇博客帖文中的所有代码示例可在<a href=\"https://github.com/indradhanush/indradhanush.github.io/tree/master/code/shell-part-2/\">这里</a>获取。在<a href=\"https://indradhanush.github.io/blog/writing-a-unix-shell-part-3/\">下一篇博客帖文</a>中，我们将探讨信号的主题以及实现对用户中断（Ctrl-C）的处理。敬请期待。</p>\n<h2>致谢</h2>\n<p>谢谢 <a href=\"https://github.com/domspad\">Dominic Spadacene</a>和我搭档写这篇文章，谢谢 <a href=\"https://github.com/saulpw\">Saul Pwanson</a>帮我解决怪异的内存泄漏，当时代码貌似完全不能工作了。</p>\n<p><strong>更新</strong>：Saul提到：按照惯例，用 <code>&lt; 0</code> 来检查错误比用 <code>== -1</code> 更好，因为有些 API 可能返回除了 <code>-1</code> 以外的负值，<code>&lt;0</code> 有助于应对那些情况。我已经据此更新了本帖文和代码示例。</p>\n<p><strong>参考资料</strong></p>\n<ul>\n<li><a href=\"http://amzn.to/2sc0p8o\">UNIX 环境高级编程 – Stephens &amp; Rago</a></li>\n<li><a href=\"http://amzn.to/2sc3TYr\">Linux 系统编程 – Robert Love</a></li>\n<li><a href=\"https://linux.die.net/man/\">Linux man 页面</a></li>\n</ul>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/8204a635b9f0335c5b2e27498c3d5c97.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/0fbc02d33dc26bbfebc27f81bea9cdf9.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112126\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112126votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112126\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/qdoverture\">效楚</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/qdoverture\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/72a13d3690f7c6edc018286f0ae732f6.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            本职工作是IC设计，工作中也经常做脚本编写、嵌入式编程等，对软件和文字翻译亦有浓厚的兴趣。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/qdoverture\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/qdoverture/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/qdoverture/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 14</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "cp 命令两个高效的用法", "url": "http://blog.jobbole.com/112170/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/0f3b1cf0b9d183fb000f5687784e8852.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 9, "tags": "IT技术,命令行", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/7/two-great-uses-cp-command\">Chris Hermansen</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8766-1.html\">bigdimple</a>   </div><blockquote><p>Linux 中高效的备份拷贝命令</p></blockquote>\n<p>在 Linux 上能使用鼠标点来点去的图形化界面是一件很美妙的事……但是如果你喜欢的开发交互环境和编译器是终端窗口、Bash 和 Vim，那你应该像我一样经常和终端打交道。</p>\n<p>即使是不经常使用终端的人，如果对终端环境深入了解也能获益良多。举个例子—— <span style=\"color: #ff0000\"><strong>cp</strong></span> 命令，据 <a href=\"https://en.wikipedia.org/wiki/Cp_(Unix)\">维基百科</a> 的解释，<span style=\"color: #ff0000\"><strong>cp</strong></span> （意即 copy）命令是第一个版本的 <a href=\"https://en.wikipedia.org/wiki/Unix\">Unix</a> 系统的一部分。连同一组其它的命令 <span style=\"color: #ff0000\"><strong>ls</strong></span>、<span style=\"color: #ff0000\"><strong>mv</strong>、<strong>cd</strong>、<strong>pwd</strong>、<strong>mkdir</strong>、<strong>vi</strong>、<strong>sh</strong>、<strong>sed</strong></span> 和<span style=\"color: #ff0000\"> <strong>awk</strong></span> ，还有提到的<span style=\"color: #ff0000\"> <strong>cp</strong> </span>都是我在 1984 年接触 System V Unix 系统时所学习的命令之一。<span style=\"color: #ff0000\"><strong>cp</strong></span> 命令最常见的用法是制作文件副本。像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d125b2e80301351060\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncp sourcefile destfile</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d125b2e80301351060-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d125b2e80301351060-1\"><span class=\"crayon-e\">cp </span><span class=\"crayon-e\">sourcefile </span><span class=\"crayon-v\">destfile</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>在终端中执行此命令，上述命令将名为 <span style=\"color: #ff0000\"><strong>sourcefile</strong></span> 的文件复制到名为<span style=\"color: #ff0000\"> <strong>destfile</strong></span> 的文件中。如果在执行命令之前 <span style=\"color: #ff0000\"><strong>destfile</strong></span> 文件不存在，那将会创建此文件，如果已经存在，那就会覆盖此文件。</p>\n<p>这个命令我不知道自己用了多少次了（我也不想知道），但是我知道在我编写测试代码的时候，我经常用，为了保留当前正常的版本，而且又能继续修改，我会输入这个命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d125b2e8b412075759\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncp test1.py test1.bak</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d125b2e8b412075759-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d125b2e8b412075759-1\"><span class=\"crayon-e\">cp </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">bak</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>在过去的30多年里，我使用了无数次这个命令。另外，当我决定编写我的第二个版本的测试程序时，我会输入这个命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d125b2e90415757938\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncp test1.py test2.py</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d125b2e90415757938-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d125b2e90415757938-1\"><span class=\"crayon-e\">cp </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py </span><span class=\"crayon-v\">test2</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这样就完成了修改程序的第一步。</p>\n<p>我通常很少查看 <span style=\"color: #ff0000\"><strong>cp</strong></span> 命令的参考文档，但是当我在备份我的图片文件夹的时候（在 GUI 环境下使用 “file” 应用），我开始思考“在 <span style=\"color: #ff0000\"><strong>cp</strong></span> 命令中是否有个参数支持只复制新文件或者是修改过的文件。”果然，真的有！</p>\n<h1 id=\"toc_1\">高效用法 1：更新你的文件夹</h1>\n<p>比如说在我的电脑上有一个存放各种文件的文件夹，另外我要不时的往里面添加一些新文件，而且我会不时地修改一些文件，例如我手机里下载的照片或者是音乐。</p>\n<p>假设我收集的这些文件对我而言都很有价值，我有时候会想做个拷贝，就像是“快照”一样将文件保存在其它媒体。当然目前有很多程序都支持备份，但是我想更为精确的将目录结构复制到可移动设备中，方便于我经常使用这些离线设备或者连接到其它电脑上。</p>\n<p><span style=\"color: #ff0000\"><strong>cp</strong></span> 命令提供了一个易如反掌的方法。例子如下：</p>\n<p>在我的 <span style=\"color: #ff0000\"><strong>Pictures</strong></span> 文件夹下，我有这样一个文件夹名字为 <span style=\"color: #ff0000\"><strong>Misc</strong></span>。为了方便说明，我把文件拷贝到 USB 存储设备上。让我们开始吧！</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d125b2e94670252072\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nme@desktop:~/Pictures$ cp -r Misc /media/clh/4388-D5FE\r\nme@desktop:~/Pictures$</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d125b2e94670252072-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d125b2e94670252072-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d125b2e94670252072-1\"><span class=\"crayon-v\">me</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">desktop</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Pictures</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Misc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">media</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">clh</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4388</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">D5FE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d125b2e94670252072-2\"><span class=\"crayon-v\">me</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">desktop</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Pictures</span><span class=\"crayon-sy\">$</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>上面的命令是我从按照终端窗口中完整复制下来的。对于有些人来说不是很适应这种环境，在我们输入命令或者执行命令之前，需要注意的是 <span style=\"color: #ff0000\"><strong>me@mydesktop:~/Pictures</strong></span> 这个前缀，<span style=\"color: #ff0000\"><strong>me</strong></span> 这个是当前用户，<span style=\"color: #ff0000\"><strong>mydesktop</strong></span> 这是电脑名称，<span style=\"color: #ff0000\"><strong>~/Pictures</strong></span> 这个是当前工作目录，是 <span style=\"color: #ff0000\"><strong>/home/me/Pictures</strong></span> 完整路径的缩写。</p>\n<p>我输入这个命令 <span style=\"color: #ff0000\"><strong>cp -r Misc /media/clh/4388-D5FE</strong></span> 并执行后 ，拷贝<span style=\"color: #ff0000\"> <strong>Misc</strong></span> 目录下所有文件（这个 <span style=\"color: #ff0000\"><strong>-r</strong></span> 参数，全称 “recursive”，递归处理，意思为本目录下所有文件及子目录一起处理）到我的 USB 设备的挂载目录<span style=\"color: #ff0000\"> <strong>/media/clh/4388-D5FE</strong></span>。</p>\n<p>执行命令后回到之前的提示，大多数命令继承了 Unix 的特性，在命令执行后，如果没有任何异常什么都不显示，在任务结束之前不会显示像 “execution succeeded” 这样的提示消息。如果想获取更多的反馈，就使用 <span style=\"color: #ff0000\"><strong>-v</strong></span> 参数让执行结果更详细。</p>\n<p>下图中是我的 USB 设备中刚刚拷贝过来的文件夹 <span style=\"color: #ff0000\"><strong>Misc</strong></span> ，里面总共有 9 张图片。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/0f3b1cf0b9d183fb000f5687784e8852.png\"><img class=\"aligncenter wp-image-112174 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/0f3b1cf0b9d183fb000f5687784e8852.png\" alt=\"134531uhe4siy48m1t4goo\" width=\"232\" height=\"197\"></a></p>\n<p>假设我要在原始拷贝路径下 <span style=\"color: #ff0000\"><strong>~/Pictures/Misc</strong></span> 下添加一些新文件，就像这样：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/ac252c3c4d39bb62fd126ffce53ed5d1.png\"><img class=\"aligncenter wp-image-112172 size-full\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/ac252c3c4d39bb62fd126ffce53ed5d1.png\" alt=\"134531uhe4siy48m1t4goo\" width=\"272\" height=\"333\"></a></p>\n<p>现在我想只拷贝新的文件到我的存储设备上，我就使用 <span style=\"color: #ff0000\"><strong>cp</strong> </span>的“更新”和“详细”选项。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d125b2e98997835931\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nme@desktop:~/Pictures$ cp -r -u -v Misc /media/clh/4388-D5FE\r\n'Misc/asunder.png' -&gt; '/media/clh/4388-D5FE/Misc/asunder.png'\r\n'Misc/editing tags guayadeque.png' -&gt; '/media/clh/4388-D5FE/Misc/editing tags guayadeque.png'\r\n'Misc/misc on usb.png' -&gt; '/media/clh/4388-D5FE/Misc/misc on usb.png'\r\nme@desktop:~/Pictures$</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d125b2e98997835931-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d125b2e98997835931-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d125b2e98997835931-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d125b2e98997835931-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d125b2e98997835931-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d125b2e98997835931-1\"><span class=\"crayon-v\">me</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">desktop</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Pictures</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">u</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">v</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Misc</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">media</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">clh</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">4388</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">D5FE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d125b2e98997835931-2\"><span class=\"crayon-s\">'Misc/asunder.png'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/media/clh/4388-D5FE/Misc/asunder.png'</span></div><div class=\"crayon-line\" id=\"crayon-59b9d125b2e98997835931-3\"><span class=\"crayon-s\">'Misc/editing tags guayadeque.png'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/media/clh/4388-D5FE/Misc/editing tags guayadeque.png'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d125b2e98997835931-4\"><span class=\"crayon-s\">'Misc/misc on usb.png'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/media/clh/4388-D5FE/Misc/misc on usb.png'</span></div><div class=\"crayon-line\" id=\"crayon-59b9d125b2e98997835931-5\"><span class=\"crayon-v\">me</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">desktop</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Pictures</span><span class=\"crayon-sy\">$</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>上面的第一行中是<span style=\"color: #ff0000\"> <strong>cp</strong></span> 命令和具体的参数（<span style=\"color: #ff0000\"><strong>-r</strong></span> 是“递归”， <span style=\"color: #ff0000\"><strong>-u</strong></span> 是“更新”，<span style=\"color: #ff0000\"><strong>-v</strong></span> 是“详细”）。接下来的三行显示被复制文件的信息，最后一行显示命令行提示符。</p>\n<p>通常来说，参数 <span style=\"color: #ff0000\"><strong>-r</strong></span> 也可用更详细的风格 <span style=\"color: #ff0000\"><strong>–recursive</strong></span>。但是以简短的方式，也可以这么连用 <span style=\"color: #ff0000\"><strong>-ruv</strong></span>。</p>\n<h1 id=\"toc_2\">高效用法 2：版本备份</h1>\n<p>回到一开始的例子中，我在开发的时候定期给我的代码版本进行备份。然后我找到了另一种更好用的 <span style=\"color: #ff0000\"><strong>cp</strong></span> 参数。</p>\n<p>假设我正在编写一个非常有用的 Python 程序，作为一个喜欢不断修改代码的开发者，我会在一开始编写一个程序简单版本，然后不停的往里面添加各种功能直到它能成功的运行起来。比方说我的第一个版本就是用 Python 程序打印出 “hello world”。这只有一行代码的程序就像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d125b2e9e620842170\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprint 'hello world'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d125b2e9e620842170-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d125b2e9e620842170-1\"><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hello world'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>然后我将这个代码保存成文件命名为 <span style=\"color: #ff0000\"><strong>test1.py</strong></span>。我可以这么运行它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d125b2ea2426323673\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nme@desktop:~/Test$ python test1.py\r\nhello world\r\nme@desktop:~/Test$</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d125b2ea2426323673-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d125b2ea2426323673-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d125b2ea2426323673-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d125b2ea2426323673-1\"><span class=\"crayon-v\">me</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">desktop</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">python </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d125b2ea2426323673-2\"><span class=\"crayon-e\">hello </span><span class=\"crayon-e\">world</span></div><div class=\"crayon-line\" id=\"crayon-59b9d125b2ea2426323673-3\"><span class=\"crayon-v\">me</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">desktop</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>现在程序可以运行了，我想在添加新的内容之前进行备份。我决定使用带编号的备份选项，如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d125b2ea5779892579\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclh@vancouver:~/Test$ cp --force --backup=numbered test1.py test1.py\r\nclh@vancouver:~/Test$ ls\r\ntest1.py &amp;nbsp;test1.py.~1~\r\nclh@vancouver:~/Test$</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d125b2ea5779892579-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d125b2ea5779892579-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d125b2ea5779892579-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d125b2ea5779892579-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d125b2ea5779892579-1\"><span class=\"crayon-v\">clh</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vancouver</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">force</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">backup</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">numbered </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d125b2ea5779892579-2\"><span class=\"crayon-v\">clh</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vancouver</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line\" id=\"crayon-59b9d125b2ea5779892579-3\"><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">nbsp</span><span class=\"crayon-sy\">;</span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">~</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">~</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d125b2ea5779892579-4\"><span class=\"crayon-v\">clh</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vancouver</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>所以，上面的做法是什么意思呢？</p>\n<p>第一，这个<span style=\"color: #ff0000\"> <strong>–backup=numbered</strong></span> 参数意思为“我要做个备份，而且是带编号的连续备份”。所以一个备份就是 1 号，第二个就是 2 号，等等。</p>\n<p>第二，如果源文件和目标文件名字是一样的。通常我们使用 <span style=\"color: #ff0000\"><strong>cp</strong></span> 命令去拷贝成自己，会得到这样的报错信息：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d125b2eaa090142922\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncp: 'test1.py' and 'test1.py' are the same file</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d125b2eaa090142922-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d125b2eaa090142922-1\"><span class=\"crayon-v\">cp</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'test1.py'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'test1.py'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">are </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">same </span><span class=\"crayon-v\">file</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>在特殊情况下，如果我们想备份的源文件和目标文件名字相同，我们使用<span style=\"color: #ff0000\"> <strong>–force</strong></span> 参数。</p>\n<p>第三，我使用 <span style=\"color: #ff0000\"><strong>ls</strong> </span>（意即 “list”）命令来显示现在目录下的文件，名字为 <span style=\"color: #ff0000\"><strong>test1.py</strong></span> 的是原始文件，名字为 <span style=\"color: #ff0000\"><strong>test1.py.~1~</strong></span> 的是备份文件</p>\n<p>假如现在我要加上第二个功能，在程序里加上另一行代码，可以打印 “Kilroy was here.”。现在程序文件 <span style=\"color: #ff0000\"><strong>test1.py</strong></span> 的内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d125b2eae343461409\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprint 'hello world'\r\nprint 'Kilroy was here'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d125b2eae343461409-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d125b2eae343461409-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d125b2eae343461409-1\"><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hello world'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d125b2eae343461409-2\"><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Kilroy was here'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>看到 Python 编程多么简单了吗？不管怎样，如果我再次执行备份的步骤，结果如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d125b2eb2624886596\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclh@vancouver:~/Test$ cp --force --backup=numbered test1.py test1.py\r\nclh@vancouver:~/Test$ ls\r\ntest1.py test1.py.~1~ test1.py.~2~\r\nclh@vancouver:~/Test$</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d125b2eb2624886596-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d125b2eb2624886596-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d125b2eb2624886596-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d125b2eb2624886596-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d125b2eb2624886596-1\"><span class=\"crayon-v\">clh</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vancouver</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">force</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">backup</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">numbered </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d125b2eb2624886596-2\"><span class=\"crayon-v\">clh</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vancouver</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ls</span></div><div class=\"crayon-line\" id=\"crayon-59b9d125b2eb2624886596-3\"><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">~</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">~</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">test1</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">~</span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">~</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d125b2eb2624886596-4\"><span class=\"crayon-v\">clh</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">vancouver</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">Test</span><span class=\"crayon-sy\">$</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>现在我有有两个备份文件：<span style=\"color: #ff0000\"> <strong>test1.py.~1~</strong></span> 包含了一行代码的程序，和<span style=\"color: #ff0000\"> <strong>test1.py.~2~</strong></span> 包含两行代码的程序。</p>\n<p>这个很好用的功能，我考虑做个 shell 函数让它变得更简单。</p>\n<h1 id=\"toc_3\">最后总结</h1>\n<p>第一，Linux 手册页，它在大多数桌面和服务器发行版都默认安装了，它提供了更为详细的使用方法和例子，对于 <span style=\"color: #ff0000\"><strong>cp</strong> </span>命令，在终端中输入如下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d125b2eb5080115052\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nman cp</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d125b2eb5080115052-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d125b2eb5080115052-1\"><span class=\"crayon-e\">man </span><span class=\"crayon-v\">cp</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>对于那些想学习如何使用这些命令，但不清楚如何使用的用户应该首先看一下这些说明，然后我建议创建一个测试目录和文件来尝试使用命令和选项。</p>\n<p>第二，兴趣是最好的老师。在你最喜欢的搜索引擎中搜索 “linux shell tutorial”，你会获得很多有趣和有用的资源。</p>\n<p>第三，你是不是在想，“为什么我要用这么麻烦的方法，图形化界面中有相同的功能，只用点击几下岂不是更简单？”，关于这个问题我有两个理由。首先，在我们工作中需要中断其他工作流程以及大量使用点击动作时，点击动作可就不简单了。其次，如果我们要完成流水线般的重复性工作，通过使用 shell 脚本和 shell 函数以及 shell 重命名等功能就能很轻松的实现。</p>\n<p>你还知道关于 <span style=\"color: #ff0000\"><strong>cp</strong></span> 命令其他更棒的使用方式吗？请在留言中积极回复哦～</p>\n<hr>\n<p><strong>作者简介：</strong></p>\n<p>Chris Hermansen – 1978 年毕业于英国哥伦比亚大学后一直从事计算机相关职业，我从 2005 年开始一直使用 Linux、Solaris、SunOS，在那之前我就是 Unix 系统管理员了，在技术方面，我的大量的职业生涯都是在做数据分析，尤其是空间数据分析，我有大量的编程经验与数据分析经验，熟练使用 awk、Python、PostgreSQL、PostGIS 和 Groovy。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112170\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112170votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112170\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 9 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "文件系统层次标准（FHS）简介", "url": "http://blog.jobbole.com/112121/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/59d49abe8909a122bc2c9aa43b71e3bb.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 6, "tags": "IT技术,Linux,文件系统", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://www.linuxinsider.com/story/84658.html\">Jonathan Terrasi</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8757-1.html\">Linux中国/firmianay</a>   </div><p>当你好奇地看着系统的根目录（<code>/</code>）的时候，可能会发现自己有点不知所措。大多数三个字母的目录名称并没有告诉你它们是做什么的，如果你需要做出一些重要的修改，那就很难知道在哪里可以查看。</p>\n<p>我想给那些没有深入了解过自己的根目录的人简单地介绍下它。</p>\n<h3 id=\"toc_1\">有用的工具</h3>\n<p>在我们开始之前，这里有几个需要熟悉的工具，它们可以让您随时挖掘那些您自己找到的有趣的东西。这些程序都不会对您的文件进行任何更改。</p>\n<p>最有用的工具是 <code>ls</code> — 它列出了使用完整路径或相对路径（即从当前目录开始的路径）作为参数给出的任何目录的内容。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9c05a6bd88077221490\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ls 路径\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9c05a6bd88077221490-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9c05a6bd88077221490-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9c05a6bd88077221490-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ls</span><span class=\"crayon-h\"> </span>路径</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9c05a6bd88077221490-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>当您进一步深入文件系统时，重复输入长路径可能会变得很麻烦，所以如果您想简化这一操作，可以用 <code>cd</code> 替换 <code>ls</code> 来更改当前的工作目录到该目录。与 <code>ls</code> 一样，只需将目录路径作为 <code>cd</code> 的参数。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9c05a6bd93825229961\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ cd 路径\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9c05a6bd93825229961-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9c05a6bd93825229961-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9c05a6bd93825229961-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">cd</span><span class=\"crayon-h\"> </span>路径</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9c05a6bd93825229961-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>如果您不确定某个文件是什么文件类型的，可以通过运行 <code>file</code> 并且将文件名作为 <code>file</code> 命令的参数。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9c05a6bd97900837473\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ file 文件名\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9c05a6bd97900837473-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9c05a6bd97900837473-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9c05a6bd97900837473-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">file</span><span class=\"crayon-h\"> </span>文件名</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9c05a6bd97900837473-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>最后，如果这个文件看起来像是适宜阅读的，那么用 <code>less</code> 来看看（不用担心文件有改变）。与最后一个工具一样，给出一个文件名作为参数来查看它。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9c05a6bd9b618538370\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ less 文件名\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9c05a6bd9b618538370-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9c05a6bd9b618538370-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9c05a6bd9b618538370-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">less</span><span class=\"crayon-h\"> </span>文件名</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9c05a6bd9b618538370-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>完成文件翻阅后，点击 <code>q</code> 键退出，即可返回到您的终端。</p>\n<h3 id=\"toc_2\">根目录之旅</h3>\n<p>现在就开始我们的旅程。我将按照字母顺序介绍直接放在根目录下的目录。这里并没有介绍所有的目录，但到最后，我们会突出其中的亮点。</p>\n<p>我们所有要遍历的目录的分类及功能都基于 Linux 的文件系统层次标准（FHS）。<a href=\"http://www.linuxfoundation.org/\">Linux 基金会</a>维护的 Linux FHS 帮助发行版和程序的设计者和开发人员来规划他们的工具的各个组件应该存放的位置。</p>\n<p>通过将各个程序的所有文件、二进制文件和帮助手册保存在一致的组织结构中，FHS 让对它们的学习、调试或修改更加容易。想象一下，如果不是使用 <code>man</code> 命令找到使用指南，那么你就得对每个程序分别寻找其手册。</p>\n<p>按照字母顺序和结构顺序，我们从 <code>/bin</code> 开始。该目录是存放所有核心系统二进制文件的地方，其包含的命令可以在 shell （解释终端指令的程序）中使用。没有这个目录的内容，你的系统就基本没法使用。</p>\n<p>接下来是 <code>/boot</code> 目录，它存储了您的计算机启动所需的所有东西。其中最重要的是引导程序和内核。引导程序是一个通过初始化一些基础工具，使引导过程得以继续的程序。在初始化结束时，引导程序会加载内核，内核允许计算机与所有其它硬件和固件进行接口。从这一点看，它可以使整个操作系统工作起来。</p>\n<p><code>/dev</code> 目录用于存储类似文件的对象来表示被系统识别为“设备”的各种东西。这里包括许多显式的设备，如计算机的硬件组件：键盘、屏幕、硬盘驱动器等。</p>\n<p>此外，<code>/dev</code> 还包含被系统视为“设备”的数据流的伪文件。一个例子是流入和流出您的终端的数据，可以分为三个“流”。它读取的信息被称为“标准输入”。命令或进程的输出是“标准输出”。最后，被分类为调试信息的辅助性输出指向到“标准错误”。终端本身作为文件也可以在这里找到。</p>\n<p><code>/etc</code>（发音类似工艺商业网站 “Etsy”，如果你想让 Linux 老用户惊艳一下的话，囧），许多程序在这里存储它们的配置文件，用于改变它们的设置。一些程序存储这里的是默认配置的副本，这些副本将在修改之前复制到另一个位置。其它的程序在这里存储配置的唯一副本，并期望用户可以直接修改。为 root 用户保留的许多程序常用一种配置模式。</p>\n<p><code>/home</code> 目录是用户个人文件所在的位置。对于桌面用户来说，这是您花费大部分时间的地方。对于每个非特权用户，这里都有一个具有相应名称的目录。</p>\n<p><code>/lib</code> 是您的系统赖以运行的许多库的所在地。许多程序都会重复使用一个或多个功能或子程序，它们经常会出现在几十上百个程序中。所以，如果每个程序在其二进制文件中重复写它需要的每一个组件，结果会是产生出一些大而无当的程序，作为更好的替代方案，我们可以通过进行“库调用”来引用这些库中的一个或多个。</p>\n<p>在 <code>/media</code> 目录中可以访问像 USB 闪存驱动器或摄像机这样的可移动媒体。虽然它并不是所有系统上都有，但在一些专注于直观的桌面系统中还是比较普遍的，如 Ubuntu。具有存储能力的媒体在此处被“挂载”，这意味着当设备中的原始位流位于 <code>/dev</code> 目录下时，用户通常可以在这里访问那些可交互的文件对象。</p>\n<p><code>/proc</code> 目录是一个动态显示系统数据的虚拟文件系统。这意味着系统可以即时地创建 <code>/proc</code> 的内容，用包含运行时生成的系统信息（如硬件统计信息）的文件进行填充。</p>\n<p><code>/tmp</code> 正如其名字，用于放置缓存数据等临时信息。这个目录不做其他更多的事情。</p>\n<p>现代 Linux 系统上大多数程序的二进制文件保存在 <code>/usr</code> 目录中。为了统一包含二进制文件的各种目录，<code>/usr</code> 包含 <code>/bin</code>、<code>/sbin</code> 和 <code>/lib</code> 中的所有内容的副本。</p>\n<p>最后，<code>/var</code> 里保存“可变variable”长度的数据。这里的可变长度数据的类型通常是会累积的数据，就像日志和缓存一样。一个例子是你的内核保留的日志。</p>\n<p>为了避免硬盘空间用尽和崩溃的情况，<code>/var</code> 内置了“日志旋转”功能，可删除旧信息，为新信息腾出空间，维持固定的最大大小。</p>\n<h3 id=\"toc_3\">结尾</h3>\n<p>正如我所说，这里介绍的绝对不是您在根目录中可以找到的一切，但是确定系统核心功能所在地是一个很好的开始，而且可以更深入地研究这些功能是什么。</p>\n<p>所以，如果你不知道要学习什么，就可能有很多的想法。如果你想得到一个更好的想法，就在这些目录中折腾自己吧！</p>\n<hr>\n<p>作者简介：</p>\n<p>自 2017 年以来 Jonathan Terrasi 一直是 ECT 新闻网的专栏作家。他的主要兴趣是计算机安全（特别是 Linux 桌面），加密和分析政治和时事。他是全职自由作家和音乐家。他的背景包括在芝加哥委员会发表的保卫人权法案文章中提供技术评论和分析。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112121\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112121votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112121\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "用神经网络训练一个文本分类器", "url": "http://blog.jobbole.com/112049/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/08/3f0fc87336415b5dec8a04dc523db2ac.png"], "praise_nums": "3", "comment_nums": 0, "fav_nums": 4, "tags": "IT技术,机器学习", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/2106382253\">Anne90</a> 翻译，<a href=\"http://www.jobbole.com/members/oliverpp\">蒋生武</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://machinelearnings.co/text-classification-using-neural-networks-f5cd7b8765c6#.eessps9io\">machinelearnings</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>理解聊天机器人的工作原理是非常重要的。聊天机器人内部一个非常重要的组件就是文本分类器。我们看一下文本分类器的神经网络（ANN）的内部工作原理。</p>\n<p style=\"text-align: center;\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/3f0fc87336415b5dec8a04dc523db2ac.png\"><img class=\"alignnone size-full wp-image-112152\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/3f0fc87336415b5dec8a04dc523db2ac.png\" alt=\"1-DpMaU1p85ZSgamwYDkzL-A\"></a></p>\n<p style=\"text-align: center;\">多层神经网络</p>\n<p>我们将会使用2层网络（1个隐层）和一个“词包”的方法来组织我们的训练数据。文本分类有3个特点：模式匹配、算法、神经网络。虽然使用多项朴素贝叶斯算法的方法非常有效，但是它有3个致命的缺陷：</p>\n<ul>\n<li>这个算法输出一个分数而不是一个概率。我们可以使用概率来忽略特定阈值以下的预测结果。这类似于忽略收音机中的噪声。</li>\n<li>这个算法从一个样本中学习一个分类中包含什么，而不是一个分类中不包含什么。一个分类中不包含什么的的学习模式往往也很重要。</li>\n<li>不成比例的大训练集的分类将会导致扭曲的分类分数，迫使算法相对于分类规模来调整输出分数，这并不理想。</li>\n</ul>\n<p>和它“天真”的对手一样，这种分类器并不试图去理解句子的含义，而仅仅对它进行分类。事实上，所谓的“人工智能聊天机器人”并不理解语言，但那是<a href=\"https://medium.com/@gk_/the-ai-label-is-bullshit-559b171867ff#.cqbwy3eb7\">另一个故事</a>。</p>\n<p>如果你刚接触人工神经网络，这是它的<a href=\"https://medium.com/@gk_/how-neural-networks-work-ff4c7ad371f7\">工作原理</a>。</p>\n<p>理解分类算法，请看<a href=\"https://chatbotslife.com/text-classification-using-algorithms-e4d50dcba45\">这里</a>。</p>\n<p>我们来逐个分析文本分类器的每个部分。我们将按照以下顺序：</p>\n<ol>\n<li><strong>引用需要的库</strong></li>\n<li><strong>提供训练集</strong></li>\n<li>整理数据</li>\n<li>迭代：编写代码+测试预测结果+调整模型</li>\n<li>抽象</li>\n</ol>\n<p>代码在这里，我们使用ipython notebook这个在数据科学项目上非常高效的工具。代码语法是python。</p>\n<p>我们首先导入自然语言工具包。我们需要一个可靠的方法将句子切分成词并且将单词词干化处理。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc413ec26994756481\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# use natural language toolkit\r\nimport nltk\r\nfrom nltk.stem.lancaster import LancasterStemmer\r\nimport os\r\nimport json\r\nimport datetime\r\nstemmer = LancasterStemmer()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec26994756481-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec26994756481-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec26994756481-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec26994756481-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec26994756481-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec26994756481-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec26994756481-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc413ec26994756481-1\"><span class=\"crayon-p\"># use natural language toolkit</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec26994756481-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">nltk</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec26994756481-3\"><span class=\"crayon-e\">from </span><span class=\"crayon-v\">nltk</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">stem</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lancaster </span><span class=\"crayon-e\">import </span><span class=\"crayon-e\">LancasterStemmer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec26994756481-4\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">os</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec26994756481-5\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">json</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec26994756481-6\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">datetime</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec26994756481-7\"><span class=\"crayon-v\">stemmer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LancasterStemmer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>下面是我们的训练集，12个句子属于3个类别（“意图”）。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc413ec30775050497\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 3 classes of training data\r\ntraining_data = []\r\ntraining_data.append({\"class\":\"greeting\", \"sentence\":\"how are you?\"})\r\ntraining_data.append({\"class\":\"greeting\", \"sentence\":\"how is your day?\"})\r\ntraining_data.append({\"class\":\"greeting\", \"sentence\":\"good day\"})\r\ntraining_data.append({\"class\":\"greeting\", \"sentence\":\"how is it going today?\"})\r\n\r\ntraining_data.append({\"class\":\"goodbye\", \"sentence\":\"have a nice day\"})\r\ntraining_data.append({\"class\":\"goodbye\", \"sentence\":\"see you later\"})\r\ntraining_data.append({\"class\":\"goodbye\", \"sentence\":\"have a nice day\"})\r\ntraining_data.append({\"class\":\"goodbye\", \"sentence\":\"talk to you soon\"})\r\n\r\ntraining_data.append({\"class\":\"sandwich\", \"sentence\":\"make me a sandwich\"})\r\ntraining_data.append({\"class\":\"sandwich\", \"sentence\":\"can you make a sandwich?\"})\r\ntraining_data.append({\"class\":\"sandwich\", \"sentence\":\"having a sandwich today?\"})\r\ntraining_data.append({\"class\":\"sandwich\", \"sentence\":\"what's for lunch?\"})\r\nprint (\"%s sentences in training data\" % len(training_data))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec30775050497-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec30775050497-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec30775050497-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec30775050497-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec30775050497-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec30775050497-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec30775050497-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec30775050497-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec30775050497-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec30775050497-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec30775050497-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec30775050497-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec30775050497-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec30775050497-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec30775050497-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec30775050497-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec30775050497-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc413ec30775050497-1\"><span class=\"crayon-p\"># 3 classes of training data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec30775050497-2\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec30775050497-3\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"greeting\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"how are you?\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec30775050497-4\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"greeting\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"how is your day?\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec30775050497-5\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"greeting\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"good day\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec30775050497-6\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"greeting\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"how is it going today?\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec30775050497-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec30775050497-8\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"goodbye\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"have a nice day\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec30775050497-9\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"goodbye\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"see you later\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec30775050497-10\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"goodbye\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"have a nice day\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec30775050497-11\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"goodbye\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"talk to you soon\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec30775050497-12\"> </div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec30775050497-13\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"sandwich\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"make me a sandwich\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec30775050497-14\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"sandwich\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"can you make a sandwich?\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec30775050497-15\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"sandwich\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"having a sandwich today?\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec30775050497-16\"><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"class\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"sandwich\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sentence\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"what's for lunch?\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec30775050497-17\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%s sentences in training data\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">training_data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0038 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc413ec35643382931\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n12 sentences in training data</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec35643382931-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc413ec35643382931-1\"><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sentences </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">training </span><span class=\"crayon-v\">data</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>现在我们可以将数据结构组织为：<em>documents</em>, <em>classes</em> 和<em>words</em>.</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc413ec39989682336\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwords = []\r\nclasses = []\r\ndocuments = []\r\nignore_words = ['?']\r\n# loop through each sentence in our training data\r\nfor pattern in training_data:\r\n    # tokenize each word in the sentence\r\n    w = nltk.word_tokenize(pattern['sentence'])\r\n    # add to our words list\r\n    words.extend(w)\r\n    # add to documents in our corpus\r\n    documents.append((w, pattern['class']))\r\n    # add to our classes list\r\n    if pattern['class'] not in classes:\r\n        classes.append(pattern['class'])\r\n\r\n# stem and lower each word and remove duplicates\r\nwords = [stemmer.stem(w.lower()) for w in words if w not in ignore_words]\r\nwords = list(set(words))\r\n\r\n# remove duplicates\r\nclasses = list(set(classes))\r\n\r\nprint (len(documents), \"documents\")\r\nprint (len(classes), \"classes\", classes)\r\nprint (len(words), \"unique stemmed words\", words)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec39989682336-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec39989682336-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec39989682336-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec39989682336-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec39989682336-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec39989682336-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec39989682336-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec39989682336-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec39989682336-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec39989682336-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec39989682336-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec39989682336-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec39989682336-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec39989682336-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec39989682336-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec39989682336-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec39989682336-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec39989682336-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec39989682336-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec39989682336-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec39989682336-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec39989682336-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec39989682336-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec39989682336-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec39989682336-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec39989682336-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc413ec39989682336-1\"><span class=\"crayon-v\">words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec39989682336-2\"><span class=\"crayon-v\">classes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec39989682336-3\"><span class=\"crayon-v\">documents</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec39989682336-4\"><span class=\"crayon-v\">ignore_words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'?'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec39989682336-5\"><span class=\"crayon-p\"># loop through each sentence in our training data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec39989682336-6\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pattern </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">training_data</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec39989682336-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># tokenize each word in the sentence</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec39989682336-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nltk</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">word_tokenize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'sentence'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec39989682336-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># add to our words list</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec39989682336-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extend</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec39989682336-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># add to documents in our corpus</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec39989682336-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">documents</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec39989682336-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># add to our classes list</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec39989682336-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">classes</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec39989682336-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">classes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">pattern</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'class'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec39989682336-16\"> </div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec39989682336-17\"><span class=\"crayon-p\"># stem and lower each word and remove duplicates</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec39989682336-18\"><span class=\"crayon-v\">words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">stemmer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">words </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ignore_words</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec39989682336-19\"><span class=\"crayon-v\">words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec39989682336-20\"> </div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec39989682336-21\"><span class=\"crayon-p\"># remove duplicates</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec39989682336-22\"><span class=\"crayon-v\">classes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">classes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec39989682336-23\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec39989682336-24\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">documents</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"documents\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec39989682336-25\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">classes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"classes\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">classes</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec39989682336-26\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"unique stemmed words\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0039 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc413ec3d838465561\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n12 documents\r\n3 classes ['greeting', 'goodbye', 'sandwich']\r\n26 unique stemmed words ['sandwich', 'hav', 'a', 'how', 'for', 'ar', 'good', 'mak', 'me', 'it', 'day', 'soon', 'nic', 'lat', 'going', 'you', 'today', 'can', 'lunch', 'is', \"'s\", 'see', 'to', 'talk', 'yo', 'what']</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec3d838465561-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec3d838465561-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec3d838465561-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc413ec3d838465561-1\"><span class=\"crayon-cn\">12</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">documents</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec3d838465561-2\"><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">classes</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'greeting'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'goodbye'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'sandwich'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec3d838465561-3\"><span class=\"crayon-cn\">26</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">unique </span><span class=\"crayon-e\">stemmed </span><span class=\"crayon-i\">words</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'sandwich'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'hav'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'how'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'for'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ar'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'good'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'mak'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'me'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'it'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'day'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'soon'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'nic'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'lat'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'going'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'you'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'today'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'can'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'lunch'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'is'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"'s\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'see'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'to'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'talk'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'yo'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'what'</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>注意每个单词都是词根并且小写。词根有助于机器将“have”和“having”等同起来。同时我们也不关心大小写。<a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/339dcac37e068d2783eff6ec4e21eb24.png\"><img class=\"alignnone size-full wp-image-112153 aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/339dcac37e068d2783eff6ec4e21eb24.png\" alt=\"1-eUedufAl7_sI_QWSEIstZg\"></a></p>\n<p>我们将训练集中的每个句子转换为词包。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc413ec41444387370\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# create our training data\r\ntraining = []\r\noutput = []\r\n# create an empty array for our output\r\noutput_empty = [0] * len(classes)\r\n\r\n# training set, bag of words for each sentence\r\nfor doc in documents:\r\n    # initialize our bag of words\r\n    bag = []\r\n    # list of tokenized words for the pattern\r\n    pattern_words = doc[0]\r\n    # stem each word\r\n    pattern_words = [stemmer.stem(word.lower()) for word in pattern_words]\r\n    # create our bag of words array\r\n    for w in words:\r\n        bag.append(1) if w in pattern_words else bag.append(0)\r\n\r\n    training.append(bag)\r\n    # output is a '0' for each tag and '1' for current tag\r\n    output_row = list(output_empty)\r\n    output_row[classes.index(doc[1])] = 1\r\n    output.append(output_row)\r\n\r\n# sample training/output\r\ni = 0\r\nw = documents[i][0]\r\nprint ([stemmer.stem(word.lower()) for word in w])\r\nprint (training[i])\r\nprint (output[i])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec41444387370-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec41444387370-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec41444387370-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec41444387370-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec41444387370-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec41444387370-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec41444387370-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec41444387370-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec41444387370-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec41444387370-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec41444387370-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec41444387370-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec41444387370-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec41444387370-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec41444387370-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec41444387370-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec41444387370-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec41444387370-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec41444387370-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec41444387370-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec41444387370-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec41444387370-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec41444387370-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec41444387370-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec41444387370-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec41444387370-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec41444387370-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec41444387370-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec41444387370-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec41444387370-30\">30</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc413ec41444387370-1\"><span class=\"crayon-p\"># create our training data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec41444387370-2\"><span class=\"crayon-v\">training</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec41444387370-3\"><span class=\"crayon-v\">output</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec41444387370-4\"><span class=\"crayon-p\"># create an empty array for our output</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec41444387370-5\"><span class=\"crayon-v\">output_empty</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">classes</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec41444387370-6\"> </div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec41444387370-7\"><span class=\"crayon-p\"># training set, bag of words for each sentence</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec41444387370-8\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">doc </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">documents</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec41444387370-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># initialize our bag of words</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec41444387370-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">bag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec41444387370-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># list of tokenized words for the pattern</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec41444387370-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pattern_words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">doc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec41444387370-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># stem each word</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec41444387370-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pattern_words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">stemmer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">word</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pattern_words</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec41444387370-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># create our bag of words array</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec41444387370-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">words</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec41444387370-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">bag</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pattern_words </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bag</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec41444387370-18\"> </div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec41444387370-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">training</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bag</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec41444387370-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># output is a '0' for each tag and '1' for current tag</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec41444387370-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">output_row</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">output_empty</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec41444387370-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">output_row</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">classes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">index</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">doc</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec41444387370-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">output</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">output_row</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec41444387370-24\"> </div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec41444387370-25\"><span class=\"crayon-p\"># sample training/output</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec41444387370-26\"><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec41444387370-27\"><span class=\"crayon-v\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">documents</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec41444387370-28\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">stemmer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">word</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec41444387370-29\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">training</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec41444387370-30\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">output</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0043 seconds] -->\r\n<p></p>\n<figure id=\"29a3\" class=\"graf graf--figure graf--iframe graf-after--p\">\n<div class=\"aspectRatioPlaceholder is-locked\"></div>\n</figure>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc413ec46440510609\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n['how', 'ar', 'you', '?']\r\n[0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\r\n[1, 0, 0]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec46440510609-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec46440510609-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec46440510609-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc413ec46440510609-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'how'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ar'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'you'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'?'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec46440510609-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec46440510609-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>上面的步骤是文本分类中的一个经典步骤：每个训练句子被转化为一个包含0和1的数组，而不是语料库中包含独特单词的数组。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc413ec49876047351\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n['how', 'are', 'you', '?']</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec49876047351-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc413ec49876047351-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'how'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'are'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'you'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'?'</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>被词干化为：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc413ec4d135948880\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n['how', 'ar', 'you', '?']</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec4d135948880-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc413ec4d135948880-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'how'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ar'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'you'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'?'</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>然后转换为输入词包的形式：<em>1</em>代表单词存在于词包中（忽略问号？）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc413ec50736153168\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec50736153168-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc413ec50736153168-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>输出：第一类</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc413ec53657546977\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[1, 0, 0]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec53657546977-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc413ec53657546977-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<p style=\"text-align: center;\">注意：一个句子可以有多个分类，也可以没有。确保理解上面的内容，仔细阅读代码直到你理解它。</p>\n<h4>机器学习的第一步是要有干净的数据</h4>\n<p style=\"text-align: center;\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/0f3abe8c32b873ad8ffa8c728a59102d.png\"><img class=\"alignnone size-full wp-image-112154\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/0f3abe8c32b873ad8ffa8c728a59102d.png\" alt=\"1-CcQPggEbLgej32mVF2lalg\"></a></p>\n<figure id=\"62c0\" class=\"graf graf--figure graf--layoutOutsetLeft graf-after--h4\">\n<div class=\"aspectRatioPlaceholder is-locked\"></div>\n</figure>\n<p>接下来我们的学习2层神经网络的核心功能。</p>\n<p>如果你是人工神经网络新手，这里是它的工作原理</p>\n<p>我们使用<a href=\"http://www.numpy.org/\">numpy</a>，原因是它可以提供快速的矩阵乘法运算。</p>\n<p style=\"text-align: center;\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/f397d71e69f5ebeaf6a3bf0522861d69.png\"><img class=\"alignnone size-full wp-image-112155\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/f397d71e69f5ebeaf6a3bf0522861d69.png\" alt=\"1-8SJcWjxz8j7YtY6K-DWxKw\"></a></p>\n<figure id=\"4f9a\" class=\"graf graf--figure graf--layoutOutsetLeft graf-after--p\">\n<div class=\"aspectRatioPlaceholder is-locked\"></div>\n</figure>\n<p>我们使用sigmoid函数对值进行归一化，用其导数来衡量错误率。通过不断迭代和调整，直到错误率低到一个可以接受的值。</p>\n<p>下面我们也实现了bag-of-words函数，将输入的一个句子转化为一个包含0和1的数组。这就是转换训练数据，得到正确的转换数据至关重要。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc413ec57245433819\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport numpy as np\r\nimport time\r\n\r\n# compute sigmoid nonlinearity\r\ndef sigmoid(x):\r\n    output = 1/(1+np.exp(-x))\r\n    return output\r\n\r\n# convert output of sigmoid function to its derivative\r\ndef sigmoid_output_to_derivative(output):\r\n    return output*(1-output)\r\n\r\ndef clean_up_sentence(sentence):\r\n    # tokenize the pattern\r\n    sentence_words = nltk.word_tokenize(sentence)\r\n    # stem each word\r\n    sentence_words = [stemmer.stem(word.lower()) for word in sentence_words]\r\n    return sentence_words\r\n\r\n# return bag of words array: 0 or 1 for each word in the bag that exists in the sentence\r\ndef bow(sentence, words, show_details=False):\r\n    # tokenize the pattern\r\n    sentence_words = clean_up_sentence(sentence)\r\n    # bag of words\r\n    bag = [0]*len(words)  \r\n    for s in sentence_words:\r\n        for i,w in enumerate(words):\r\n            if w == s: \r\n                bag[i] = 1\r\n                if show_details:\r\n                    print (\"found in bag: %s\" % w)\r\n\r\n    return(np.array(bag))\r\n\r\ndef think(sentence, show_details=False):\r\n    x = bow(sentence.lower(), words, show_details)\r\n    if show_details:\r\n        print (\"sentence:\", sentence, \"n bow:\", x)\r\n    # input layer is our bag of words\r\n    l0 = x\r\n    # matrix multiplication of input and hidden layer\r\n    l1 = sigmoid(np.dot(l0, synapse_0))\r\n    # output layer\r\n    l2 = sigmoid(np.dot(l1, synapse_1))\r\n    return l2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec57245433819-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec57245433819-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec57245433819-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec57245433819-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec57245433819-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec57245433819-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec57245433819-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec57245433819-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec57245433819-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec57245433819-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec57245433819-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec57245433819-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec57245433819-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec57245433819-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec57245433819-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec57245433819-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec57245433819-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec57245433819-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec57245433819-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec57245433819-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec57245433819-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec57245433819-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec57245433819-45\">45</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">numpy </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">np</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec57245433819-2\"><span class=\"crayon-e\">import </span><span class=\"crayon-v\">time</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec57245433819-4\"><span class=\"crayon-p\"># compute sigmoid nonlinearity</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-5\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">sigmoid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec57245433819-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">output</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">exp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">output</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec57245433819-8\"> </div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-9\"><span class=\"crayon-p\"># convert output of sigmoid function to its derivative</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec57245433819-10\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">sigmoid_output_to_derivative</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">output</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">output*</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">output</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec57245433819-12\"> </div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-13\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">clean_up_sentence</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec57245433819-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># tokenize the pattern</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sentence_words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nltk</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">word_tokenize</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec57245433819-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># stem each word</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sentence_words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">stemmer</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">stem</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">word</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">word</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sentence_words</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec57245433819-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sentence_words</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec57245433819-20\"><span class=\"crayon-p\"># return bag of words array: 0 or 1 for each word in the bag that exists in the sentence</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-21\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">bow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec57245433819-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># tokenize the pattern</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sentence_words</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">clean_up_sentence</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec57245433819-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># bag of words</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">bag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">*</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec57245433819-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sentence_words</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">enumerate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec57245433819-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-29\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">bag</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec57245433819-30\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-31\"><span class=\"crayon-h\">                    </span><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"found in bag: %s\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">w</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec57245433819-32\"> </div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">bag</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec57245433819-34\"> </div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-35\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">think</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec57245433819-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bow</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">words</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-37\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec57245433819-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"sentence:\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"n bow:\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># input layer is our bag of words</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec57245433819-40\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">l0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-41\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># matrix multiplication of input and hidden layer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec57245433819-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">l1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sigmoid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">l0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">synapse_0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># output layer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec57245433819-44\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">l2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sigmoid</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dot</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">l1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">synapse_1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec57245433819-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0083 seconds] -->\r\n<p>现在我们对神经网络训练函数进行编码，创造连接权重。别太激动，这主要是矩阵乘法——来自中学数学课堂。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/02/e0e648def4862d31563d98fa1d9e60a4.jpg\"><img class=\"alignnone size-medium wp-image-64665 aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/02/e0e648def4862d31563d98fa1d9e60a4.jpg\" alt=\"2017-06-03_151025\"></a></p>\n<p>我们现在准备去构建我们的神经网络<em>模型</em>，我们将连接权重保存为json文件。</p>\n<p>你应该尝试不同的“α”（梯度下降参数），看看它是如何影响错误率。此参数有助于错误调整，并找到最低错误率：</p>\n<p>synapse_0 += <strong>alpha</strong> * synapse_0_weight_update</p>\n<p style=\"text-align: center;\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/41e84709aaf122cd41527923403b8e99.png\"><img class=\"alignnone size-full wp-image-112156\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/41e84709aaf122cd41527923403b8e99.png\" alt=\"1-HZ-YQpdBM4hDbh4Q5FcsMA\"></a></p>\n<p>我们在隐藏层使用了20个神经元，你可以很容易地调整。这些参数将随着于您的训练数据规模的不同而不同，将错误率调整到低于10 ^ – 3是比较合理的。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc413ec5c667404188\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nX = np.array(training)\r\ny = np.array(output)\r\n\r\nstart_time = time.time()\r\n\r\ntrain(X, y, hidden_neurons=20, alpha=0.1, epochs=100000, dropout=False, dropout_percent=0.2)\r\n\r\nelapsed_time = time.time() - start_time\r\nprint (\"processing time:\", elapsed_time, \"seconds\")</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec5c667404188-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec5c667404188-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec5c667404188-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec5c667404188-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec5c667404188-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec5c667404188-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec5c667404188-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec5c667404188-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec5c667404188-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc413ec5c667404188-1\"><span class=\"crayon-v\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">training</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec5c667404188-2\"><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">output</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec5c667404188-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec5c667404188-4\"><span class=\"crayon-v\">start_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec5c667404188-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec5c667404188-6\"><span class=\"crayon-e\">train</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">X</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hidden_neurons</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">20</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">alpha</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">epochs</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">100000</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dropout</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dropout_percent</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec5c667404188-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec5c667404188-8\"><span class=\"crayon-v\">elapsed_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">start_time</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec5c667404188-9\"><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"processing time:\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">elapsed_time</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"seconds\"</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc413ec60964426000\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nTraining with 20 neurons, alpha:0.1, dropout:False \r\nInput matrix: 12x26    Output matrix: 1x3\r\ndelta after 10000 iterations:0.0062613597435\r\ndelta after 20000 iterations:0.00428296074919\r\ndelta after 30000 iterations:0.00343930779307\r\ndelta after 40000 iterations:0.00294648034566\r\ndelta after 50000 iterations:0.00261467859609\r\ndelta after 60000 iterations:0.00237219554105\r\ndelta after 70000 iterations:0.00218521899378\r\ndelta after 80000 iterations:0.00203547284581\r\ndelta after 90000 iterations:0.00191211022401\r\ndelta after 100000 iterations:0.00180823798397\r\nsaved synapses to: synapses.json\r\nprocessing time: 6.501226902008057 seconds</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec60964426000-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec60964426000-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec60964426000-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec60964426000-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec60964426000-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec60964426000-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec60964426000-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec60964426000-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec60964426000-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec60964426000-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec60964426000-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec60964426000-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec60964426000-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec60964426000-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc413ec60964426000-1\"><span class=\"crayon-e\">Training </span><span class=\"crayon-i\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">neurons</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">alpha</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dropout</span><span class=\"crayon-o\">:</span><span class=\"crayon-t\">False</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec60964426000-2\"><span class=\"crayon-e\">Input </span><span class=\"crayon-v\">matrix</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12x26</span><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Output </span><span class=\"crayon-v\">matrix</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1x3</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec60964426000-3\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.0062613597435</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec60964426000-4\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00428296074919</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec60964426000-5\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00343930779307</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec60964426000-6\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00294648034566</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec60964426000-7\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">50000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00261467859609</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec60964426000-8\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">60000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00237219554105</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec60964426000-9\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">70000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00218521899378</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec60964426000-10\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00203547284581</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec60964426000-11\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">90000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00191211022401</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec60964426000-12\"><span class=\"crayon-e\">delta </span><span class=\"crayon-i\">after</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100000</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">iterations</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0.00180823798397</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec60964426000-13\"><span class=\"crayon-e\">saved </span><span class=\"crayon-e\">synapses </span><span class=\"crayon-st\">to</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">synapses</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">json</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec60964426000-14\"><span class=\"crayon-e\">processing </span><span class=\"crayon-v\">time</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6.501226902008057</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">seconds</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0051 seconds] -->\r\n<p>synapse.json文件中包含了全部的连接权重，<strong>这就是我们的模型</strong>。</p>\n<p style=\"text-align: center;\"><a href=\"http://jbcdn2.b0.upaiyun.com/2017/08/8b07f3b20cfc25210fcad980aebab930.jpeg\"><img class=\"alignnone size-full wp-image-112157\" src=\"http://jbcdn2.b0.upaiyun.com/2017/08/8b07f3b20cfc25210fcad980aebab930.jpeg\" alt=\"1-qYkCgPE3DD26VD-qDwsicA\"></a></p>\n<p>一旦连接权重已经计算完成，对于分类来说只需要classify()函数了：大约15行代码</p>\n<p>备注：如果训练集有变化，我们的模型需要重新计算。对于非常大的数据集，这需要较长的时间。</p>\n<p>现在我们可以生成一个句子属于一个或者多个分类的概率了。它的速度非常快，这是因为我们之前定义的think()函数中的点积运算。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc413ec64500596003\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# probability threshold\r\nERROR_THRESHOLD = 0.2\r\n# load our calculated synapse values\r\nsynapse_file = 'synapses.json' \r\nwith open(synapse_file) as data_file: \r\n    synapse = json.load(data_file) \r\n    synapse_0 = np.asarray(synapse['synapse0']) \r\n    synapse_1 = np.asarray(synapse['synapse1'])\r\n\r\ndef classify(sentence, show_details=False):\r\n    results = think(sentence, show_details)\r\n\r\n    results = [[i,r] for i,r in enumerate(results) if r&gt;ERROR_THRESHOLD ] \r\n    results.sort(key=lambda x: x[1], reverse=True) \r\n    return_results =[[classes[r[0]],r[1]] for r in results]\r\n    print (\"%s n classification: %s\" % (sentence, return_results))\r\n    return return_results\r\n\r\nclassify(\"sudo make me a sandwich\")\r\nclassify(\"how are you today?\")\r\nclassify(\"talk to you tomorrow\")\r\nclassify(\"who are you?\")\r\nclassify(\"make me some lunch\")\r\nclassify(\"how was your lunch today?\")\r\nprint()\r\nclassify(\"good day\", show_details=True)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec64500596003-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec64500596003-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec64500596003-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec64500596003-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec64500596003-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec64500596003-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec64500596003-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec64500596003-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec64500596003-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec64500596003-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec64500596003-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec64500596003-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec64500596003-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec64500596003-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec64500596003-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec64500596003-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec64500596003-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec64500596003-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec64500596003-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec64500596003-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec64500596003-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec64500596003-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec64500596003-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec64500596003-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec64500596003-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec64500596003-26\">26</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc413ec64500596003-1\"><span class=\"crayon-p\"># probability threshold</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec64500596003-2\"><span class=\"crayon-v\">ERROR_THRESHOLD</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.2</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec64500596003-3\"><span class=\"crayon-p\"># load our calculated synapse values</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec64500596003-4\"><span class=\"crayon-v\">synapse_file</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'synapses.json'</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec64500596003-5\"><span class=\"crayon-e\">with </span><span class=\"crayon-e\">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">synapse_file</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data_file</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec64500596003-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">synapse</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">json</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">load</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data_file</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec64500596003-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">synapse_0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">asarray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">synapse</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'synapse0'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec64500596003-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">synapse_1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">asarray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">synapse</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'synapse1'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec64500596003-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec64500596003-10\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec64500596003-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">results</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">think</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec64500596003-12\"> </div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec64500596003-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">results</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">enumerate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-v\">ERROR</span><span class=\"crayon-sy\">_</span>THRESHOLD<span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec64500596003-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reverse</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec64500596003-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">return_results</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">classes</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">results</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec64500596003-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"%s n classification: %s\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sentence</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">return_results</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec64500596003-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">return_results</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec64500596003-18\"> </div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec64500596003-19\"><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"sudo make me a sandwich\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec64500596003-20\"><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"how are you today?\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec64500596003-21\"><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"talk to you tomorrow\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec64500596003-22\"><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"who are you?\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec64500596003-23\"><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"make me some lunch\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec64500596003-24\"><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"how was your lunch today?\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec64500596003-25\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec64500596003-26\"><span class=\"crayon-e\">classify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"good day\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">show_details</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0080 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc413ec69559941671\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;strong&gt;sudo make me a sandwich &lt;/strong&gt;\r\n [['sandwich', 0.99917711814437993]]\r\n&lt;strong&gt;how are you today? &lt;/strong&gt;\r\n [['greeting', 0.99864563257858363]]\r\n&lt;strong&gt;talk to you tomorrow &lt;/strong&gt;\r\n [['goodbye', 0.95647479275905511]]\r\n&lt;strong&gt;who are you? &lt;/strong&gt;\r\n [['greeting', 0.8964283843977312]]\r\n&lt;strong&gt;make me some lunch&lt;/strong&gt; \r\n [['sandwich', 0.95371924052636048]]\r\n&lt;strong&gt;how was your lunch today? &lt;/strong&gt;\r\n [['greeting', 0.99120883810944971], ['sandwich', 0.31626066870883057]]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec69559941671-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec69559941671-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec69559941671-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec69559941671-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec69559941671-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec69559941671-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec69559941671-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec69559941671-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec69559941671-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec69559941671-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec69559941671-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec69559941671-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc413ec69559941671-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">make </span><span class=\"crayon-i\">me</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sandwich</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec69559941671-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'sandwich'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.99917711814437993</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec69559941671-3\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">how </span><span class=\"crayon-e\">are </span><span class=\"crayon-e\">you </span><span class=\"crayon-v\">today</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec69559941671-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'greeting'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.99864563257858363</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec69559941671-5\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">talk </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">you </span><span class=\"crayon-v\">tomorrow</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec69559941671-6\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'goodbye'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.95647479275905511</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec69559941671-7\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">who </span><span class=\"crayon-e\">are </span><span class=\"crayon-v\">you</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec69559941671-8\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'greeting'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.8964283843977312</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec69559941671-9\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">make </span><span class=\"crayon-e\">me </span><span class=\"crayon-e\">some </span><span class=\"crayon-v\">lunch</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec69559941671-10\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'sandwich'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.95371924052636048</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec69559941671-11\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">how </span><span class=\"crayon-e\">was </span><span class=\"crayon-e\">your </span><span class=\"crayon-e\">lunch </span><span class=\"crayon-v\">today</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">strong</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec69559941671-12\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'greeting'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.99120883810944971</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'sandwich'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.31626066870883057</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0053 seconds] -->\r\n<p>你可以用其它语句、不同概率来试验几次，也可以添加训练数据来改进／扩展当前的模型。尤其注意用很少的训练数据就得到稳定的预测结果。</p>\n<p>有一些句子将会产生多个预测结果（高于阈值）。你需要给你的程序设定一个合适的阈值。并非所有的文本分类方案都是相同的：<em>一些预测情况比其他预测需要更高的置信水平</em>。</p>\n<p>最后这个分类结果展示了一些内部的细节：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc413ec6d141964175\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfound in bag: good\r\nfound in bag: day\r\nsentence: **good day** \r\n bow: [0 0 0 0 0 0 1 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\r\ngood day \r\n [['greeting', 0.99664077655648697]]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec6d141964175-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec6d141964175-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec6d141964175-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec6d141964175-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec6d141964175-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec6d141964175-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc413ec6d141964175-1\"><span class=\"crayon-e\">found </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bag</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">good</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec6d141964175-2\"><span class=\"crayon-e\">found </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bag</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">day</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec6d141964175-3\"><span class=\"crayon-v\">sentence</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-e\">good </span><span class=\"crayon-e \">day*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec6d141964175-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bow</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec6d141964175-5\"><span class=\"crayon-e\">good </span><span class=\"crayon-i\">day</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec6d141964175-6\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'greeting'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.99664077655648697</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n<p>从这个句子的词包中可以看到，有两个单词和我们的词库是匹配的。同时我们的神经网络从这些 0 代表的非匹配词语中学习了。</p>\n<p>如果提供一个仅仅有一个常用单词 ‘a’ 被匹配的句子，那我们会得到一个低概率的分类结果A：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc413ec71963461884\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfound in bag: a\r\nsentence: **a burrito! **\r\n bow: [0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\r\na burrito! \r\n [['sandwich', 0.61776860634647834]]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec71963461884-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec71963461884-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec71963461884-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc413ec71963461884-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc413ec71963461884-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc413ec71963461884-1\"><span class=\"crayon-e\">found </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bag</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec71963461884-2\"><span class=\"crayon-v\">sentence</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">burrito</span><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec71963461884-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bow</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc413ec71963461884-4\"><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">burrito</span><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9cc413ec71963461884-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'sandwich'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.61776860634647834</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p>现在你已经掌握了构建聊天机器人的一些基础知识结构，它能处理大量不同的意图，并且对于有限或者海量的训练数据都能很好的适配。想要为某个意图添加一个或者多个响应实在轻而易举，就不必多讲了。</p>\n<h4>Enjoy!</h4>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/9d1537dc33c0a291a88e68a8d61b1cd2.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/ac2801b765615f93574f10b0ac15990b.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112049\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112049votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112049\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/2106382253\">Anne90</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/2106382253\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/04/ee02ba031bee9222a2878fe9565d65a6.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            软件开发测试工程师，关注互联网/软件测试相关        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/2106382253\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/2106382253/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/2106382253/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 12</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/2106382253\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "ss：查看网络连接的另一种方法", "url": "http://blog.jobbole.com/112061/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/149000d5c8b1bb08b8de6914ed749f28.gif"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://insights.ubuntu.com/2017/07/25/ss-another-way-to-get-socket-statistics/\">Mathieu Trudel-lapierre</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8727-1.html\">Linux中国/Vic020</a>   </div><p>在之前的文章中，我提到过 <code>ss</code>，它是 iproute2 包附带的另一个工具，允许你查询 socket 的有关统计信息。可以完成 <code>netstat</code> 同样的任务，但是，<code>ss</code> 稍微快一点而且命令更简短。</p>\n<p>直接输入 <code>ss</code>，默认会显示与 <code>netstat</code> 同样的内容，并且输入类似的参数可以获取你想要的类似输出。例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d14a4df35992984436\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ss -t\r\nState       Recv-Q Send-Q       Local Address:Port                        Peer Address:Port\r\nESTAB       0      0                127.0.0.1:postgresql                     127.0.0.1:48154\r\nESTAB       0      0            192.168.0.136:35296                      192.168.0.120:8009\r\nESTAB       0      0            192.168.0.136:47574                     173.194.74.189:https\r\n[…]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d14a4df35992984436-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d14a4df35992984436-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d14a4df35992984436-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d14a4df35992984436-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d14a4df35992984436-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d14a4df35992984436-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d14a4df35992984436-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ss</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">t</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d14a4df35992984436-2\"><span class=\"crayon-i\">State</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-v\">Recv</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Send</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">Local </span><span class=\"crayon-v\">Address</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">Port</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-e\">Peer </span><span class=\"crayon-v\">Address</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">Port</span></div><div class=\"crayon-line\" id=\"crayon-59b9d14a4df35992984436-3\"><span class=\"crayon-i\">ESTAB</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">postgresql</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">48154</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d14a4df35992984436-4\"><span class=\"crayon-i\">ESTAB</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">192.168.0.136</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">35296</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">192.168.0.120</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8009</span></div><div class=\"crayon-line\" id=\"crayon-59b9d14a4df35992984436-5\"><span class=\"crayon-i\">ESTAB</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">192.168.0.136</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">47574</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">173.194.74.189</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">https</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d14a4df35992984436-6\"><span class=\"crayon-sy\">[</span>…<span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p><code>ss -t</code> 只显示 TCP 连接。<code>ss -u</code> 用于显示 UDP 连接，<code>-l</code> 参数只会显示监听的端口，而且可以进一步过滤到任何想要的信息。</p>\n<p>我并没有测试所有可用参数，但是你甚至可以使用 <code>-K</code> 强制关闭 socket。</p>\n<p><code>ss</code> 真正耀眼的地方是其内置的过滤能力。让我们列出所有端口为 22（ssh）的连接：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d14a4df46912345358\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ss state all sport = :ssh\r\nNetid State      Recv-Q Send-Q     Local Address:Port                      Peer Address:Port\r\ntcp   LISTEN     0      128                    *:ssh                                  *:*\r\ntcp   ESTAB      0      0          192.168.0.136:ssh                      192.168.0.102:46540\r\ntcp   LISTEN     0      128                   :::ssh                                 :::*</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d14a4df46912345358-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d14a4df46912345358-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d14a4df46912345358-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d14a4df46912345358-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d14a4df46912345358-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d14a4df46912345358-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ss </span><span class=\"crayon-e\">state </span><span class=\"crayon-e\">all </span><span class=\"crayon-v\">sport</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">ssh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d14a4df46912345358-2\"><span class=\"crayon-e\">Netid </span><span class=\"crayon-i\">State</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-v\">Recv</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Send</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">Local </span><span class=\"crayon-v\">Address</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">Port</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-e\">Peer </span><span class=\"crayon-v\">Address</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">Port</span></div><div class=\"crayon-line\" id=\"crayon-59b9d14a4df46912345358-3\"><span class=\"crayon-i\">tcp</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-i\">LISTEN</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">128</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-o\">*</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">ssh</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-o\">*</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">*</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d14a4df46912345358-4\"><span class=\"crayon-i\">tcp</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-i\">ESTAB</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">192.168.0.136</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">ssh</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">192.168.0.102</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">46540</span></div><div class=\"crayon-line\" id=\"crayon-59b9d14a4df46912345358-5\"><span class=\"crayon-i\">tcp</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-i\">LISTEN</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">128</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-o\">::</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">ssh</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-o\">::</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">*</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0040 seconds] -->\r\n<p>如果只想看已建立的 socket（排除了 <em>listening</em> 和 <em>closed</em> ）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d14a4df4b541603671\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ss state connected sport = :ssh\r\nNetid State      Recv-Q Send-Q     Local Address:Port                      Peer Address:Port\r\ntcp   ESTAB      0      0          192.168.0.136:ssh                      192.168.0.102:46540</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d14a4df4b541603671-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d14a4df4b541603671-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d14a4df4b541603671-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d14a4df4b541603671-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ss </span><span class=\"crayon-e\">state </span><span class=\"crayon-e\">connected </span><span class=\"crayon-v\">sport</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">ssh</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d14a4df4b541603671-2\"><span class=\"crayon-e\">Netid </span><span class=\"crayon-i\">State</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-v\">Recv</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Send</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">Local </span><span class=\"crayon-v\">Address</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">Port</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-e\">Peer </span><span class=\"crayon-v\">Address</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">Port</span></div><div class=\"crayon-line\" id=\"crayon-59b9d14a4df4b541603671-3\"><span class=\"crayon-i\">tcp</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-i\">ESTAB</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">192.168.0.136</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">ssh</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">192.168.0.102</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">46540</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>类似的，可以列出指定的 host 或者 ip 段。例如，列出到达 74.125.0.0/16 子网的连接，这个子网属于 Google：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d14a4df4e204732692\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ss state all dst 74.125.0.0/16\r\nNetid State      Recv-Q Send-Q     Local Address:Port                      Peer Address:Port\r\ntcp   ESTAB      0      0          192.168.0.136:33616                   74.125.142.189:https\r\ntcp   ESTAB      0      0          192.168.0.136:42034                    74.125.70.189:https\r\ntcp   ESTAB      0      0          192.168.0.136:57408                   74.125.202.189:https</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d14a4df4e204732692-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d14a4df4e204732692-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d14a4df4e204732692-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d14a4df4e204732692-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d14a4df4e204732692-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d14a4df4e204732692-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ss </span><span class=\"crayon-e\">state </span><span class=\"crayon-e\">all </span><span class=\"crayon-i\">dst</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">74.125.0.0</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">16</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d14a4df4e204732692-2\"><span class=\"crayon-e\">Netid </span><span class=\"crayon-i\">State</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-v\">Recv</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Send</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">Local </span><span class=\"crayon-v\">Address</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">Port</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-e\">Peer </span><span class=\"crayon-v\">Address</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">Port</span></div><div class=\"crayon-line\" id=\"crayon-59b9d14a4df4e204732692-3\"><span class=\"crayon-i\">tcp</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-i\">ESTAB</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">192.168.0.136</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">33616</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">74.125.142.189</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">https</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d14a4df4e204732692-4\"><span class=\"crayon-i\">tcp</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-i\">ESTAB</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">192.168.0.136</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">42034</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">74.125.70.189</span><span class=\"crayon-o\">:</span><span class=\"crayon-e\">https</span></div><div class=\"crayon-line\" id=\"crayon-59b9d14a4df4e204732692-5\"><span class=\"crayon-i\">tcp</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-i\">ESTAB</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-cn\">192.168.0.136</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">57408</span><span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-cn\">74.125.202.189</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">https</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0092 seconds] -->\r\n<p><code>ss</code>与 iptables 的语法非常相同，如果已经熟悉了其语法，<code>ss</code> 非常容易上手。也可以安装 iproute2-doc 包， 通过 <code>/usr/share/doc/iproute2-doc/ss.html</code> 获得完整文档。</p>\n<p>还不快试试! 你就可以知道它有多棒。无论如何，让我输入的字符越少我越高兴。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112061\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112061votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112061\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "Neo4j 图数据库基础", "url": "http://blog.jobbole.com/112064/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/03/database-logo.png"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/7/fundamentals-graph-databases-neo4j\">Ruth Holloway</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8728-1.html\">Linux中国/geekpi</a>   </div><blockquote><p>在这个三篇系列文章的第一篇文章中，我们将学习图数据库（graph database）的基础知识，它支持了这地球上最大的一些数据池。</p></blockquote>\n<p>对于海量的各种非结构化信息来说，图数据库已经成为帮助收集、管理和搜索大量数据的技术。在这三篇系列文章中，我们将使用开源图数据库软件 Neo4j 来研究图数据库。</p>\n<p>在本文中，我将向你展示图数据库的基础知识，帮助你快速了解概念模型。在第二篇中，我将向你展示如何启动 Neo4j 数据库，并使用内置的浏览器工具填充一些数据。而且，在本系列的最后一篇文章中，我们将探讨一些在开发工作中使用的 Neo4j 编程库。</p>\n<p>掌握图数据库的概念模型是有用的，所以我们从那里开始。图数据库中只存储两种数据：节点node和边edge。</p>\n<ul>\n<li><strong>节点是实体：</strong>诸如人物、发票、电影、书籍或其他具体事物。这些有些等同于关系数据库中的记录或行。</li>\n<li><strong>边名关系：</strong>连接节点的概念、事件或事物。在关系数据库中，这些关系通常存储在具有链接字段的数据库行中。在图数据库中，它们本身就是有用的，是可以以其自己的权限搜索的对象。</li>\n</ul>\n<p>节点和边都可以拥有可搜索的<em>属性</em>。例如，如果你的节点代表人，他们可能拥有名字、性别、出生日期、身高等属性。而边的属性可能描述了两个人之间的关系何时建立，见面的情况或关系的性质。</p>\n<p>这是一个帮助你可视化的图表：</p>\n<p><img class=\"aligncenter\" title=\"Graph database image 1\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/61f03ca246db79a877365543604ae7de.jpg\" alt=\"Graph database image 1\"></p>\n<p>在这张图中，你知道 Jane Doe 有一个新的丈夫 John；一个女儿（来自她以前的夫妻关系）Mary Smith 和朋友 Robert 和 Rhonda Roe。Roes 有一个儿子 Ryan，他正在与 Mary Smith 约会。</p>\n<p>看看它怎么工作？每个节点代表一个独立于其他节点的人。你需要找到关于<em>那个</em>人的一切都可以存储在节点的属性中。边描述了人们之间的关系，这与你在程序中需要的一样多。</p>\n<p>关系是单向的，且不能是无向的，但这没有问题。由于数据库可以以相同的速度遍历两个方向，并且方向可以忽略，你只需要定义一次此关系。如果你的程序需要定向关系，则可以自由使用它们，但如果双向性是暗含的，则不需要。</p>\n<p>另外需要注意的是，图数据库本质上是无 schema 的。这与关系数据库不同，关系数据库每行都有一组列表，并且添加新的字段会给开发和升级带来很多工作。</p>\n<p>每个节点都可以拥有一个标签label；对于大多数程序你需要“输入”这个标签，是对典型的关系数据库中的表名的模拟。标签可以让你区分不同的节点类型。如果你需要添加新的标签或属性，修改程序来用它就行！</p>\n<p>使用图数据库，你可以直接开始使用新的属性和标签，节点将在创建或编辑时获取它们。不需要转换东西；只需在你的代码中使用它们即可。在这里的例子中，你可以看到，我们知道 Jane 和 Mary 最喜欢的颜色和 Mary 的出生日期，但是别人没有（这些属性）。这个系统不需要知道它；用户可以在正常使用程序的过程中访问节点时为其添加信息（属性）。</p>\n<p>作为一名开发人员，这是一个有用的特性。你可以将新的标签或属性添加到由节点处理的表单中并开始使用它，而不必进行数据库 schema 的修改。对于没有该属性的节点，将不显示任何内容。你可以使用任何一种类型的数据库来为表单进行编码，但是你可以放下在关系型数据库中要进行的许多后端工作了。</p>\n<p>让我们添加一些新的信息：</p>\n<p><img class=\"aligncenter\" title=\"Graph database image 2, defining a new type of node\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/5362edb32fd33fc06def8b3a179b978a.jpg\" alt=\"Graph database image 2, defining a new type of node\"></p>\n<p>这是一个新的节点类型，它代表一个位置，以及一些相关关系。现在我们看到 John Doe 出生在加利福尼亚州的 Petaluma，而他的妻子 Jane 则出生在德克萨斯州的 Grand Prairie。 他们现在住在得克萨斯州的赛普拉斯，因为 Jane 在附近的休斯顿工作。Ryan Roe 缺乏城市关系对数据库来说没有什么大不了的事情，我们<em>不知道</em>那些信息而已。当用户输入更多数据时，数据库可以轻松获取新数据并添加新数据，并根据需要创建新的节点和关系。</p>\n<p>了解节点和边应该足以让你开始使用图形数据库。如果你像我一样，已经在考虑如何在一个图中重组你的程序。在本系列的下一篇文章中，我将向你展示如何安装 Neo4j、插入数据，并进行一些基本的搜索。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112064\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112064votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112064\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "优秀的程序员都有哪些习惯？", "url": "http://blog.jobbole.com/112067/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/11/68569d6253986872f6d708b3c9fb1426.jpeg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 2, "tags": "开发,程序员", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/qingfeng6438\">阿慧</a> 翻译，<a href=\"http://www.jobbole.com/members/young605867996\">Lada</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://news.ycombinator.com/item?id=14709076\">nostrademons</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【伯乐在线导读】：「我不是卓越的程序员，我只不过是一个有着卓越习惯的程序员。」技术大牛 Kent Beck 曾这样说过自己。</p>\n<p>7月初，nostrademons 在 Hacker News 发起一个讨论，是哪些习惯成就了优秀/卓越的程序员？</p>\n<hr>\n<p>可变的习惯：学习着在不同的情况中采用不同的习惯。考虑到这一点，我总结了一些适用于不同情况的通用技巧：</p>\n<h3>为了数据科学类问题研究新领域的发展：</h3>\n<p>1.尽量亲自动手去完成事情。你将会有一种直觉，知道如何去处理该事物。</p>\n<p>2.积累案例，从数据表中标注着你已获得的数据开始。</p>\n<p style=\"padding-left: 30px;\"><span style=\"color: #999999;\">（关于这一点：rluhar 评论补充说，这不仅适用于数据科学，也适用于解决任何数值问题。用一个电子表格（或一个R／Python Notebook）来实现算法并获得一些结果，在过去帮助我真正理解了问题，避免走死胡同。例如，在建立一个外汇定价系统时，我能够使用电子表格来描述定价算法是如何工作的，并向交易者（最终用户）解释它。在执行和部署算法之前，我们可以调整计算并确保一切都清楚。很好的建议！）</span></p>\n<p>3.在找到通用办法之前，先找到一种能解决当前问题的办法。</p>\n<p>4.让算法本身输出调试信息。你应该能够转储每一步的中间结果，并用文本编辑器或是 Web 浏览器手动检查它们。</p>\n<p>5.不要为单元测试操心，定义出正确行为才是首要的。</p>\n<h3>维护大的、不熟悉的代码库程序：</h3>\n<p>1.检查文件的大小。最大的文件总是包含了程序的实体部分，至少是指向程序实体内容的分派程序。 main.cc  通常很小，并且对寻找代码结构毫无用处。</p>\n<p>2.从主循环调度开始单步调试程序。可以学到很多关于控制流的东西。</p>\n<p>3.寻找数据结构，特别是做为参数传递到许多函数中的那些。大多数程序具有一个小的关键数据结构集合，找到它们，理解代码的其余部分会变得容易的多。</p>\n<p>4.写单元测试。这是确认你所理解的代码与真实代码工作方式无误的最好方法。</p>\n<p>5.移除代码，看看什么出问题了。（但不要 check in！）</p>\n<h3>性能工作：</h3>\n<p>0.一般不需要做，除非你所构建的东西对用户来说太慢了。制定出需要提高的性能目标，达成这个目标即可。</p>\n<p>1.在开始所有工作之前，甚至是在剖析（profile）之前，建立一套代表典型现实世界的使用基准。别让性能倒退，除非你确信已经登峰造极，高处不胜寒，并且更好的解决方法还藏在世界的某个角落里无人发现（如果出现了那种情况，在版本控制系统（VCS）中标记你的分支，以便在发现错误之后回来更改。）。</p>\n<p>2.许多性能瓶颈都出现在系统的交叉处。在所有 RPC 框架中搜集时间统计数据，并且有一些方式来传播和可视化每个服务器的请求时间，以及哪些部分的请求是并行的，哪里是关键路径。</p>\n<p>3.剖析（Profile）。</p>\n<p>4.通常，避免不必要的工作可使你赢在起跑线上。缓存最大的计算结果，粗略评估不常用的东西。</p>\n<p>5.不要忽视常量因素。有时候一个渐进性更差的算法在实践中执行的很好，原因是其具有更好的缓存局部性。为此，你可以在多次调用的函数中识别出威胁。</p>\n<p>6.当你获得了程序大致剖析之后，更改数据结构往往会获得更多收益。注意内存的使用，时常缩小内存需求来减小缓存压力，可显著地提高系统的速度。注意局部性，将常用数据放到一起。如果你的编程语言允许（为 Java 感到遗憾 ），可以消除指针雕镂（pointer-chasing）来支持值控制。</p>\n<blockquote><p>译注：指针雕镂（Pointer-chasing）程序：该程序中会遍历一个由指针链在一起的数据结构，即一个链表。但是在遍历的过程中会不断的引起内存操作。因为下一个元素总不在 Cache 中。</p></blockquote>\n<h3>编码常规</h3>\n<p>1.不要想当然地去构建，确保你所加入的每个特性都有客户在用。</p>\n<p>2.谨慎地控制依赖。为了某个效果而引入的库，可能会帮你节省一个小时，但也会导致更多地方被破坏——部署、版本控制、安全性、日志记录、意外的进程死亡。</p>\n<p>3.当为个人或小团体开发的时候，把出现的问题累积起来，然后一次性全部解决（或者扔掉代码库，然后重新启动）。当为大型团队开发时，永远都不要让问题堆积，代码库应该始终处于新的开发人员可以看懂的状态，他们会说：“我知道这是做什么的，也知道如何更改它”（代码的）阅读者/编写者的比例结果是这样的：初始代码的编写多过阅读，因此可读性不那么重要，但成熟代码的阅读多过编写。（当你要求开发前一种初始代码去获得用户、资金和存活了，转换到后一种成熟代码中去就是给阅读者留下的操练了。）</p>\n<p> </p>\n<p>欢迎大家补充。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2017/02/f9e94e087837b17681c87206c9d540dd.png\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2017/02/748ed21a8038cdafa65b3b4ab9a0185a.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112067\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112067votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112067\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/qingfeng6438\">阿慧</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/qingfeng6438\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/02/c169e93746e89947e9a2f0fce3f937cc.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            什么东西没头没尾没中间？        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/qingfeng6438\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/qingfeng6438/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/qingfeng6438/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 14</a> · <a title=\"QQ：1305735677\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：chenahui1996\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "小王子之程序员版", "url": "http://blog.jobbole.com/111959/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/06/3b102356e4b2e8b92940143a3a70bed0.png"], "praise_nums": "6", "comment_nums": 5, "fav_nums": 12, "tags": "职场,程序员", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/huangxiaofei\">黄小非</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://ferd.ca/the-little-printf.html\">Fred Hebert</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【伯乐在线提示】：本文较长，Fred Hebert 仿照《小王子》小说，写了一个小程序员在学习软件开发中的各种历险，分了 11 个小故事。正如读者 lei 的评论所言：所有程序员都是文中这些人的缩影。</p>\n<p>补充：《小王子》是法国作家安托万·德·圣·埃克苏佩里于 1942 年写成的著名儿童文学短篇小说。本书的主人公是来自外星球的小王子。书中以一位飞行员作为故事叙述者，讲述了小王子从自己星球出发前往地球的过程中，所经历的各种历险。</p>\n<p> </p>\n<p> </p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/3b102356e4b2e8b92940143a3a70bed0.png\"><img class=\"aligncenter size-full wp-image-65334\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/3b102356e4b2e8b92940143a3a70bed0.png\" alt=\"printf-nocover\" width=\"387\" height=\"424\"></a></p>\n<h3>第 0 章</h3>\n<p>我出生在电子游戏和电脑泛滥年代之前。所以我还算幸运，有足够的时间和我哥，还有小伙伴们一起做户外运动，还发明我们自己的游戏。</p>\n<p>我们自己扮演英雄，拿着一根树枝，我们就能瞬间把它想象成弓、剑、枪，甚至是望远镜，当然也可以是任何其他东西。哦，对了，唯一的例外就是你不能把它想象成回旋镖，因为真的回旋镖扔出去是会自己飞回来的，但是树枝扔出去了，你要自己去捡回来。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/f0a415ae533c3befdffdf1b417a054ae.png\"><img class=\"aligncenter size-full wp-image-65343\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/f0a415ae533c3befdffdf1b417a054ae.png\" alt=\"boomerang\" width=\"356\" height=\"230\"></a></p>\n<p>后来我们就长大了，再这么玩就有些尴尬了。要知道，在孩子们开始觉得大人的世界很精彩的阶段，你要是再玩那些把松果想象成魔法手榴弹的游戏，这就很不合群了。迟早你要面对成长的烦恼。不过，能有一个完整的童年还是很幸运。</p>\n<p>后来我就开始学会玩电子游戏了，当然也开始使用电脑。电子游戏的世界可绝对是你梦寐以求的世界，因为它能把你想象中的东西在你面前实现出来。玩游戏很消耗时间，但是它绝对会让你体验到不同的人生。</p>\n<p>不过对于电子游戏来说，有一个特点：那就是你不负责创造，你只负责响应和付出时间。我长到青少年的岁数，还当过即兴表演的演员。所以说，无论是与人相处，还是装作旁若无人，这对我都不是问题。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/c0d8cbc8c759f27640821750644a554c.png\"><img class=\"aligncenter size-full wp-image-65339\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/c0d8cbc8c759f27640821750644a554c.png\" alt=\"improv\" width=\"360\" height=\"289\"></a></p>\n<p>当然，在魁北克做即兴表演还是有点儿不同寻常，因为我们是在溜冰场地上表演——你知道冰球在加拿大多火吗。</p>\n<p>后来我去了职业学校学习多媒体，大概是 2005 年到 2008 年这个时段，我终究还是要做些编程的事情。不过我发现编程是个有意思的事情！我又感觉到了创造性！并且我还能靠这个赚钱！于是我设计了我的第一套游戏，这可让我受益匪浅。<a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/2f5fe97ea19c4f50e42da989f216c5ea.png\"><img class=\"aligncenter size-full wp-image-65337\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/2f5fe97ea19c4f50e42da989f216c5ea.png\" alt=\"game\" width=\"472\" height=\"400\"></a></p>\n<p>不过后来又有人告诉我：“你做的并不是真正的电子游戏。你做的只是一个 HTML 表单。而且你做的时候应该用数组来表示文字和选项，这样效果会更好。你写的代码应该更整洁一些。”</p>\n<p>我对这个评价觉得有点儿沮丧。我做的这个游戏是一个基于文字的游戏，文字大概有 11 页，通过选择来“进行你的冒险”。不过我意识到，如果想让大家对我做的东西更加满意，我还有很多东西要学。</p>\n<p>我应该学一些“真正的编程知识”。于是我从基于JScript 的 GUI 工具跳到了一些更牛的东西上面，例如 PHP。我学了 PHP，同时也学了 JavaScript。可是后来，我听说这些还是不行，我还得学一些“真正的编程知识”。别人跟我说，PHP 不行，我应该学的是 Python，当然后来我真的去学了。</p>\n<p>不过“真正的程序员”还会一些更时髦的东西，Python 的 Lambda 可到不了那个逼格，而且面向对象编程模式简直就是弱爆了。人家告诉我说，我应该去读一读 SICP，毕竟这是计算机科学的圣经嘛。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/88196eec64f6b673f4e1ce9ebe35eb80.png\"><img class=\"aligncenter size-full wp-image-65349\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/88196eec64f6b673f4e1ce9ebe35eb80.png\" alt=\"sicp\" width=\"309\" height=\"456\"></a></p>\n<p>然后我就接触了 Scheme。我还买了 Brian Kernighan 和 Dennis Ritchie<i><i class=\"01\"> </i></i>合写的《The C Programming Language》，因为真正的程序员就是要用 C 语言写程序的嘛。我还在本地大学报了一个业余班去上课，同时我还得去上班，因为真正的程序员都是很懂数学和算法的嘛，所以我也得学。我开始读论文，看书，因为真正的程序员在算法这件事情上肯定是与时俱进的啊。</p>\n<p>后来，我学了 Erlang 语言，而且还靠这门语言找了份工作。我写了一本 Erlang 的书。不过有意思的是，从来没人问过我是不是这本书的作者？我还有没有写其他的书？或者书里的图是不是我画的？好吧，我找到了一份教 Erlang 语言的工作，但是却从来没有在生产环境中用过这门语言。</p>\n<h3>第 1 章</h3>\n<p>我就这样一直在全世界飞来飞去，教给别人一些连我自己都没有做过的事情，结果突然之间大家就觉得我也是真正的程序员了。要知道我的工作一开始和写程序是没什么关系的。</p>\n<p>有一天，我参加完某个技术会议回家，然后被滞留在机场了，正当我气急败坏地在电脑上打字的时候，突然听到了一个奇怪的，但是很绅士的声音对我说：</p>\n<p>“能帮我设计一个系统吗？”</p>\n<p>“啥？”</p>\n<p>“设计一个系统！“</p>\n<p>我被这个请求惊呆了，于是抬起了头。我环顾四周，看到了一个小孩，他非常希望成为一名程序员，然后他说我可以叫他”printf”，当然，我觉得这肯定不是他的真名，而且这个名字也挺蠢的。他看上去长得这个样子：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/e91da181fb13d148dcb5b74e34579a96.png\"><img class=\"aligncenter size-full wp-image-65333\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/e91da181fb13d148dcb5b74e34579a96.png\" alt=\"printf-end\" width=\"393\" height=\"423\"></a></p>\n<p><q class=\"printf\"></q>”我不是很懂电脑，但是看上去你很懂。我想写一个博客程序给大家用，然后还想让大家阅读这个博客。所以麻烦你帮我写一个系统吧。”</p>\n<p>这可是一个让人吃惊的请求，可能是因为我已经 20 个小时没睡觉的原因，我还不是很理解，或者说我感觉还是很不真实。我跟他说，这可不是简单的事情。我不太清楚他到底要做什么？有没有考虑过失败了怎么办？这个博客要支持多少人同时在线阅读呢？服务器的主机放在哪儿呢？在缺乏这么多信息的前提下，我是没法设计一个合理系统的。</p>\n<p>“这些都不重要。就给我设计一个系统就好。”</p>\n<p>好吧，那么我就画了一个系统的架构图：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/23bf341a92d7e72309b27ca82f202995.png\"><img class=\"aligncenter size-full wp-image-65347\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/23bf341a92d7e72309b27ca82f202995.png\" alt=\"arch1\" width=\"467\" height=\"251\"></a></p>\n<p>他看了看，然后说：“不行，这个系统还不够好。给我再做一个吧。“</p>\n<p>然后我就又做了一个：<br>\n<a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/b9b614d4b48593d53f73e56f015f79d1.png\"><img class=\"aligncenter size-full wp-image-65346\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/b9b614d4b48593d53f73e56f015f79d1.png\" alt=\"arch2\" width=\"583\" height=\"337\"></a></p>\n<p>接着我跟他简要解释了一下这个系统是如何工作的。</p>\n<p>我的新朋友礼貌地笑了笑，说：”这不是我要的系统，它太复杂了，好多功能我其实都不需要。“</p>\n<p>我听了感觉气不打一处来啊，我可是考虑了冗余、系统监控、备份、缓存还有很多其他的机制，来降低负载，减轻额外的处理器负担，并且还能对系统进行有效保护，失效备援，易于部署等等。要知道，如果平时我给人拿出这种方案，那可是要收咨询费的！好吧我失去耐心了，然后我就画了下面这个图：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/ed300d72e9e18a9845bd8da8da96cae3.png\"><img class=\"aligncenter size-full wp-image-65344\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/ed300d72e9e18a9845bd8da8da96cae3.png\" alt=\"blackbox\" width=\"188\" height=\"176\"></a></p>\n<p>然后我还补充说：“这就是你要的设计。你要的系统就在这个黑盒子里。”我希望这个设计方案能让他放过我。不过我听到了一句非常意外的回答：</p>\n<p>“没错！这就是我要的系统！”</p>\n<p>这就是我和小 printf 初识的故事。</p>\n<h3>第 2 章</h3>\n<p>我迅速地对小 printf 做了点调查。发现他之前写的东西都是些小程序，基于表单的小网页，还有一些无关紧要的命令行工具。这些东西平淡无奇，就算是做出来了也很快会被人忘记。</p>\n<p>然后突然之间，他就开始做包含好几个模块的大项目了。这个项目要用到 sockets，要能访问本地硬盘，而且还要和数据库交互。程序刚一做出来的时候，小 printf 还觉得很神奇。但是即便如此这个项目还是差强人意。</p>\n<p>这个项目还需要重构，需要更细致的测试，需要更完备的文档，需要更好的包装和分析。项目上线已本来应该正常运行，但是某一天早上，它崩溃了。</p>\n<p>接下来就是各种崩溃，崩了又崩。</p>\n<p>系统配置不对，日志界面也不再滚动，磁盘速度忽快忽慢，网络不定时抽风，bug 开始各种出现，系统编码也让人匪夷所思，数据库需要清理，事务也被挂起，证书过期，各种漏洞开始暴露，系统监测则什么动静也没有。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/2a137d24c99e91c1d8b1d4fee8b313bb.png\"><img class=\"aligncenter size-full wp-image-65350\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/2a137d24c99e91c1d8b1d4fee8b313bb.png\" alt=\"spaghetti\" width=\"243\" height=\"143\"></a></p>\n<p>系统开始变成一锅粥了。</p>\n<p>他对我说：“事实上我什么都不懂！我本应根据我的需求来做判断的。我太想做一个完美的系统，花了这么多的时间，结果却是‘磨刀误了砍柴功’。当然，我还是知道这个系统的美妙之处的。“</p>\n<p>于是一天早晨，他决定离开办公室。他对着一大堆电脑指示灯说了「再见」。他离开是为了要看看，除了他那乱糟糟的服务器之外，软件的世界还能给他提供些什么好办法来实现他的系统。</p>\n<p>如果照现在的情况，只会是日志继续不停地累计，直到硬盘存爆了为止。</p>\n<h3>第 3 章</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/72c115153857d62127329f76d4615d75.png\"><img class=\"aligncenter size-full wp-image-65342\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/72c115153857d62127329f76d4615d75.png\" alt=\"building\" width=\"394\" height=\"281\"></a></p>\n<p>他来到了一个工作区，想找个经验丰富的人指点迷津。</p>\n<p>他找的第一个人是一个超级自信的高级工程师，他看上去地位很高的样子。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/e71c20866e199431e56c0e63c09a7c93.png\"><img class=\"aligncenter size-full wp-image-65335\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/e71c20866e199431e56c0e63c09a7c93.png\" alt=\"pro\" width=\"362\" height=\"425\"></a><q class=\"other\"></q>”啊，来向我取经啊！你可找对人了，我可是这个领域的专家！“这个人说。</p>\n<p>”专家？”小 printf 问到，”这就是说你什么程序都能写，什么程序都会写？“</p>\n<p>”那当然！“专家回答到。他补充说：”总的来说，我只写那些值得写的程序。我可不写那些没意义的东西。我能写但不写的那些程序，都是因为太简单，所以不劳我动手。“</p>\n<p>”啊，那你能帮我看一下我的系统吗？”就在小 printf 开始阐述他的系统的时候，这位专家打断了他：</p>\n<p>“抱歉，我真心觉得这么做没什么意义。”</p>\n<p>“为什么？”</p>\n<p>“因为经验。我善于编写我善于的程序，我给我善于编写的东西编程。我要严格限制我只做我擅长做的事情，这样才能变得更好。我管这个叫做‘职业安全’，这就是程序界的适者生存原理，而且这一行就是这么玩的。“</p>\n<p>”那你为什么不能帮我呢？“</p>\n<p>”好吧，你看，如果我花时间帮助了你，那么我就会让我的技术自我投资的方向发生分散和偏离——这对我来说是失策。对于你来说，最好的学习方法就是我当年做的那样：通过痛苦的努力来找到解决的办法。这有助于锻造你的个性。“</p>\n<p>”但是这样效率好低。“</p>\n<p>”好吧那你就去学校学，你也可以自学。但是无论哪种做法，都只是把那些想不劳而获的懒人踢出去，让真正愿意踏实学习的人留下来。如果不是这样的话，那我坚持恪守的价值观就会随之崩溃。“</p>\n<p>”那你觉得跟人合作，或者是你的同事能不能帮助你？“</p>\n<p>”并不能。我工作状态最好的时候其实是我一个人独自待着而且没人打扰的时候。每次我被迫和别人一起工作的时候，几乎可以肯定我们做的东西没法凑到一起。最后只能是我怒了，然后把他们写的东西又自己重新再写一遍，然后这才能行。“</p>\n<p>小 printf 对这个专家不愿帮助别人的态度感到非常意外，而且也对专家描述的周围的人能力如此之差感到很困惑。专家把自己的全部视野只集中在自己擅长的领域，只解决自己能解决的问题，这听上去有点儿悲哀。</p>\n<p>”我明白了…我觉得你别给我帮助的话就最好了。“ 小 printf 说到。</p>\n<p>”你什么意思？“自带高大上光环的专家似乎感到了自己的价值观受到了挑战。”你是说我的做的工作毫无趣味可言吗？“</p>\n<p>”哦，并不是，你做的工作很有趣。不过从你的眼光中看来，我只是一个烦躁而讨厌的家伙。我是来寻求帮助的，不是来找罪受的。“</p>\n<p>小 printf 迅速地离开了这个专家，因为他明白，除非你在他的”职业安全“范围之内，否则根本就不能碰他。</p>\n<h3>第 4 章</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/1ca156937bc6ffd234324776df20998e.png\"><img class=\"aligncenter size-full wp-image-65361\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/1ca156937bc6ffd234324776df20998e.png\" alt=\"books\" width=\"461\" height=\"360\"></a></p>\n<p>在继续寻找帮助的路上，小 printf 来到了一个办公室的的门口，办公室里四面都是书架，书架上放着装帧优美的硬皮书，书上有各式各样的精美图画，一个人坐在办公室里面。</p>\n<p>“先生你的书真不错啊“小 printf 说。</p>\n<p>”谢谢！我觉得这些书都是程序员必备的材料。如果你没有这些书，你都不好意思跟人家说你是真正的程序员。“</p>\n<p>”啊，那我觉得我可能就不算是真正的程序员了“，小 printf 说，”那你最喜欢哪本书呢？“</p>\n<p>”哦，大部分书我还没看过呢。“</p>\n<p>”那你不是个优秀的程序员咯？“</p>\n<p>”啊不，我不是。“这个开发者骄傲地补充到：”实际上，我是个糟糕的程序员。“</p>\n<p>”真遗憾，“，小 printf 说，”我可是不断在进步呢。“</p>\n<p>“你听说过 Dunning-Kruger 效应没？”，房间中的人问到。</p>\n<p>“没有，那是个啥玩意儿？”</p>\n<p>“就是一种认知偏差。它的意思大概就是说，那些能力不太强的人更容易高估自己，而能力很强的人更容易低估自己。”</p>\n<p>“所以按照你的意思，如果我认为我在进步，其实是因为我不够好造成的？”</p>\n<p>“是啊，就是这个意思。很可能就是你其实能力不强。而我，我公开声称自己是一个糟糕的程序员。但是根据 Dunning-Kruger 效应，我很可能是在低估我自己，这就意味着我其实是一个很棒的程序员，你还不明白吗？”</p>\n<p>“为什么会这样？”</p>\n<p>“那是因为自黑是程序员的一大法宝。当你自我感觉良好的时候，你实际上已经停滞不前了。”</p>\n<p>“但是这样一来不就意味着，一旦你自己感觉不错的时候，你就开始走下坡路了，所以你应该让自己感觉糟糕起来吗？”</p>\n<p>“对的。但是这件事情正确的做法是，你要对任何东西都说很糟糕，即便是你不知道怎么解决问题也要这么说。这样就能让你看上去很聪明，而且又并不用真的做什么。“</p>\n<p>”能具体解释一下么？“</p>\n<p>”比如我在网上看到了一个让我不爽的项目。然后我就说这个项目所有的地方都不对，但是又并不具体说哪儿不对。我只需要轻描淡写地说，因为做这个项目的人本身就是个白痴，就这样就可以了。“</p>\n<p>“但是你这么说，别人怎么会信呢？”</p>\n<p>“哈哈，我觉得他们都愿意相信他们做错了，而且他们也愿意让别人指出来。这就有点儿像烟雾或者镜子。实际上没人知道自己做的东西是啥样，他们只能知道自己做的东西看上去是啥样。”</p>\n<p>“那么如果他们说他们没法解决问题，让你来帮他们的话，那你怎么办？“</p>\n<p>”这样的话就又回到了一切事情都很糟糕的那个问题；你就说你很忙，有很多事情要做，然后你还很悲观。这样的话，他们就只能靠他们自己了。“</p>\n<p>”所以说这一切都只是摆个姿态而已？这对你来说只是一个套路？你懂的时候装作不懂，是为了让真正啥都不懂的人失去信心，你不懂的时候装懂，是为了让真正懂的人感觉糟糕。“</p>\n<p>”在大多数情况下，有能力没什么用。只有名声才是最重要的。老板招人的时候喜欢招自己的朋友，公司裁人的时候不招人喜欢的和不被重视的人会先被裁。这就是规则。如果你想改变社会的规则，你就会成为异类。这就是套路。业界就是这么运作的，学术界也大致如此，尽管这些都是潜规则，但是我还是都看出来了。一切都取决于你认识谁，如何推销自己，如果经营你的个人品牌。只有这样你才能在业界拥有一席之地。“</p>\n<p>”如果我必须要觉得自己很糟糕，而且还得让别人觉得很糟糕，这样才能找到工作的话，那我想还是算了。“小 printf 说完就走开了。</p>\n<h3>第 5 章</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/27adece4ab9b8ec687df066fb64d100a.png\"><img class=\"aligncenter size-full wp-image-65348\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/27adece4ab9b8ec687df066fb64d100a.png\" alt=\"realprog\" width=\"489\" height=\"488\"></a></p>\n<p>接下来就是午餐时间了，printf打断了一个全神贯注工作忘记吃午饭的人，他一直盯着屏幕，饭都已经凉了。</p>\n<p>工作这么忙碌的人应该很擅长软件行业。于是小 printf 问到：</p>\n<p>”如果主数据库崩溃了，那从数据库也会崩溃么？“</p>\n<p>”你运行的一切东西。“这个忙碌的人回答说，”迟早都会崩溃的。“</p>\n<p>”那么那些告诉你程序崩溃的程序呢？它们也会崩溃么？“</p>\n<p>”是的，它们也会崩溃。所有的大型系统在任意时刻都处在某种部分崩溃的状态。“</p>\n<p>”那么，我们搭建可靠系统（reliable system）的意义在哪儿呢？“</p>\n<p>这个忙碌的人不知道，他也在思考同样的问题，因为就在此时，他们又接到了一个问题，说是一朵云坏掉了，造成了天空塌下来砸到了头上。</p>\n<p>”那么，搭建可靠系统的意义到底在哪儿呢？“小 printf 追问到。</p>\n<p>这个忙碌的人此时一脸的不爽，一看就是在工作遇到问题的样子。他就像一个放了学被留下来不让走的孩子，而且他的三明治显然是废了。他很不耐烦地大声回答说：</p>\n<p>“显然没有任何意义。因为程序本身就是一坨屎。”</p>\n<p>“噢！”他倒抽了一口气。</p>\n<p>接下来，就是一段完全的沉默。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/3b7432892c1dbafb839a60491ad99734.png\"><img class=\"aligncenter size-full wp-image-65351\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/3b7432892c1dbafb839a60491ad99734.png\" alt=\"trashcan\" width=\"229\" height=\"381\"></a></p>\n<p>小 printf 打破了沉默，并且带着一丝愤怒：</p>\n<p>“我不相信你说的话。程序确实是脆弱的，但是程序员能够通过努力让程序变得更好且可用。”</p>\n<p>没有回应。这个时候忙碌的人已经打开一个文档，查看如何从头启动一个集群备份，情况似乎变得越来越糟糕了。</p>\n<p>“那么你真的相信可靠的程–”</p>\n<p>“噢不！”忙碌的人说，“不不不！我不相信什么好的或者可靠的程序！再也不信了！它们都不行！我告诉你我现在脑袋里想的就是怎么处理手头的这个垃圾系统。你没看到是我在努力维持让这些东西运行吗？这些破玩意儿多么重要！”</p>\n<p>小 printf 瞪了回来，表情有些惊愕。</p>\n<p>“都坏成这样了还很重要？你的口气就像是个真正的程序员似的。“</p>\n<p>他补充说：</p>\n<p>”你把概念完全搞混了。世界上有成百上千的程序，年复一年地运行，而且总是会崩溃。但是即便如此人们还是需要这些程序，使用这些程序。而且我知道还有一种程序，它们只会在单台笔记本上运行，但是只要发生一点点错误，其结果就能瞬间毁灭整个社区。如果这样，你还认为不重要吗？“</p>\n<p>接下来这个忙碌的人就不再说话了。</p>\n<h3>第 6 章</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/7350f2b08649e74bdbe6927120ebe2e3.png\"><img class=\"aligncenter size-full wp-image-65338\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/7350f2b08649e74bdbe6927120ebe2e3.png\" alt=\"frameworks\" width=\"529\" height=\"487\"></a></p>\n<p>小 printf 造访的第四个工作区有一个人，他的电脑前贴满了各种不知名的即时贴。</p>\n<p>”motor-mvc, quadrangular JS, GoQuery, cometeor, 还有一些听上去像是日语的东西, …“</p>\n<p>”Hi,“ 小 printf 打断了他，”请问你在做什么呢？“</p>\n<p>”alchemist, bongodb, mochascript, walktime.js, portasql, …“这个人不停地念叨。</p>\n<p>”请问您在做什么呢？“小 printf 又问了一遍，这次声音更大了一些。</p>\n<p>”噢，我在尝试新的框架，工具，数据库，编程语言。“</p>\n<p>”哇！你好像进度很快啊，效率和10个程序员加起来一样高。“</p>\n<p>”是啊，你看，这个行业的前进速度是非常快的！“他对着手机看了几秒，然后补充说，”这儿！cardboard.io 框架推出了 3.5 版本，这个版本和 3.4 不兼容，目前已经产生了 4 个 fork 了！我必须要把他们都试一遍，然后决定自己用哪个。“</p>\n<p>”但是你学这么多，都拿来做什么呢？“</p>\n<p>”我是一个提前学习主义者。如果你不保持着与时俱进的心态，现在你可能还要靠写 COBOL 或者 MUMPS 来过日子呢。如果你想做大事情，就要确保自己站在浪潮之巅。“</p>\n<p>”那这么做有效果么？“</p>\n<p>”有啊，我在 Rails 火起来之前就知道它要火了，我在 node.js 流行起来就知道它要流行了。我参与了 Redis、Mongodb 和 Riak早期的 beta 测试！我是第一个用 Vagrant 的人，后来又切换到了Docker上面，当然现在的潮流是 Unikernel“</p>\n<p>”酷，那么你掌握了这么多最前沿的技术，有什么回报呢？“</p>\n<p>”哦，并没有回报，Rails 变得越来越臃肿了以后，我就必须得赶快去关注别的重要技术，保证自己不要落后。其他的各种技术差不多也是这个套路。目前我希望掌握的是 Unikernel。“</p>\n<p>”明白了。“，小 printf 补充到，”那么这些新框架和技术都会用来解决哪些问题呢？“</p>\n<p>”噢，不是重大技术我们不用，我主要是要确保这一点，这样才能让我们公司不至于把资源花费到没有未来的技术上。这是很重要的，因为如果你不这么做的话，你的技术就会被那帮花白胡子的过时老程序员绑架，为了避免这样，你就必须成为一个自我驱动力强大的学习者，一个提前学习主义者。“</p>\n<p>”真有趣。“小 printf 插了一句嘴。</p>\n<p>”这可不是有趣，这是很难做到的！在创业的世界里，如果你想要吸引人才，你就必须要通过优秀的技术来招揽他们！否则你就是个不灵活的落后者。没人愿意做不灵活的落后者。“</p>\n<p>小 printf 赶紧说：”不，我不是这个意思。“，然后他补充到，”我感到有趣的地方在于，工具本来是用来给我们解决问题的，但是对于你来说，工具本身却成了问题。“</p>\n<p>接下来，这个人就站在他那个新潮的健身式办公桌前，没有任何回应了，小 printf 真希望自己赶紧出去。</p>\n<h3>第 7 章</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/6a7cef8b627c1b5bbdef6056762200a1.png\"><img class=\"aligncenter size-full wp-image-65362\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/6a7cef8b627c1b5bbdef6056762200a1.png\" alt=\"ops\" width=\"363\" height=\"349\"></a></p>\n<p>在下一个办公室，坐着一个看上去很疲倦的员工，他的桌子上堆满了空咖啡杯。她无精打采地坐着，愤怒地敲击着键盘。</p>\n<p>”嗨！“小 printf 说。</p>\n<p>这个疲倦的女人并没有停下手上的动作。他继续愤怒地敲击着键盘。</p>\n<p>”你好？“小 printf 又打了一遍招呼。</p>\n<p>这个女人忽然间停了下来，从抽屉里取出一只水壶，然后大口喝起水来。</p>\n<p>”我的工作太糟糕了。“她说，”我是做 Devops 的。一开始还好，我大部分时间做开发，偶尔也做做调试的事情，但是随着时间的推移，情况变得越来越糟糕。我开始在各处救火，但是问题还是不断发生。我解决了其中的大部分问题，但是有些小毛病还是要期盼奇迹发生，这才能赶得上开发计划预定的期限，而且开发工作也是我的。“</p>\n<p>”他们没有再找个人帮帮你么？“</p>\n<p>”没有，这就是问题的所在。小问题总是到处发生，因为我必须要解决这些问题，所以我在做开发的时候就不可能像以前只做开发时那么专注，所以我本身就会制造更多的问题。现在，我每天都没日没夜地给系统灭火，我真是恨死我的工作了。“</p>\n<p>”那你的雇主为什么什么都不做呢？“</p>\n<p>”那是因为我擅长我的工作啊，我长期以来一直可以控制住局面，而且大家都已经习惯了。当你把创造奇迹变成一种习惯的时候，人们就适应了。然后你就会被困在‘总是要创造奇迹’的局面当中，否则人们就会认为是你的工作不得力。“</p>\n<p>”这听上去可真是悲哀！“</p>\n<p>”是啊。因为你是最熟悉怎么去给系统灭火的人，所以你就总得去，久而久之就是你的工作了，直到有一天老板雇了新人来替代你做你心爱的工作。如果你真的很在意你的工作的话，那么就去做那种谁都不愿意干的脏活累活，接下来所有人都会感谢你，你干得越多人们就会越感谢你，直到所有的脏活累活全都归你。当然，这样的话工作就没有什么乐趣可言了。“</p>\n<p>”那么你可真不走运。“小 printf 说。</p>\n<p>说着，她的呼叫器又响了。</p>\n<p>”那个女人，”小 printf 对自己说，就像是他父亲的口吻，“那个女人的工作被所有人轻视，专家、明星程序员、提前学习主义者，他们都看不上她的工作。但是她做的工作才是唯一有帮助的。这很可能是因为她总是在考虑别人，而不是只考虑自己吧。”</p>\n<h3>第 8 章</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/e3b19d8ef4b712035dd80e8738020147.png\"><img class=\"aligncenter size-full wp-image-65363\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/e3b19d8ef4b712035dd80e8738020147.png\" alt=\"architect\" width=\"449\" height=\"377\"></a></p>\n<p>在建筑的一角，小 printf 发现了一间大办公室，办公室有巨大的落地窗，窗外视野极好。办公室内有一张非常大的办公桌，桌子上的文件堆成了小山，有一个老绅士坐在办公桌前。</p>\n<p>“啊，开发者来了”老绅士看到小 printf 走到门厅，于是就大声喊到，“进来！”</p>\n<p>透过窗户看去，小 printf 注意到窗户的玻璃上写着各种各样的字，还有用修正液涂改的痕迹，以至于窗外的风景都快被各种圈圈点点，箭头，圆柱等几何图形给盖住了，而且上面还画了云朵的图案。明明窗外就有真正的云，为什么还要在窗户上画云朵的形状？还有整个图案的含义也让人很感兴趣。</p>\n<p>”这是什么？“，小 printf 指着窗户问。</p>\n<p>”这个么？这是我们的生产系统！“那个老绅士说，一副看上去对外面事物毫不关心的样子，”我是一个软件架构师。“</p>\n<p>”软件架构师是什么？”</p>\n<p>“多数情况下，架构师是那种最了解组件之间的结构，并且最能够合理调度组件关系的人，架构师能让大型系统的各个部分完美协调地工作。同时，软件架构师也了解数据库、编程语言、框架、编辑器、序列化格式、协议以及诸如封装、协议隔离等概念。“</p>\n<p>”听上去真有趣！“小 printf 说，“终于有一个人能够回答所有的问题了！”他看了一眼架构师的图，“你的系统真是让人印象深刻啊！那么这个系统速度快么？”</p>\n<p>“我不知道，”架构师说，“应该挺快的吧。”</p>\n<p>“那系统的代码呢？写得好么？”</p>\n<p>“我也没法告诉你”</p>\n<p>“用户对系统满意么？”</p>\n<p>“恐怕我还是没法告诉你。”</p>\n<p>“但是你是软件架构师啊！”</p>\n<p>“对啊！但是我并不是开发者啊。软件架构师的任务并不是去写模块、类，也不是调用类库。软件架构师的工作相比写代码来说要重要得多。软件架构师会和开发者，程序员们聊天，问他们问题，给他们提供指导。如果程序员问的问题很有趣，那么架构师也许会亲自出马给这个问题做规划。”</p>\n<p>“为什么要这样？”</p>\n<p>“因为我们更有经验啊。我们对系统能做哪些事，不能做哪些事了解得更多。开发者则是我们知识的延伸，他们会去把优秀的系统真正做出来。”</p>\n<p>“但是你们不亲自编码，怎么能确认开发过程是顺利的呢？”</p>\n<p>“因为我们信任开发人员啊。”</p>\n<p>“所以你相信开发人员能够正确实现你的想法，并且不会产生他们自己的想法？”</p>\n<p>软件架构师听了小 printf 的话后明显有些震惊，他说：”我想我还是有点儿脱节。“，他最后承认说，“问题确实存在，别人总是跟你说要按照某种思想或者主意去做事，但是你又没法有效验证你做的事情是不是真的符合这种思想。”他低下了头，沉思着，“有的时候软件架构师既不做软件，也不做架构，这貌似是真的。”</p>\n<p>接着，小 printf 离开了坊间，然后结束了他的访问，离开了大楼。</p>\n<h3>第 9 章</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/badf773e339eb22672ab17db1335c747.png\"><img class=\"aligncenter size-full wp-image-65341\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/badf773e339eb22672ab17db1335c747.png\" alt=\"charity\" width=\"410\" height=\"299\"></a></p>\n<p>小 printf 刚一走出门，就碰到了一个男人正在路边募集善款。</p>\n<p>“Hi，”那个男人说，“你今天想不想给别人献点儿爱心呢？”</p>\n<p>”好吧，这样做我感觉可能会好点儿“，小 printf 回答说，”我已经在这栋大楼里待了一整天，可是我出来的时候感觉更加困惑了。“</p>\n<p>”啊，我明白了。这些人都是开发者。他们其实一点儿也帮不上忙，对不？他们总是喊着要改变世界，而且他们确实也做到了。“</p>\n<p>”但是为什么感觉这么奇怪呢？“小 printf 回答到。</p>\n<p>”好吧，因为他们的工作就是把人们的职业转换成程序，让人们安逸的生活变得更加安逸。软件会吞噬整个世界，然后给让世界面貌一新……不过从深层次来看，面貌一新的世界还是那个旧世界，只是面貌变了而已。之所你觉得奇怪，是因为世界的改变并不一定朝好的方向改变。我们现在面临的问题其实和以前一样多，需要填的坑也和以前一样深。“</p>\n<p>”那么我怎么才能让自己感觉好一点儿呢？”小 printf 显得有些焦虑。</p>\n<p>这个男人思考了一会儿，然后希望小 printf 能和他一起来帮助别人，这是他认为的能让自己感觉变好的方式。printf用了一整个下午告诉这个人自己的问题和经历。这个人听完了以后沉默了很长一段时间，然后说：</p>\n<p>“人们在社会中相互博弈，扮演不同角色，追逐和享受的名声，解决错综复杂的问题后得到瞬间的快感，这些都只是过眼云烟。最终，如果你没有解决什么有意义的问题，如果你完全不考虑别人，那么你是无法做到内心满足的。”</p>\n<p>“得不到内心的满足也许也没什么，也许会很糟糕，在你成长的过程中，你的满足感可能来自于你的工作之外，也可能来自于工作。工作可以仅仅就是工作，也可以是单纯为了钱，也可以为了兴趣。这些都OK。只要你能从生命中的某处找到内心的满足，那就好了。”</p>\n<p>“最后，只有当你以人类的面孔去解决问题的时候，你才会觉得真的正确；真正关键的点其实和电脑没关系。”</p>\n<p>“真正的关键在于你用心花在系统上的精力，这才是最重要的。“，那个人补充到，”如果你忘记了为什么花这么多精力的初衷，当一切都变成了关乎个人骄傲的游戏，那么事情的性质就变了，从可慰变成可悲。“</p>\n<p>”开发者们常常会忘记一个事实；如果你失去了对事物的眼光，那么在开发系统本身就成为了一个问题，这样的话最有效的办法就是把系统废掉，因为系统自己就是问题的根源。“</p>\n<p>”只有当你以人类的面孔去解决问题的时候，才会觉得真的正确。“，小 printf 不断重复着这句话，他铭记在心。</p>\n<h3>第 10 章</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/06/c3e439e098ad3e922e7c338db045c453.png\"><img class=\"aligncenter size-full wp-image-65332\" src=\"http://jbcdn2.b0.upaiyun.com/2017/06/c3e439e098ad3e922e7c338db045c453.png\" alt=\"printf\" width=\"569\" height=\"638\"></a></p>\n<p>坐在我身旁的Printf现在要起身回家了。跟他的一席对话让我意识到了我现在所做的事情和我的爱好有多么大的距离，而我的爱好才是我真正开始编程的动力。小 printf 遇到的每一个角色，我每天也都会遇到很多。我曾受到他们的鼓舞，希望成为他们的一员，我可能也鼓励过别人这么做。</p>\n<p>当我还在挣扎着成为一个真正的程序员的时候，小 printf 却没有这么做。他说他成不了一个真正的程序员也没关系，他更希望能成为一个长着人类面孔的程序员。</p>\n<p>时至今日，回首望去，我的困境并没有改变，我还是要在人类的面孔和纯粹的工作之间做出选择，我希望我能有这个能力。而且在这两者之间好像也没有什么中间地段可以让我去选择。</p>\n<p>无论如何，小 printf 觉得他不需要做一个真正的程序员了，我想我和他的感觉是一样的。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://www.jobbole.com/wp-content/uploads/2016/04/78805a221a988e79ef3f42d7c5bfd4187.jpeg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111959\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111959votetotal\">6</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111959\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 12 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 5 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/huangxiaofei\">黄小非</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/huangxiaofei\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/avatars/5423/Corbis-42-221258652.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            黄小非：毕业于重庆大学计算机系，南开大学软件工程硕士，SCJP。 目前在一家国企信息中心任职软件开发工程师。主要技术兴趣为Java平台相关技术、系统构架、C/C++、计算机图形学等。（新浪微博：@黄小非）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/huangxiaofei\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/huangxiaofei/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/huangxiaofei/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 65</a> · <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/huangxiaofei2002\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "Facebook 这类网站如何处理数十亿请求并保持高可用性的？", "url": "http://blog.jobbole.com/111996/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/03/912be8d20ca700194c3aced111cc833d1.jpg"], "praise_nums": "1", "comment_nums": 1, "fav_nums": 7, "tags": "IT技术,Web,负载均衡", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/snowhere\">孙腾浩</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://blog.vivekpanyam.com/scaling-a-web-service-load-balancing/\">Vivek Panyam</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>Facebook 这类网站如何处理数十亿请求并保持高可用性呢，答案是负载均衡，本文将对其一探究竟。</p>\n<h3>什么是负载均衡</h3>\n<p>负载均衡是许多协同工作资源（通常是计算机）的分配策略。它们通常用于提高容量和可靠性。</p>\n<p>为了便于讨论负载均衡，对于服务扩展我假设以下两点：</p>\n<ul>\n<li>我可以运行任意数量实例</li>\n<li>任何请求可以到达任意实例</li>\n</ul>\n<p>第一个假设表明服务是无状态的（或者像 Redis 集群一样可以共享状态）。第二个假设实际中并不是必须的（比如粘性负载均衡），但在这片文章中做这样的假设便于讨论。</p>\n<p>下面是我将要讨论的负载均衡技术：</p>\n<ol>\n<li>应用层（OSI 第七层）负载均衡（HTTP、HTTPS、WS）</li>\n<li>传输层（OSI 第四层）负载均衡（TCP、UDP）</li>\n<li>网络层（OSI 第三层）负载均衡</li>\n<li>DNS 负载均衡</li>\n<li>多个子域手动负载均衡</li>\n<li>任播（Anycast）</li>\n</ol>\n<p>最后还有一些其他知识点：</p>\n<ul>\n<li>延迟和吞吐量</li>\n<li>服务器直接返回</li>\n</ul>\n<p>这些技术大致按照「网站流量增大时需要的操作步骤」排序。比如，应用层的负载均衡是首先要做的事（远远早于任播）。前三条技术提高吞吐量和可用性，但存在单点故障。其余的三条技术在提高吞吐量的同时避免了单点故障。</p>\n<p>为了帮助我们理解负载均衡，我们来看一个简单的服务扩展。</p>\n<p>注意：每种扩展技术都采用了非技术的比喻（在商店购物）。这些比喻仅仅是描述技术背后的思想，并不完全准确。</p>\n<h3>服务</h3>\n<p>我们假设我们正在构建大规模的服务。就像下图所示：</p>\n<p><img class=\"aligncenter\" src=\"https://blog.vivekpanyam.com/content/images/2016/02/Service-1.png\" alt=\"\"></p>\n<p>这个系统并不能处理大量通信，并且如果它宕机，整个应用就停了。</p>\n<h4>比喻：</h4>\n<ul>\n<li>你走向商店唯一一条结账的队伍。</li>\n<li>你购买你的商品，如果那里没有收银员，你无法完成购买。</li>\n</ul>\n<h3>应用层（OSI 第七层）负载均衡</h3>\n<p>为了承载更大的通信量，首先用到的就是应用层负载均衡。应用层是 OSI 第七层。它包括 HTTP、HTTPS 和 WebSockets。一款非常流行又久经考验的应用层负载均衡器就是 Nginx。让我们看看它如何帮助我们扩展服务：</p>\n<p><img src=\"https://blog.vivekpanyam.com/content/images/2016/02/L7LB.png\" alt=\"\"></p>\n<p>请注意，通过这种技术，我们能负载均衡数十或上百服务器实例。上面图片只展示两个作为例子。</p>\n<h4>比喻</h4>\n<ul>\n<li>商店员工引领你到一个特别的（有收银员的）结账队伍</li>\n<li>你购买你的商品</li>\n</ul>\n<h4>工具：</h4>\n<ul>\n<li>Nginx</li>\n<li>HAProxy</li>\n</ul>\n<h4>注意：</h4>\n<ul>\n<li>我们要在这里停止使用 SSL（分发时不用 SSL)</li>\n</ul>\n<h3>传输层（OSI 第四层）负载均衡（TCP、UDP）</h3>\n<p>上一条技术帮助我们承载大量通信，但如果我们需要承载更大的通信量，传输层负载均衡非常有用。传输层是 OSI 第四层，包括 TCP 和 UDP。流行的传输层负载均衡器有 HAProxy（这个也用于应用层负载均衡）和 IPVS。让我们看看它们如何帮助我们扩展服务：</p>\n<p><img src=\"https://blog.vivekpanyam.com/content/images/2016/02/L4LB.png\" alt=\"\"></p>\n<p>应用层负载均衡+传输层负载均衡能处理大多数情况下的通信量。然而我们我们仍要担心可用性。单点故障有可能出现在传输层的负载均衡器。我们在下面一节的 DNS 负载均衡解决这个问题。</p>\n<h4>比喻：</h4>\n<ul>\n<li>根据客户会员卡卡号有不同结账区域。举个例子，如果你的会员卡卡号是偶数，去电器区附近的结账台，否则就去食品区附近的结账台。</li>\n<li>一旦你到达正确的结账区域，商店员工引领你到一个特别的结账队伍</li>\n<li>你购买你的商品</li>\n</ul>\n<h4>工具：</h4>\n<ul>\n<li>HAProxy</li>\n<li>IPVS</li>\n</ul>\n<h3>网络层（OSI 第三层）负载均衡</h3>\n<p>如果我们要继续扩展，我们需要增加网络层负载均衡。这比上面两条技术更复杂。网络层是 OSI 第三层，包括 IPv4 和 IPv6。下面是网络层负载均衡：</p>\n<p><img src=\"https://blog.vivekpanyam.com/content/images/2016/02/L3LB.png\" alt=\"\"></p>\n<p>为了搞清楚它如何工作，我们需要一点等价路由的知识（ECMP）。当有多条等价链路到达相同地址时，我们使用等价路由。简单来说，它允许路由器或交换机通过不同链接发送数据包（支持高吞吐量），最终到达同一地址。</p>\n<p>我们可以利用这一点来实现网络层负载均衡，因为在我们看来，每个传输层负载均衡器是相同的。这意味着我们可以把从网络层负载均衡器到传输层负载均衡器的链接看做相同目的地的链路。如果我们把所有负载均衡器绑定到相同 IP 地址，我们可以使用等价路由在传输层负载均衡器之间分配通信。</p>\n<h4>比喻：</h4>\n<ul>\n<li>街对面有两家彼此分开却又一模一样的商店，你去哪一家完全取决于你的习惯。</li>\n<li>一旦你到达了商店，根据客户会员卡卡号有不同结账区域。举个例子，如果你的会员卡卡号是偶数，去电器区附近的结账台，否则就去食品区附近的结账台。</li>\n<li>一旦你到达正确的结账区域，商店员工引领你到一个特别的结账队伍</li>\n<li>你购买你的商品</li>\n</ul>\n<h4>工具：</h4>\n<ul>\n<li>通常在机柜里交换机内部的硬件中处理。</li>\n</ul>\n<h4>太长不阅：</h4>\n<ul>\n<li>除非你的服务规模相当大或有自己的硬件，否则你不需要它。</li>\n</ul>\n<h3>DNS 负载均衡</h3>\n<p>DNS 是将名称转换为 IP 地址的系统。举个例子，它可以把 example.com 转换为 93.184.216.34 。它当然也可以返回多个 IP 地址，像下面这样：</p>\n<p><img class=\"aligncenter\" src=\"https://blog.vivekpanyam.com/content/images/2016/02/Screen-Shot-2016-02-04-at-3-25-32-AM.png\" alt=\"\"></p>\n<p>如果返回了多个 IP，客户端通常会使用第一个可用的地址（然而一些应用只看第一个返回的 IP）。</p>\n<p>目前有很多 DNS 负载均衡技术，比如 GeoDNS 和轮询调度（round-robin）。GeoDNS 基于不同请求者而返回不同响应。这让我们可以将客户端路由到其最近的服务器或数据中心。轮询调度会循环所有可用的 IP 地址，对于每个响应会返回不同的 IP。如果多个 IP 可用，这两种技术仅仅改变响应里的 IP 顺序。</p>\n<p>下图展示 DNS 负载均衡如何工作：</p>\n<p><img src=\"https://blog.vivekpanyam.com/content/images/2016/02/DNS.png\" alt=\"\"></p>\n<p>在这个例子中，不同的用户被路由到不同的服务集群（随机或基于地理位置）。</p>\n<p>现在这里不再有单点故障的可能性（假设有多台 DNS 服务器）。为了进一步提高可靠性，我们可以在不同数据中心运行多个服务集群。</p>\n<h4>比喻：</h4>\n<ul>\n<li>你在网上查询购物中心，返回的列表把最近的购物中心放在第一个。你查看通往每个购物中心的路，然后选择列表中第一个营业的购物中心。</li>\n<li>街对面有两家彼此分开却又一模一样的商店，你去哪一家完全取决于你的习惯。</li>\n<li>一旦你到达了商店，根据客户会员卡卡号有不同结账区域。举个例子，如果你的会员卡卡号是偶数，去电器区附近的结账台，否则就去食品区附近的结账台。</li>\n<li>一旦你到达正确的结账区域，商店员工引领你到一个特别的结账队伍</li>\n<li>你购买你的商品</li>\n</ul>\n<h3>手动负载均衡和路由</h3>\n<p>如果你的内容在许多数据中心或服务间共享，而我们需要路由到其中特定的一个，那么这条技术就很有用了。比如 <code>cat.jpg</code> 储存在伦敦的集群中，但其他集群中没有。相似的，<code>dog.jpg</code> 储存在纽约的集群中，其他数据中心或集群中没有。举个例子，这很可能发生在内容刚刚上传，还未在数据中心之间复制的时候。</p>\n<p>然而，用户获取内容时不应该等待复制完成。这意味着我们的应用需要临时把所有 <code>cat.jpg</code> 请求发送到伦敦，所有 <code>dog.jpg</code> 请求发送到纽约。所以我们需要用 <code>https://lon-1e.static.example.net/cat.jpg</code> 代替 <code>https://cdn.example.net/cat.jpg</code>。对 <code>dog.jpg</code> 来说也一样。</p>\n<p>为了实现这一点，我们需要为每个数据中心设置子域（最好细分到每个集群每台机器）。除了上面的 DNS 负载均衡，这一点也很有必要。</p>\n<p>注意：我们的应用需要保持追踪内容的位置，以便重写请求。</p>\n<h4>比喻：</h4>\n<ul>\n<li>你拨打公司电话询问哪个购物中心提供猫粮。</li>\n<li>你查看列表上的购物中心路线，然后选择第一个营业的。</li>\n<li>街对面有两家彼此分开却又一模一样的商店，你去哪一家完全取决于你的习惯。</li>\n<li>一旦你到达了商店，根据客户会员卡卡号有不同结账区域。举个例子，如果你的会员卡卡号是偶数，去电器区附近的结账台，否则就去食品区附近的结账台。</li>\n<li>一旦你到达正确的结账区域，商店员工引领你到一个特别的结账队伍</li>\n<li>你购买你的商品</li>\n</ul>\n<h3>任播（Anycast）</h3>\n<p>这篇文章讨论的最后一种技术就是任播。首先来看一点背景知识：</p>\n<p>大多数网路使用单播。这本质上意味着每台计算机拥有独一无二的 IP 地址。有另一种称为任播的理论。通过任播，一些机器可以使用相同的 IP 地址和路由，并把请求发送到最近的一台机器。我们可以把这种技术和上面所讲的技术结合起来，构建出高可靠性和可用性，能承载巨大通信量的系统。</p>\n<p>任播根本上来说是允许互联网为我们处理部分负载均衡。</p>\n<h4>比喻：</h4>\n<ul>\n<li>你告诉别人你打算去商店，他们把你带到最近的位置。</li>\n<li>街对面有两家彼此分开却又一模一样的商店，你去哪一家完全取决于你的习惯。</li>\n<li>一旦你到达了商店，根据客户会员卡卡号有不同结账区域。举个例子，如果你的会员卡卡号是偶数，去电器区附近的结账台，否则就去食品区附近的结账台。</li>\n<li>一旦你到达正确的结账区域，商店员工引领你到一个特别的结账队伍</li>\n<li>你购买你的商品</li>\n</ul>\n<h3>杂项</h3>\n<h4>延迟和吞吐量</h4>\n<p>顺便一提的是，这些技术也可以提升低延迟服务的吞吐量。增加服务数量而不是让每个服务处理更多的通信。这样我们就可以得到低延迟、高吞吐量的系统。</p>\n<h4>服务器直接返回</h4>\n<p>在传统负载均衡系统中，请求穿过负载均衡的所有层级，响应也同样穿过它们。降低负载均衡通信量的一个优化点就是服务器直接返回。这意味着服务端的响应不通过负载均衡。如果服务端的响应十分巨大，这点尤其有用。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/5085cce1bd4e144b7d148079a34b20c1.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/02b09a29fdb3ab5fe03d4bd1afe95664.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111996\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111996votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111996\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere\">孙腾浩</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/47765e50cfb7c4e598e72d893ab4f62f.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            毕业于郑州大学软件工程专业，身为 Java 程序猿却同样热爱着 JavaScript 。为了兴趣而写代码，做自己喜欢做的事。Keep coding ... Stay Cool ...        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/snowhere\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/snowhere/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 18</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://snowhere.me/\"><i class=\"fa fa-link\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/Snowhere/\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "MySQL EXPLAIN 详解", "url": "http://blog.jobbole.com/112021/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/e78e36715813f49e9e62fe0c6050075c.png"], "praise_nums": "3", "comment_nums": 0, "fav_nums": 6, "tags": "IT技术,MySQL,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jianshu.com/p/ea3fc71fdc45\">高广超</a>   </div><p>MySQL EXPLAIN命令是查询性能优化不可缺少的一部分，该文主要讲解explain命令的使用及相关参数说明。</p>\n<h3>EXPLAIN Output Columns</h3>\n<table>\n<thead>\n<tr>\n<th>列名</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>id</td>\n<td>执行编号，标识select所属的行。如果在语句中没子查询或关联查询，只有唯一的select，每行都将显示1。否则，内层的select语句一般会顺序编号，对应于其在原始语句中的位置</td>\n</tr>\n<tr>\n<td>select_type</td>\n<td>显示本行是简单或复杂select。如果查询有任何复杂的子查询，则最外层标记为PRIMARY（DERIVED、UNION、UNION RESUlT）</td>\n</tr>\n<tr>\n<td>table</td>\n<td>访问引用哪个表（引用某个查询，如“derived3”）</td>\n</tr>\n<tr>\n<td>type</td>\n<td>数据访问/读取操作类型（ALL、index、range、ref、eq_ref、const/system、NULL）</td>\n</tr>\n<tr>\n<td>possible_keys</td>\n<td>揭示哪一些索引可能有利于高效的查找</td>\n</tr>\n<tr>\n<td>key</td>\n<td>显示mysql决定采用哪个索引来优化查询</td>\n</tr>\n<tr>\n<td>key_len</td>\n<td>显示mysql在索引里使用的字节数</td>\n</tr>\n<tr>\n<td>ref</td>\n<td>显示了之前的表在key列记录的索引中查找值所用的列或常量</td>\n</tr>\n<tr>\n<td>rows</td>\n<td>为了找到所需的行而需要读取的行数，估算值，不精确。通过把所有rows列值相乘，可粗略估算整个查询会检查的行数</td>\n</tr>\n<tr>\n<td>Extra</td>\n<td>额外信息，如using index、filesort等</td>\n</tr>\n</tbody>\n</table>\n<h4>id</h4>\n<p>id是用来顺序标识整个查询中SELELCT 语句的，在嵌套查询中id越大的语句越先执行。该值可能为NULL，如果这一行用来说明的是其他行的联合结果。</p>\n<h4>select_type</h4>\n<p>表示查询的类型</p>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>simple</td>\n<td>简单子查询，不包含子查询和union</td>\n</tr>\n<tr>\n<td>primary</td>\n<td>包含union或者子查询，最外层的部分标记为primary</td>\n</tr>\n<tr>\n<td>subquery</td>\n<td>一般子查询中的子查询被标记为subquery，也就是位于select列表中的查询</td>\n</tr>\n<tr>\n<td>derived</td>\n<td>派生表——该临时表是从子查询派生出来的，位于form中的子查询</td>\n</tr>\n<tr>\n<td>union</td>\n<td>位于union中第二个及其以后的子查询被标记为union，第一个就被标记为primary如果是union位于from中则标记为derived</td>\n</tr>\n<tr>\n<td>union result</td>\n<td>用来从匿名临时表里检索结果的select被标记为union result</td>\n</tr>\n<tr>\n<td>dependent union</td>\n<td>顾名思义，首先需要满足UNION的条件，及UNION中第二个以及后面的SELECT语句，同时该语句依赖外部的查询</td>\n</tr>\n<tr>\n<td>subquery</td>\n<td>子查询中第一个SELECT语句</td>\n</tr>\n<tr>\n<td>dependent subquery</td>\n<td>和DEPENDENT UNION相对UNION一样</td>\n</tr>\n</tbody>\n</table>\n<h4>table</h4>\n<p>对应行正在访问哪一个表，表名或者别名</p>\n<ul>\n<li>关联优化器会为查询选择关联顺序，左侧深度优先</li>\n<li>当from中有子查询的时候，表名是derivedN的形式，N指向子查询，也就是explain结果中的下一列</li>\n<li>当有union result的时候，表名是union 1,2等的形式，1,2表示参与union的query id</li>\n</ul>\n<p>注意：MySQL对待这些表和普通表一样，但是这些“临时表”是没有任何索引的。</p>\n<h4>type</h4>\n<p>type显示的是访问类型，是较为重要的一个指标，结果值从好到坏依次是：<br>\nsystem &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range &gt; index &gt; ALL ，一般来说，得保证查询至少达到range级别，最好能达到ref。</p>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>All</td>\n<td>最坏的情况,全表扫描</td>\n</tr>\n<tr>\n<td>index</td>\n<td>和全表扫描一样。只是扫描表的时候按照索引次序进行而不是行。主要优点就是避免了排序, 但是开销仍然非常大。如在Extra列看到Using index，说明正在使用覆盖索引，只扫描索引的数据，它比按索引次序全表扫描的开销要小很多</td>\n</tr>\n<tr>\n<td>range</td>\n<td>范围扫描，一个有限制的索引扫描。key 列显示使用了哪个索引。当使用=、 &lt;&gt;、&gt;、&gt;=、&lt;、&lt;=、IS NULL、&lt;=&gt;、BETWEEN 或者 IN 操作符,用常量比较关键字列时,可以使用 range</td>\n</tr>\n<tr>\n<td>ref</td>\n<td>一种索引访问，它返回所有匹配某个单个值的行。此类索引访问只有当使用非唯一性索引或唯一性索引非唯一性前缀时才会发生。这个类型跟eq_ref不同的是，它用在关联操作只使用了索引的最左前缀，或者索引不是UNIQUE和PRIMARY KEY。ref可以用于使用=或&lt;=&gt;操作符的带索引的列。</td>\n</tr>\n<tr>\n<td>eq_ref</td>\n<td>最多只返回一条符合条件的记录。使用唯一性索引或主键查找时会发生 （高效）</td>\n</tr>\n<tr>\n<td>const</td>\n<td>当确定最多只会有一行匹配的时候，MySQL优化器会在查询前读取它而且只读取一次，因此非常快。当主键放入where子句时，mysql把这个查询转为一个常量（高效）</td>\n</tr>\n<tr>\n<td>system</td>\n<td>这是const连接类型的一种特例，表仅有一行满足条件。</td>\n</tr>\n<tr>\n<td>Null</td>\n<td>意味说mysql能在优化阶段分解查询语句，在执行阶段甚至用不到访问表或索引（高效）</td>\n</tr>\n</tbody>\n</table>\n<h4>possible_keys</h4>\n<p>显示查询使用了哪些索引，表示该索引可以进行高效地查找，但是列出来的索引对于后续优化过程可能是没有用的</p>\n<h4>key</h4>\n<p>key列显示MySQL实际决定使用的键（索引）。如果没有选择索引，键是NULL。要想强制MySQL使用或忽视possible_keys列中的索引，在查询中使用FORCE INDEX、USE INDEX或者IGNORE INDEX。</p>\n<h4>key_len</h4>\n<p>key_len列显示MySQL决定使用的键长度。如果键是NULL，则长度为NULL。使用的索引的长度。在不损失精确性的情况下，长度越短越好 。</p>\n<h4>ref</h4>\n<p>ref列显示使用哪个列或常数与key一起从表中选择行。</p>\n<h4>rows</h4>\n<p>rows列显示MySQL认为它执行查询时必须检查的行数。注意这是一个预估值。</p>\n<h4>Extra</h4>\n<p>Extra是EXPLAIN输出中另外一个很重要的列，该列显示MySQL在查询过程中的一些详细信息，MySQL查询优化器执行查询的过程中对查询计划的重要补充信息。</p>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Using filesort</td>\n<td>MySQL有两种方式可以生成有序的结果，通过排序操作或者使用索引，当Extra中出现了Using filesort 说明MySQL使用了后者，但注意虽然叫filesort但并不是说明就是用了文件来进行排序，只要可能排序都是在内存里完成的。大部分情况下利用索引排序更快，所以一般这时也要考虑优化查询了。使用文件完成排序操作，这是可能是ordery by，group by语句的结果，这可能是一个CPU密集型的过程，可以通过选择合适的索引来改进性能，用索引来为查询结果排序。</td>\n</tr>\n<tr>\n<td>Using temporary</td>\n<td>用临时表保存中间结果，常用于GROUP BY 和 ORDER BY操作中，一般看到它说明查询需要优化了，就算避免不了临时表的使用也要尽量避免硬盘临时表的使用。</td>\n</tr>\n<tr>\n<td>Not exists</td>\n<td>MYSQL优化了LEFT JOIN，一旦它找到了匹配LEFT JOIN标准的行， 就不再搜索了。</td>\n</tr>\n<tr>\n<td>Using index</td>\n<td>说明查询是覆盖了索引的，不需要读取数据文件，从索引树（索引文件）中即可获得信息。如果同时出现using where，表明索引被用来执行索引键值的查找，没有using where，表明索引用来读取数据而非执行查找动作。这是MySQL服务层完成的，但无需再回表查询记录。</td>\n</tr>\n<tr>\n<td>Using index condition</td>\n<td>这是MySQL 5.6出来的新特性，叫做“索引条件推送”。简单说一点就是MySQL原来在索引上是不能执行如like这样的操作的，但是现在可以了，这样减少了不必要的IO操作，但是只能用在二级索引上。</td>\n</tr>\n<tr>\n<td>Using where</td>\n<td>使用了WHERE从句来限制哪些行将与下一张表匹配或者是返回给用户。<strong>注意</strong>：Extra列出现Using where表示MySQL服务器将存储引擎返回服务层以后再应用WHERE条件过滤。</td>\n</tr>\n<tr>\n<td>Using join buffer</td>\n<td>使用了连接缓存：<strong>Block Nested Loop</strong>，连接算法是块嵌套循环连接;<strong>Batched Key Access</strong>，连接算法是批量索引连接</td>\n</tr>\n<tr>\n<td>impossible where</td>\n<td>where子句的值总是false，不能用来获取任何元组</td>\n</tr>\n<tr>\n<td>select tables optimized away</td>\n<td>在没有GROUP BY子句的情况下，基于索引优化MIN/MAX操作，或者对于MyISAM存储引擎优化COUNT(*)操作，不必等到执行阶段再进行计算，查询执行计划生成的阶段即完成优化。</td>\n</tr>\n<tr>\n<td>distinct</td>\n<td>优化distinct操作，在找到第一匹配的元组后即停止找同样值的动作</td>\n</tr>\n</tbody>\n</table>\n<h3>参考资料</h3>\n<p>高性能mysql第三版<br>\n<a href=\"https://dev.mysql.com/doc/refman/5.7/en/explain-output.html\" target=\"_blank\">https://dev.mysql.com/doc/refman/5.7/en/explain-output.html</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112021\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112021votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112021\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "教你如何比谷歌搜索更快速有效地利用 man", "url": "http://blog.jobbole.com/112016/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/008d9c47f50ab5eac3f349d238b3b6dc.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 5, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/7/using-man-pages\">Greg Pittman</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8722-1.html\">Linux中国/toyijiu</a>   </div><blockquote><p>Linux 的帮助手册其实拥有很多有用的信息，而且比你想象中更容易使用</p></blockquote>\n<p>我们通常通过 google 来查询 Linux 中的命令说明，但是其实还有一个更好的办法：那就是通过 Linux 自带的 <strong>man 帮助页</strong>来查询命令详尽完整的使用说明。</p>\n<p>man 页面的历史本身比 Linux 还长，可以追溯到 Unix 早期那个年代。 通过<a href=\"https://en.wikipedia.org/wiki/Man_page\">这个 Wikipedia</a> 可以知道，Dennis Ritchie 和 Ken Thompson 在 1971 年写了第一个 man 帮助页，那个年代的计算器使用的还是像烤箱一样的计算机，个人电脑还未出世。man 帮助页也有它自己的一套设计精炼的语法，和 Unix 与 Linux 一样，man 帮助页也不是一成不变的，它就像 Linux 内核一样不停地发展更新。</p>\n<p>Man 帮助页通过数字标识符来分成不同类型的内容：</p>\n<ol>\n<li>一般用户命令</li>\n<li>系统调用命令</li>\n<li>库函数</li>\n<li>特殊的文件和驱动程序</li>\n<li>文件格式</li>\n<li>游戏和屏保</li>\n<li>杂项</li>\n<li>系统管理命令和守护进程</li>\n</ol>\n<p>尽管如此，用户一般也不需要知道他们想查询的命令是属于哪一个类型的。</p>\n<p>这些文件格式化的方式在当今许多用户看来有点古怪。因为最开始他们是用 <strong>trooff</strong> 的方式，通过 PostScript 打印机来打印，所以包含了头部和布局方面的格式化信息。在 Linux 中，取而代之使用了一种叫做 <a href=\"https://en.wikipedia.org/wiki/Groff_(software)\">groff</a> 的方法。</p>\n<p>在我的 Fedora 系统中，man 帮助页相关的文件存储在 <code>/usr/share/man</code> 下的子目录中（比如 <code>man1</code> 存储第一部分的命令），还有进一步的子目录用于存储 man 帮助页的翻译。</p>\n<p>如果你在 Shell 中查找 <code>man</code> 命令的 man 帮助页，你时间看到将是 gzip 工具压缩的 <code>man.1.gz</code> 文件。想要查询 man 帮助页，需要输入类似如下命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d12687c40109394177\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nman man\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d12687c40109394177-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d12687c40109394177-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d12687c40109394177-1\"><span class=\"crayon-e\">man </span><span class=\"crayon-i\">man</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d12687c40109394177-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>这个例子会显示 <code>man</code> 命令的 man 帮助页，这将先解压 man 帮助页文件，然后解释格式化指令并用 <code>less</code> 显示结果，所以导航操作和在 <code>less</code> 中一样。</p>\n<p>所有的 man 帮助页都应该显示这些子段落：<strong>Name</strong>、 <strong>Synopsis</strong>、 <strong>Description</strong>、<strong>Examples</strong>、<strong>See</strong>、<strong>Also</strong>。有些还会添加一些额外的子段落，比如 <strong>Options</strong>、 <strong>Exit</strong>、<strong>Status</strong>、 <strong>Environment</strong>、<strong>Bugs</strong>、<strong>Files</strong>、<strong>Author</strong>、<strong>Reporting</strong>、<strong>Bugs</strong>、<strong>History</strong>、<strong>Copyright</strong>。</p>\n<h3 id=\"toc_1\">详细说明一个 man 帮助页</h3>\n<p>为了更详细地介绍一个典型的 man 帮助页，就用 ls 命令的帮助页来分析吧，在 <strong>Name</strong> 分段下，我们可以看到如下内容：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d12687c4b888351954\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nls - list directory contents\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d12687c4b888351954-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d12687c4b888351954-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d12687c4b888351954-1\"><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">list </span><span class=\"crayon-e\">directory </span><span class=\"crayon-i\">contents</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d12687c4b888351954-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>它会简要地告诉我 <code>ls</code> 这条命令的作用.</p>\n<p>在 <code>Synopsis</code> 分段下，我们可以看到如下的内容:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d12687c4f568203753\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nls [OPTION]... [FILE]…\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d12687c4f568203753-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d12687c4f568203753-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d12687c4f568203753-1\"><span class=\"crayon-i\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">OPTION</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">FILE</span><span class=\"crayon-sy\">]</span>…</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d12687c4f568203753-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>任何在中括号中的元素都是可选的。你可以只输入 <code>ls</code> 命令，后面不接任何参数。参数后面的省略号表示你可以添加任意多个彼此兼容的参数，以及许多文件名。对于 <code>[FILE]</code> 参数，你可以指定具体的目录名，或者可以使用通配符 <code>*</code>，比如这个例子，它会显示 <code>Documents</code> 文件夹下的 <code>.txt</code> 文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d12687c53308391944\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nls Documents/*.txt\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d12687c53308391944-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d12687c53308391944-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d12687c53308391944-1\"><span class=\"crayon-e\">ls </span><span class=\"crayon-v\">Documents</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">txt</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d12687c53308391944-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>在 <strong>Description</strong> 分段下, 我们可以看到关于这条命令更加详细的信息，还有关于这条命令各个参数作用的详细介绍的列表，比如说 <code>ls</code> 命令第一个选项 <code>-a</code> 参数，它的作用是显示包括隐藏文件/目录在内的所有文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d12687c56743345482\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n-a, --all \r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d12687c56743345482-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d12687c56743345482-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d12687c56743345482-1\"><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-i\">all</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d12687c56743345482-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>如果我们想用这些参数，要么用它们的别名，比如 <code>-a</code>，要么用它们的全名，比如 <code>--all</code>（两条中划线）。然而并不是所有参数都有全名和别名（比如 <code>--author</code> 只有一种），而且两者的名字并不总是相互关联的（<code>-F</code> 和 <code>--classify</code>）。当你想用多个参数时，要么以空格隔开，要么共用一个连字符 <code>-</code>，在连字符后连续输入你需要的参数（不要添加空格）。比如下面两个等价的例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d12687c5a338679576\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nls -a -d -l\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d12687c5a338679576-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d12687c5a338679576-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d12687c5a338679576-1\"><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d12687c5a338679576-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d12687c5d848515289\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nls -adl\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d12687c5d848515289-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d12687c5d848515289-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d12687c5d848515289-1\"><span class=\"crayon-v\">ls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">adl</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d12687c5d848515289-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>但是 <code>tar</code> 这个命令有些例外，由于一些历史遗留原因，当参数使用别名时可以不用添加连字符 <code>-</code>，因此以下两种命令都是合法的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d12687c60620686983\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntar -cvf filearchive.tar thisdirectory/\r\n\r\ntar cvf filearchive.tar thisdirectory/\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d12687c60620686983-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d12687c60620686983-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d12687c60620686983-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d12687c60620686983-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d12687c60620686983-1\"><span class=\"crayon-v\">tar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">cvf </span><span class=\"crayon-v\">filearchive</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">tar </span><span class=\"crayon-v\">thisdirectory</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d12687c60620686983-2\"> </div><div class=\"crayon-line\" id=\"crayon-59b9d12687c60620686983-3\"><span class=\"crayon-e\">tar </span><span class=\"crayon-e\">cvf </span><span class=\"crayon-v\">filearchive</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">tar </span><span class=\"crayon-v\">thisdirectory</span><span class=\"crayon-o\">/</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d12687c60620686983-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><strong>ls</strong> 的 <strong>Description</strong> 分段后是 <strong>Author</strong>、<strong>Reporting Bugs</strong>、<strong>Copyright</strong>、 <strong>See Also</strong> 等分段。</p>\n<p><strong>See Also</strong> 分段会提供一些相关的 man 帮助页，没事的话可以看看。毕竟除了命令外还有许多其他类型的 man 帮助页。</p>\n<p>有一些命令不是系统命令，而是 Bash 特有的，比如 <code>alias</code> 和 <code>cd</code>。这些 Bash 特有的命令可以在 <strong>BASH_BUILTINS</strong> man 帮助页中查看，和上面的比起来它们的描述更加精炼，不过内容都是类似的。</p>\n<p>其实通过 man 帮助页让你可以获得大量有用的信息，特别是当你想用一个已经很久没用过的命令，需要复习下这条命令的作用时。这个时候 man 帮助页饱受非议的简洁性反而对你来说是更好的。</p>\n<hr>\n<p>作者简介：</p>\n<p>Greg Pittman – Greg 是住在肯塔基州路易斯维尔的一位退休神经学家，但是却对计算机和编程保持着长久的兴趣，从二十世纪六十年代就开始捣腾 Fortran IV 了。随着 Linux 和开源软件的到来，更加激起了他去学习的兴趣并投身于这项事业中，并成为 Scribus 组织的一员。</p>\n<hr>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112016\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112016votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112016\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "Redis 核心概念", "url": "http://blog.jobbole.com/112024/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2016/04/49961db8952e63d98b519b76a2daa5e2.png"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 16, "tags": "IT技术,Redis,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jianshu.com/p/2a4a57c5e313\">高广超</a>   </div><h3>概述</h3>\n<p>Redis 与其他 key – value 缓存产品有以下三个特点：</p>\n<ol>\n<li>Redis支持数据的持久化，可以将内存中的数据保持在磁盘中，重启的时候可以再次加载进行使用。</li>\n<li>Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。</li>\n<li>Redis支持数据的备份，即master-slave模式的数据备份。</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>概念</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Redis 优势</td>\n<td>1. 性能极高 – Redis能读的速度是110000次/s,写的速度是81000次/s 。\n<p>2. 丰富的数据类型 – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。</p>\n<p>3. 原子 – Redis的所有操作都是原子性的，同时Redis还支持对几个操作全并后的原子性执行。</p>\n<p>4. 丰富的特性 – Redis还支持 publish/subscribe, 通知, key 过期等等特性。</p></td>\n</tr>\n<tr>\n<td>Redis与其他key-value存储有什么不同？</td>\n<td>1. Redis有着更为复杂的数据结构并且提供对他们的原子性操作，这是一个不同于其他数据库的进化路径。Redis的数据类型都是基于基本数据结构的同时对程序员透明，无需进行额外的抽象。\n<p>2. Redis运行在内存中但是可以持久化到磁盘，所以在对不同数据集进行高速读写时需要权衡内存，应为数据量不能大于硬件内存。在内存数据库方面的另一个优点是， 相比在磁盘上相同的复杂的数据结构，在内存中操作起来非常简单，这样Redis可以做很多内部复杂性很强的事情。 同时，在磁盘格式方面他们是紧凑的以追加的方式产生的，因为他们并不需要进行随机访问。</p></td>\n</tr>\n</tbody>\n</table>\n<h4>数据类型</h4>\n<table>\n<thead>\n<tr>\n<th>概念</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>String（字符串）</td>\n<td>string是redis最基本的类型，你可以理解成与Memcached一模一样的类型，一个key对应一个value。\n<p>string类型是二进制安全的。意思是redis的string可以包含任何数据。比如jpg图片或者序列化的对象 。</p>\n<p>string类型是Redis最基本的数据类型，一个键最大能存储512MB。</p></td>\n</tr>\n<tr>\n<td>Hash（哈希）</td>\n<td>Redis hash 是一个键值对集合。\n<p>Redis hash是一个string类型的field和value的映射表，hash特别适合用于存储对象。</p>\n<p>每个 hash 可以存储 2 *32 – 1键值对（40多亿）。</p></td>\n</tr>\n<tr>\n<td>List（列表）</td>\n<td>Redis 列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素导列表的头部（左边）或者尾部（右边）。\n<p>列表最多可存储 2*32 – 1元素 (4294967295, 每个列表可存储40多亿)。</p></td>\n</tr>\n<tr>\n<td>Set（集合）</td>\n<td>Redis的Set是string类型的无序集合。\n<p>集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是O(1)。</p>\n<p>集合中最大的成员数为 2<em> 32 – 1(4294967295, 每个集合可存储40多亿个成员)。<br>\n<strong>* </strong></em></p></td>\n</tr>\n<tr>\n<td>zset(sorted set：有序集合)</td>\n<td>Redis zset 和 set 一样也是string类型元素的集合,且不允许重复的成员。\n<p>不同的是每个元素都会关联一个double类型的分数。redis正是通过分数来为集合中的成员进行从小到大的排序。</p>\n<p>zset的成员是唯一的,但分数(score)却可以重复。</p></td>\n</tr>\n</tbody>\n</table>\n<h4>基本概念</h4>\n<table>\n<thead>\n<tr>\n<th>概念</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>HyperLogLog</td>\n<td>Redis 在 2.8.9 版本添加了 HyperLogLog 结构。\n<p>Redis HyperLogLog 是用来做基数统计的算法，HyperLogLog 的优点是，在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定 的、并且是很小的。</p>\n<p>在 Redis 里面，每个 HyperLogLog 键只需要花费 12 KB 内存，就可以计算接近 2^64 个不同元素的基 数。这和计算基数时，元素越多耗费内存就越多的集合形成鲜明对比。</p>\n<p>但是，因为 HyperLogLog 只会根据输入元素来计算基数，而不会储存输入元素本身，所以 HyperLogLog 不能像集合那样，返回输入的各个元素。</p>\n<p>什么是基数?</p>\n<p>比如数据集 {1, 3, 5, 7, 5, 7, 8}， 那么这个数据集的基数集为 {1, 3, 5 ,7, 8}, 基数(不重复元素)为5。 基数估计就是在误差可接受的范围内，快速计算基数。</p></td>\n</tr>\n<tr>\n<td>发布订阅</td>\n<td>Redis 发布订阅(pub/sub)是一种消息通信模式：发送者(pub)发送消息，订阅者(sub)接收消息。\n<p>Redis 客户端可以订阅任意数量的频道。</p>\n<p>下图展示了频道 channel1 ， 以及订阅这个频道的三个客户端 —— client2 、 client5 和 client1 之间的关系：</p>\n<div>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/ab86674b7a9021d28c5d48f0dd02577f.png\"></p>\n<div>pubsub1</div>\n</div>\n<p>当有新消息通过 PUBLISH 命令发送给频道 channel1 时， 这个消息就会被发送给订阅它的三个客户端：</p>\n<div>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/3d22f3afc11b262baf8ae1db4f7ab4f3.png\"></p>\n<div>pubsub2</div>\n</div>\n</td>\n</tr>\n<tr>\n<td>Redis 事务</td>\n<td>Redis 事务可以一次执行多个命令， 并且带有以下两个重要的保证：\n<p>1. 事务是一个单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。</p>\n<p>2. 事务是一个原子操作：事务中的命令要么全部被执行，要么全部都不执行。</p>\n<p>一个事务从开始到执行会经历以下三个阶段：</p>\n<p>a. 开始事务。</p>\n<p>b. 命令入队。</p>\n<p>c. 执行事务。</p></td>\n</tr>\n</tbody>\n</table>\n<h4>复制（Replication）</h4>\n<p>Redis 支持简单且易用的主从复制（master-slave replication）功能， 该功能可以让从服务器(slave server)成为主服务器(master server)的精确复制品。</p>\n<p><strong> 以下是关于 Redis 复制功能的几个重要方面：</strong></p>\n<ol>\n<li>Redis 使用异步复制。 从 Redis 2.8 开始， 从服务器会以每秒一次的频率向主服务器报告复制流（replication stream）的处理进度。</li>\n<li>一个主服务器可以有多个从服务器。</li>\n<li>不仅主服务器可以有从服务器， 从服务器也可以有自己的从服务器， 多个从服务器之间可以构成一个图状结构。</li>\n<li>复制功能不会阻塞主服务器： 即使有一个或多个从服务器正在进行初次同步， 主服务器也可以继续处理命令请求。</li>\n<li>复制功能也不会阻塞从服务器： 只要在 redis.conf 文件中进行了相应的设置， 即使从服务器正在进行初次同步， 服务器也可以使用旧版本的数据集来处理命令查询。不过， 在从服务器删除旧版本数据集并载入新版本数据集的那段时间内， 连接请求会被阻塞。<br>\n你还可以配置从服务器， 让它在与主服务器之间的连接断开时， 向客户端发送一个错误。</li>\n<li>复制功能可以单纯地用于数据冗余（data redundancy）， 也可以通过让多个从服务器处理只读命令请求来提升扩展性（scalability）： 比如说， 繁重的 <a href=\"http://doc.redisfans.com/key/sort.html#sort\" target=\"_blank\">SORT</a> 命令可以交给附属节点去运行。</li>\n<li>可以通过复制功能来让主服务器免于执行持久化操作： 只要关闭主服务器的持久化功能， 然后由从服务器去执行持久化操作即可。</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>概念</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>复制功能的运作原理</td>\n<td>无论是初次连接还是重新连接， 当建立一个从服务器时， 从服务器都将向主服务器发送一个 <a href=\"http://doc.redisfans.com/server/sync.html#sync\" target=\"_blank\">SYNC</a> 命令。\n<p>接到 <a href=\"http://doc.redisfans.com/server/sync.html#sync\" target=\"_blank\">SYNC</a> 命令的主服务器将开始执行 <a href=\"http://doc.redisfans.com/server/bgsave.html#bgsave\" target=\"_blank\">BGSAVE</a> ， 并在保存操作执行期间， 将所有新执行的写入命令都保存到一个缓冲区里面。</p>\n<p>当 <a href=\"http://doc.redisfans.com/server/bgsave.html#bgsave\" target=\"_blank\">BGSAVE</a> 执行完毕后， 主服务器将执行保存操作所得的 .rdb 文件发送给从服务器， 从服务器接收这个 .rdb 文件， 并将文件中的数据载入到内存中。</p>\n<p>之后主服务器会以 Redis 命令协议的格式， 将写命令缓冲区中积累的所有内容都发送给从服务器。</p>\n<p>你可以通过 telnet 命令来亲自验证这个同步过程： 首先连上一个正在处理命令请求的 Redis 服务器， 然后向它发送 <a href=\"http://doc.redisfans.com/server/sync.html#sync\" target=\"_blank\">SYNC</a> 命令， 过一阵子， 你将看到 telnet 会话（session）接收到服务器发来的大段数据（.rdb 文件）， 之后还会看到， 所有在服务器执行过的写命令， 都会重新发送到 telnet 会话来。</p>\n<p>即使有多个从服务器同时向主服务器发送 <a href=\"http://doc.redisfans.com/server/sync.html#sync\" target=\"_blank\">SYNC</a> ， 主服务器也只需执行一次 <a href=\"http://doc.redisfans.com/server/bgsave.html#bgsave\" target=\"_blank\">BGSAVE</a> 命令， 就可以处理所有这些从服务器的同步请求。</p>\n<p>从服务器可以在主从服务器之间的连接断开时进行自动重连， 在 Redis 2.8 版本之前， 断线之后重连的从服务器总要执行一次完整重同步（full resynchronization）操作， 但是从 Redis 2.8 版本开始， 从服务器可以根据主服务器的情况来选择执行完整重同步还是部分重同步（partial resynchronization）。</p></td>\n</tr>\n<tr>\n<td>部分重同步</td>\n<td>从 Redis 2.8 开始， 在网络连接短暂性失效之后， 主从服务器可以尝试继续执行原有的复制进程（process）， 而不一定要执行完整重同步操作。\n<p>这个特性需要主服务器为被发送的复制流创建一个内存缓冲区（in-memory backlog）， 并且主服务器和所有从服务器之间都记录一个复制偏移量（replication offset）和一个主服务器 ID （master run id）， 当出现网络连接断开时， 从服务器会重新连接， 并且向主服务器请求继续执行原来的复制进程：</p>\n<p>1. 如果从服务器记录的主服务器 ID 和当前要连接的主服务器的 ID 相同， 并且从服务器记录的偏移量所指定的数据仍然保存在主服务器的复制流缓冲区里面， 那么主服务器会向从服务器发送断线时缺失的那部分数据， 然后复制工作可以继续执行。</p>\n<p>2. 否则的话， 从服务器就要执行完整重同步操作。</p>\n<p>Redis 2.8 的这个部分重同步特性会用到一个新增的 <a href=\"http://doc.redisfans.com/server/psync.html#psync\" target=\"_blank\">PSYNC</a> 内部命令， 而 Redis 2.8 以前的旧版本只有 <a href=\"http://doc.redisfans.com/server/sync.html#sync\" target=\"_blank\">SYNC</a> 命令， 不过， 只要从服务器是 Redis 2.8 或以上的版本， 它就会根据主服务器的版本来决定到底是使用 <a href=\"http://doc.redisfans.com/server/psync.html#psync\" target=\"_blank\">PSYNC</a> 还是 <a href=\"http://doc.redisfans.com/server/sync.html#sync\" target=\"_blank\">SYNC</a> ：</p>\n<p>1. 如果主服务器是 Redis 2.8 或以上版本，那么从服务器使用 <a href=\"http://doc.redisfans.com/server/psync.html#psync\" target=\"_blank\">PSYNC</a> 命令来进行同步。</p>\n<p>2. 如果主服务器是 Redis 2.8 之前的版本，那么从服务器使用 <a href=\"http://doc.redisfans.com/server/sync.html#sync\" target=\"_blank\">SYNC</a> 命令来进行同步。</p></td>\n</tr>\n<tr>\n<td>只读从服务器</td>\n<td>从 Redis 2.6 开始， 从服务器支持只读模式， 并且该模式为从服务器的默认模式。\n<p>只读模式由 redis.conf 文件中的 slave-read-only 选项控制， 也可以通过 <a href=\"http://doc.redisfans.com/server/config_set.html#config-set\" target=\"_blank\">CONFIG SET</a> 命令来开启或关闭这个模式。</p>\n<p>只读从服务器会拒绝执行任何写命令， 所以不会出现因为操作失误而将数据不小心写入到了从服务器的情况。</p>\n<p>即使从服务器是只读的， DEBUG 和 CONFIG 等管理式命令仍然是可以使用的， 所以我们还是不应该将服务器暴露给互联网或者任何不可信网络。 不过， 使用 redis.conf 中的命令改名选项， 我们可以通过禁止执行某些命令来提升只读从服务器的安全性。</p>\n<p>你可能会感到好奇， 既然从服务器上的写数据会被重同步数据覆盖， 也可能在从服务器重启时丢失， 那么为什么要让一个从服务器变得可写呢？</p>\n<p>原因是， 一些不重要的临时数据， 仍然是可以保存在从服务器上面的。 比如说， 客户端可以在从服务器上保存主服务器的可达性（reachability）信息， 从而实现故障转移（failover）策略。</p></td>\n</tr>\n<tr>\n<td>主服务器只在有至少 N 个从服务器的情况下，才执行写操作</td>\n<td>从 Redis 2.8 开始， 为了保证数据的安全性， 可以通过配置， 让主服务器只在有至少 N 个当前已连接从服务器的情况下， 才执行写命令。\n<p>不过， 因为 Redis 使用异步复制， 所以主服务器发送的写数据并不一定会被从服务器接收到， 因此， 数据丢失的可能性仍然是存在的。</p>\n<p>以下是这个特性的运作原理：</p>\n<p>1 从服务器以每秒一次的频率 PING 主服务器一次， 并报告复制流的处理情况。</p>\n<p>2 主服务器会记录各个从服务器最后一次向它发送 PING 的时间。</p>\n<p>3 用户可以通过配置， 指定网络延迟的最大值 ， 以及执行写操作所需的至少从服务器数量如果至少有 min-slaves-to-write 个从服务器， 并且这些服务器的延迟值都少于 min-slaves-max-lag 秒， 那么主服务器就会执行客户端请求的写操作。</p>\n<p>你可以将这个特性看作 CAP 理论中的 C 的条件放宽版本： 尽管不能保证写操作的持久性， 但起码丢失数据的窗口会被严格限制在指定的秒数中。</p>\n<p>另一方面， 如果条件达不到min-slaves-to-write 和 min-slaves-max-lag 所指定的条件， 那么写操作就不会被执行， 主服务器会向请求执行写操作的客户端返回一个错误。</p>\n<p>以下是这个特性的两个选项和它们所需的参数：</p>\n<p>1 min-slaves-to-write</p>\n<p>2 min-slaves-max-lag</p>\n<p>详细的信息可以参考 Redis 源码中附带的 redis.conf 示例文件。</p></td>\n</tr>\n</tbody>\n</table>\n<h4>事务（transaction）</h4>\n<p><a href=\"http://doc.redisfans.com/transaction/multi.html#multi\" target=\"_blank\">MULTI</a> 、 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 、 <a href=\"http://doc.redisfans.com/transaction/discard.html#discard\" target=\"_blank\">DISCARD</a> 和 <a href=\"http://doc.redisfans.com/transaction/watch.html#watch\" target=\"_blank\">WATCH</a> 是 Redis 事务的基础。<br>\n事务可以一次执行多个命令， 并且带有以下两个重要的保证：</p>\n<ol>\n<li>事务是一个单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。</li>\n<li>事务是一个原子操作：事务中的命令要么全部被执行，要么全部都不执行。<br>\n<a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 命令负责触发并执行事务中的所有命令：\n<ul>\n<li>如果客户端在使用 <a href=\"http://doc.redisfans.com/transaction/multi.html#multi\" target=\"_blank\">MULTI</a> 开启了一个事务之后，却因为断线而没有成功执行 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> ，那么事务中的所有命令都不会被执行。</li>\n<li>另一方面，如果客户端成功在开启事务之后执行 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> ，那么事务中的所有命令都会被执行。<br>\n当使用 AOF 方式做持久化的时候， Redis 会使用单个 write(2) 命令将事务写入到磁盘中。</li>\n</ul>\n</li>\n</ol>\n<p>然而，如果 Redis 服务器因为某些原因被管理员杀死，或者遇上某种硬件故障，那么可能只有部分事务命令会被成功写入到磁盘中。<br>\n如果 Redis 在重新启动时发现 AOF 文件出了这样的问题，那么它会退出，并汇报一个错误。<br>\n使用 redis-check-aof 程序可以修复这一问题：它会移除 AOF 文件中不完整事务的信息，确保服务器可以顺利启动。<br>\n从 2.2 版本开始，Redis 还可以通过乐观锁（optimistic lock）实现 CAS （check-and-set）操作，具体信息请参考文档的后半部分。</p>\n<table>\n<thead>\n<tr>\n<th>概念</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>事务中的错误</td>\n<td>使用事务时可能会遇上以下两种错误：\n<p>1. 事务在执行 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 之前，入队的命令可能会出错。比如说，命令可能会产生语法错误（参数数量错误，参数名错误，等等），或者其他更严重的错误，比如内存不足（如果服务器使用 maxmemory 设置了最大内存限制的话）。</p>\n<p>2. 命令可能在 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 调用之后失败。举个例子，事务中的命令可能处理了错误类型的键，比如将列表命令用在了字符串键上面，诸如此类。</p>\n<p>对于发生在 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 执行之前的错误，客户端以前的做法是检查命令入队所得的返回值：如果命令入队时返回 QUEUED ，那么入队成功；否则，就是入队失败。如果有命令在入队时失败，那么大部分客户端都会停止并取消这个事务。</p>\n<p>不过，从 Redis 2.6.5 开始，服务器会对命令入队失败的情况进行记录，并在客户端调用 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 命令时，拒绝执行并自动放弃这个事务。</p>\n<p>在 Redis 2.6.5 以前， Redis 只执行事务中那些入队成功的命令，而忽略那些入队失败的命令。 而新的处理方式则使得在流水线（pipeline）中包含事务变得简单，因为发送事务和读取事务的回复都只需要和服务器进行一次通讯。</p>\n<p>至于那些在 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 命令执行之后所产生的错误， 并没有对它们进行特别处理： 即使事务中有某个/某些命令在执行时产生了错误， 事务中的其他命令仍然会继续执行。</p>\n<p>最重要的是记住这样一条， 即使事务中有某条/某些命令执行失败了， 事务队列中的其他命令仍然会继续执行 —— Redis 不会停止执行事务中的命令。</p></td>\n</tr>\n<tr>\n<td>Redis 不支持回滚</td>\n<td>如果你有使用关系式数据库的经验， 那么 “Redis 在事务失败时不进行回滚，而是继续执行余下的命令”这种做法可能会让你觉得有点奇怪。\n<p>以下是这种做法的优点：</p>\n<p>1. Redis 命令只会因为错误的语法而失败（并且这些问题不能在入队时发现），或是命令用在了错误类型的键上面：这也就是说，从实用性的角度来说，失败的命令是由编程错误造成的，而这些错误应该在开发的过程中被发现，而不应该出现在生产环境中。</p>\n<p>2. 因为不需要对回滚进行支持，所以 Redis 的内部可以保持简单且快速。</p>\n<p>有种观点认为 Redis 处理事务的做法会产生 bug ， 然而需要注意的是， 在通常情况下， 回滚并不能解决编程错误带来的问题。 举个例子， 如果你本来想通过 <a href=\"http://doc.redisfans.com/string/incr.html#incr\" target=\"_blank\">INCR</a> 命令将键的值加上 1 ， 却不小心加上了 2 ， 又或者对错误类型的键执行了 <a href=\"http://doc.redisfans.com/string/incr.html#incr\" target=\"_blank\">INCR</a> ， 回滚是没有办法处理这些情况的。</p>\n<p>鉴于没有任何机制能避免程序员自己造成的错误， 并且这类错误通常不会在生产环境中出现， 所以 Redis 选择了更简单、更快速的无回滚方式来处理事务。</p></td>\n</tr>\n<tr>\n<td>乐观锁</td>\n<td><a href=\"http://doc.redisfans.com/transaction/watch.html#watch\" target=\"_blank\">WATCH</a> 命令可以为 Redis 事务提供 check-and-set （CAS）行为。\n<p>被 <a href=\"http://doc.redisfans.com/transaction/watch.html#watch\" target=\"_blank\">WATCH</a> 的键会被监视，并会发觉这些键是否被改动过了。 如果有至少一个被监视的键在 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 执行之前被修改了， 那么整个事务都会被取消， <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 返回空多条批量回复（null multi-bulk reply）来表示事务已经失败。</p>\n<p>举个例子， 假设我们需要原子性地为某个值进行增 1 操作（假设 <a href=\"http://doc.redisfans.com/string/incr.html#incr\" target=\"_blank\">INCR</a> 不存在）。</p>\n<p>首先我们可能会这样做：</p>\n<p>val = GETmykey</p>\n<p>val = val + 1</p>\n<p>SET mykey $val</p>\n<p>上面的这个实现在只有一个客户端的时候可以执行得很好。 但是， 当多个客户端同时对同一个键进行这样的操作时， 就会产生竞争条件。</p>\n<p>举个例子， 如果客户端 A 和 B 都读取了键原来的值， 比如 10 ， 那么两个客户端都会将键的值设为 11 ， 但正确的结果应该是 12 才对。</p>\n<p>有了 <a href=\"http://doc.redisfans.com/transaction/watch.html#watch\" target=\"_blank\">WATCH</a> ， 我们就可以轻松地解决这类问题了：</p>\n<p>WATCH mykey</p>\n<p>val = GET mykey</p>\n<p>val = val + 1</p>\n<p>MULTI</p>\n<p>SET mykey $val</p>\n<p>EXEC</p>\n<p>使用上面的代码， 如果在 <a href=\"http://doc.redisfans.com/transaction/watch.html#watch\" target=\"_blank\">WATCH</a> 执行之后， <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 执行之前， 有其他客户端修改了 mykey 的值， 那么当前客户端的事务就会失败。 程序需要做的， 就是不断重试这个操作， 直到没有发生碰撞为止。</p>\n<p>这种形式的锁被称作乐观锁， 它是一种非常强大的锁机制。 并且因为大多数情况下， 不同的客户端会访问不同的键， 碰撞的情况一般都很少， 所以通常并不需要进行重试。</p></td>\n</tr>\n<tr>\n<td>WATCH</td>\n<td><a href=\"http://doc.redisfans.com/transaction/watch.html#watch\" target=\"_blank\">WATCH</a> 使得 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 命令需要有条件地执行： 事务只能在所有被监视键都没有被修改的前提下执行， 如果这个前提不能满足的话，事务就不会被执行。\n<p>如果你使用 <a href=\"http://doc.redisfans.com/transaction/watch.html#watch\" target=\"_blank\">WATCH</a> 监视了一个带过期时间的键， 那么即使这个键过期了， 事务仍然可以正常执行， 关于这方面的详细情况，请看这个帖子： <a href=\"http://code.google.com/p/redis/issues/detail?id=270\" target=\"_blank\">http://code.google.com/p/redis/issues/detail?id=270</a></p>\n<p><a href=\"http://doc.redisfans.com/transaction/watch.html#watch\" target=\"_blank\">WATCH</a> 命令可以被调用多次。 对键的监视从 <a href=\"http://doc.redisfans.com/transaction/watch.html#watch\" target=\"_blank\">WATCH</a> 执行之后开始生效， 直到调用 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 为止。</p>\n<p>用户还可以在单个 <a href=\"http://doc.redisfans.com/transaction/watch.html#watch\" target=\"_blank\">WATCH</a> 命令中监视任意多个键， 就像这样：</p>\n<p>redis&gt; WATCH key1 key2 key3</p>\n<p>OK</p>\n<p>当 <a href=\"http://doc.redisfans.com/transaction/exec.html#exec\" target=\"_blank\">EXEC</a> 被调用时， 不管事务是否成功执行， 对所有键的监视都会被取消。</p>\n<p>另外， 当客户端断开连接时， 该客户端对键的监视也会被取消。</p>\n<p>使用无参数的 <a href=\"http://doc.redisfans.com/transaction/unwatch.html#unwatch\" target=\"_blank\">UNWATCH</a> 命令可以手动取消对所有键的监视。 对于一些需要改动多个键的事务， 有时候程序需要同时对多个键进行加锁， 然后检查这些键的当前值是否符合程序的要求。 当值达不到要求时， 就可以使用 <a href=\"http://doc.redisfans.com/transaction/unwatch.html#unwatch\" target=\"_blank\">UNWATCH</a> 命令来取消目前对键的监视， 中途放弃这个事务， 并等待事务的下次尝试。</p>\n<p><a href=\"http://doc.redisfans.com/transaction/watch.html#watch\" target=\"_blank\">WATCH</a> 可以用于创建 Redis 没有内置的原子操作。</p></td>\n</tr>\n<tr>\n<td>Redis 脚本和事务</td>\n<td>从定义上来说， Redis 中的脚本本身就是一种事务， 所以任何在事务里可以完成的事， 在脚本里面也能完成。 并且一般来说， 使用脚本要来得更简单，并且速度更快。\n<p>因为脚本功能是 Redis 2.6 才引入的， 而事务功能则更早之前就存在了， 所以 Redis 才会同时存在两种处理事务的方法。</p>\n<p>不过我们并不打算在短时间内就移除事务功能， 因为事务提供了一种即使不使用脚本， 也可以避免竞争条件的方法， 而且事务本身的实现并不复杂。</p>\n<p>不过在不远的将来， 可能所有用户都会只使用脚本来实现事务也说不定。 如果真的发生这种情况的话， 那么我们将废弃并最终移除事务功能。</p></td>\n</tr>\n</tbody>\n</table>\n<h4>Sentinel</h4>\n<p>Redis 的 Sentinel 系统用于管理多个 Redis 服务器（instance）， 该系统执行以下三个任务：</p>\n<ol>\n<li><strong>监控（Monitoring）</strong>： Sentinel 会不断地检查你的主服务器和从服务器是否运作正常。</li>\n<li><strong>提醒（Notification）</strong>： 当被监控的某个 Redis 服务器出现问题时， Sentinel 可以通过 API 向管理员或者其他应用程序发送通知。</li>\n<li><strong>自动故障迁移（Automatic failover）</strong>： 当一个主服务器不能正常工作时， Sentinel 会开始一次自动故障迁移操作， 它会将失效主服务器的其中一个从服务器升级为新的主服务器， 并让失效主服务器的其他从服务器改为复制新的主服务器； 当客户端试图连接失效的主服务器时， 集群也会向客户端返回新主服务器的地址， 使得集群可以使用新主服务器代替失效服务器。</li>\n</ol>\n<p>Redis Sentinel 是一个分布式系统， 你可以在一个架构中运行多个 Sentinel 进程（progress）， 这些进程使用流言协议（gossip protocols)来接收关于主服务器是否下线的信息， 并使用投票协议（agreement protocols）来决定是否执行自动故障迁移， 以及选择哪个从服务器作为新的主服务器。<br>\n虽然 Redis Sentinel 释出为一个单独的可执行文件 redis-sentinel ， 但实际上它只是一个运行在特殊模式下的 Redis 服务器， 你可以在启动一个普通 Redis 服务器时通过给定 –sentinel 选项来启动 Redis Sentinel 。<br>\nRedis Sentinel 目前仍在开发中， 这个文档的内容可能随着 Sentinel 实现的修改而变更。<br>\nRedis Sentinel 兼容 Redis 2.4.16 或以上版本， 推荐使用 Redis 2.8.0 或以上的版本。</p>\n<table>\n<thead>\n<tr>\n<th>概念</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>主观下线和客观下线</td>\n<td>Redis 的 Sentinel 中关于下线（down）有两个不同的概念：\n<p>1. 主观下线（Subjectively Down， 简称 SDOWN）指的是单个 Sentinel 实例对服务器做出的下线判断。</p>\n<p>2. 客观下线（Objectively Down， 简称 ODOWN）指的是多个 Sentinel 实例在对同一个服务器做出 SDOWN 判断， 并且通过 SENTINEL is-master-down-by-addr 命令互相交流之后， 得出的服务器下线判断。 （一个 Sentinel 可以通过向另一个 Sentinel 发送 SENTINEL is-master-down-by-addr 命令来询问对方是否认为给定的服务器已下线。）</p>\n<p>如果一个服务器没有在 master-down-after-milliseconds 选项所指定的时间内， 对向它发送 <a href=\"http://doc.redisfans.com/connection/ping.html#ping\" target=\"_blank\">PING</a> 命令的 Sentinel 返回一个有效回复（valid reply）， 那么 Sentinel 就会将这个服务器标记为主观下线。</p>\n<p>服务器对 <a href=\"http://doc.redisfans.com/connection/ping.html#ping\" target=\"_blank\">PING</a> 命令的有效回复可以是以下三种回复的其中一种：</p>\n<p>1. 返回 +PONG 。</p>\n<p>2. 返回 -LOADING 错误。</p>\n<p>3. 返回 -MASTERDOWN 错误。</p>\n<p>如果服务器返回除以上三种回复之外的其他回复， 又或者在指定时间内没有回复 <a href=\"http://doc.redisfans.com/connection/ping.html#ping\" target=\"_blank\">PING</a> 命令， 那么 Sentinel 认为服务器返回的回复无效（non-valid）。</p>\n<p>注意， 一个服务器必须在 master-down-after-milliseconds 毫秒内， 一直返回无效回复才会被 Sentinel 标记为主观下线。</p>\n<p>举个例子， 如果 master-down-after-milliseconds 选项的值为 30000 毫秒（30 秒）， 那么只要服务器能在每 29 秒之内返回至少一次有效回复， 这个服务器就仍然会被认为是处于正常状态的。</p>\n<p>从主观下线状态切换到客观下线状态并没有使用严格的法定人数算法（strong quorum algorithm）， 而是使用了流言协议： 如果 Sentinel 在给定的时间范围内， 从其他 Sentinel 那里接收到了足够数量的主服务器下线报告， 那么 Sentinel 就会将主服务器的状态从主观下线改变为客观下线。 如果之后其他 Sentinel 不再报告主服务器已下线， 那么客观下线状态就会被移除。</p>\n<p>客观下线条件<strong>只适用于主服务器</strong>： 对于任何其他类型的 Redis 实例， Sentinel 在将它们判断为下线前不需要进行协商， 所以从服务器或者其他 Sentinel 永远不会达到客观下线条件。</p>\n<p>只要一个 Sentinel 发现某个主服务器进入了客观下线状态， 这个 Sentinel 就可能会被其他 Sentinel 推选出， 并对失效的主服务器执行自动故障迁移操作。</p></td>\n</tr>\n<tr>\n<td>每个 Sentinel 都需要定期执行的任务</td>\n<td>1. 每个 Sentinel 以每秒钟一次的频率向它所知的主服务器、从服务器以及其他 Sentinel 实例发送一个 <a href=\"http://doc.redisfans.com/connection/ping.html#ping\" target=\"_blank\">PING</a> 命令。\n<p>2. 如果一个实例（instance）距离最后一次有效回复 <a href=\"http://doc.redisfans.com/connection/ping.html#ping\" target=\"_blank\">PING</a> 命令的时间超过 down-after-milliseconds 选项所指定的值， 那么这个实例会被 Sentinel 标记为主观下线。 一个有效回复可以是： +PONG 、 -LOADING 或者 -MASTERDOWN 。</p>\n<p>3. 如果一个主服务器被标记为主观下线， 那么正在监视这个主服务器的所有 Sentinel 要以每秒一次的频率确认主服务器的确进入了主观下线状态。</p>\n<p>4. 如果一个主服务器被标记为主观下线， 并且有足够数量的 Sentinel （至少要达到配置文件指定的数量）在指定的时间范围内同意这一判断， 那么这个主服务器被标记为客观下线。</p>\n<p>5. 在一般情况下， 每个 Sentinel 会以每 10 秒一次的频率向它已知的所有主服务器和从服务器发送 <a href=\"http://doc.redisfans.com/server/info.html#info\" target=\"_blank\">INFO</a> 命令。 当一个主服务器被 Sentinel 标记为客观下线时， Sentinel 向下线主服务器的所有从服务器发送 <a href=\"http://doc.redisfans.com/server/info.html#info\" target=\"_blank\">INFO</a> 命令的频率会从 10 秒一次改为每秒一次。</p>\n<p>6. 当没有足够数量的 Sentinel 同意主服务器已经下线， 主服务器的客观下线状态就会被移除。 当主服务器重新向 Sentinel 的 <a href=\"http://doc.redisfans.com/connection/ping.html#ping\" target=\"_blank\">PING</a>命令返回有效回复时， 主服务器的主管下线状态就会被移除。</p></td>\n</tr>\n<tr>\n<td>自动发现 Sentinel 和从服务器</td>\n<td>一个 Sentinel 可以与其他多个 Sentinel 进行连接， 各个 Sentinel 之间可以互相检查对方的可用性， 并进行信息交换。\n<p>你无须为运行的每个 Sentinel 分别设置其他 Sentinel 的地址， 因为 Sentinel 可以通过发布与订阅功能来自动发现正在监视相同主服务器的其他 Sentinel ， 这一功能是通过向频道 <strong>sentinel</strong>:hello 发送信息来实现的。</p>\n<p>与此类似， 你也不必手动列出主服务器属下的所有从服务器， 因为 Sentinel 可以通过询问主服务器来获得所有从服务器的信息。</p>\n<p>1. 每个 Sentinel 会以每两秒一次的频率， 通过发布与订阅功能， 向被它监视的所有主服务器和从服务器的 <strong>sentinel</strong>:hello 频道发送一条信息， 信息中包含了 Sentinel 的 IP 地址、端口号和运行 ID （runid）。</p>\n<p>2. 每个 Sentinel 都订阅了被它监视的所有主服务器和从服务器的 <strong>sentinel</strong>:hello 频道， 查找之前未出现过的 sentinel （looking for unknown sentinels）。 当一个 Sentinel 发现一个新的 Sentinel 时， 它会将新的 Sentinel 添加到一个列表中， 这个列表保存了 Sentinel 已知的， 监视同一个主服务器的所有其他 Sentinel 。</p>\n<p>3. Sentinel 发送的信息中还包括完整的主服务器当前配置（configuration）。 如果一个 Sentinel 包含的主服务器配置比另一个 Sentinel 发送的配置要旧， 那么这个 Sentinel 会立即升级到新配置上。</p>\n<p>4. 在将一个新 Sentinel 添加到监视主服务器的列表上面之前， Sentinel 会先检查列表中是否已经包含了和要添加的 Sentinel 拥有相同运行 ID 或者相同地址（包括 IP 地址和端口号）的 Sentinel ， 如果是的话， Sentinel 会先移除列表中已有的那些拥有相同运行 ID 或者相同地址的 Sentinel ， 然后再添加新 Sentinel 。</p></td>\n</tr>\n<tr>\n<td>故障转移</td>\n<td>一次故障转移操作由以下步骤组成：\n<p>1. 发现主服务器已经进入客观下线状态。</p>\n<p>2. 对我们的当前纪元进行自增（详情请参考 <a href=\"https://www.google.com.hk/search?q=Raft+leader+election&amp;client=ubuntu&amp;channel=cs&amp;oq=Raft+leader+election&amp;aqs=chrome..69i57&amp;sourceid=chrome&amp;ie=UTF-8\" target=\"_blank\">Raft leader election</a> ）， 并尝试在这个纪元中当选。</p>\n<p>3. 如果当选失败， 那么在设定的故障迁移超时时间的两倍之后， 重新尝试当选。 如果当选成功， 那么执行以下步骤。</p>\n<p>4. 选出一个从服务器，并将它升级为主服务器。</p>\n<p>5. 向被选中的从服务器发送 SLAVEOF NO ONE 命令，让它转变为主服务器。</p>\n<p>6. 通过发布与订阅功能， 将更新后的配置传播给所有其他 Sentinel ， 其他 Sentinel 对它们自己的配置进行更新。</p>\n<p>7. 向已下线主服务器的从服务器发送 <a href=\"http://doc.redisfans.com/server/slaveof.html#slaveof\" target=\"_blank\">SLAVEOF</a> 命令， 让它们去复制新的主服务器。</p>\n<p>8. 当所有从服务器都已经开始复制新的主服务器时， 领头 Sentinel 终止这次故障迁移操作。</p>\n<p>每当一个 Redis 实例被重新配置（reconfigured） —— 无论是被设置成主服务器、从服务器、又或者被设置成其他主服务器的从服务器 —— Sentinel 都会向被重新配置的实例发送一个 CONFIG REWRITE 命令， 从而确保这些配置会持久化在硬盘里。</p>\n<p>Sentinel 使用以下规则来选择新的主服务器：</p>\n<p>1. 在失效主服务器属下的从服务器当中， 那些被标记为主观下线、已断线、或者最后一次回复 <a href=\"http://doc.redisfans.com/connection/ping.html#ping\" target=\"_blank\">PING</a> 命令的时间大于五秒钟的从服务器都会被淘汰。</p>\n<p>2. 在失效主服务器属下的从服务器当中， 那些与失效主服务器连接断开的时长超过 down-after 选项指定的时长十倍的从服务器都会被淘汰。</p>\n<p>3. 在经历了以上两轮淘汰之后剩下来的从服务器中， 我们选出复制偏移量（replication offset）最大的那个从服务器作为新的主服务器； 如果复制偏移量不可用， 或者从服务器的复制偏移量相同， 那么带有最小运行 ID 的那个从服务器成为新的主服务器。</p>\n<p><strong> Sentinel 自动故障迁移的一致性特质</strong></p>\n<p>Sentinel 自动故障迁移使用 Raft 算法来选举领头（leader） Sentinel ， 从而确保在一个给定的纪元（epoch）里， 只有一个领头产生。</p>\n<p>这表示在同一个纪元中， 不会有两个 Sentinel 同时被选中为领头， 并且各个 Sentinel 在同一个纪元中只会对一个领头进行投票。</p>\n<p>更高的配置纪元总是优于较低的纪元， 因此每个 Sentinel 都会主动使用更新的纪元来代替自己的配置。</p>\n<p>简单来说， 我们可以将 Sentinel 配置看作是一个带有版本号的状态。 一个状态会以最后写入者胜出（last-write-wins）的方式（也即是，最新的配置总是胜出）传播至所有其他 Sentinel 。</p>\n<p>举个例子， 当出现网络分割（<a href=\"http://en.wikipedia.org/wiki/Network_partition\" target=\"_blank\">network partitions</a>）时， 一个 Sentinel 可能会包含了较旧的配置， 而当这个 Sentinel 接到其他 Sentinel 发来的版本更新的配置时， Sentinel 就会对自己的配置进行更新。</p>\n<p>如果要在网络分割出现的情况下仍然保持一致性， 那么应该使用 min-slaves-to-write 选项， 让主服务器在连接的从实例少于给定数量时停止执行写操作， 与此同时， 应该在每个运行 Redis 主服务器或从服务器的机器上运行 Redis Sentinel 进程。</p>\n<p><strong> Sentinel 状态的持久化 </strong></p>\n<p>Sentinel 的状态会被持久化在 Sentinel 配置文件里面。</p>\n<p>每当 Sentinel 接收到一个新的配置， 或者当领头 Sentinel 为主服务器创建一个新的配置时， 这个配置会与配置纪元一起被保存到磁盘里面。</p>\n<p>这意味着停止和重启 Sentinel 进程都是安全的。</p>\n<p><strong> Sentinel 在非故障迁移的情况下对实例进行重新配置</strong></p>\n<p>即使没有自动故障迁移操作在进行， Sentinel 总会尝试将当前的配置设置到被监视的实例上面。 特别是：</p>\n<p>1. 根据当前的配置， 如果一个从服务器被宣告为主服务器， 那么它会代替原有的主服务器， 成为新的主服务器， 并且成为原有主服务器的所有从服务器的复制对象。</p>\n<p>2. 那些连接了错误主服务器的从服务器会被重新配置， 使得这些从服务器会去复制正确的主服务器。</p>\n<p>不过， 在以上这些条件满足之后， Sentinel 在对实例进行重新配置之前仍然会等待一段足够长的时间， 确保可以接收到其他 Sentinel 发来的配置更新， 从而避免自身因为保存了过期的配置而对实例进行了不必要的重新配置。</p></td>\n</tr>\n<tr>\n<td>TILT 模式</td>\n<td>Redis Sentinel 严重依赖计算机的时间功能： 比如说， 为了判断一个实例是否可用， Sentinel 会记录这个实例最后一次相应 <a href=\"http://doc.redisfans.com/connection/ping.html#ping\" target=\"_blank\">PING</a> 命令的时间， 并将这个时间和当前时间进行对比， 从而知道这个实例有多长时间没有和 Sentinel 进行任何成功通讯。\n<p>不过， 一旦计算机的时间功能出现故障， 或者计算机非常忙碌， 又或者进程因为某些原因而被阻塞时， Sentinel 可能也会跟着出现故障。</p>\n<p>TILT 模式是一种特殊的保护模式： 当 Sentinel 发现系统有些不对劲时， Sentinel 就会进入 TILT 模式。</p>\n<p>因为 Sentinel 的时间中断器默认每秒执行 10 次， 所以我们预期时间中断器的两次执行之间的间隔为 100 毫秒左右。 Sentinel 的做法是， 记录上一次时间中断器执行时的时间， 并将它和这一次时间中断器执行的时间进行对比：</p>\n<p>1. 如果两次调用时间之间的差距为负值， 或者非常大（超过 2 秒钟）， 那么 Sentinel 进入 TILT 模式。</p>\n<p>2. 如果 Sentinel 已经进入 TILT 模式， 那么 Sentinel 延迟退出 TILT 模式的时间。</p>\n<p>当 Sentinel 进入 TILT 模式时， 它仍然会继续监视所有目标， 但是：</p>\n<p>1. 它不再执行任何操作，比如故障转移。</p>\n<p>2. 当有实例向这个 Sentinel 发送 SENTINEL is-master-down-by-addr 命令时， Sentinel 返回负值： 因为这个 Sentinel 所进行的下线判断已经不再准确。</p>\n<p>如果 TILT 可以正常维持 30 秒钟， 那么 Sentinel 退出 TILT 模式。</p></td>\n</tr>\n</tbody>\n</table>\n<h3>其他</h3>\n<p><a href=\"http://doc.redisfans.com/topic/cluster-tutorial.html\" target=\"_blank\">集群教程</a><br>\n<a href=\"http://doc.redisfans.com/topic/cluster-spec.html\" target=\"_blank\">Redis 集群规范</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112024\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112024votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112024\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 16 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "开发团队面临的 3 大安全挑战", "url": "http://blog.jobbole.com/112007/", "front_image_url": ["http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-security.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 0, "tags": "IT技术,安全,开发", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>应用安全不能只依靠防火墙，必须要在应用开发阶段采取适当的安全控制措施，使得应用在发布上线前就具备较好的安全性，避免人为失误造成安全隐患。</p>\n<p><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-security.jpg\" alt=\"\" width=\"1000\" height=\"414\"></p>\n<p>不少企业早就意识到了这一点，然而理想和现实之间还隔着几十个安全漏洞，尤其是那些采用敏捷或者精益开发模式的团队，在具体的实践过程中，几乎无可避免的会遭遇到下面几个挑战。</p>\n<h3>挑战1：一次性的安全检查无法匹配持续性的交付</h3>\n<p>为确保团队开发出来的应用具有足够的安全性，最常见的选择是对其进行全方位的安全渗透测试。无论这样的测试是由企业自己的安全团队执行，还是购买外部第三方服务，最终都会得到一份详细的安全报告，团队接下来需要做的就是基于这份报告所揭露的漏洞，对应用进行相应的调整，直到安全漏洞被修复为止。</p>\n<p>持续交付是敏捷、精益开发团队的核心能力之一，这意味着团队可以做到每周甚至任意时刻发布产品，持续性的从真实环境中获取市场反馈，然后基于这些反馈对产品进行调整。一个可以参考的案例是，早在2014年的时候，亚马逊平均每秒有一次以上的产品部署，每天如此。</p>\n<p>与此同时，安全渗透测试却没有这么高的“交付”速度。由于渗透测试的特殊性，虽然有大量的自动化漏洞扫描工具可以使用，但是一次全面、高质量的渗透测试依然需要人工参与，几天甚至一两周之后才能得到测试报告是普遍现象。</p>\n<p>那么问题来了，一方面开发团队持续性的每周都有新功能上线和旧功能调整，另一方面渗透测试却没办法在这么短的时间里完成，它只能是阶段性、或者定期性的进行，例如每个季度测试一次。</p>\n<p><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/2-develop-team-1024x614.jpg\" alt=\"\" width=\"700\" height=\"420\"></p>\n<p>这种情况下，开发团队该何去何从？如果要安全，那么就得等着做渗透测试，而且一旦发现安全漏洞还要花额外的时间去修复，产品发布必定会延期。如果要效率，那么就只能冒着风险发布，因为谁也不知道当前应用有没有安全漏洞，万一被黑客发现并且加以利用，后果不堪设想。</p>\n<p>问题的关键在于，开发团队是在持续的发布应用到生产环境，然而渗透测试却是个相当耗时的一次性活动，它没办法跟上这么快的交付速度。</p>\n<h3>挑战2：缺乏自动化、自助化的支持，安全实践落地难</h3>\n<p>开发团队其实明白安全对于应用而言至关重要，也知道在开发过程中就应当通过运用各种安全最佳实践来主动消除安全问题，把安全风险降至最低。不过现状却是，不少安全实践要么无法落地实施，要么有流于形式的倾向。</p>\n<p><strong>一个真实的案例</strong></p>\n<p><em>一个开发团队在做完业务需求梳理后，立即进入了开发阶段。安全团队虽然在项目启动时提出过安全要求，例如要求团队采用威胁建模活动，识别出应用面临的安全威胁，并制定应对措施。然而由于该项目交付压力大，时间紧任务重，再加上团队成员对于威胁建模并不熟悉，最后这个活动被一拖再拖，直到应用开发完毕进行上线前的审批时，才发现没有做威胁建模，而此刻为了能让应用按时上线，只好回过头来临时补一份威胁建模的文档，仅用于应付安全部门的要求。这种情况下，安全威胁根本得不到全面的分析和应对，风险由此而生。</em></p>\n<p>在项目前期的设计阶段是进行威胁识别的最佳时刻，开发团队只要在这时做一次威胁建模，就能识别出潜在的安全风险，并且在接下来的开发过程中采取适当的措施加以应对。但是开发团队却仿佛是懒癌晚期患者，硬是拖到上线前才把威胁建模补上，而此时它早已失去意义。</p>\n<p><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/3-useless-1024x683.jpg\" alt=\"\" width=\"700\" height=\"467\"></p>\n<p>为何开发团队一边认同安全的重要性，一边却又对安全实践如此怠慢呢？本质原因在于，某些安全实践需要大量人工参与，或者对人员安全技能有很高的要求，与此同时又缺乏自动化、自助化的支持，因此在开发团队看来，这些实践的采纳成本太高，在面临交付压力的情况下选择性的忽略，或者认认真真的走个形式，就成了再正常不过的结果。</p>\n<h3>挑战3：高耸的部门墙让开发和安全团队难以进行高效的协作</h3>\n<p>随着敏捷、精益开发模式的普及，再加上DevOps转型的助推，不少企业已经开始组建全功能开发团队，团队中各个角色有着共同的目标，相互协作以更高的效率交付应用。但是安全团队却依然隶属于一墙之隔的安全部门。</p>\n<p>别小看了这堵墙，说它是万恶之源有点太夸张，但它的存在确确实实阻碍了企业实现其业务价值最大化。墙的这边，开发团队竭尽所能的以最快的速度完成应用开发，以求尽快上线获取反馈；墙的另一边，安全团队只关心应用是否安全，至于是否急着上线，那不是他们关心的问题。但是他们都忽略了一个事实，那就是企业的成功需要两者共同高效的协作。</p>\n<h3>小结</h3>\n<p>敏捷、精益团队一方面要保持快速的交付速度，一方面还要提高应用的安全质量，看上去这是鱼和熊掌不可兼得的事情，然而事实上我们依然有办法解决这些挑战。</p>\n<p>开发团队可以通过自动化，显著降低安全实践的实施难度和成本，把一次性的安全检查转变为持续性的安全质量反馈。对于安全团队，也应当向着开发团队迈进一步，打通开发和安全部门之间的隔离，以更加紧密和高效协作的方式，共同确保应用具备更高的安全质量。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112007\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112007votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112007\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 72</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "REST 的 6 个约束", "url": "http://blog.jobbole.com/112006/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/08/544851c6c17d5b59f6fe22f223db85aa.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 2, "tags": "IT技术,API,Rest", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/yalishizhude\">亚里士朱德</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://en.wikipedia.org/wiki/Representational_state_transfer#Client-server\">wikipedia</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>定义个一个 RESTful 系统的时候应该遵循 6 个约束。</p>\n<p>它们限制了服务端只能遵循这些约束来处理和响应客户端请求，但是遵循这些约束服务也可以获取理想的非函数化的属性，例如性能、可伸缩、简单程度、可变能力、可见度、灵活性、可信度。</p>\n<p>如果任何一个服务违背了其中一个原则，将不能被称作 RESTful 系统。</p>\n<p>标准的 REST 约束如下：</p>\n<h3 id=\"客户端-服务器\">客户端-服务器</h3>\n<p><em>参考内容：<a href=\"https://en.wikipedia.org/wiki/Client%E2%80%93server_model\" target=\"_blank\" rel=\"external\">客户端-服务器模型</a></em></p>\n<p>第一个约束是基于<strong>客户端-服务器</strong>架构背后的原则——关注点分离。通过分离用户界面和数据存储这两个关注点，提高了用户界面跨平台的可能性，通过简化服务器组件提高了其可伸缩性。这种分离对于Web来说更加重要的意义是，它使得组件能够进行独立修改和扩展，从而能够支持大量组织的网络化需求。</p>\n<h3 id=\"无状态\">无状态</h3>\n<p><em>参考内容：<a href=\"https://en.wikipedia.org/wiki/Stateless_protocol\" target=\"_blank\" rel=\"external\">无状态协议</a></em></p>\n<p>客户端-服务器通信的一个制约条件就是服务端无法存储客户端的上下文执行环境。从任何客户端发出的每个请求都包含了服务端所必要的信息，但是会话状态仍留在客户端。</p>\n<p>然而在服务端会话状态可以轻松实现跨服务调用，例如利用数据库做持久化来保存一段时间内的身份认证信息。客户端开始发送请求时，它已准备好过渡到一个新的状态。当一个或多个请求正在发送时，客户端处于过渡状态。每个应用程序状态的表示包含可在下一次客户端选择发起一个新的状态过渡使用的链接。</p>\n<h3 id=\"可缓存\">可缓存</h3>\n<p><em>参考内容：<a href=\"https://en.wikipedia.org/wiki/Web_cache\" target=\"_blank\" rel=\"external\">网页缓存</a></em></p>\n<p>互联网中的客户端和中间层服务器可以缓存响应。因此响应必须直接或间接定义自身是否可被缓存，以免客户端使用过期的响应数据来发送其它请求。良好的缓存策略可以有效减少客户端-服务器之间的交互，从而进一步提高系统的可伸缩性和性能。</p>\n<h3 id=\"分层系统\">分层系统</h3>\n<p><em>参考内容：<a href=\"https://en.wikipedia.org/w/index.php?title=Representational_state_transfer&amp;action=edit&amp;section=7\" target=\"_blank\" rel=\"external\">分层系统</a></em></p>\n<p>客户端通常无法判断它是否是直接连接到后端服务器，还是中间服务器。中间服务器可通过启用负载平衡，并通过提供共享高速缓存来提高系统的可扩展性。当然也可以强制执行安全政策。</p>\n<h3 id=\"按需代码（可选）\">按需代码（可选）</h3>\n<p><em>参考内容：<a href=\"https://en.wikipedia.org/wiki/Dynamic_web_page#Client-side_scripting\" target=\"_blank\" rel=\"external\">客户端脚本</a></em></p>\n<p>服务端可以通过传递可执行代码临时为客户端扩展或自定义功能。这方面的例子包括可编译的组件如Java applets和客户机端脚本如JavaScript。</p>\n<h3 id=\"统一的接口\">统一的接口</h3>\n<p>统一接口约束是设计任何REST服务的基础。它简化和解耦的架构，使得每个部分可以独立被修改。这个统一的接口包含了四个约束：</p>\n<h3 id=\"资源的标识\">资源的标识</h3>\n<p>各种资源都在请求中被确定，例如在使用URI的Web REST系统中，资源本身就表明它们想要被返回给客户端的格式。例如服务端可以从它的数据库发送HTML，XML或JSON格式的数据，即使这些都不是服务端的内部数据格式。</p>\n<h3 id=\"通过表述来操作资源\">通过表述来操作资源</h3>\n<p>当一个客户端持有一种资源的表述时，包括任何关联的元数据，它都有足够的信息来修改或删除该资源。</p>\n<h3 id=\"自描述的消息\">自描述的消息</h3>\n<p>每条信息都包含足够的信息来描述如何处理消息本身。例如，一个网络媒体类型本身就定义了能运行该媒体的解析器（以前被称为MIME类型）。</p>\n<h3 id=\"超媒体作为应用程序状态的引擎（HATEOAS）\">超媒体作为应用程序状态的引擎（HATEOAS）</h3>\n<p>已经初始化URI的REST客户端应用，应该就像人们访问了一个Web网站主页一样，能够使用服务器提供的动态链接，请求它所需的资源和进行所需的操作。</p>\n<p>处理客户端访问时，服务端将响应内容也包括当前可用的其它行为的超链接。没有必要对REST服务的结构或动态信息进行硬编码来响应客户端客户端。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://www.jobbole.com/wp-content/uploads/2016/03/981844a17323ad7e3f25209b78bc671c1.jpg\">\n            \n                            <img src=\"http://www.jobbole.com/wp-content/uploads/2016/03/ccd097a7b57abdd91d882ff55cda32091.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112006\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112006votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112006\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/yalishizhude\">亚里士朱德</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/yalishizhude\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/4a4b7e0673565612b7c599e582face0c.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            JSP工程师，多年大型国际项目开发经验。WEB前端工程师，擅长PC端以及移动端开发。js全栈工程师，熟悉node.js、mongoDB。开发者头条top10专栏作者慕课网签约讲师个人博客：yalishizhude.github.io        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/yalishizhude\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/yalishizhude/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/yalishizhude/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 19</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://yalishizhude.github.io/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/arisjutle\"><i class=\"fa fa-weibo\"></i></a> <a title=\"QQ：381355576\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/yalishizhude\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "MySQL 高性能表设计规范", "url": "http://blog.jobbole.com/112035/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/dea4002e77dd3ecd398568bf746ea46c.png"], "praise_nums": "3", "comment_nums": 2, "fav_nums": 7, "tags": "IT技术,MySQL,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.jianshu.com/p/f797bbe11d76\">高广超</a>   </div><div>\n<div>\n<p>良好的逻辑设计和物理设计是高性能的基石， 应该根据系统将要执行的查询语句来设计schema, 这往往需要权衡各种因素。</p>\n<h2>一、选择优化的数据类型</h2>\n<p>MySQL支持的数据类型非常多， 选择正确的数据类型对于获得高性能至关重要。</p>\n<h4>更小的通常更好</h4>\n<p>更小的数据类型通常更快， 因为它们占用更少的磁盘、 内存和CPU缓存， 并且处理时需要的CPU周期也更少。</p>\n<h4>简单就好</h4>\n<p>简单数据类型的操作通常需要更少的CPU周期。 例如， 整型比字符操作代价更低， 因为字符集和校对规则（排序规则 ）使字符比较比整型比较更复杂。</p>\n<h4>尽量避免NULL</h4>\n<p>如果查询中包含可为NULL 的列， 对MySQL来说更难优化， 因为可为NULL 的列使得索引、 索引统计和值比较都更复杂。 可为NULL的列会使用更多的存储空间， 在MySQL里也需要特殊处理。 当可为NULL的列被索引时， 每个索引记录需要一个额外的字节， 在MyISAM里甚至还可能导致固定大小的索引（例如只有一个整数列的索引）变成可变大小的索引。<br>\n当然也有例外， 例如InnoDB 使用单独的位 (bit) 存储NULL值， 所以对于稀疏数据有很好的空间效率。</p>\n<h3>1.整数类型</h3>\n<p>有两种类型的数字：整数 (whole number) 和实数 (real number) 。 如果存储整数， 可以使用这几种整数类型：TINYINT, SMALLINT, MEDIUMINT, INT, BIGINT。分别使用8,16, 24, 32, 64位存储空间。</p>\n<p>整数类型有可选的 **UNSIGNED ** 属性，表示不允许负值，这大致可以使正数的上限提高一倍。 例如 TINYINT. UNSIGNED 可以存储的范围是 0 – 255, 而 TINYINT 的存储范围是 -128 -127 。</p>\n<p><strong>有符号和无符号类型使用相同的存储空间，并具有相同的性能</strong> ， 因此可以根据实际情况选择合适的类型。</p>\n<p>你的选择决定 MySQL 是怎么在内存和磁盘中保存数据的。 然而， 整数计算一般使用64 位的 BIGINT 整数， 即使在 32 位环境也是如此。（ 一些聚合函数是例外， 它们使用DECIMAL 或 DOUBLE 进行计算）。</p>\n<p>MySQL 可以为整数类型指定宽度， 例如 INT(11), 对大多数应用这是没有意义的：它不会限制值的合法范围，只是规定了MySQL 的一些交互工具（例如 MySQL 命令行客户端）用来显示字符的个数。 对于存储和计算来说， INT(1) 和 INT(20) 是相同的。</p>\n<h3>2.实数类型</h3>\n<p>实数是带有小数部分的数字。 然而， 它们不只是为了存储小数部分，也可以使用DECIMAL 存储比 BIGINT 还大的整数。</p>\n<p>FLOAT和DOUBLE类型支持使用标准的浮点运算进行近似计算。<br>\nDECIMAL类型用于存储精确的小数。<br>\n浮点和DECIMAL类型都可以指定精度。 对于DECIMAL列， 可以指定小数点前后所允许的最大位数。这会影响列的空间消耗。</p>\n<p>有多种方法可以指定浮点列所需要的精度， 这会使得MySQL选择不同的数据类型，或者在存储时对值进行取舍。 这些精度定义是非标准的，<strong>所以我们建议只指定数据类型，不指定精度。</strong></p>\n<p><strong>浮点类型在存储同样范围的值时， 通常比DECIMAL使用更少的空间。FLOAT使用4个字节存储。DOUBLE占用8个字节，相比FLOAT有更高的精度和更大的范围。和整数类型一样， 能选择的只是存储类型； MySQL使用DOUBLE作为内部浮点计算的类型。</strong></p>\n<p>因为需要额外的空间和计算开销，所以应该尽量只在对小数进行精确计算时才使用DECIMAL。<strong>但在数据最比较大的时候， 可以考虑使用BIGINT代替DECIMAL, 将需要存储的货币单位根据小数的位数乘以相应的倍数即可。</strong></p>\n<h3>3.字符串类型</h3>\n<h4>VARCHAR</h4>\n<p>用于存储可变⻓字符串，长度支持到65535<br>\n需要使用1或2个额外字节记录字符串的长度<br>\n适合：字符串的最大⻓度比平均⻓度⼤很多；更新很少</p>\n<h4>CHAR</h4>\n<p>定⻓，⻓度范围是1~255<br>\n适合：存储很短的字符串，或者所有值接近同一个长度；经常变更</p>\n<h4>慷慨是不明智的</h4>\n<p>使用VARCHAR(5)和VARCHAR(200)存储’hello’的空间开销是一样的。 那么使用更短的列有什么优势吗？</p>\n<p>事实证明有很大的优势。 更长的列会消耗更多的内存， 因为MySQL通常会分配固定大小的内存块来保存内部值。 尤其是使用内存临时表进行排序或操作时会特别糟糕。 在利用磁盘临时表进行排序时也同样糟糕。</p>\n<p>所以最好的策略是只分配真正需要的空间。</p>\n<h3>4.BLOB和TEXT类型</h3>\n<p>BLOB和 TEXT都是为存储很大的数据而设计的字符串数据类型， 分别采用 二进制和字符方式存储 。</p>\n<p>与其他类型不同， MySQL把每个BLOB和TEXT值当作一个独立的对象处理。 存储引擎在存储时通常会做特殊处理。 当BLOB和TEXT值太大时，InnoDB会使用专门的 “外部“存储区域来进行存储， 此时每个值在行内需要1 – 4个字节存储 存储区域存储实际的值。</p>\n<p>BLOB 和 TEXT 之间仅有的不同是 BLOB 类型存储的是二进制数据， 没有排序规则或字符集， 而 TEXT类型有字符集和排序规则</p>\n<h3>5.日期和时间类型</h3>\n<p>大部分时间类型都没有替代品， 因此没有什么是最佳选择的问题。 唯一的问题是保存日期和时间的时候需要做什么。 MySQL提供两种相似的日期类型： DATE TIME和 TIMESTAMP。</p>\n<p>但是目前我们更建议存储时间戳的方式，因此该处不再对 DATE TIME和 TIMESTAMP做过多说明。</p>\n<h3>5.其他类型</h3>\n<h4>5.1选择标识符</h4>\n<p>在可以满足值的范围的需求， 井且预留未来增长空间的前提下， 应该选择最小的数据类型。</p>\n<h5>整数类型</h5>\n<p>整数通常是标识列最好的选择， 因为它们很快并且可以使用AUTO_INCREMENT。</p>\n<h5>ENUM和SET类型</h5>\n<p>对于标识列来说，EMUM和SET类型通常是一个糟糕的选择， 尽管对某些只包含固定状态或者类型的静态 ”定义表” 来说可能是没有问题的。ENUM和SET列适合存储固定信息， 例如有序的状态、 产品类型、 人的性别。</p>\n<h5>字符串类型</h5>\n<p>如果可能， 应该避免使用字符串类型作为标识列， 因为它们很消耗空间， 并且通常比数字类型慢。</p>\n<p>对于完全 “随机” 的字符串也需要多加注意， 例如 MDS() 、 SHAl() 或者 UUID() 产生的字符串。 这些函数生成的新值会任意分布在很大的空间内， 这会导致 INSERT 以及一些SELECT语句变得很慢。如果存储 UUID 值， 则应该移除 “-“符号。</p>\n<h4>5.2特殊类型数据</h4>\n<p>某些类型的数据井不直接与内置类型一致。 低千秒级精度的时间戳就是一个例子，另一个例子是以个1Pv4地址，人们经常使用VARCHAR(15)列来存储IP地址，然而， 它们实际上是32位无符号整数， 不是字符串。用小数点将地址分成四段的表示方法只是为了让人们阅读容易。所以应该用无符号整数存储IP地址。MySQL提供INET_ATON()和INET_NTOA()函数在这两种表示方法之间转换。</p>\n<h2>二、表结构设计</h2>\n<h3>1.范式和反范式</h3>\n<p>对于任何给定的数据通常都有很多种表示方法， 从完全的范式化到完全的反范式化， 以及两者的折中。 在范式化的数据库中， 每个事实数据会出现并且只出现一次。 相反， 在反范式化的数据库中， 信息是冗余的， 可能会存储在多个地方。</p>\n<h4>范式的优点和缺点</h4>\n<p>为性能提升考虑时，经常会被建议对 schema 进行范式化设计，尤其是写密集的场景。</p>\n<ul>\n<li>范式化的更新操作通常比反范式化要快。</li>\n<li>当数据较好地范式化时，就只有很少或者没有重复数据，所以只需要修改更少的数据。</li>\n<li>范式化的表通常更小，可以更好地放在内存里，所以执行操作会更快。</li>\n<li>很少有多余的数据意味着检索列表数据时更少需要 DISTINCT 或者 GROUP BY语句。</li>\n</ul>\n<h4>反范式的优点和缺点</h4>\n<p>不需要关联表，则对大部分查询最差的情况——即使表没有使用索引——是全表扫描。 当数据比内存大时这可能比关联要快得多，因为这样避免了随机I/0。</p>\n<p>单独的表也能使用更有效的索引策略。</p>\n<h4>混用范式化和反范式化</h4>\n<p>在实际应用中经常需要混用，可能使用部分范式化的 schema 、 缓存表，以及其他技巧。<br>\n表适当增加冗余字段，如性能优先，但会增加复杂度。可避免表关联查询。</p>\n<h4>简单熟悉数据库范式</h4>\n</div>\n</div>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc4256442935546643\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n第一范式(1NF)：字段值具有原子性,不能再分(所有关系型数据库系统都满足第一范式);\r\n 例如：姓名字段,其中姓和名是一个整体,如果区分姓和名那么必须设立两个独立字段;\r\n \r\n第二范式(2NF)：一个表必须有主键,即每行数据都能被唯一的区分;\r\n 备注：必须先满足第一范式;\r\n \r\n第三范式(3NF)：一个表中不能包涵其他相关表中非关键字段的信息,即数据表不能有沉余字段;\r\n 备注：必须先满足第二范式;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc4256442935546643-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc4256442935546643-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc4256442935546643-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc4256442935546643-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc4256442935546643-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc4256442935546643-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc4256442935546643-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc4256442935546643-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc4256442935546643-1\">第一范式<span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1NF</span><span class=\"crayon-sy\">)</span>：字段值具有原子性<span class=\"crayon-sy\">,</span>不能再分<span class=\"crayon-sy\">(</span>所有关系型数据库系统都满足第一范式<span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc4256442935546643-2\"><span class=\"crayon-h\"> </span>例如：姓名字段<span class=\"crayon-sy\">,</span>其中姓和名是一个整体<span class=\"crayon-sy\">,</span>如果区分姓和名那么必须设立两个独立字段<span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc4256442935546643-3\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc4256442935546643-4\">第二范式<span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2NF</span><span class=\"crayon-sy\">)</span>：一个表必须有主键<span class=\"crayon-sy\">,</span>即每行数据都能被唯一的区分<span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc4256442935546643-5\"><span class=\"crayon-h\"> </span>备注：必须先满足第一范式<span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc4256442935546643-6\"><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9cc4256442935546643-7\">第三范式<span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">3NF</span><span class=\"crayon-sy\">)</span>：一个表中不能包涵其他相关表中非关键字段的信息<span class=\"crayon-sy\">,</span>即数据表不能有沉余字段<span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc4256442935546643-8\"><span class=\"crayon-h\"> </span>备注：必须先满足第二范式<span class=\"crayon-sy\">;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n<p></p>\n<div>\n<div>\n<h3>2.表字段少⽽精</h3>\n<ul>\n<li>I/O高效</li>\n<li>字段分开维护简单</li>\n<li>单表1G体积 500W⾏行评估</li>\n<li>单⾏行不超过200Byte</li>\n<li>单表不超过50个INT字段</li>\n<li>单表不超过20个CHAR(10)字段</li>\n<li>建议单表字段数控制在20个以内</li>\n<li>拆分TEXT/BLOB，TEXT类型处理性能远低于VARCHAR，强制生成硬盘临时表浪费更多空间。</li>\n</ul>\n<h4>参考资料：</h4>\n<p>高性能mysql第三版</p>\n</div>\n</div>\n<hr>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112035\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112035votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112035\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "MySQL 死锁与日志二三事", "url": "http://blog.jobbole.com/112054/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/11/e78e36715813f49e9e62fe0c6050075c.png"], "praise_nums": "2", "comment_nums": 1, "fav_nums": 5, "tags": "IT技术,MySQL,数据库", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/leejun2005/blog/1484511\">xrzs</a>   </div><p>最近线上 MySQL 接连发生了几起数据异常，都是在凌晨爆发，由于业务场景属于典型的数据仓库型应用，白天压力较小无法复现。甚至有些异常还比较诡异，最后 root cause 分析颇费周折。那实际业务当中咱们如何能快速的定位线上 MySQL 问题，修复异常呢？下文我会根据两个实际 case，分享下相关的经验与方法。</p>\n<h3>1、Case1：部分数据更新失败</h3>\n<p>某天渠道同学反馈某报表极个别渠道数据为 0，大部分渠道数据正常。这个数据是由一个统计程序每天凌晨例行更新的，按理来说，要么全部正常，要么全部失败，那会是什么原因导致极个别数据异常呢？</p>\n<p>首先我们能想到的自然是根据统计任务日志来看了，但是看了统计程序打印的日志没有发现诸如 SQL update 失败的异常描述，那当时的数据库究竟发生了什么呢？在查看 MySQL-server 日志之前，习惯性的看了下数据库状态：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d13b8a1a4078326357\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nSHOW ENGINE INNODB STATUS\\G</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1a4078326357-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1a4078326357-1\"><span class=\"crayon-e\">SHOW </span><span class=\"crayon-e\">ENGINE </span><span class=\"crayon-e\">INNODB </span><span class=\"crayon-v\">STATUS</span><span class=\"crayon-sy\">\\</span><span class=\"crayon-v\">G</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>恰好看到了凌晨这个 update 发生了死锁：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d13b8a1ae202064559\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n------------------------\r\nLATEST DETECTED DEADLOCK\r\n------------------------\r\n2017-07-17 04:09:01 0x7f6de03c8700\r\n*** (1) TRANSACTION:\r\nTRANSACTION 215208479, ACTIVE 0 sec fetching rows\r\nmysql tables in use 3, locked 3\r\nLOCK WAIT 5 lock struct(s), heap size 1136, 3 row lock(s)\r\nMySQL thread id 27844824, OS thread handle 140092183037696, query id 412503674 10.126.95.84 zeye Searching rows for update\r\nupdate t_channel_final_datas set nr_register=133,nr_add_goods=29,nr_order_normal=11,nr_pay_normal=8,nr_order_special=0,nr_pay_special=0,n_add_user_num=16 where count_date='2017-07-16' and channel_id='16' and channel_type='10' and terminal='26'\r\n*** (1) WAITING FOR THIS LOCK TO BE GRANTED:\r\nRECORD LOCKS space id 464 page no 5459 n bits 392 index index_countdate_type_terminal of table `db_zz_flow`.`t_channel_final_datas` trx id 215208479 lock_mode X locks rec but not gap waiting\r\nRecord lock, heap no 304 PHYSICAL RECORD: n_fields 4; compact format; info bits 0\r\n 0: len 10; hex 323031372d30372d3136; asc 2017-07-16;;\r\n 1: len 1; hex 30; asc 0;;\r\n 2: len 4; hex 80000010; asc     ;;\r\n 3: len 4; hex 8009055e; asc    ^;;\r\n\r\n*** (2) TRANSACTION:\r\nTRANSACTION 215208474, ACTIVE 0 sec fetching rows\r\nmysql tables in use 3, locked 3\r\n6 lock struct(s), heap size 1136, 7 row lock(s)\r\nMySQL thread id 27844825, OS thread handle 140109890225920, query id 412503669 10.135.6.41 zeye Searching rows for update\r\nupdate t_channel_final_datas set nr_register=24,nr_add_goods=32,nr_order_normal=0,nr_pay_normal=0,nr_order_special=0,nr_pay_special=0,n_add_user_num=11 where count_date='2017-07-16' and channel_id='114' and channel_type='10' and terminal='116'\r\n*** (2) HOLDS THE LOCK(S):\r\nRECORD LOCKS space id 464 page no 5459 n bits 392 index index_countdate_type_terminal of table `db_zz_flow`.`t_channel_final_datas` trx id 215208474 lock_mode X locks rec but not gap\r\nRecord lock, heap no 304 PHYSICAL RECORD: n_fields 4; compact format; info bits 0\r\n 0: len 10; hex 323031372d30372d3136; asc 2017-07-16;;\r\n 1: len 1; hex 30; asc 0;;\r\n 2: len 4; hex 80000010; asc     ;;\r\n 3: len 4; hex 8009055e; asc    ^;;\r\n\r\n...\r\n\r\n*** (2) WAITING FOR THIS LOCK TO BE GRANTED:\r\nRECORD LOCKS space id 464 page no 4743 n bits 264 index PRIMARY of table `db_zz_flow`.`t_channel_final_datas` trx id 215208474 lock_mode X locks rec but not gap waiting\r\nRecord lock, heap no 168 PHYSICAL RECORD: n_fields 32; compact format; info bits 0\r\n 0: len 4; hex 80090569; asc    i;;\r\n 1: len 6; hex 00000cd3b9d0; asc       ;;\r\n...\r\n\r\n*** WE ROLL BACK TRANSACTION (1)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1ae202064559-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1ae202064559-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1ae202064559-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1ae202064559-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1ae202064559-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1ae202064559-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1ae202064559-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1ae202064559-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1ae202064559-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1ae202064559-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1ae202064559-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1ae202064559-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1ae202064559-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1ae202064559-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1ae202064559-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1ae202064559-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1ae202064559-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1ae202064559-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1ae202064559-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1ae202064559-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1ae202064559-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1ae202064559-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1ae202064559-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1ae202064559-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1ae202064559-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1ae202064559-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1ae202064559-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1ae202064559-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1ae202064559-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1ae202064559-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1ae202064559-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1ae202064559-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1ae202064559-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1ae202064559-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1ae202064559-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1ae202064559-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1ae202064559-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1ae202064559-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1ae202064559-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1ae202064559-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1ae202064559-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1ae202064559-42\">42</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1ae202064559-1\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1ae202064559-2\"><span class=\"crayon-e\">LATEST </span><span class=\"crayon-e\">DETECTED </span><span class=\"crayon-v\">DEADLOCK</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1ae202064559-3\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1ae202064559-4\"><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">17</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">04</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">09</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x7f6de03c8700</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1ae202064559-5\"><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TRANSACTION</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1ae202064559-6\"><span class=\"crayon-i\">TRANSACTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">215208479</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ACTIVE</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sec </span><span class=\"crayon-e\">fetching </span><span class=\"crayon-e\">rows</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1ae202064559-7\"><span class=\"crayon-e\">mysql </span><span class=\"crayon-e\">tables </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">locked</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1ae202064559-8\"><span class=\"crayon-e\">LOCK </span><span class=\"crayon-i\">WAIT</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lock </span><span class=\"crayon-t\">struct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">heap </span><span class=\"crayon-i\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1136</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">row </span><span class=\"crayon-e\">lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1ae202064559-9\"><span class=\"crayon-e\">MySQL </span><span class=\"crayon-e\">thread </span><span class=\"crayon-i\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">27844824</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">OS </span><span class=\"crayon-e\">thread </span><span class=\"crayon-i\">handle</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">140092183037696</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">query </span><span class=\"crayon-i\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">412503674</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10.126.95.84</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">zeye </span><span class=\"crayon-e\">Searching </span><span class=\"crayon-e\">rows </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">update</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1ae202064559-10\"><span class=\"crayon-e\">update </span><span class=\"crayon-e\">t_channel_final_datas </span><span class=\"crayon-e\">set </span><span class=\"crayon-v\">nr_register</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">133</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nr_add_goods</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">29</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nr_order_normal</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nr_pay_normal</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nr_order_special</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nr_pay_special</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">n_add_user_num</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">16</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">where </span><span class=\"crayon-v\">count_date</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'2017-07-16'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">channel_id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'16'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">channel_type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'10'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">terminal</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'26'</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1ae202064559-11\"><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WAITING </span><span class=\"crayon-st\">FOR</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">THIS</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LOCK </span><span class=\"crayon-st\">TO</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BE </span><span class=\"crayon-v\">GRANTED</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1ae202064559-12\"><span class=\"crayon-e\">RECORD </span><span class=\"crayon-e\">LOCKS </span><span class=\"crayon-e\">space </span><span class=\"crayon-i\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">464</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">page </span><span class=\"crayon-i\">no</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5459</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">bits</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">392</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">index </span><span class=\"crayon-e\">index_countdate_type_terminal </span><span class=\"crayon-e\">of </span><span class=\"crayon-i\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">db_zz_flow</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">t_channel_final_datas</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">trx </span><span class=\"crayon-i\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">215208479</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">_</span>mode<span class=\"crayon-h\"> </span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">locks </span><span class=\"crayon-e\">rec </span><span class=\"crayon-e\">but </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gap </span><span class=\"crayon-e\">waiting</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1ae202064559-13\"><span class=\"crayon-e\">Record </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">heap </span><span class=\"crayon-i\">no</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">304</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PHYSICAL </span><span class=\"crayon-v\">RECORD</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">_</span>fields<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">compact </span><span class=\"crayon-v\">format</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">info </span><span class=\"crayon-i\">bits</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1ae202064559-14\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">hex</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">323031372d30372d3136</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">asc</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1ae202064559-15\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">hex</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">asc</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1ae202064559-16\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">hex</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80000010</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">asc</span><span class=\"crayon-h\">     </span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1ae202064559-17\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">hex</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8009055e</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">asc</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">^</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1ae202064559-18\"> </div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1ae202064559-19\"><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TRANSACTION</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1ae202064559-20\"><span class=\"crayon-i\">TRANSACTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">215208474</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ACTIVE</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sec </span><span class=\"crayon-e\">fetching </span><span class=\"crayon-e\">rows</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1ae202064559-21\"><span class=\"crayon-e\">mysql </span><span class=\"crayon-e\">tables </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">locked</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1ae202064559-22\"><span class=\"crayon-cn\">6</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lock </span><span class=\"crayon-t\">struct</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">heap </span><span class=\"crayon-i\">size</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1136</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">row </span><span class=\"crayon-e\">lock</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1ae202064559-23\"><span class=\"crayon-e\">MySQL </span><span class=\"crayon-e\">thread </span><span class=\"crayon-i\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">27844825</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">OS </span><span class=\"crayon-e\">thread </span><span class=\"crayon-i\">handle</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">140109890225920</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">query </span><span class=\"crayon-i\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">412503669</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10.135.6.41</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">zeye </span><span class=\"crayon-e\">Searching </span><span class=\"crayon-e\">rows </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">update</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1ae202064559-24\"><span class=\"crayon-e\">update </span><span class=\"crayon-e\">t_channel_final_datas </span><span class=\"crayon-e\">set </span><span class=\"crayon-v\">nr_register</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">24</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nr_add_goods</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">32</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nr_order_normal</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nr_pay_normal</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nr_order_special</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">nr_pay_special</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">n_add_user_num</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">where </span><span class=\"crayon-v\">count_date</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'2017-07-16'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">channel_id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'114'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">channel_type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'10'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">terminal</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'116'</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1ae202064559-25\"><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HOLDS </span><span class=\"crayon-e\">THE </span><span class=\"crayon-e\">LOCK</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">S</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1ae202064559-26\"><span class=\"crayon-e\">RECORD </span><span class=\"crayon-e\">LOCKS </span><span class=\"crayon-e\">space </span><span class=\"crayon-i\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">464</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">page </span><span class=\"crayon-i\">no</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5459</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">bits</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">392</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">index </span><span class=\"crayon-e\">index_countdate_type_terminal </span><span class=\"crayon-e\">of </span><span class=\"crayon-i\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">db_zz_flow</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">t_channel_final_datas</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">trx </span><span class=\"crayon-i\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">215208474</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">_</span>mode<span class=\"crayon-h\"> </span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">locks </span><span class=\"crayon-e\">rec </span><span class=\"crayon-e\">but </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gap</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1ae202064559-27\"><span class=\"crayon-e\">Record </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">heap </span><span class=\"crayon-i\">no</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">304</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PHYSICAL </span><span class=\"crayon-v\">RECORD</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">_</span>fields<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">compact </span><span class=\"crayon-v\">format</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">info </span><span class=\"crayon-i\">bits</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1ae202064559-28\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">hex</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">323031372d30372d3136</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">asc</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1ae202064559-29\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">hex</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">asc</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1ae202064559-30\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">hex</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80000010</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">asc</span><span class=\"crayon-h\">     </span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1ae202064559-31\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">hex</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8009055e</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">asc</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">^</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1ae202064559-32\"> </div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1ae202064559-33\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1ae202064559-34\"> </div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1ae202064559-35\"><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WAITING </span><span class=\"crayon-st\">FOR</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">THIS</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">LOCK </span><span class=\"crayon-st\">TO</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BE </span><span class=\"crayon-v\">GRANTED</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1ae202064559-36\"><span class=\"crayon-e\">RECORD </span><span class=\"crayon-e\">LOCKS </span><span class=\"crayon-e\">space </span><span class=\"crayon-i\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">464</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">page </span><span class=\"crayon-i\">no</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4743</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">bits</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">264</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">index </span><span class=\"crayon-e\">PRIMARY </span><span class=\"crayon-e\">of </span><span class=\"crayon-i\">table</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">db_zz_flow</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">t_channel_final_datas</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">trx </span><span class=\"crayon-i\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">215208474</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">_</span>mode<span class=\"crayon-h\"> </span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">locks </span><span class=\"crayon-e\">rec </span><span class=\"crayon-e\">but </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">gap </span><span class=\"crayon-e\">waiting</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1ae202064559-37\"><span class=\"crayon-e\">Record </span><span class=\"crayon-v\">lock</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">heap </span><span class=\"crayon-i\">no</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">168</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PHYSICAL </span><span class=\"crayon-v\">RECORD</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">_</span>fields<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">32</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">compact </span><span class=\"crayon-v\">format</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">info </span><span class=\"crayon-i\">bits</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1ae202064559-38\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">hex</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80090569</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">asc</span><span class=\"crayon-h\">    </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1ae202064559-39\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">len</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">hex</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">00000cd3b9d0</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">asc</span><span class=\"crayon-h\">       </span><span class=\"crayon-sy\">;</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1ae202064559-40\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1ae202064559-41\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1ae202064559-42\"><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WE </span><span class=\"crayon-e\">ROLL </span><span class=\"crayon-e\">BACK </span><span class=\"crayon-e\">TRANSACTION</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0219 seconds] -->\r\n<p>篇幅所限，上下文我这里省略了很多，从这段日志里可以看到，TRANSACTION 1 和 TRANSACTION 2 分别持有一定数量的行锁，然后又等待对方的锁，最后 MySQL 检测到 deadlock ，然后选择回滚了 TRANSACTION 1：Innodb目前处理死锁的方法是将持有最少行级排他锁的事务进行回滚。</p>\n<p>那这里就有 3 个问题了：</p>\n<h4>（1）innodb 行锁不是只锁一行？</h4>\n<p>因为这张表是 innodb 引擎的，InnoDB 支持行锁和表锁。而InnoDB行锁是通过给索引上的索引项加锁来实现的，这一点MySQL与Oracle不同，后者是通过在数据块中对相应数据行加锁来实现的。InnoDB这种行锁实现特点意味着：只有通过索引条件检索数据，InnoDB才使用行级锁，否则，InnoDB将使用表锁，会把所有扫描过的行都锁定！在实际应用中，要特别注意InnoDB行锁的这一特性，不然的话，可能导致大量的锁冲突，从而影响并发性能。由于MySQL的行锁是针对索引加的锁，不是针对记录加的锁，所以虽然是访问不同行的记录，但是如果是使用相同的索引键，是会出现锁冲突的。当我们用范围条件而不是相等条件检索数据，并请求共享或排他锁时，InnoDB会给符合条件的已有数据记录的索引项加锁；另外间隙锁也会锁多行，InnoDB除了通过范围条件加锁时使用间隙锁外，如果使用相等条件请求给一个不存在的记录加锁，InnoDB也会使用间隙锁！</p>\n<p>话都说到这了，那就看下咱们业务表的索引情况：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d13b8a1b4389862102\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nshow INDEX from `db_zz_flow`.`t_channel_final_datas`;\r\n+-----------------------+--------------+-------------------------------+----------------+-------------+----------+--------+--------------+-----------+-----------------+\r\n| Table | Non_unique | Key_name | Seq_in_index | Column_namt | Packed | Null | Index_type | Comment | Index_comment |\r\n|-----------------------+--------------+-------------------------------+----------------+-------------+----------+--------+--------------+-----------+-----------------|\r\n| t_channel_final_datas | 0 | PRIMARY | 1 | id &gt; | &lt;null&gt; | | BTREE | | |\r\n| t_channel_final_datas | 1 | index_countdate_type_terminal | 1 | count_date&gt; | &lt;null&gt; | YES | BTREE | | |\r\n| t_channel_final_datas | 1 | index_countdate_type_terminal | 2 | channel_ty&gt; | &lt;null&gt; | YES | BTREE | | |\r\n| t_channel_final_datas | 1 | index_countdate_type_terminal | 3 | terminal &gt; | &lt;null&gt; | YES | BTREE | | |\r\n| t_channel_final_datas | 1 | index_countdate_channelid | 1 | count_date&gt; | &lt;null&gt; | YES | BTREE | | |\r\n| t_channel_final_datas | 1 | index_countdate_channelid | 2 | channel_id&gt; | &lt;null&gt; | YES | BTREE | | |\r\n+-----------------------+--------------+-------------------------------+----------------+-------------+----------+--------+--------------+-----------+-----------------+</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1b4389862102-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1b4389862102-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1b4389862102-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1b4389862102-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1b4389862102-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1b4389862102-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1b4389862102-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1b4389862102-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1b4389862102-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1b4389862102-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1b4389862102-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1b4389862102-1\"><span class=\"crayon-e\">show </span><span class=\"crayon-e\">INDEX </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">db_zz_flow</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">t_channel_final_datas</span><span class=\"crayon-sy\">`</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1b4389862102-2\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1b4389862102-3\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Table</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Non_unique</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Key_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Seq_in_index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Column_namt</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Packed</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">Null</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Index_type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Index_comment</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1b4389862102-4\"><span class=\"crayon-o\">|</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1b4389862102-5\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t_channel_final_datas</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PRIMARY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">id</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">null</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BTREE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1b4389862102-6\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t_channel_final_datas</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index_countdate_type_terminal</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count_date</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">null</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">YES</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BTREE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1b4389862102-7\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t_channel_final_datas</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index_countdate_type_terminal</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">channel_ty</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">null</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">YES</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BTREE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1b4389862102-8\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t_channel_final_datas</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index_countdate_type_terminal</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">terminal</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">null</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">YES</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BTREE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1b4389862102-9\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t_channel_final_datas</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index_countdate_channelid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">count_date</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">null</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">YES</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BTREE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1b4389862102-10\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">t_channel_final_datas</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">index_countdate_channelid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">channel_id</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-t\">null</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">YES</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">BTREE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1b4389862102-11\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0103 seconds] -->\r\n<p>可以看到这张表的索引极不合理：有3个索引，但是 update 却没有完全的用上索引，导致 update 没有精确的用上索引，需要锁定多行范围数据，从而引发死锁。</p>\n<p>知道原理后，咱们再精心构建一个四字段的组合索引即可让 update 精准的走 innodb 索引，实际上，我们更新索引后，这个死锁问题即得到了解决。<br>\n注：innodb不仅会打印出事务和事务持有和等待的锁，而且还有记录本身，不幸的是，它可能超过innodb为输出结果预留的长度（只能打印1M的内容且只能保留最近一次的死锁信息），如果你无法看到完整的输出，此时可以在任意库下创建innodb_monitor或innodb_lock_monitor表，这样innodb status信息会完整且每15s一次被记录到错误日志中。如：create table innodb_monitor(a int)engine=innodb;，不需要记录到错误日志中时就删掉这个表即可。</p>\n<h4>（2）回滚的话，为什么只有部分 update 语句失败，而不是整个事务里的所有 update 都失败？</h4>\n<p>这是因为咱们的 innodb 默认是自动提交的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d13b8a1b9837465363\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nshow variables like 'autocommit';\r\n+-----------------+---------+\r\n| Variable_name   | Value   |\r\n|-----------------+---------|\r\n| autocommit      | ON      |\r\n+-----------------+---------+\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1b9837465363-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1b9837465363-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1b9837465363-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1b9837465363-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1b9837465363-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1b9837465363-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1b9837465363-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1b9837465363-1\"><span class=\"crayon-e\">show </span><span class=\"crayon-e\">variables </span><span class=\"crayon-i\">like</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'autocommit'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1b9837465363-2\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1b9837465363-3\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Value</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1b9837465363-4\"><span class=\"crayon-o\">|</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1b9837465363-5\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">autocommit</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ON</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1b9837465363-6\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1b9837465363-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>在多个 update 或 insert 语句情况下，每执行完一条 SQL，innodb 就立即 commit 一次以持久化变更，同时释放锁，这也正是本例中死锁回滚事务后只有极个别语句失败的原因。</p>\n<p>需要注意的是，通常还有另外一种情况也可能导致部分语句回滚，需要格外留意。在 innodb 里有个参数叫：innodb_rollback_on_timeout</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d13b8a1bc978135239\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nshow VARIABLES LIKE 'innodb_rollback_on_timeout'\r\n+----------------------------+---------+\r\n| Variable_name              | Value   |\r\n|----------------------------+---------|\r\n| innodb_rollback_on_timeout | OFF     |\r\n+----------------------------+---------+\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1bc978135239-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1bc978135239-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1bc978135239-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1bc978135239-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1bc978135239-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1bc978135239-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1bc978135239-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1bc978135239-1\"><span class=\"crayon-e\">show </span><span class=\"crayon-e\">VARIABLES </span><span class=\"crayon-i\">LIKE</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'innodb_rollback_on_timeout'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1bc978135239-2\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1bc978135239-3\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\">              </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Value</span><span class=\"crayon-h\">   </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1bc978135239-4\"><span class=\"crayon-o\">|</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1bc978135239-5\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">innodb_rollback_on_timeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">OFF</span><span class=\"crayon-h\">     </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1bc978135239-6\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1bc978135239-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>官方手册里这样描述：</p>\n<blockquote><p>In MySQL 5.1, InnoDB rolls back only the last statement on a transaction timeout by default. If –innodb_rollback_on_timeout is specified, a transaction timeout causes InnoDB to abort and roll back the entire transaction (the same behavior as in MySQL 4.1). This variable was added in MySQL 5.1.15.</p></blockquote>\n<p>解释：这个参数关闭或不存在的话遇到超时只回滚事务最后一个Query，打开的话事务遇到超时就回滚整个事务。</p>\n<h3>（3）怎样降低 innodb 死锁几率？</h3>\n<p>死锁在行锁及事务场景下很难完全消除，但可以通过表设计和SQL调整等措施减少锁冲突和死锁，包括：</p>\n<ul>\n<li>尽量使用较低的隔离级别，比如如果发生了间隙锁，你可以把会话或者事务的事务隔离级别更改为 RC(read committed)级别来避免，但此时需要把 binlog_format 设置成 row 或者 mixed 格式</li>\n<li>精心设计索引，并尽量使用索引访问数据，使加锁更精确，从而减少锁冲突的机会；</li>\n<li>选择合理的事务大小，小事务发生锁冲突的几率也更小；</li>\n<li>给记录集显示加锁时，最好一次性请求足够级别的锁。比如要修改数据的话，最好直接申请排他锁，而不是先申请共享锁，修改时再请求排他锁，这样容易产生死锁；</li>\n<li>不同的程序访问一组表时，应尽量约定以相同的顺序访问各表，对一个表而言，尽可能以固定的顺序存取表中的行。这样可以大大减少死锁的机会；</li>\n<li>尽量用相等条件访问数据，这样可以避免间隙锁对并发插入的影响；</li>\n<li>不要申请超过实际需要的锁级别；除非必须，查询时不要显示加锁；</li>\n<li>对于一些特定的事务，可以使用表锁来提高处理速度或减少死锁的可能。</li>\n</ul>\n<h3>2、Case2：诡异的 Lock wait timeout</h3>\n<p>连续几天凌晨6点和早上8点 都分别有一个任务失败，load data local infile 的时候报 Lock wait timeout exceeded try restarting transaction innodb 的 Java SQL 异常，和平台的同学沟通得知，这是我们自己的业务数据库的 Lock 时间太短或者锁冲突的问题。但是回头一想不应该啊？这不一直好好的吗？而且基本都是单表单任务，不存在多人冲突。</p>\n<p>甭管谁的问题，那咱们还是先看自己的数据库有没有问题：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d13b8a1c1800592554\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nshow variables like 'innodb_lock_wait_timeout';\r\n+--------------------------+---------+\r\n| Variable_name            |   Value |\r\n|--------------------------+---------|\r\n| innodb_lock_wait_timeout |      50 |\r\n+--------------------------+---------+\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1c1800592554-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1c1800592554-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1c1800592554-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1c1800592554-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1c1800592554-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1c1800592554-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1c1800592554-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1c1800592554-1\"><span class=\"crayon-e\">show </span><span class=\"crayon-e\">variables </span><span class=\"crayon-i\">like</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'innodb_lock_wait_timeout'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1c1800592554-2\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1c1800592554-3\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\">            </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">   </span><span class=\"crayon-v\">Value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1c1800592554-4\"><span class=\"crayon-o\">|</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1c1800592554-5\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">innodb_lock_wait_timeout</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">50</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1c1800592554-6\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1c1800592554-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>默认 lock 超时时间 50s，这个时间真心不短了，估计调了也没用，事实上确实死马当活马医的试了下没用。。。</p>\n<p>而且这次 SHOW ENGINE INNODB STATUSG 也没出现任何死锁信息，然后又将目光转向 MySQL-server 日志，希望能从日志里看一看那个时刻前后数据究竟在做什么操作。这里先简单的介绍下MySQL日志文件系统的组成：</p>\n<p>(a) error 日志：记录启动、运行或停止 mysqld 时出现的问题，默认开启。<br>\n(b) general 日志：通用查询日志，记录所有语句和指令，开启数据库会有 5% 左右性能损失。<br>\n(c) binlog 日志：二进制格式，记录所有更改数据的语句，主要用于 slave 复制和数据恢复。<br>\n(d) slow 日志：记录所有执行时间超过 long_query_time 秒的查询或不使用索引的查询，默认关闭。<br>\n(e) Innodb日志：innodb redo log、undo log，用于恢复数据和撤销操作。</p>\n<p>从上面的介绍可以看到，目前这个问题的日志可能在 d 和 b 中，看了下 d 中没有，那就只能开启 b 了，但 b 对数据库的性能有一定损耗，由于是全量日志，量非常巨大，所以开启一定要谨慎：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d13b8a1c5889773684\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n-- general_log 日志默认关闭，开启会影响数据库 5% 左右性能：\r\nshow variables like 'general%';\r\n+------------------+---------------------------------+\r\n| Variable_name    | Value                           |\r\n|------------------+---------------------------------|\r\n| general_log      | OFF                             |\r\n| general_log_file | /opt/data/mysql/tjtx-103-26.log |\r\n+------------------+---------------------------------+\r\n\r\n-- 全局 session 级别开启：\r\nset global general_log=1\r\n\r\n-- 如果需要对当前 session 生效需要：\r\nset general_log=1\r\n\r\n-- set 指令设置的动态参数在 MySQL 重启后失效，如果需要永久生效需要在 /etc/my.cnf 中配置静态变量/参数。\r\n-- 如果不知道 my.cnf 位置，可以根据 mysql -? | grep \".cnf\" 查询\r\n                      order of preference, my.cnf, $MYSQL_TCP_PORT,\r\n/etc/my.cnf /etc/mysql/my.cnf /usr/etc/my.cnf ~/.my.cnf</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1c5889773684-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1c5889773684-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1c5889773684-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1c5889773684-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1c5889773684-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1c5889773684-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1c5889773684-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1c5889773684-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1c5889773684-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1c5889773684-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1c5889773684-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1c5889773684-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1c5889773684-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1c5889773684-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1c5889773684-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1c5889773684-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1c5889773684-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1c5889773684-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1c5889773684-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1c5889773684-1\"><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">general</span><span class=\"crayon-sy\">_</span>log<span class=\"crayon-h\"> </span>日志默认关闭，开启会影响数据库<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span>左右性能：</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1c5889773684-2\"><span class=\"crayon-e\">show </span><span class=\"crayon-e\">variables </span><span class=\"crayon-i\">like</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'general%'</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1c5889773684-3\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1c5889773684-4\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\">    </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Value</span><span class=\"crayon-h\">                           </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1c5889773684-5\"><span class=\"crayon-o\">|</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1c5889773684-6\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">general_log</span><span class=\"crayon-h\">      </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">OFF</span><span class=\"crayon-h\">                             </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1c5889773684-7\"><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">general_log_file</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">opt</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tjtx</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">103</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">26.log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1c5889773684-8\"><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-o\">+</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1c5889773684-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1c5889773684-10\"><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span>全局<span class=\"crayon-h\"> </span><span class=\"crayon-i\">session</span><span class=\"crayon-h\"> </span>级别开启：</div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1c5889773684-11\"><span class=\"crayon-e\">set </span><span class=\"crayon-m\">global</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">general_log</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1c5889773684-12\"> </div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1c5889773684-13\"><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span>如果需要对当前<span class=\"crayon-h\"> </span><span class=\"crayon-i\">session</span><span class=\"crayon-h\"> </span>生效需要：</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1c5889773684-14\"><span class=\"crayon-e\">set </span><span class=\"crayon-v\">general_log</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1c5889773684-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1c5889773684-16\"><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">set</span><span class=\"crayon-h\"> </span>指令设置的动态参数在<span class=\"crayon-h\"> </span><span class=\"crayon-i\">MySQL</span><span class=\"crayon-h\"> </span>重启后失效，如果需要永久生效需要在<span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">my</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cnf</span><span class=\"crayon-h\"> </span>中配置静态变量<span class=\"crayon-o\">/</span>参数。</div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1c5889773684-17\"><span class=\"crayon-o\">--</span><span class=\"crayon-h\"> </span>如果不知道<span class=\"crayon-h\"> </span><span class=\"crayon-v\">my</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">cnf</span><span class=\"crayon-h\"> </span>位置，可以根据<span class=\"crayon-h\"> </span><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-sy\">?</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\".cnf\"</span><span class=\"crayon-h\"> </span>查询</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1c5889773684-18\"><span class=\"crayon-h\">                      </span><span class=\"crayon-e\">order </span><span class=\"crayon-e\">of </span><span class=\"crayon-v\">preference</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">my</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cnf</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">MYSQL_TCP_PORT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1c5889773684-19\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">my</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cnf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">my</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cnf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">etc</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">my</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cnf</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">my</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cnf</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0053 seconds] -->\r\n<p>我这里只是每天在出问题的前后半小时开启下全量日志，结果没有发现任何 MySQL-client 请求到我们的业务数据库！该日志格式如下，记录了所有的连接与命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d13b8a1c9298113001\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n/usr/sbin/mysqld, Version: 5.7.12-log (MySQL Community Server (GPL)). started with:\r\nTcp port: 3306  Unix socket: /opt/data/mysql/mysql.sock\r\nTime                 Id Command    Argument\r\n2017-07-20T21:45:01.880828Z28556028 Quit\r\n2017-07-20T21:45:02.708621Z28401469 Query       SELECT 1\r\n2017-07-20T21:45:02.736734Z28556029 Connect     ooxx@127.0.0.1 on db_zz_system using TCP/IP\r\n2017-07-20T21:45:02.737242Z28556029 Query       /* mysql-connector-java-5.1.6 ( Revision: ${svn.Revision} ) */SHOW VARIABLES WHERE Variable_name ='language' OR Variable_name = 'net_write_timeout' OR Variable_name = 'interactive_timeout' OR Variable_name = 'wait_timeout' OR Variable_name = 'character_set_client' OR Variable_name = 'character_set_connection' OR Variable_name = 'character_set' OR Variable_name = 'character_set_server' OR Variable_name = 'tx_isolation' OR Variable_name = 'transaction_isolation' OR Variable_name = 'character_set_results' OR Variable_name = 'timezone' OR Variable_name = 'time_zone' OR Variable_name = 'system_time_zone' OR Variable_name = 'lower_case_table_names' OR Variable_name = 'max_allowed_packet' OR Variable_name = 'net_buffer_length' OR Variable_name = 'sql_mode' OR Variable_name = 'query_cache_type' OR Variable_name = 'query_cache_size' OR Variable_name = 'init_connect'\r\n2017-07-20T21:45:02.738868Z28556029 Query       SHOW COLLATION\r\n2017-07-20T21:45:02.739941Z28556029 Query       SET character_set_results = NULL\r\n2017-07-20T21:45:02.740275Z28556029 Query       SET autocommit=1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1c9298113001-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1c9298113001-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1c9298113001-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1c9298113001-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1c9298113001-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1c9298113001-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1c9298113001-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1c9298113001-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1c9298113001-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1c9298113001-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1c9298113001-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">sbin</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mysqld</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Version</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.7.12</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">MySQL </span><span class=\"crayon-e\">Community </span><span class=\"crayon-e\">Server</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">GPL</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">started </span><span class=\"crayon-v\">with</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1c9298113001-2\"><span class=\"crayon-e\">Tcp </span><span class=\"crayon-v\">port</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3306</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">Unix </span><span class=\"crayon-v\">socket</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">opt</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mysql</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mysql</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sock</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1c9298113001-3\"><span class=\"crayon-e\">Time                 </span><span class=\"crayon-e\">Id </span><span class=\"crayon-e\">Command    </span><span class=\"crayon-i\">Argument</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1c9298113001-4\"><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20T21</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">01.880828Z28556028</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Quit</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1c9298113001-5\"><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20T21</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">02.708621Z28401469</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Query       </span><span class=\"crayon-i\">SELECT</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1c9298113001-6\"><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20T21</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">02.736734Z28556029</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Connect     </span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-sy\">@</span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">on </span><span class=\"crayon-e\">db_zz_system </span><span class=\"crayon-e\">using </span><span class=\"crayon-v\">TCP</span><span class=\"crayon-o\">/</span><span class=\"crayon-i\">IP</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1c9298113001-7\"><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20T21</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">02.737242Z28556029</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Query</span><span class=\"crayon-h\">       </span><span class=\"crayon-c\">/* mysql-connector-java-5.1.6 ( Revision: ${svn.Revision} ) */</span><span class=\"crayon-e\">SHOW </span><span class=\"crayon-e\">VARIABLES </span><span class=\"crayon-e\">WHERE </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'language'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'net_write_timeout'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'interactive_timeout'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'wait_timeout'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'character_set_client'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'character_set_connection'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'character_set'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'character_set_server'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'tx_isolation'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'transaction_isolation'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'character_set_results'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'timezone'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'time_zone'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'system_time_zone'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'lower_case_table_names'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'max_allowed_packet'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'net_buffer_length'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'sql_mode'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'query_cache_type'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'query_cache_size'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">OR</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Variable_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'init_connect'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1c9298113001-8\"><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20T21</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">02.738868Z28556029</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Query       </span><span class=\"crayon-e\">SHOW </span><span class=\"crayon-i\">COLLATION</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1c9298113001-9\"><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20T21</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">02.739941Z28556029</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Query       </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">character_set_results</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">NULL</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1c9298113001-10\"><span class=\"crayon-cn\">2017</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">07</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">20T21</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">45</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">02.740275Z28556029</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Query       </span><span class=\"crayon-e\">SET </span><span class=\"crayon-v\">autocommit</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0065 seconds] -->\r\n<p>那问题基本确定了，客户端请求都没到我们这边就抛出了上述的异常，和平台方再三沟通确认下，最后平台方查证是因为在执行插入前他们需要先从 SQL task 表取出 SQL 和更新 task 状态，结果这张表由于在整点存在大量 insert 和 update 并发，导致部分 SQL 等待 lock 超时了。。。</p>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/d29579706b846656c946e30891c2c075.jpg\" alt=\"\" width=\"280\" height=\"200\"></p>\n<h3>3、MySQL 日志分析脚本</h3>\n<p>由于凌晨是数据仓库的业务高峰，很多问题都是在这个时候爆发，一些诡异的问题往往是过了这个村就没这个店了，白天无法复现。如何能捕获我们关心的日志，便于快速的定位问题，这个是重中之重，这里我写了个小脚本，crontab 部署，可以选择时间范围开启，每分钟采样一次日志，需要说明的是 general log 没事别轻易开启，否则对数据库性能损耗较大。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d13b8a1cd167349055\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# crontab 部署方式：\r\n# */1 0-10 * * * cd /opt/ooxx/script &amp;&amp; bash mysql_perf.sh &gt;&gt; logs/mysql_perf.log.`date -I` 2&gt;&amp;1\r\n\r\ndate -Iseconds\r\n\r\necho '&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; top -bn1|head'\r\ntop -bn1|head \r\necho\r\n\r\necho '&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; SHOW ENGINE INNODB STATUS\\G '\r\nmysql -uroot -pooxx -h127.0.0.1 -e 'SHOW ENGINE INNODB STATUS\\G'\r\necho\r\n\r\necho '&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; show open tables where in_use&gt;0;'\r\nmysql -uroot -pooxx -h127.0.0.1 -e 'show open tables where in_use&gt;0;'\r\necho\r\n\r\necho '&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; show full processlist;'\r\nmysql -uroot -pooxx -h127.0.0.1 -e 'show full processlist;'\r\necho\r\n\r\necho '&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; SELECT * FROM `information_schema`.`innodb_trx` ORDER BY `trx_started`; '\r\nmysql -uroot -pooxx -h127.0.0.1 -e 'SELECT * FROM `information_schema`.`innodb_trx` ORDER BY `trx_started`;' \r\necho\r\n\r\necho '&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; SELECT * FROM `information_schema`.`innodb_locks`;'\r\nmysql -uroot -pooxx -h127.0.0.1 -e 'SELECT * FROM `information_schema`.`innodb_locks`;'\r\necho\r\n\r\necho \"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; show status like '%lock%';\"\r\nmysql -uroot -pooxx -h127.0.0.1 -e \"show status like '%lock%';\"\r\necho\r\n\r\necho '&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; show global status like \"table_locks%\";'\r\nmysql -uroot -pooxx -h127.0.0.1 -e 'show global status like \"table_locks%\";'\r\necho\r\n\r\necho \"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; too long omit...\"\r\nmysql -uroot -pooxx -h127.0.0.1 -e \"select r.trx_isolation_level, r.trx_id waiting_trx_id, r.trx_mysql_thread_id waiting_trx_thread, r.trx_state waiting_trx_state, lr.lock_mode waiting_trx_lock_mode, lr.lock_type waiting_trx_lock_type, lr.lock_table waiting_trx_lock_table, lr.lock_index waiting_trx_lock_index, r.trx_query waiting_trx_query, b.trx_id blocking_trx_id, b.trx_mysql_thread_id blocking_trx_thread, b.trx_state blocking_trx_state, lb.lock_mode blocking_trx_lock_mode, lb.lock_type blocking_trx_lock_type, lb.lock_table blocking_trx_lock_table, lb.lock_index blocking_trx_lock_index, b.trx_query blocking_query from information_schema.innodb_lock_waits w inner join information_schema.innodb_trx b on b.trx_id=w.blocking_trx_id inner join information_schema.innodb_trx r on r.trx_id=w.requesting_trx_id inner join information_schema.innodb_locks lb on lb.lock_trx_id=w.blocking_trx_id inner join information_schema.innodb_locks lr on lr.lock_trx_id=w.requesting_trx_id\\G\"\r\necho\r\n\r\necho \"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; too long omit...\"\r\nmysql -uroot -pooxx -h127.0.0.1 -e \"SELECT r.trx_id waiting_trx_id, r.trx_mysql_thread_id waiting_thread, r.trx_query waiting_query, b.trx_id blocking_trx_id, b.trx_mysql_thread_id blocking_thread, b.trx_query blocking_query FROM information_schema.innodb_lock_waits w INNER JOIN information_schema.innodb_trx b ON b.trx_id = w.blocking_trx_id INNER JOIN information_schema.innodb_trx r ON r.trx_id = w.requesting_trx_id\\G\"\r\necho\r\n\r\n\r\ndate -Iseconds\r\necho '&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;=================================================================================='\r\necho\r\n\r\nfile_name=mysql_perf.log.`date -I`\r\nif [[ `date +%-H%-M` == 1059 ]]\r\nthen\r\n cd /opt/ooxx/script/logs\r\n chmod 777 /home/work/ooxx/$file_name\r\n find /home/work/ooxx -name 'mysql_perf.log.*' -mtime +7 -delete\r\n \r\n cd /opt/data/mysql\r\n cp tjtx-ooxx-slow.log /home/work/ooxx/tjtx-ooxx-slow.log.`date -I`\r\n chmod 777 /home/work/ooxx/tjtx-ooxx-slow.log.`date -I`\r\n find /home/work/ooxx -name 'tjtx-ooxx-slow.log.*' -mtime +7 -delete\r\n \r\n cp mysqld.log /home/work/ooxx/mysqld.log.`date -I`\r\n chmod 777 /home/work/ooxx/mysqld.log.`date -I`\r\n find /home/work/ooxx -name 'mysqld.log.*' -mtime +7 -delete\r\nfi\r\n\r\n\r\n################\r\n# 开启 general_log 全量明细日志会降低数据库 5% 性能\r\n#if [[ \"`date +%H%M`\" == \"0545\" ]]\r\n#then\r\n# echo \"`date +%H%M` ------- set global general_log=1;\"\r\n# mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=1;'\r\n#elif [[ \"`date +%H%M`\" == \"0630\" ]]\r\n#then\r\n# echo \"`date +%H%M` ------- set global general_log=0;\"\r\n# mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=0;'\r\n#elif [[ \"`date +%H%M`\" == \"0745\" ]]\r\n#then\r\n# echo \"`date +%H%M` ------- set global general_log=1;\"\r\n# mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=1;'\r\n#elif [[ \"`date +%H%M`\" == \"0830\" ]]\r\n#then\r\n# echo \"`date +%H%M` ------- set global general_log=0;\"\r\n# mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=0;'\r\n#elif [[ \"`date +%H%M`\" == \"0001\" ]]\r\n#then\r\n# echo \"`date +%H%M` ------- set global general_log=1;\"\r\n# mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=1;'\r\n#elif [[ \"`date +%H%M`\" == \"0002\" ]]\r\n#then\r\n# echo \"`date +%H%M` ------- set global general_log=0;\"\r\n# mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=0;'\r\n#fi\r\n\r\n\r\n\r\n\r\n\r\n#[[ 10#`date +%H%M` -lt 10#0550 || 10#`date +%H%M` -gt 10#0830 ]] &amp;&amp; echo \"`date +%H%M` ------- set global general_log=0;\" &amp;&amp; mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=0;'\r\n\r\n\r\n# mysql -uroot -pooxx -h127.0.0.1 -e 'show open tables where in_use&gt;0;show full processlist;SELECT * FROM `information_schema`.`innodb_trx` ORDER BY `trx_started`;SELECT * FROM `information_schema`.`innodb_locks`;SHOW ENGINE INNODB STATUS\\G'\r\n\r\n# --show variables like '%tx_isolation%';\r\n# --SELECT @@GLOBAL.tx_isolation, @@tx_isolation, @@session.tx_isolation;\r\n# -- SET GLOBAL tx_isolation = 'READ-COMMITTED';\r\n# \r\n# --show variables like '%timeout%';\r\n# --show variables like 'innodb_lock_wait_timeout';\r\n# -- SET GLOBAL innodb_lock_wait_timeout=60\r\n# \r\n# --show variables like 'long_query_time';\r\n# -- SET global long_query_time=3;\r\n\r\n\r\n# -- show variables like 'innodb_rollback_on_timeout';\r\n\r\n# -- show VARIABLES like '%max_allowed_packet%';\r\n# -- set global max_allowed_packet = 100*1024*1024;\r\n\r\n# 自动提交\r\n# -- show variables like 'autocommit';\r\n\r\n# 慢查询\r\n# -- show variables like '%slow_query_log%';\r\n# set global 只对当前数据库生效，如果MySQL重启后则会失效。如果要永久生效，就必须修改配置文件my.cnf（其它系统变量也是如此）。\r\n# set global slow_query_log=1;\r\n# -- show variables like 'long_query_time%';\r\n# set global long_query_time=4;\r\n# show global variables like 'long_query_time'; \r\n# select sleep(5);\r\n# -- show variables like 'log_queries_not_using_indexes';\r\n# set global log_queries_not_using_indexes=1;\r\n# -- show variables like 'log_slow_admin_statements';\r\n# -- show global status like '%Slow_queries%';\r\n# http://www.cnblogs.com/kerrycode/p/5593204.html\r\n\r\n\r\n\r\n# -- show variables like \"%time_zone%\";\r\n#set global time_zone = '+8:00';\r\n\r\n#开启general_log日志\r\n# -- show variables like 'general%';\r\n#可以在my.cnf里添加,1开启（0关闭）,当然了,这样要重启才能生效,有点多余了\r\n#general-log = 1\r\n#log = /log/mysql_query.log路径\r\n#也可以设置变量那样更改,1开启（0关闭）,即时生效,不用重启,首选当然是这样的了\r\n# set global general_log=1\r\n#这个日志对于操作频繁的库,产生的数据量会很快增长,出于对硬盘的保护,可以设置其他存放路径\r\n#set global general_log_file=/tmp/general_log.log\r\n\r\n#mysql记录客户端IP：init_connect，有super权限的用户是不记录的，\r\n# create table t1 ( cur_user varchar(100), n_user varchar(100),in_time timestamp default current_timestamp()) ;\r\n# set global init_connect='insert into test.t1 (cur_user,n_user) values (current_user(),user())'; \r\n# SHOW CREATE TABLE mysql.general_log\\G ，开启general_log日志也行：\r\n# https://dba.stackexchange.com/questions/33654/mysql-logging-activity-from-specific-user-or-ip \r\n#SELECT REVERSE(SUBSTRING_INDEX(REVERSE(USER()),'@',1)) as ip;\r\n#SELECT SUBSTRING(USER(), LOCATE('@', USER())+1) as ip;\r\n#select SUBSTRING_INDEX(host,':',1) as 'ip' from information_schema.processlist WHERE ID=connection_id();</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-139\">139</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-140\">140</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-141\">141</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-142\">142</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-143\">143</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-144\">144</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-145\">145</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-146\">146</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-147\">147</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-148\">148</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-149\">149</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-150\">150</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-151\">151</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-152\">152</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-153\">153</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-154\">154</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-155\">155</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-156\">156</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-157\">157</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-158\">158</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-159\">159</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-160\">160</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b8a1cd167349055-161\">161</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b8a1cd167349055-162\">162</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-1\"><span class=\"crayon-p\"># crontab 部署方式：</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-2\"><span class=\"crayon-p\"># */1 0-10 * * * cd /opt/ooxx/script &amp;&amp; bash mysql_perf.sh &gt;&gt; logs/mysql_perf.log.`date -I` 2&gt;&amp;1</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-4\"><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Iseconds</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-6\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; top -bn1|head'</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-7\"><span class=\"crayon-v\">top</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">bn1</span><span class=\"crayon-o\">|</span><span class=\"crayon-e\">head </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-8\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-10\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; SHOW ENGINE INNODB STATUS\\G '</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-11\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">uroot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h127</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'SHOW ENGINE INNODB STATUS\\G'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-12\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-13\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-14\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; show open tables where in_use&gt;0;'</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-15\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">uroot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h127</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'show open tables where in_use&gt;0;'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-16\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-17\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-18\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; show full processlist;'</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-19\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">uroot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h127</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'show full processlist;'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-20\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-21\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-22\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; SELECT * FROM `information_schema`.`innodb_trx` ORDER BY `trx_started`; '</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-23\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">uroot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h127</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'SELECT * FROM `information_schema`.`innodb_trx` ORDER BY `trx_started`;'</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-24\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-26\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; SELECT * FROM `information_schema`.`innodb_locks`;'</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-27\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">uroot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h127</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'SELECT * FROM `information_schema`.`innodb_locks`;'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-28\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-30\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; show status like '%lock%';\"</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-31\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">uroot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h127</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"show status like '%lock%';\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-32\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-33\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-34\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; show global status like \"table_locks%\";'</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-35\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">uroot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h127</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'show global status like \"table_locks%\";'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-36\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-37\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-38\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; too long omit...\"</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-39\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">uroot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h127</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"select r.trx_isolation_level, r.trx_id waiting_trx_id, r.trx_mysql_thread_id waiting_trx_thread, r.trx_state waiting_trx_state, lr.lock_mode waiting_trx_lock_mode, lr.lock_type waiting_trx_lock_type, lr.lock_table waiting_trx_lock_table, lr.lock_index waiting_trx_lock_index, r.trx_query waiting_trx_query, b.trx_id blocking_trx_id, b.trx_mysql_thread_id blocking_trx_thread, b.trx_state blocking_trx_state, lb.lock_mode blocking_trx_lock_mode, lb.lock_type blocking_trx_lock_type, lb.lock_table blocking_trx_lock_table, lb.lock_index blocking_trx_lock_index, b.trx_query blocking_query from information_schema.innodb_lock_waits w inner join information_schema.innodb_trx b on b.trx_id=w.blocking_trx_id inner join information_schema.innodb_trx r on r.trx_id=w.requesting_trx_id inner join information_schema.innodb_locks lb on lb.lock_trx_id=w.blocking_trx_id inner join information_schema.innodb_locks lr on lr.lock_trx_id=w.requesting_trx_id\\G\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-40\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-41\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-42\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; too long omit...\"</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-43\"><span class=\"crayon-v\">mysql</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">uroot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">pooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h127</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">e</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"SELECT r.trx_id waiting_trx_id, r.trx_mysql_thread_id waiting_thread, r.trx_query waiting_query, b.trx_id blocking_trx_id, b.trx_mysql_thread_id blocking_thread, b.trx_query blocking_query FROM information_schema.innodb_lock_waits w INNER JOIN information_schema.innodb_trx b ON b.trx_id = w.blocking_trx_id INNER JOIN information_schema.innodb_trx r ON r.trx_id = w.requesting_trx_id\\G\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-44\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-45\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-46\"> </div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-47\"><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">Iseconds</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-48\"><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;=================================================================================='</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-49\"><span class=\"crayon-e\">echo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-50\"> </div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-51\"><span class=\"crayon-v\">file_name</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">mysql_perf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">I</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-52\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-o\">%</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">H</span><span class=\"crayon-o\">%</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">M</span><span class=\"crayon-sy\">`</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1059</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-53\"><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-54\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">opt</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">script</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">logs</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-55\"><span class=\"crayon-e\"> </span><span class=\"crayon-i\">chmod</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">777</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">work</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">$</span><span class=\"crayon-e\">file_name</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-56\"><span class=\"crayon-e\"> </span><span class=\"crayon-v\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">work</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'mysql_perf.log.*'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">mtime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">delete</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-57\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-58\"><span class=\"crayon-e\"> </span><span class=\"crayon-v\">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">opt</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">mysql</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-59\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">cp </span><span class=\"crayon-v\">tjtx</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">slow</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">work</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tjtx</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">slow</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">I</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-60\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">chmod</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">777</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">work</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tjtx</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">slow</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">I</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-61\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">work</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'tjtx-ooxx-slow.log.*'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">mtime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">delete</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-62\"><span class=\"crayon-e\"> </span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-63\"><span class=\"crayon-e\"> </span><span class=\"crayon-e\">cp </span><span class=\"crayon-v\">mysqld</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">work</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mysqld</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">I</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-64\"><span class=\"crayon-h\"> </span><span class=\"crayon-i\">chmod</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">777</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">work</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">mysqld</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">log</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">date</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">I</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-65\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">find</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">home</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">work</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ooxx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'mysqld.log.*'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">mtime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">delete</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-66\"><span class=\"crayon-v\">fi</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-67\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-68\"> </div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-69\"><span class=\"crayon-p\">################</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-70\"><span class=\"crayon-p\"># 开启 general_log 全量明细日志会降低数据库 5% 性能</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-71\"><span class=\"crayon-p\">#if [[ \"`date +%H%M`\" == \"0545\" ]]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-72\"><span class=\"crayon-p\">#then</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-73\"><span class=\"crayon-p\"># echo \"`date +%H%M` ------- set global general_log=1;\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-74\"><span class=\"crayon-p\"># mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=1;'</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-75\"><span class=\"crayon-p\">#elif [[ \"`date +%H%M`\" == \"0630\" ]]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-76\"><span class=\"crayon-p\">#then</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-77\"><span class=\"crayon-p\"># echo \"`date +%H%M` ------- set global general_log=0;\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-78\"><span class=\"crayon-p\"># mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=0;'</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-79\"><span class=\"crayon-p\">#elif [[ \"`date +%H%M`\" == \"0745\" ]]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-80\"><span class=\"crayon-p\">#then</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-81\"><span class=\"crayon-p\"># echo \"`date +%H%M` ------- set global general_log=1;\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-82\"><span class=\"crayon-p\"># mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=1;'</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-83\"><span class=\"crayon-p\">#elif [[ \"`date +%H%M`\" == \"0830\" ]]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-84\"><span class=\"crayon-p\">#then</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-85\"><span class=\"crayon-p\"># echo \"`date +%H%M` ------- set global general_log=0;\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-86\"><span class=\"crayon-p\"># mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=0;'</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-87\"><span class=\"crayon-p\">#elif [[ \"`date +%H%M`\" == \"0001\" ]]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-88\"><span class=\"crayon-p\">#then</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-89\"><span class=\"crayon-p\"># echo \"`date +%H%M` ------- set global general_log=1;\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-90\"><span class=\"crayon-p\"># mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=1;'</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-91\"><span class=\"crayon-p\">#elif [[ \"`date +%H%M`\" == \"0002\" ]]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-92\"><span class=\"crayon-p\">#then</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-93\"><span class=\"crayon-p\"># echo \"`date +%H%M` ------- set global general_log=0;\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-94\"><span class=\"crayon-p\"># mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=0;'</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-95\"><span class=\"crayon-p\">#fi</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-96\"> </div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-97\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-98\"> </div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-99\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-100\"> </div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-101\"><span class=\"crayon-p\">#[[ 10#`date +%H%M` -lt 10#0550 || 10#`date +%H%M` -gt 10#0830 ]] &amp;&amp; echo \"`date +%H%M` ------- set global general_log=0;\" &amp;&amp; mysql -uroot -pooxx -h127.0.0.1 -e 'set global general_log=0;'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-102\"> </div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-103\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-104\"><span class=\"crayon-p\"># mysql -uroot -pooxx -h127.0.0.1 -e 'show open tables where in_use&gt;0;show full processlist;SELECT * FROM `information_schema`.`innodb_trx` ORDER BY `trx_started`;SELECT * FROM `information_schema`.`innodb_locks`;SHOW ENGINE INNODB STATUS\\G'</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-105\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-106\"><span class=\"crayon-p\"># --show variables like '%tx_isolation%';</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-107\"><span class=\"crayon-p\"># --SELECT @@GLOBAL.tx_isolation, @@tx_isolation, @@session.tx_isolation;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-108\"><span class=\"crayon-p\"># -- SET GLOBAL tx_isolation = 'READ-COMMITTED';</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-109\"><span class=\"crayon-p\"># </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-110\"><span class=\"crayon-p\"># --show variables like '%timeout%';</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-111\"><span class=\"crayon-p\"># --show variables like 'innodb_lock_wait_timeout';</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-112\"><span class=\"crayon-p\"># -- SET GLOBAL innodb_lock_wait_timeout=60</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-113\"><span class=\"crayon-p\"># </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-114\"><span class=\"crayon-p\"># --show variables like 'long_query_time';</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-115\"><span class=\"crayon-p\"># -- SET global long_query_time=3;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-116\"> </div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-117\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-118\"><span class=\"crayon-p\"># -- show variables like 'innodb_rollback_on_timeout';</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-119\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-120\"><span class=\"crayon-p\"># -- show VARIABLES like '%max_allowed_packet%';</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-121\"><span class=\"crayon-p\"># -- set global max_allowed_packet = 100*1024*1024;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-122\"> </div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-123\"><span class=\"crayon-p\"># 自动提交</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-124\"><span class=\"crayon-p\"># -- show variables like 'autocommit';</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-125\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-126\"><span class=\"crayon-p\"># 慢查询</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-127\"><span class=\"crayon-p\"># -- show variables like '%slow_query_log%';</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-128\"><span class=\"crayon-p\"># set global 只对当前数据库生效，如果MySQL重启后则会失效。如果要永久生效，就必须修改配置文件my.cnf（其它系统变量也是如此）。</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-129\"><span class=\"crayon-p\"># set global slow_query_log=1;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-130\"><span class=\"crayon-p\"># -- show variables like 'long_query_time%';</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-131\"><span class=\"crayon-p\"># set global long_query_time=4;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-132\"><span class=\"crayon-p\"># show global variables like 'long_query_time'; </span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-133\"><span class=\"crayon-p\"># select sleep(5);</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-134\"><span class=\"crayon-p\"># -- show variables like 'log_queries_not_using_indexes';</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-135\"><span class=\"crayon-p\"># set global log_queries_not_using_indexes=1;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-136\"><span class=\"crayon-p\"># -- show variables like 'log_slow_admin_statements';</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-137\"><span class=\"crayon-p\"># -- show global status like '%Slow_queries%';</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-138\"><span class=\"crayon-p\"># http://www.cnblogs.com/kerrycode/p/5593204.html</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-139\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-140\"> </div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-141\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-142\"><span class=\"crayon-p\"># -- show variables like \"%time_zone%\";</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-143\"><span class=\"crayon-p\">#set global time_zone = '+8:00';</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-144\"> </div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-145\"><span class=\"crayon-p\">#开启general_log日志</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-146\"><span class=\"crayon-p\"># -- show variables like 'general%';</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-147\"><span class=\"crayon-p\">#可以在my.cnf里添加,1开启（0关闭）,当然了,这样要重启才能生效,有点多余了</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-148\"><span class=\"crayon-p\">#general-log = 1</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-149\"><span class=\"crayon-p\">#log = /log/mysql_query.log路径</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-150\"><span class=\"crayon-p\">#也可以设置变量那样更改,1开启（0关闭）,即时生效,不用重启,首选当然是这样的了</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-151\"><span class=\"crayon-p\"># set global general_log=1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-152\"><span class=\"crayon-p\">#这个日志对于操作频繁的库,产生的数据量会很快增长,出于对硬盘的保护,可以设置其他存放路径</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-153\"><span class=\"crayon-p\">#set global general_log_file=/tmp/general_log.log</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-154\"> </div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-155\"><span class=\"crayon-p\">#mysql记录客户端IP：init_connect，有super权限的用户是不记录的，</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-156\"><span class=\"crayon-p\"># create table t1 ( cur_user varchar(100), n_user varchar(100),in_time timestamp default current_timestamp()) ;</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-157\"><span class=\"crayon-p\"># set global init_connect='insert into test.t1 (cur_user,n_user) values (current_user(),user())'; </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-158\"><span class=\"crayon-p\"># SHOW CREATE TABLE mysql.general_log\\G ，开启general_log日志也行：</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-159\"><span class=\"crayon-p\"># https://dba.stackexchange.com/questions/33654/mysql-logging-activity-from-specific-user-or-ip </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-160\"><span class=\"crayon-p\">#SELECT REVERSE(SUBSTRING_INDEX(REVERSE(USER()),'@',1)) as ip;</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b8a1cd167349055-161\"><span class=\"crayon-p\">#SELECT SUBSTRING(USER(), LOCATE('@', USER())+1) as ip;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b8a1cd167349055-162\"><span class=\"crayon-p\">#select SUBSTRING_INDEX(host,':',1) as 'ip' from information_schema.processlist WHERE ID=connection_id();</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0140 seconds] -->\r\n<p></p>\n<h3>Refer：</h3>\n<p>[1] MySQL批量SQL插入性能优化</p>\n<p><a href=\"http://database.51cto.com/art/201309/411050.htm\" target=\"_blank\" rel=\"nofollow\">http://database.51cto.com/art/201309/411050.htm</a></p>\n<p>[2] MySQL 四种事务隔离级的说明</p>\n<p><a href=\"http://www.cnblogs.com/zhoujinyi/p/3437475.html\" target=\"_blank\" rel=\"nofollow\">http://www.cnblogs.com/zhoujinyi/p/3437475.html</a></p>\n<p>[3] innodb_rollback_on_timeout参数对锁的影响</p>\n<p><a href=\"http://q.fireflyclub.org/?/article/37\" target=\"_blank\" rel=\"nofollow\">http://q.fireflyclub.org/?/article/37</a></p>\n<p>[4] 日均万条数据丢失，一个隐式骚操作导致的奇葩事故！</p>\n<p><a href=\"https://mp.weixin.qq.com/s/OpPV24ILewVc2lRDrV4vvA\" target=\"_blank\" rel=\"nofollow\">https://mp.weixin.qq.com/s/OpPV24ILewVc2lRDrV4vvA</a></p>\n<p>[5] mysql之show engine innodb status解读（转）</p>\n<p><a href=\"http://www.cnblogs.com/ajianbeyourself/p/6941905.html\" target=\"_blank\" rel=\"nofollow\">http://www.cnblogs.com/ajianbeyourself/p/6941905.html</a></p>\n<p><a href=\"http://www.cnblogs.com/olinux/p/5497176.html\" target=\"_blank\" rel=\"nofollow\">http://www.cnblogs.com/olinux/p/5497176.html</a></p>\n<p>[6] Mysql 锁机制笔记</p>\n<p><a href=\"http://www.jianshu.com/p/fa28035656a9\" target=\"_blank\" rel=\"nofollow\">http://www.jianshu.com/p/fa28035656a9</a></p>\n<p><a href=\"http://www.jianshu.com/p/ec4a343c49f0\" target=\"_blank\" rel=\"nofollow\">http://www.jianshu.com/p/ec4a343c49f0</a></p>\n<p><a href=\"http://hudeyong926.iteye.com/blog/1490687\" target=\"_blank\" rel=\"nofollow\">http://hudeyong926.iteye.com/blog/1490687</a></p>\n<p>[7] MySQL索引原理及慢查询优化</p>\n<p><a href=\"https://tech.meituan.com/mysql-index.html\" target=\"_blank\" rel=\"nofollow\">https://tech.meituan.com/mysql-index.html</a></p>\n<p>[8] [译文]MySQL发生死锁肿么办？</p>\n<p><a href=\"http://www.10tiao.com/html/672/201612/2653929751/1.html\" target=\"_blank\" rel=\"nofollow\">http://www.10tiao.com/html/672/201612/2653929751/1.html</a></p>\n<p>[9] MySQL的timeout那点事</p>\n<p><a href=\"http://www.penglixun.com/tech/database/mysql_timeout.html\" target=\"_blank\" rel=\"nofollow\">http://www.penglixun.com/tech/database/mysql_timeout.html</a></p>\n<p>[10] mysql死锁(deadlock)分析及解决 （索引 间隙锁 sql顺序）</p>\n<p><a href=\"http://www.youyong.top/article/1158d0e3bcf\" target=\"_blank\" rel=\"nofollow\">http://www.youyong.top/article/1158d0e3bcf</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112054\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112054votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112054\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 5 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "这些奇怪的排序算法，你没见过吧？", "url": "http://blog.jobbole.com/112051/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/07/15cdc9eaec6ba9ac858b0eaebfb6b949.jpg"], "praise_nums": "3", "comment_nums": 1, "fav_nums": 6, "tags": "IT技术,趣文小说,排序算法", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/snowhere\">孙腾浩</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://www.quora.com/What-is-the-strangest-sorting-algorithm\">Quora</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>【伯乐在线导读】：如果有人问你哪种排序算法最奇怪，可能你会先在冒泡排序、选择排序、快速排序等常见排序算法中「搜索」了。</p>\n<p>有人在 Quora 上也发帖问了这个问题。于是乎，各种脑洞大开的奇特算法就被列出来了。它们可能存在性能问题或无法实现，但是不可否认其创造性。</p>\n<p><img class=\"alignnone wp-image-112059\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/15cdc9eaec6ba9ac858b0eaebfb6b949.jpg\" alt=\"黑人问号\" width=\"571\" height=\"326\"></p>\n<h3>睡眠排序（Nipun Ramakrishnan 的回答）</h3>\n<p>这个搞笑算法流传于 4chan 的 /prog/ 板块。无从查证具体出自哪位程序员，伪代码如下</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d13b882a1094467693\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprocedure printNumber(n)\r\n    sleep n seconds\r\n    print n\r\nend\r\n\r\nfor arg in args\r\n    run printNumber(arg) in background\r\nend\r\nwait for all processes to finish</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d13b882a1094467693-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b882a1094467693-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b882a1094467693-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b882a1094467693-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b882a1094467693-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b882a1094467693-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b882a1094467693-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b882a1094467693-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b882a1094467693-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d13b882a1094467693-1\"><span class=\"crayon-e\">procedure </span><span class=\"crayon-e\">printNumber</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b882a1094467693-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">sleep</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">seconds</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b882a1094467693-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b882a1094467693-4\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b882a1094467693-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b882a1094467693-6\"><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">arg </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">args</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b882a1094467693-7\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">run </span><span class=\"crayon-e\">printNumber</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">arg</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">background</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b882a1094467693-8\"><span class=\"crayon-st\">end</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b882a1094467693-9\"><span class=\"crayon-e\">wait </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">all </span><span class=\"crayon-e\">processes </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">finish</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>算法运行如下： 对于数组中每个元素 x，开启一个新程序：</p>\n<ul>\n<li>休眠 x 秒</li>\n<li>打印 x 所有元素同时开始计时。 只适用于非负数字。</li>\n</ul>\n<h3>Bogo 排序/猴子排序 （Ryan Turner的回答）</h3>\n<p>Bogo 排序/猴子排序，名字很奇怪。它是<a href=\"https://en.m.wikipedia.org/wiki/Stupid_sort\">愚蠢排序</a>中的一员。</p>\n<p>主要来说，算法就是你把元素随机排列。</p>\n<p>如果没有排好序，再次把元素随机排列。</p>\n<p>如果还没有排好序，你懂的。下面是个例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d13b882aa605899723\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n4, 7, 9, 6, 5, 5, 2, 1 (未排序)\r\n2, 5, 4, 7, 5, 9, 6, 1 (随机排列)\r\n1, 4, 5, 6, 9, 7, 5, 2 (再次随机排列)\r\n1, 2, 4, 5, 5, 6, 7, 9 (天呐，真幸运)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d13b882aa605899723-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b882aa605899723-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b882aa605899723-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b882aa605899723-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d13b882aa605899723-1\"><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span>未排序<span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b882aa605899723-2\"><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span>随机排列<span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b882aa605899723-3\"><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span>再次随机排列<span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b882aa605899723-4\"><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span>天呐，真幸运<span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>你不停地随机排序，直到得到一个有序数组。</p>\n<p>毫无疑问这是最低效的排序算法之一，除非你非常非常幸运。它时间复杂度是令人窒息的 O(n!)，而且随着元素数量增加，很有 O(∞) 的趋势。</p>\n<h3>量子 Bogo 排序（Tyler Schroeder 的回答）</h3>\n<p>我是量子 Bogo 排序的粉丝：</p>\n<ul>\n<li>随机排列数组中元素。</li>\n<li>如果数组没有排好序，摧毁当前宇宙（这一步就拜托你了）</li>\n<li>存活的宇宙将会有排好序的数组。 时间复杂度仅仅 O(n) 注意：这种算法依赖于量子力学的平行宇宙理论的可靠性。如果量子力学的平行宇宙理论不准确，这个算法时间复杂度达不到 O(n)</li>\n</ul>\n<h3>打印店页码排序 （Yi Wang的回答）</h3>\n<p>这并不是我发明的，我从别处看到的。</p>\n<p>一个学生去打印店打印材料。他需要两份，但并没有直接打印两份，而是将每一页打印了两次，像下面这样：</p>\n<p>需要的页码顺序: 1 2 3 4 … N; 1 2 3 4 … N</p>\n<p>手上的页码顺序: 1 1 2 2 3 3 4 4 …. N N</p>\n<p>他开始对打印材料排序，取一页放在左边，然后取一页放在右边。打印店老板看不下去了，直接把材料拿过来。</p>\n<p>老板首先取一页放在左边，然后两页放在右边，再然后两页左边，两页右边…… 排序速度瞬间翻倍 ……</p>\n<p>（有网友评论提醒：这是归纳，不是排序）</p>\n<h2>下面是其他网友的回答：</h2>\n<h3>慢排序</h3>\n<p>这是一个非常幽默却没什么用的排序算法。它基于“合而不治”的原则（分治算法基本思想“分而治之”的反义词，文字游戏），它由 Andrei Broder 和 Jorge Stolfi 于 1986 年发表在论文《Pessimal Algorithms and Simplexity Analysis（最坏排序和简单性分析）》中，伪代码如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9d13b882af256234179\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfunction slowSort(array,start,end){\r\n    if( start &gt;= end ) return; //已经不能再慢了\r\n    middle = floor( (start+end)/2 );\r\n\r\n    //递归\r\n    slowSort(array,start,middle);\r\n    slowSort(array,middle+1,end);\r\n\r\n    //比较得出最大值放在队尾\r\n    if( array[end] &lt; array[middle] )\r\n        swap array[end] and array[middle]\r\n\r\n    //去掉最大值之后再排序\r\n    slowsort(array,start,end-1);\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9d13b882af256234179-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b882af256234179-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b882af256234179-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b882af256234179-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b882af256234179-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b882af256234179-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b882af256234179-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b882af256234179-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b882af256234179-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b882af256234179-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b882af256234179-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b882af256234179-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b882af256234179-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9d13b882af256234179-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-59b9d13b882af256234179-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9d13b882af256234179-1\"><span class=\"crayon-t\">function</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">slowSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">,</span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b882af256234179-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">start</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">end</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">//已经不能再慢了</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b882af256234179-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">middle</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">floor</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">start</span><span class=\"crayon-o\">+</span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b882af256234179-4\"> </div><div class=\"crayon-line\" id=\"crayon-59b9d13b882af256234179-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//递归</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b882af256234179-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">slowSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">middle</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b882af256234179-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">slowSort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">middle</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b882af256234179-8\"> </div><div class=\"crayon-line\" id=\"crayon-59b9d13b882af256234179-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//比较得出最大值放在队尾</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b882af256234179-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-sy\">(</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">middle</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b882af256234179-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">swap </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">end</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">middle</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b882af256234179-12\"> </div><div class=\"crayon-line\" id=\"crayon-59b9d13b882af256234179-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\">//去掉最大值之后再排序</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9d13b882af256234179-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">slowsort</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">array</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">start</span><span class=\"crayon-sy\">,</span><span class=\"crayon-st\">end</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9d13b882af256234179-15\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p></p>\n<ul>\n<li>递归排序好前一半</li>\n<li>递归排序好后一半</li>\n<li>比较中间和队尾的值，得到整个数组的最大值，将最大值放到队尾。</li>\n<li>去掉最大值，递归整个数组</li>\n</ul>\n<h3>Stack 排序</h3>\n<p>从 StackOverflow 上搜索标题含有“数组排序”的帖子，复制粘贴并运行其中的代码片段，直到数组排好序。我认为这种排序算法事实上验证了整个数组。它被发表在<a href=\"https://xkcd.com/1185/\">xkcd网站</a>上，这里有一个在线版的具体实现<a href=\"https://gkoberger.github.io/stacksort/\">stacksort</a></p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/87e983d6fd4a07bf10518f60d84c2595.png\"><img class=\"alignnone size-medium wp-image-65367\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/87e983d6fd4a07bf10518f60d84c2595.png\" alt=\"stacksort\"></a></p>\n<h3>随机排序</h3>\n<p>运行如下： 创建一个随机程序。 传入数组并运行随机程序。 如果程序的输出恰好是排好序的，完成。 否则重复上面过程。</p>\n<h3>太阳能比特翻转排序</h3>\n<p>太阳发出的阿尔法粒子偶尔能够翻转内存中的比特位，所以这种算法主要基于希望这种翻转能够使元素正确排序。运行方式如下：</p>\n<p>检查数组是否排好序。 如果排好序，返回这个数组。 如果没有，等 10 秒钟并祈祷太阳辐射使得比特位翻转，而且使得数组排好序，重复第一步。</p>\n<h3>意大利面排序</h3>\n<p>这是一种线性时间算法，是需要 O(n) 空间的稳定排序。它需要并行处理器。简单来说，假设我们排序一列自然数。排序方法需要使用很多根生的意大利面条。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/eb19bcfbd683bded0fdd0b92891aac90.png\"><img class=\"size-medium wp-image-65368\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/eb19bcfbd683bded0fdd0b92891aac90.png\" alt=\"意大利面\"></a></p>\n<p>将数据按比例转换成表示意大利面条长度的数字。 在每根面条上写下数字，并将面条折断成数字表示的长度。 把所有面条攥成一捆并把底部在平面上敲击。 取出最突出的一根面条，也就是最长的一根，获取上面的数字，转换成原始的数据并记录下来。 重复这个过程直到处理完所有意大利面。</p>\n<h3>指鹿为马排序</h3>\n<p>这个算法时间复杂度 O(n)。 聚集一帮人并向他们展示数组。 询问他们这个数组是否是排序好的。 干掉其中认为没有排序好的人。 重复几次，直到所有人同意这个数组是排序好的。</p>\n<h3>智能设计排序</h3>\n<p>无论你的数组状态是什么样的，它都算是排好序的。 解释：原始输入按照某种顺序的概率是 1/(n!)。概率是如此小，（当前的顺序）归结于运气成分显然是荒谬的，所以它是按照“智能设计”排序过的。所以完全可以说数组已经排好序了，只是不是我们传统意义上的“升序”。如果按照我们传统观点对它进行操作，只会让它乱序。（<a href=\"https://zh.wikipedia.org/wiki/%E6%99%BA%E8%83%BD%E8%AE%BE%E8%AE%A1\">“智能设计”涉及宗教和哲学，不过多解释</a>）</p>\n<h3>互联网排序</h3>\n<p>这是一种冒泡排序，但每次比较都依靠互联网的搜索。比如 “0.211 和 0.75 哪个大？”</p>\n<h3>委员会排序</h3>\n<p>排序一个包含 N 个自然数的数组，首先用纸打印出 N 份整个数组。 然后在办公室周围选择几个恰好路过的倒霉委员。每个委员对应数组中的一个数字。 给每个委员一份打印的数组，并让他们通过开会或其他手段，来决定自己代表的数字应该在有序数组中的位置。 当这些委员有结论并答复你时，数组自然排好序了。</p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>任选一种支付方式</p>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/5085cce1bd4e144b7d148079a34b20c1.jpg\">\n            \n                            <img src=\"http://jbcdn2.b0.upaiyun.com/2017/01/02b09a29fdb3ab5fe03d4bd1afe95664.jpg\">\n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112051\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112051votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112051\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 1 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere\">孙腾浩</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/06/47765e50cfb7c4e598e72d893ab4f62f.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            毕业于郑州大学软件工程专业，身为 Java 程序猿却同样热爱着 JavaScript 。为了兴趣而写代码，做自己喜欢做的事。Keep coding ... Stay Cool ...        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/snowhere\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/snowhere/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/snowhere/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 18</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://snowhere.me/\"><i class=\"fa fa-link\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/Snowhere/\"><i class=\"fa fa-github\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "可能是迄今为止最好的 GitHub 代码浏览插件", "url": "http://blog.jobbole.com/112011/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2013/03/124.jpg"], "praise_nums": "1", "comment_nums": 2, "fav_nums": 9, "tags": "工具与资源,Github", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"http://www.geeksense.cn/plugin/\">geeksense</a>   </div><p>【伯乐在线转注】：以前曾介绍过一个 Chrome 插件 <a href=\"http://t.cn/RPZJZfD\" target=\"_blank\">Octotree</a>。安装之后，浏览托管在 Github上的项目，可看到左侧的树形结构，更方便查看代码。今天这篇文章介绍另外一个同类插接。</p>\n<hr>\n<p>GitHub是很多开发者远(tong)程(xing)协(jiao)作(you)的重要工具，其社交化编码的理念伴随着开源运动改变着整个开发社区的生态，无数优质项目依托GitHub在全球开源开发者的参与下蓬勃发展。</p>\n<p><strong>不过，讲真，你有在GitHub上好好读过代码吗？</strong></p>\n<p>对于大部分人来说恐怕是没有，GitHub作为一款基于Git的代码管理工具和协同工具是很优秀的，然而作为代码浏览和搜索工具，就和IDE差的很远了。不然为什么到今天GitHub连个侧栏的文件树没有，很多开发者要专门去下载浏览器插件才能有文件树？为什么你还是需要git clone到本地在把代码装到你的IDE里才能愉快的阅读代码？是不是有想过如果能像IDE那样在GitHub上浏览代码多好？</p>\n<p>今天我们就来介绍一款Chrome浏览器插件Insight.io，让你能像在GitHub上像你的IDE里一样浏览和搜索代码，让你的Github就像穿上了钢铁侠的战衣。</p>\n<p><img id=\"pic\" class=\"\" src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fhzg5vidjjg20dq094wp8.gif\"></p>\n<h2 id=\"\">功能总览</h2>\n<p><a href=\"https://chrome.google.com/webstore/detail/insightio/pmhfgjjhhomfplgmbalncpcohgeijonh\">下载安装</a>后，打开一个GitHub上的项目，会看到左边有个侧边栏，是不是已经有了自己在IDE里面的感觉了？插件提供以下功能</p>\n<ul>\n<li><strong>跳转到定义</strong></li>\n<li><strong>查找引用</strong></li>\n<li><strong>目录树功能</strong></li>\n<li><strong>基于符号的代码搜索</strong></li>\n</ul>\n<p><img src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fhzg5waddog21410osb29.gif\" alt=\"Glance\"></p>\n<p> </p>\n<h2 id=\"\">交叉引用</h2>\n<p>用<a href=\"https://github.com/apache/spark\">Apache Spark</a>做例子，悬浮在某个节点(类，方法，变量等)上就可以看到相应的类型和文档说明。点击左边的结构(Structure)按钮就可以看到改文件的类结构，包括成员变量，成员函数等，点击也可以跳到相应的行。</p>\n<p><img src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fhzg5y5wqwg21400ot1l0.gif\" alt=\"Cross Reference\"></p>\n<h2 id=\"\">查找引用</h2>\n<p>点击任何节点的用例就能跳到这个类，方法或者变量定义的地方（类似于IDE中的Ctrl + click）。</p>\n<p>点击类，方法和变量的定义节点，则可以找出所有该节点的使用例子。其中使用例子又会以被引用(Referenced At), 继承 (Inherit), 被继承(Inherited By), 重写(Override)等类型进一步分类方便查找。如果结果太多，用例的右上方也会有支持regular expression的文本框可以用来过滤出感兴趣的文件。</p>\n<p><img src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fhzg5zayzeg21650q4kjn.gif\" alt=\"Find References\"></p>\n<h2 id=\"\">目录树</h2>\n<p>点击文件(File)按钮你会看到树状的目录结构，忘记GitHub上切换文件的痛苦吧，文件树让你轻松的在项目之内的文件中自如切换。</p>\n<p>对于私有项目需要点击下方的<strong>Sign In</strong>按钮并到insight.io上导入私有项目文件树才会生效。</p>\n<p><img src=\"http://wx4.sinaimg.cn/large/7cc829d3gy1fhzg60wyodg21420othdv.gif\" alt=\"Directory Tree\"></p>\n<h2 id=\"\">代码搜索</h2>\n<p>GitHub只支持纯文本搜索，这时常让搜索代码变得很困难，特别是当你想搜的关键词是常用词的时候，大量的无用结果会让搜索功能完全不可用。而是用Insight.io插件，点击搜索(Search)按钮可以按类名，方法名，变量名，文件名等等搜索代码，并且有自动补全功能。试试在Insight.io和GitHub原生搜索上搜一下RDD.map对比下搜索结果吧？</p>\n<p><img src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fhzg62hd81g21660q44qr.gif\" alt=\"Code Search\"></p>\n<h2 id=\"insightio\">跳转到Insight.io</h2>\n<p>你也可以一键点击跳转到Insight.io上获得更好的浏览体验。</p>\n<p><img src=\"http://wx2.sinaimg.cn/large/7cc829d3gy1fhzg645xmfg21410oru0y.gif\" alt=\"View on insight.io\"></p>\n<h2 id=\"insightio\">提交项目给Insight.io</h2>\n<p>Insight.io目前收录了2000多个最活跃的开源项目，包括<a href=\"https://github.com/apache/kafka\">Apache Kafka</a>, <a href=\"https://github.com/torvalds/linux\">Linux-kernel</a>这样的大型项目，也有像<a href=\"https://github.com/daimajia/AndroidSwipeLayout\">AndroidSwipeLayout</a>这样优质的个人项目。如果你需要的项目并未被我们收录，点击<strong>Information</strong>栏下的<strong>Request Analyze</strong>就可以提交你目前正在浏览的项目了。</p>\n<p><img src=\"http://wx3.sinaimg.cn/large/7cc829d3gy1fhzg65lh83g213y0oru0x.gif\" alt=\"Request Analyze\"></p>\n<h2 id=\"\">快捷键</h2>\n<p>用快捷键可以快速打开关闭插件功能:</p>\n<ul>\n<li><strong>文件树</strong>: <code>⌘+⇧+f</code></li>\n<li><strong>类结构</strong>: <code>⌘+⇧+o</code></li>\n<li><strong>信息</strong>: <code>⌘+⇧+i</code></li>\n<li><strong>搜索</strong>: <code>⌘+⇧+s</code></li>\n</ul>\n<hr>\n<p><a href=\"https://chrome.google.com/webstore/detail/insightio-for-github/pmhfgjjhhomfplgmbalncpcohgeijonh/\" target=\"_blank\">插件下载传送门</a></p>\n<p>目前插件支持的语言有Java, C/C++, Scala, Python和Ruby。想跟开发团队吐个槽或者点个赞？想知道最好的编程语言PHP什么时候支持？想知道怎么让公司代码库也能用上Insight.io？欢迎邮件到 support@insight.io 。想实时吐槽的也可以加入我们的gitter房间</p>\n<p><a href=\"https://gitter.im/Insight-io/Lobby\"><img title=\"\" src=\"https://badges.gitter.im/Insight-io/Lobby.png\" alt=\"Gitter chat\"></a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112011\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112011votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112011\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 9 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "27 个机器学习、数学、Python 速查表", "url": "http://blog.jobbole.com/112009/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/04/ff247977ac3e5237654ad324e8c880ed.jpg"], "praise_nums": "6", "comment_nums": 2, "fav_nums": 27, "tags": "工具与资源,Python,数学,机器学习", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/shaozhengjiang\">iPytLab</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://unsupervisedmethods.com/cheat-sheet-of-machine-learning-and-python-and-math-cheat-sheets-a4afe4e791b6\">Robbie Allen</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>机器学习涉及到的方面非常多。当我开始准备复习这些内容的时候，我找到了许多不同的”速查表”, 这些速查表针对某一主题都罗列出了所有我需要知道的知识重点。最终我编译了超过 20 份机器学习相关的速查表，其中一些是我经常用到的而且我相信其他人也会从中受益。本文整理了我在网络上找到的 27 个速查表，我认为比较好。如果我有遗漏，欢迎补充。</p>\n<p>如今机器学习领域的发展相当迅速，我可以想象出来这些资源将会很快过时，但是至少在当前，在2017年6月1日，他们都是相当流行的。</p>\n<p>如果你们像我一样想要一次性批量下载所有资源，我已经将 27 个速查表整理打包（<a href=\"https://www.dropbox.com/s/v3yg8djhdf24g6v/UnsupervisedMethods.com%20-%20Cheat%20Sheets.zip?dl=0\" target=\"_blank\">Dropbox</a>、<a href=\"https://pan.baidu.com/s/1mi0viGS\" target=\"_blank\">百度云</a>）好了，请尽情享用吧！</p>\n<p>如果你喜欢本文，记得给我在下面点个 zan 哦。</p>\n<h2 id=\"机器学习\">机器学习\n</h2><p>这里我从一些和机器学习算法相关的流程图和表格中选择了我认为最全面的几个并在下面罗列出来。</p>\n<h3 id=\"Neural-Network-Architectures\">Neural Network Architectures\n</h3><p>链接: <a href=\"http://www.asimovinstitute.org/neural-network-zoo/\" target=\"_blank\" rel=\"external\">http://www.asimovinstitute.org/neural-network-zoo/</a><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/NN.png\" alt=\"\"></p>\n<p> </p>\n<p style=\"text-align: center;\"><em>The Neural Network Zoo</em></p>\n<h3 id=\"Microsoft-Azure-Algorithm-Flowchart\">Microsoft Azure Algorithm Flowchart\n</h3><p>链接: <a href=\"https://docs.microsoft.com/en-us/azure/machine-learning/machine-learning-algorithm-cheat-sheet\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://docs.microsoft.com/en-us/azure/machine-learning/machine-learning-algorithm-cheat-sheet</span></a></p>\n<p><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/MS.png\" alt=\"\"></p>\n<p style=\"text-align: center;\"><em>Machine learning algorithm cheat sheet for Microsoft Azure Machine Learning Studio</em></p>\n<h3 id=\"SAS-Algorithm-Flowchart\">SAS Algorithm Flowchart\n</h3><p>链接: <a href=\"http://blogs.sas.com/content/subconsciousmusings/2017/04/12/machine-learning-algorithm-use/\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://blogs.sas.com/content/subconsciousmusings/2017/04/12/machine-learning-algorithm-use/</span></a></p>\n<p><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/SAS.png\" alt=\"\"></p>\n<p style=\"text-align: center;\"><em>SAS: Which machine learning algorithm should I use?</em></p>\n<h3 id=\"Algorithm-Summary\">Algorithm Summary\n</h3><p>链接: <a href=\"http://machinelearningmastery.com/a-tour-of-machine-learning-algorithms/\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://machinelearningmastery.com/a-tour-of-machine-learning-algorithms/</span></a></p>\n<p><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/AS.png\" alt=\"\"></p>\n<p style=\"text-align: center;\"><em>A Tour of Machine Learning Algorithms</em></p>\n<p style=\"text-align: center;\"><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/best.jpeg\" rel=\"gallery0\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/best.jpeg\" alt=\"\"></a><br>\n<em>Which are the best known machine learning algorithms?</em></p>\n<h3 id=\"Algorithm-Pro-Con\">Algorithm Pro/Con\n</h3><p>链接: <a href=\"https://blog.dataiku.com/machine-learning-explained-algorithms-are-your-friend\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://blog.dataiku.com/machine-learning-explained-algorithms-are-your-friend</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/CON.jpeg\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/CON.jpeg\" alt=\"\"></span></a></p>\n<h2 id=\"Python\">Python\n</h2><p>网上在线的Python资源可以说是相当的多。在这一部分，我挑选了我遇到的几个最好的速查表呈献给大家。</p>\n<h3 id=\"ML算法\">ML算法\n</h3><p>链接: <a href=\"https://www.analyticsvidhya.com/blog/2015/09/full-cheatsheet-machine-learning-algorithms/\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://www.analyticsvidhya.com/blog/2015/09/full-cheatsheet-machine-learning-algorithms/</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/PYALGO.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/PYALGO.png\" alt=\"\"></span></a></p>\n<h3 id=\"Python基础\">Python基础\n</h3><p>链接: <a href=\"http://datasciencefree.com/python.pdf\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://datasciencefree.com/python.pdf</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/PYBASIC.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/PYBASIC.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"https://www.datacamp.com/community/tutorials/python-data-science-cheat-sheet-basics#gs.0x1rxEA\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://www.datacamp.com/community/tutorials/python-data-science-cheat-sheet-basics#gs.0x1rxEA</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/PYBASIC2.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/PYBASIC2.png\" alt=\"\"></span></a></p>\n<h3 id=\"Numpy\">Numpy\n</h3><p>链接: <a href=\"https://www.dataquest.io/blog/numpy-cheat-sheet/\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://www.dataquest.io/blog/numpy-cheat-sheet/</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/NUMPY.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/NUMPY.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"http://datasciencefree.com/numpy.pdf\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://datasciencefree.com/numpy.pdf</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/numpy-pdf.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/numpy-pdf.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"https://www.datacamp.com/community/blog/python-numpy-cheat-sheet#gs.Nw3V6CE\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://www.datacamp.com/community/blog/python-numpy-cheat-sheet#gs.Nw3V6CE</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/numpy3.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/numpy3.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"https://github.com/donnemartin/data-science-ipython-notebooks/blob/master/numpy/numpy.ipynb\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://github.com/donnemartin/data-science-ipython-notebooks/blob/master/numpy/numpy.ipynb</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/numpy4.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/numpy4.png\" alt=\"\"></span></a></p>\n<h3 id=\"Pandas\">Pandas\n</h3><p>链接: <a href=\"http://datasciencefree.com/pandas.pdf\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://datasciencefree.com/pandas.pdf</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/pandas.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/pandas.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"https://www.datacamp.com/community/blog/python-pandas-cheat-sheet#gs.S4P4T=U\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://www.datacamp.com/community/blog/python-pandas-cheat-sheet#gs.S4P4T=U</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/pandas2.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/pandas2.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"https://github.com/donnemartin/data-science-ipython-notebooks/blob/master/pandas/pandas.ipynb\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://github.com/donnemartin/data-science-ipython-notebooks/blob/master/pandas/pandas.ipynb</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/pandas3.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/pandas3.png\" alt=\"\"></span></a></p>\n<h3 id=\"Matplotlib\">Matplotlib\n</h3><p>链接: <a href=\"https://www.datacamp.com/community/blog/python-matplotlib-cheat-sheet\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://www.datacamp.com/community/blog/python-matplotlib-cheat-sheet</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/matplotlib.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/matplotlib.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"https://github.com/donnemartin/data-science-ipython-notebooks/blob/master/matplotlib/matplotlib.ipynb\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://github.com/donnemartin/data-science-ipython-notebooks/blob/master/matplotlib/matplotlib.ipynb</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/matplotlib2.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/matplotlib2.png\" alt=\"\"></span></a></p>\n<h3 id=\"Scikit-Learn\">Scikit Learn\n</h3><p>链接: <a href=\"https://www.datacamp.com/community/blog/scikit-learn-cheat-sheet#gs.fZ2A1Jk\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://www.datacamp.com/community/blog/scikit-learn-cheat-sheet#gs.fZ2A1Jk</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/skl.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/skl.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"http://peekaboo-vision.blogspot.de/2013/01/machine-learning-cheat-sheet-for-scikit.html\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://peekaboo-vision.blogspot.de/2013/01/machine-learning-cheat-sheet-for-scikit.html</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/skl2.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/skl2.png\" alt=\"\"></span></a></p>\n<p>链接: <a href=\"https://github.com/rcompton/ml_cheat_sheet/blob/master/supervised_learning.ipynb\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://github.com/rcompton/ml_cheat_sheet/blob/master/supervised_learning.ipynb</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/skl3.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/skl3.png\" alt=\"\"></span></a></p>\n<h3 id=\"Tensorflow\">Tensorflow\n</h3><p>链接: <a href=\"https://github.com/aymericdamien/TensorFlow-Examples/blob/master/notebooks/1_Introduction/basic_operations.ipynb\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://github.com/aymericdamien/TensorFlow-Examples/blob/master/notebooks/1_Introduction/basic_operations.ipynb</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/tf.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/tf.png\" alt=\"\"></span></a></p>\n<h3 id=\"Pytorch\">Pytorch\n</h3><p>链接: <a href=\"https://github.com/bfortuner/pytorch-cheatsheet\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://github.com/bfortuner/pytorch-cheatsheet</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/torch.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/torch.png\" alt=\"\"></span></a></p>\n<h2 id=\"数学\">数学\n</h2><p>如果你想真正的理解机器学习，你需要有扎实的统计学(尤其是概率论), 线性代数以及微积分基础。我在上大学的时候辅修了数学专业，但是我肯定还是需要对这些数学知识进行复习。如果你想理解常用机器学习算法背后的数学原理，那么下面的这些速查表将会是你需要的。</p>\n<h3 id=\"概率论\">概率论\n</h3><p>链接: <a href=\"http://www.wzchen.com/s/probability_cheatsheet.pdf\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://www.wzchen.com/s/probability_cheatsheet.pdf</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/prob.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/prob.png\" alt=\"\"></span></a></p>\n<h3 id=\"线性代数\">线性代数\n</h3><p>链接: <a href=\"https://minireference.com/static/tutorials/linear_algebra_in_4_pages.pdf\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">https://minireference.com/static/tutorials/linear_algebra_in_4_pages.pdf</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/la.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/la.png\" alt=\"\"></span></a></p>\n<h3 id=\"统计学\">统计学\n</h3><p>链接: <a href=\"http://web.mit.edu/~csvoss/Public/usabo/stats_handout.pdf\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://web.mit.edu/~csvoss/Public/usabo/stats_handout.pdf</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/stat.png\" rel=\"gallery0\"><span style=\"color: #0066cc;\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/stat.png\" alt=\"\"></span></a></p>\n<h3 id=\"微积分\">微积分\n</h3><p>链接: <a href=\"http://tutorial.math.lamar.edu/getfile.aspx?file=B,41,N\" target=\"_blank\" rel=\"external\"><span style=\"color: #0066cc;\">http://tutorial.math.lamar.edu/getfile.aspx?file=B,41,N</span></a></p>\n<p><a class=\"fancybox\" href=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/calculus.png\" rel=\"gallery0\"><img src=\"http://pytlab.org/assets/images/blog_img/2017-07-25-%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0-Python-%E6%95%B0%E5%AD%A6%E7%9B%B8%E5%85%B3%E7%9A%84%E9%80%9F%E6%9F%A5%E8%A1%A8/calculus.png\" alt=\"\"></a></p>\n<p>打包下载：<a href=\"https://www.dropbox.com/s/v3yg8djhdf24g6v/UnsupervisedMethods.com%20-%20Cheat%20Sheets.zip?dl=0\" target=\"_blank\">Dropbox</a>、<a href=\"https://pan.baidu.com/s/1mi0viGS\" target=\"_blank\">百度云</a></p>\n\r\n        \r\n            <blockquote class=\"rewards\">\n        <p><strong>打赏支持我翻译更多好文章，谢谢！</strong></p>\n        <a href=\"#rewardbox\" id=\"rewards-button\" class=\"fancybox\"><span class=\"btn-bluet-blue href-style\"><i class=\"fa fa-jpy\"></i> 打赏译者</span></a>\n    </blockquote>\n\n    <div id=\"rewardbox\">\n        <h4>打赏支持我翻译更多好文章，谢谢！</h4>\n                <p>\n                        <img src=\"http://jbcdn2.b0.upaiyun.com/2016/05/c3d3aeee3e50259c10c3524201fc68db.jpg\">\n            \n                    </p>\n    </div>\n\n    \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"112009\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"112009votetotal\">6</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"112009\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 27 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 2 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang\">iPytLab</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2017/07/d3f741a9dd5c4194b365e95b06a56c09.jpeg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            喜欢写程序的计算化学狗，Python/C/C++/Fortran, 个人博客 http://pytlab.org        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/shaozhengjiang\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/shaozhengjiang/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/shaozhengjiang/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 15</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://pytlab.org\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/shaowugui\"><i class=\"fa fa-weibo\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/PytLab\"><i class=\"fa fa-github\"></i></a> <a title=\"Stack Overflow主页\" target=\"_blank\" href=\"http://stackoverflow.com/users/4014840/pytlab\"><i class=\"fa fa-stack-overflow\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "移花接木：针对OAuth2的攻击", "url": "http://blog.jobbole.com/111926/", "front_image_url": ["http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-OAuth2-Authorization-Code-Flow.png"], "praise_nums": "2", "comment_nums": 0, "fav_nums": 3, "tags": "IT技术,OAuth2", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>作为第三方应用，为了提升用户体验，往往会提供第三方社交账号登录或者绑定的功能，这背后使用到的关键技术是OAuth认证。想要在自己的应用里集成OAuth不是难事儿，各大社交网站都提供了详尽的文档指南。</p>\n<div>\n<p>OAuth的复杂度比较高，有不少安全方面的坑，开发者在使用过程中一不注意可能就会掉进去，比如说不正确的使用OAuth2可能会遭遇到CSRF攻击。本文将对这个安全风险做一个通俗易懂的解释。 老司机发车前的特别提醒：阅读本文需要你对OAuth2有一些了解，可以参考文末的链接。</p>\n<h3>1. OAuth2 授权模式回顾</h3>\n<p>在开始之前，让我们先来回顾一下OAuth2中最典型的Authorization Code 授权模式，其大致流程如下：</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-OAuth2-Authorization-Code-Flow.png\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-OAuth2-Authorization-Code-Flow.png\" alt=\"\" width=\"768\" height=\"734\"></a></p>\n<p>图1：OAuth2 Authorization Code Flow</p>\n<p>我们把OAuth2的整个认证过程大致分为三个阶段。第一阶段主要是向用户取得授权许可，对应图中的第1、2、3步；第二阶段主要是申请访问令牌（access_token），对应图中的第4、5步；第三阶段就是使用access_token获取用户数据。</p>\n<p>这一过程中涉及了不少敏感参数和数据，例如client_secret相当于是第三方应用自己的密码，access_token某种程度上来讲就是用户的session id。由于这些参数以及数据极其特殊，我们当然得确保它们的安全性，HTTPS加密传输以及安全存储是必不可少的防护手段。不过仅仅做到这些是远远不够的，在这个流程里存在一个弱点，容易被攻击者利用进行CSRF攻击。</p>\n<h3>2. 针对OAuth2的CSRF攻击</h3>\n<h4>2.1 攻击流程</h4>\n<p>让我们来看一个针对OAuth2的CSRF攻击的例子。假设有用户张三，和攻击者李四，还有一个第三方Web应用Tonr，它集成了第三方社交账号登录，并且允许用户将社交账号和Tonr中的账号进行绑定。此外还有一个OAuth2服务提供者Sparklr。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/2-CSRF-attack.png\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/2-CSRF-attack.png\" alt=\"\" width=\"768\" height=\"250\"></a></p>\n<p>图2：模拟攻击案例中涉及的角色</p>\n<p>Step 1. 攻击者李四登录Tonr网站，并且选择绑定自己的Sparklr账号。</p>\n<p>Step 2. Tonr网站将李四重定向到Sparklr，由于他之前已经登录过Sparklr，所以Sparklr直接向他显示“是否授权Tonr访问”的页面。</p>\n<p>Step 3. 李四在点击”同意授权“之后，截获Sparklr服务器返回的含有Authorization Code参数的HTTP响应。</p>\n<p>Step 4. 李四精心构造一个Web页面，它会触发Tonr网站向Sparklr发起令牌申请的请求，而这个请求中的Authorization Code参数正是上一步截获到的code。</p>\n<p>Step 5. 李四将这个Web页面放到互联网上，等待或者诱骗受害者张三来访问。</p>\n<p>Step 6. 张三之前登录了Tonr网站，只是没有把自己的账号和其他社交账号绑定起来。在张三访问了李四准备的这个Web页面后，令牌申请流程在张三的浏览器里被顺利触发，Tonr网站从Sparklr那里获取到access_token，但是这个token以及通过它进一步获取到的用户信息却都是攻击者李四的。</p>\n<p>Step 7. Tonr网站将李四的Sparklr账号同张三的Tonr账号关联绑定起来，从此以后，李四就可以用自己的Sparklr账号通过OAuth登录到张三在Tonr网站中的账号，堂而皇之的冒充张三的身份执行各种操作。</p>\n<p>等等，这一切发生得太快，还没看清楚李四怎么就登录到张三的账号里去了。没关系，让我们从几个不同的角度来看看这当中发生了什么。</p>\n<h4>2.2 受害者张三(Resource Owner)视角</h4>\n<p>受害者张三访问了一个Web页面，然后，就没有然后了，他在Tonr网站上的账号就和攻击者李四在Sparklr上的账号绑定到了一起。伪造的请求是经过精心构造的，令牌申请这一过程在张三的浏览器里是非常隐蔽的被触发的，换句话讲就是，他根本不知道这背后发生了什么。</p>\n<h4>2.3 Tonr网站(Client)视角</h4>\n<p>从Tonr网站来看，它收到的所有请求看上去都是正常的。首先它收到了一个HTTP请求，其代表着当前用户张三在Sparklr网站上已经做了“同意授权”操作。其内容如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc4152a41692629045\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nGET /bindingCallback?code=AUTHORIZATION_CODE\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc4152a41692629045-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc4152a41692629045-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc4152a41692629045-1\"><span class=\"crayon-v\">GET</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">bindingCallback</span><span class=\"crayon-sy\">?</span><span class=\"crayon-v\">code</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">AUTHORIZATION</span><span class=\"crayon-sy\">_</span>CODE</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc4152a41692629045-2\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>不过需要注意的是，URL里的code不是当前受害者张三的Authorization Code，而是攻击者李四的。</p>\n<p>当Tonr收到这样的请求时，它以为张三已经同意授权（但实际上这个请求是李四伪造的），于是就发起后续的令牌申请请求，用收到的Authorization Code向Sparklr换取access_token，只不过最后拿到的是攻击者李四的 access_token。</p>\n<p>最后，Tonr网站把攻击者李四的access_token和当前受害者张三在Tonr网站上的账号进行关联绑定。</p>\n<h4>2.4 Sparklr网站(OAuth2服务提供者)视角</h4>\n<p>Sparklr网站也是一脸茫然的样子，因为在它看来，自己收到的授权请求，以及后续的令牌申请请求都是正常的，或者说它无法得知接收到的这些请求之间的关联关系，而且也无法区别出这些请求到底是来自张三本人，还是由李四伪造出来的。因此只要自己收到的参数是正确有效的，那就提供正常的认证服务，仅此而已。</p>\n<h4>2.5 攻击者李四视角</h4>\n<p>李四伪造了一个用户授权成功的请求，并且将其中的Authorization Code参数替换成了自己提前获取到的code。这样，当受害者张三的浏览器被欺骗从而发起令牌申请请求时，实际上是在用张三在Tonr网站上的账号和李四在Sparklr网站上的账号做绑定。</p>\n<p>攻击完成后，李四在Tonr网站上可以通过自己在Sparklr网站的账号进行登录，而且登录进入的是张三在Tonr网站上的账号。而张三通过自己在Tonr网站上的账号登录进去之后，看到的是李四在Sparklr网站上的数据。</p>\n<h4>2.6 上帝视角</h4>\n<p>从整体上来看，这次攻击的时序图应该是下面这个样子的：</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/3-Sparklr.png\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/3-Sparklr.png\" alt=\"\" width=\"768\" height=\"734\"></a></p>\n<p>图3：攻击时序图示</p>\n<h3>3. 漏洞的本质</h3>\n<p>这个问题的关键点在于，OAuth2的认证流程是分为好几步来完成的，在图1中的第4步，第三方应用在收到一个GET请求时，除了能知道当前用户的cookie，以及URL中的Authorization Code之外，难以分辨出这个请求到底是用户本人的意愿，还是攻击者利用用户的身份伪造出来的请求。 于是乎，攻击者就能使用移花接木的手段，提前准备一个含有自己的Authorization Code的请求，并让受害者的浏览器来接着完成后续的令牌申请流程。</p>\n<h3>4. 前提条件</h3>\n<p>尽管这个攻击既巧妙又隐蔽，但是要成功进行这样的CSRF攻击也是需要满足一定前提条件的。</p>\n<p>首先，在攻击过程中，受害者张三在Tonr网站上的用户会话(User Session)必须是有效的，也就是说，张三在受到攻击前已经登录了Tonr网站。</p>\n<p>其次，整个攻击必须在短时间内完成，因为OAuth2提供者颁发的Authorization Code有效期很短，OAuth2官方推荐的时间是不大于10分钟，而一旦Authorization Code过期那么后续的攻击也就不能进行下去了。</p>\n<p>最后，一个Authorization Code只能被使用一次，如果OAuth2提供者收到重复的Authorization Code，它会拒绝当前的令牌申请请求。不止如此，根据OAuth2官方推荐，它还可以把和这个已经使用过的Authorization Code相关联的access_token全部撤销掉，进一步降低安全风险。</p>\n<h3>5. 防御办法</h3>\n<p>要防止这样的攻击其实很容易，作为第三方应用的开发者，只需在OAuth认证过程中加入state参数，并验证它的参数值即可。具体细节如下：</p>\n<ul>\n<li>在将用户重定向到OAuth2的Authorization Endpoint去的时候，为用户生成一个随机的字符串，并作为state参数加入到URL中。</li>\n<li>在收到OAuth2服务提供者返回的Authorization Code请求的时候，验证接收到的state参数值。如果是正确合法的请求，那么此时接受到的参数值应该和上一步提到的为该用户生成的state参数值完全一致，否则就是异常请求。</li>\n<li>state参数值需要具备下面几个特性：\n<ul>\n<li>不可预测性：足够的随机，使得攻击者难以猜到正确的参数值</li>\n<li>关联性：state参数值和当前用户会话（user session）是相互关联的</li>\n<li>唯一性：每个用户，甚至每次请求生成的state参数值都是唯一的</li>\n<li>时效性：state参数一旦被使用则立即失效</li>\n</ul>\n</li>\n</ul>\n<h3>6. 总结</h3>\n<p>要避免遭受本文提到的CSRF攻击问题，需要第三方应用正确的使用state参数，然而纵观各大OAuth服务提供者，在其开发文档里都没有明确把state参数和CSRF攻击联系起来，仅仅只是像下面这样一句话带过：</p>\n<p><em>“参数：state</em></p>\n<p><em>是否必须：否</em></p>\n<p><em>说明：重定向后会带上state参数，开发者可以填写a-zA-Z0-9的参数值，最多128字节”</em></p>\n<p>让事情变得更糟糕的是，state是可选参数，因此更容易被开发者忽略，造成安全风险。此外，本文中的攻击非常巧妙，可以悄无声息的攻陷受害者的账号，难以被察觉到。</p>\n<p>作为第三方应用的开发者，我们除了参考OAuth2服务提供者的开发文档之外，还应当加深自己对OAuth2的理解，尽可能的避开这些安全的坑。 而作为OAuth2服务提供者，也应当承担起提醒开发者注意防范安全风险的责任。</p>\n<p>参考资料</p>\n<ul>\n<li><a href=\"https://aaronparecki.com/oauth-2-simplified/\">OAuth2 Simplified</a></li>\n<li><a href=\"https://tools.ietf.org/html/rfc6749\">OAuth2 Authorization Framework RFC6749</a></li>\n</ul>\n<div></div>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111926\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111926votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111926\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 72</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "程序员之间的 N 层鄙视网", "url": "http://blog.jobbole.com/111968/", "front_image_url": ["http://wx4.sinaimg.cn/mw690/7cc829d3gy1fhrc09kvxmj20d4076mx9.jpg"], "praise_nums": "7", "comment_nums": 17, "fav_nums": 8, "tags": "趣文小说,程序员,趣文", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"\">CatchShot</a>   </div><p>有人的地方就有江湖。程序员，是一个知识、智商、都异于常规行业的群体。自傲，清高，闷骚，也属于这个群体鲜明标签。</p>\n<p>程序员有时候很自我，这样就给自己一个盲目的优越感。特别在与其他程序员对比的时候，他总能找到在一两个地方优于你的地方，所以，程序员之间的鄙视网络，在程序员这个职位诞生之日起，就慢慢的形成了。</p>\n<p>时至今日，这张鄙视网络已经相当的庞大。互联网的江湖中，有好事者开始归纳这张网，现在我们就来看看这张日益巨大的鄙视网。</p>\n<p><img title=\"图0：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/5042be614d564104e6abff9d60b74424.jpg\" alt=\"图0：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图1：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/9be03e45f9c9394775c39ea3dcb081f5.jpg\" alt=\"图1：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图2：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/480754675738b67ad7ae3e2949393d5d.jpg\" alt=\"图2：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图3：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f39623c25fb96e5c33838562ca979955.jpg\" alt=\"图3：程序员之间的十八层鄙视网络\"></p>\n<p><img class=\"alignnone\" src=\"http://wx4.sinaimg.cn/mw690/7cc829d3gy1fhrbemwgsij20go07mmxn.jpg\" width=\"600\" height=\"274\"></p>\n<p><img title=\"图5：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f71f261ee07d4ae68811ba8984c5bbca.jpg\" alt=\"图5：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图6：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/4b6d9bfeaa47d08e5a6c831b61f5126d.jpg\" alt=\"图6：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图7：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/557f1fc15a91cb3b642e8a0067d68802.jpg\" alt=\"图7：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图8：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e47d0b440956c2e60401fe7cf04c1a8a.jpg\" alt=\"图8：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图9：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/bbb4da59f1ef5e2df8fac5c9dcb91038.jpg\" alt=\"图9：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图10：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/d2533f84335c10e36bf8e52e7ae434ad.jpg\" alt=\"图10：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图11：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6f24fa523abd09103d082d8dff7077f1.jpg\" alt=\"图11：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图12：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/1c58fb20f86d4337ea5f0489abcc18e7.jpg\" alt=\"图12：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图13：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/88db446e732da4c31c3cae98f6979b6e.jpg\" alt=\"图13：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图14：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f17aa010b0dd6196521546234e547b02.jpg\" alt=\"图14：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图15：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/29c576dcbe282cd302f17dec6c25b098.jpg\" alt=\"图15：程序员之间的十八层鄙视网络\"></p>\n<p><img title=\"图16：程序员之间的十八层鄙视网络\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/5c1f66baed364a4b698298630753b458.jpg\" alt=\"图16：程序员之间的十八层鄙视网络\"></p>\n<p>时代在发展，技术也在发展，唯一不变的，是人与人之间的江湖，程序员们，将这种江湖诙谐的发展了下去，期待以后更多层的程序员鄙视网。</p>\n<p> </p>\n<p style=\"text-align: center\">—【分隔线】—</p>\n<p>【伯乐在线 补充】：① 尽管原文没有说明改编来源，但应该是改编自一位台湾博主的文章《<a href=\"http://mp.weixin.qq.com/s?__biz=MjM5OTA1MDUyMA==&amp;mid=405595221&amp;idx=1&amp;sn=357da8e3285f4dc82cdd8721a2bf5d6c&amp;scene=21#wechat_redirect\" target=\"_blank\">软件工程师的鄙视链</a>》。</p>\n<p>② 不过这篇图文貌似忘了还有一种鄙视链：</p>\n<p><strong><img class=\"alignnone size-full wp-image-111981\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/d0d02c341e4dcd8dfdfffcb1b37b9e11.png\" alt=\"Screenshot 2017-07-21_17-30-14\"></strong></p>\n<p> </p>\n<p> </p>\n<p><strong><img class=\"alignnone size-full wp-image-111980\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/f7e1de78dfd636859fdae27cbe176a35.png\" alt=\"8472-1F630105T9\"></strong></p>\n<p><strong>扎心了么？</strong></p>\n<p>不用心痛，我们老早就发起了<a href=\"http://date.jobbole.com/4164/\" target=\"_blank\">「面向对象」征友活动</a>。除了发单身妹子，现在也可以发男生啦。</p>\n<p style=\"text-align: center\"><strong>关注底下<strong>的</strong>面向对象微信公号</strong><br>\n关注后发送  <strong>案例</strong>  看脱单案例</p>\n<p><img class=\"alignnone aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2015/02/5d683ab1ce9e4dd6d3e0ffb190c19ddd.jpg\" width=\"133\" height=\"136\"></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111968\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111968votetotal\">7</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111968\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 8 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 17 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "Linux Bash 提示符的一些骚操作", "url": "http://blog.jobbole.com/111971/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/23426c26d6b88a782a1d894de8e89bca.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 6, "tags": "IT技术,Linux", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/17/7/bash-prompt-tips-and-tricks\">Dave Neary</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-8711-1.html\">Linux中国/toyijiu</a>   </div><p>当你在 Linux 环境下打开一个 Shell 终端时，会看到命令行中出现了类似下面的一个 Bash 提示符：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc415face821617750\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[user@$host ~]$</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc415face821617750-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc415face821617750-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">host</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">$</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>你知道命令行提示符其实是可以自己设置添加许多非常有用的信息的吗？在这篇文章中我就会教你如何自定义自己的 Bash 命令行提示符，想看的话就接着看吧~</p>\n<h3 id=\"toc_1\">如何设置 Bash 提示符</h3>\n<p>Bash 提示符是通过环境变量 <code>PS1</code> （提示符字符串 1Prompt String 1） 来设置的，它用于交互式 shell 提示符。当然如果你需要更多的输入才能完成一个 Bash 命令时，<code>PS2</code> 环境变量就是用来设置多行提示符的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc415fad8164247976\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[dneary@dhcp-41-137 ~]$ export PS1=\"[Linux Rulez]$ \"\r\n[Linux Rulez] export PS2=\"... \"\r\n[Linux Rulez] if true; then\r\n... echo \"Success!\"\r\n... fi\r\nSuccess!</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc415fad8164247976-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc415fad8164247976-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc415fad8164247976-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc415fad8164247976-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc415fad8164247976-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc415fad8164247976-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc415fad8164247976-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">dneary</span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">dhcp</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">41</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">137</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">export </span><span class=\"crayon-v\">PS1</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"[Linux Rulez]$ \"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc415fad8164247976-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">Linux </span><span class=\"crayon-v\">Rulez</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">export </span><span class=\"crayon-v\">PS2</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"... \"</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc415fad8164247976-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">Linux </span><span class=\"crayon-v\">Rulez</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">then</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc415fad8164247976-4\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">echo</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Success!\"</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc415fad8164247976-5\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fi</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc415fad8164247976-6\"><span class=\"crayon-v\">Success</span><span class=\"crayon-o\">!</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p></p>\n<h3 id=\"toc_2\">在哪里设置 PS1 的值？</h3>\n<p><code>PS1</code> 就是一个普通的环境变量，系统默认值设置在 <code>/etc/bashrc</code> 中，在我的系统中，默认提示符通过以下命令来设置的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc415fadd845309087\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[ \"$PS1\" = \"\\\\s-\\\\v\\\\\\$ \" ] &amp;&amp; PS1=\"[\\u@\\h \\W]\\\\$ \"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc415fadd845309087-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc415fadd845309087-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"$PS1\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\\\\s-\\\\v\\\\\\$ \"</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PS1</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"[\\u@\\h \\W]\\\\$ \"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>它判断 <code>PS1</code> 是否是系统的默认值 <code>\\s-\\v$</code> ，如果是的话则将值设置为 <code>[\\u@\\h \\W]\\$</code>。（LCTT 译注：注意命令中用 <code>\\</code> 做了转义。）</p>\n<p>但如果你想要自定义提示符，不应该修改 <code>/etc/bashrc</code> ，而是应该在你的主目录下将自定义命令加到 <code>.bashrc</code> 文件中。</p>\n<h3 id=\"toc_3\">上面提到的 <code>\\u</code>、<code>\\h</code>、<code>\\W</code>、<code>\\s</code> 和 <code>\\v</code> 是什么意思？</h3>\n<p>在 <code>man bash</code> 中的 PROMPTING 章节中，你能够找到所有 <code>PS1</code> 和 <code>PS2</code> 相关的特殊字符的描述，以下是一些比较常用的：</p>\n<ul>\n<li><code>\\u</code>：用户名</li>\n<li><code>\\h</code>：短主机名</li>\n<li><code>\\W</code>：当前你所在的目录的名称（basename），<code>~</code> 表示你的主目录</li>\n<li><code>\\s</code>：Shell 名字（bash 或者 sh，取决于你的 Shell 的名字是什么）</li>\n<li><code>\\v</code>：Shell 的版本号</li>\n</ul>\n<h3 id=\"toc_4\">还有哪些特殊的字符串可以用在提示符当中</h3>\n<p>除了上面这些，还有很多有用的字符串可以用在提示符当中：</p>\n<ul>\n<li><code>\\d</code>：将日期扩展成 “Tue Jun 27” 这种格式</li>\n<li><code>\\D{fmt}</code>：允许自定义日期格式——可通过 <code>man strftime</code> 来获得更多信息</li>\n<li><code>\\D{%c}</code>：获得本地化的日期和时间</li>\n<li><code>\\n</code>：换行（参考下面的多行提示符）</li>\n<li><code>\\w</code>：显示当前工作目录的完整路径</li>\n<li><code>\\H</code>：当前工作机器的完整主机名</li>\n</ul>\n<p>除了以上这些，你还可以在 Bash 的 man 页面的 PROMPTING 部分找到更多的特殊字符和它的用处。</p>\n<h3 id=\"toc_5\">多行提示符</h3>\n<p>如果你的提示符过长（比如说你想包括 <code>\\H</code> 、<code>\\w</code> 或完整的日期时间时 ），想将提示符切成两行，可以使用 <code>\\n</code> 将提示符切断成两行显示，比如下面的多行的例子会在第一行显示日期、时间和当前工作目录，第二行显示用户名和主机名：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc415fae2035261774\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nPS1=\"\\D{%c} \\w\\n[\\u@\\H]$ \"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc415fae2035261774-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc415fae2035261774-1\"><span class=\"crayon-v\">PS1</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"\\D{%c} \\w\\n[\\u@\\H]$ \"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p>\n<h3 id=\"toc_6\">还能再好玩点吗？</h3>\n<p>人们偶尔也想将提示符变成彩色的。虽然我觉得彩色提示符让人分心、易怒，但是也许你很喜欢。如果我们想将日期变成红色的，目录变成青蓝色，用户名搞一个黄色背景，你可以这样做：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/e93d223f94256801e7b835a1d8a8fd6a.png\"><img class=\"alignnone size-full wp-image-111975\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/e93d223f94256801e7b835a1d8a8fd6a.png\" alt=\"QQ截图20170721114211\"></a></p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2017/07/6b40448b267a67ff6bfa9118492cf7f4.png\"><img class=\"alignnone size-full wp-image-111986\" src=\"http://jbcdn2.b0.upaiyun.com/2017/07/6b40448b267a67ff6bfa9118492cf7f4.png\" alt=\"QQ截图20170722114539\"></a></p>\n<p>你可以在 <a class=\"ext\" href=\"http://tldp.org/HOWTO/Bash-Prompt-HOWTO/x329.html\" target=\"_blank\" rel=\"external nofollow\">Bash prompt HOWTO</a> 这里找到更多的颜色代码，甚至可以让字符反相和闪烁！我不知道为什么地球人会有这种想法，但是你可以这么干！</p>\n<p>所以你最喜欢的自定义提示符是什么样子的呢？有没有让你抓狂的自定义提示符呢？请在评论里告诉我吧~</p>\n<p>作者简介：</p>\n<p>Dave Neary – Dave Neary 是红帽开源和标准化团队成员，帮助开源项目对红帽的成功至关重要。自从在 1999 年为 GIMP 提交了第一个补丁以来，他一直带着各种不同的帽子，在开源的世界徜徉。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111971\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111971votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111971\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 6 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "避免持续集成（CI）成为一个安全隐患", "url": "http://blog.jobbole.com/111988/", "front_image_url": ["http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-Jenkins.jpg"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 1, "tags": "IT技术,安全,持续集成", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><div>\n<h3>背景</h3>\n<p>最近临时交接了一个客户测试环境和产品环境的维护工作。交接的客户资产包含：代码库、生产环境主机、测试环境主机、搭建在测试环境主机上的持续集成服务器以及对应的账号密码。这个持续集成服务器采用Jenkins搭建，并且可以用来部署测试环境和生产环境的应用。</p>\n<p>不久，接到了客户的一个维护请求：把最新的生产环境数据同步到测试环境里。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-Jenkins.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/1-Jenkins.jpg\" alt=\"\" width=\"940\" height=\"556\"></a></p>\n<p>这个维护任务需要通过SSH登录到测试环境主机上进行操作。测试主机是通过authorized_keys进行SSH认证的，只要你自己的ssh-key被添加到了主机上，就可以实现无密码登录。这样有两个好处：一方面维护人员无需使用密码，避免了生产环境密码的泄露。另一方面可以按需吊销不再使用的客户端，及时回收权限。所以我需要把自己的sshpublickey交给管理员，让他把我的key加到可访问列表里。</p>\n<p>悲剧的是，前管理员告诉我，他的key因为更换电脑的关系没有及时更新。所以，他也无法登录主机。而且之前参与维护的其它管理员的key也都失效了，这意味着我们失去了对主机的控制。此时，我手上只有登录Jenkins的的用户名和密码，于是一个邪恶的想法就诞生了：</p>\n<p><strong>既然Jenkins可以执行脚本，那么我是否可以通过Jenkins把我的key注入进去？</strong></p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/2-sshpublickey.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/2-sshpublickey-1024x620.jpg\" alt=\"\" width=\"700\" height=\"424\"></a></p>\n<p>于是我把ExecuteShell的Job变成了我的命令行，通过运行日志得知了宿主用户的文件目录信息。然后把自己的sshpublickey加到了登录列表里（此处省略敏感信息）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9bbe7e390b027355638\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nsudo sh -c“cp~/.ssh/authorized_keys~/.ssh/authorized_keys.bak”\r\n\r\nsudo sh -c\"echo‘{我的sshpublickey}’&gt;&gt;~/.ssh/authorized_keys\"\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9bbe7e390b027355638-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bbe7e390b027355638-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9bbe7e390b027355638-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9bbe7e390b027355638-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9bbe7e390b027355638-1\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span>“<span class=\"crayon-v\">cp</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ssh</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">authorized_keys</span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">ssh</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">authorized_keys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">bak</span>”</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bbe7e390b027355638-2\"> </div><div class=\"crayon-line\" id=\"crayon-59b9bbe7e390b027355638-3\"><span class=\"crayon-e\">sudo </span><span class=\"crayon-v\">sh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-s\">\"echo‘{我的sshpublickey}’&gt;&gt;~/.ssh/authorized_keys\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9bbe7e390b027355638-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>It works !</p>\n<p>我成功的登录了机器，但这却暴露了一个问题：持续集成服务器成为了一个安全隐患。</p>\n<p><strong>首先</strong>，持续集成服务器可以执行代码。这就意味着它有可能执行有害代码。</p>\n<p><strong>其次</strong>，持续集成服务器缺乏足够的用户鉴权，这很有可能导致未授权用户访问。</p>\n<p>无权限控制的服务器+可以执行代码=裸奔的肉鸡</p>\n<p>那么，如何构建一个更安全的持续集成服务器服务器？</p>\n<h3>rootless原则</h3>\n<blockquote><p>“神操纵着万物，你感觉得到他，但永远看不见他。”——《圣经·希伯来书11:27》</p></blockquote>\n<p>在服务器的世界里，root用户就是神，拥有至高的权力和力量。如果有人获得了“神之力”，后果可能不堪设想。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/3-inconceivable.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/3-inconceivable-1024x574.jpg\" alt=\"\" width=\"700\" height=\"392\"></a></p>\n<p>无论是Web服务器、数据库服务器还是持续集成服务器。都是这个世界里的二等公民，权限和力量都应该受到约束。执行的时候应该受到控制。</p>\n<p>此外，应该极力避免sudo的滥用，尤其是对那些从外部访问的用户。很多情况下，为了操作方便，很多用户都有sudo的权限。但这恰恰造成了低权限用户通过提升自己的访问权限进行有害操作。</p>\n<p>在上述的故事里，因为没有对Jenkins的主机用户做有效隔离，导致了我可以用sudo注入自己的key获得机器的访问权限。</p>\n<h3>沙盒隔离原则</h3>\n<p>因为持续集成服务器会执行脚本或运行程序，而这些程序和脚本有可能是存在恶意代码的。所以，对应的任务应该在隔离的安全沙盒中执行，例如：受限的用户，受限的权限，受限的空间。</p>\n<p>在上述的故事里，我就通过CI执行了一段不安全的脚本成功获得了登录主机的权限。</p>\n<p>如果这些任务在隔离并受控的Docker容器里执行，那么会安全得多。</p>\n<p>当然，也可以考虑采用TravisCI这样的第三方持续集成服务来保证安全性。</p>\n<h3>备份和备份核查原则</h3>\n<p>在上述故事里，因为缺乏有效的备份机制，导致了所有人都无法访问主机。此外，我在修改authorized_keys的时候先进行了备份。这样，如果我注入失败，还可以还原。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/4-authorized_keys.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/4-authorized_keys-1024x610.jpg\" alt=\"\" width=\"700\" height=\"417\"></a></p>\n<p>这里的备份，不光是对配置、数据的备份，还有岗位的备份。</p>\n<p>如果管理员有备份，完全不会出现无法登陆的事情。</p>\n<p>如果有备份QA服务器，完全可以不需要当前的QA服务器。</p>\n<p>在做任何变更前，都应该做好备份以及还原的准备。因为任何变更都会带来“蝴蝶效应”。</p>\n<p>但是，光备份是不够的。如果备份不能有效还原，那和没有备份没有什么区别。所以，要定时的进行备份恢复测试。确保备份在各种情况下可用。</p>\n<h3>多重要素身份验证原则</h3>\n<p>上述的持续集成服务器是暴露在互联网中的，任何一个人访问到这个站点，通过一定程度的密码破解，就可以获得这个持续集成服务器的访问控制权限。从而可以做出上述的操作。</p>\n<p>所以，有了用户名和密码，并不一定是可信用户。还需要通过更多的手段，诸如手机短信验证码或者第三方认证集成来验证用户的身份。</p>\n<h3>关键操作手动验证原则</h3>\n<p>试想一下，如果在上述的例子中我并没有服务器的访问权限。而是通过提交未经审查的代码自动运行测试脚本。实际上也会造成同样的效果。</p>\n<p>有时候我们会为了方便，让持续集成服务器自动触发测试。但是，恰恰是这种“方便”带来了额外的安全隐患。而这样的方便，不光方便了自己，也方便了恶意入侵者。</p>\n<p>所以，不能为了方便而留下安全隐患。在关键操作上设置为手动操作，并通过一定机制保证关键操作的可靠性才是最佳实践。</p>\n<p><a href=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/5-reliability-1.jpg\"><img src=\"http://insights.thoughtworkers.org/wp-content/uploads/2017/07/5-reliability-1-1024x627.jpg\" alt=\"\" width=\"700\" height=\"429\"></a></p>\n<h3>构建安全<strong>CI</strong>的几个实践：</h3>\n<p>采用<a href=\"https://jpetazzo.github.io/2015/09/03/do-not-use-docker-in-docker-for-ci/\">Sibling</a>的方式在Docker里运行任务。</p>\n<p>账户密码管理统一采用LDAP认证，如果过期则从外部修改。</p>\n<p>CI的登录权限和其它的认证方式（比如GitHub、Okta等）集成起来。并用组限制登录。</p>\n<p>对于生产环境的CI，通过更加细粒度的权限限制来隔离一些危险操作。</p>\n<h3>官方的安全指南</h3>\n<p>不少持续集成工具的官方都提供了最佳实践以及安全指南帮助我们构建持续集成服务器。请务必在构建持续集成服务器前阅读并理解这些安全实践和措施，并遵照安全最佳实践构建持续集成服务器：</p>\n<p><strong>Jenkins最佳实践：</strong><a href=\"https://wiki.jenkins-ci.org/display/JENKINS/Jenkins+Best+Practices\">https://wiki.jenkins-ci.org/display/JENKINS/Jenkins+Best+Practices</a></p>\n<p><strong>Jenkins官方安全指南：</strong><a href=\"https://wiki.jenkins-ci.org/display/JENKINS/Securing+Jenkins\">https://wiki.jenkins-ci.org/display/JENKINS/Securing+Jenkins</a></p>\n<h3>如果没有这些如果</h3>\n<p>上面提到了太多的如果。如果这些“如果”能发生在事前，这些问题就不会产生。持续集成本身是开发的最佳</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111988\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111988votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111988\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">ThoughtWorks</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina\">\r\n\t\t\t<img src=\"http://tp3.sinaimg.cn/1774908135/180/0/1\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ThoughtWorks是一家全球IT咨询公司，追求卓越软件质量，致力于科技驱动商业变革。擅长构建定制化软件产品，帮助客户快速将概念转化为价值。同时为客户提供用户体验设计、技术战略咨询、组织转型等咨询服务。        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/thoughtworkschina\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/thoughtworkschina/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/thoughtworkschina/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 72</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://insights.thoughtworkers.org/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/thoughtworkschina\"><i class=\"fa fa-weibo\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
{"title": "12 个 Vim 小窍门", "url": "http://blog.jobbole.com/111962/", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2012/04/vim-logo.png"], "praise_nums": "1", "comment_nums": 0, "fav_nums": 9, "tags": "IT技术,Vim", "content": "<div class=\"entry\">\r\n\r\n        \t\t\t<div class=\"textwidget\"></div>\n\t\t\r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://blog.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/8zjl8\">周进林</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://dalibornasevic.com/posts/43-12-vim-tips\">Dalibor Nasevic</a>。欢迎加入<a target=\"_blank\" href=\"http://group.jobbole.com/category/feedback/trans-team/\">翻译组</a>。</div><p>这篇 Vim 技巧文章，包含了一些我觉得比较有意思的从中级到高级的 Vim 技巧，让我们一起来回顾一下。</p>\n<h3>1. 重复上一次 Ex 命令</h3>\n<p>在 Vim 中有 3 种命令行模式：</p>\n<ul>\n<li>Ex 命令模式： <code>：something</code></li>\n<li>搜素 模式： <code>/something</code></li>\n<li>表达式 模式（在插入模式里输入 &lt;<code>C-r&gt;=</code> 进入）： <code>=1+1&lt;cr&gt;</code></li>\n</ul>\n<p>假如我们通过以下命令在 Ex 命令模式里运行规范文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc217fe84027459717\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:!rspec spec/models/code_spec.rb</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc217fe84027459717-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc217fe84027459717-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-o\">!</span><span class=\"crayon-e\">rspec </span><span class=\"crayon-v\">spec</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">models</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">code_spec</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rb</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>我们可以在普通模式里输入 <code>@:</code> 来重复上一次 Ex 命令。</p>\n<h3>2. 对 CSS 的属性进行排序</h3>\n<p>如果我们想对 CSS 选择器里面的属性行按照字母顺序排序，我们只需要在可视化模式里选择这些属性行并且输入 <code>:sort</code> ，然后就可以看到排序后的结果。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc217fe8f665592267\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nh4 {\r\n    font-size: 11px;\r\n    margin: 15px;\r\n    background: red;\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc217fe8f665592267-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc217fe8f665592267-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc217fe8f665592267-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc217fe8f665592267-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc217fe8f665592267-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc217fe8f665592267-1\"><span class=\"crayon-e\">h4</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc217fe8f665592267-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">font</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">size</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11px</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc217fe8f665592267-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">margin</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15px</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc217fe8f665592267-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">background</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">red</span><span class=\"crayon-sy\">;</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc217fe8f665592267-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p>\n<h3>3. 选择复制并且粘贴文本</h3>\n<p>我们可以通过使用 <code>gv</code> 来选择上一次选择复制的文本。并且，可以使用 <code>gv</code> 来选择上一次粘贴的文本，<code>gb</code> 是一个我们已经添加到 vimrc 文件里的自定义映射。当我们进行方法重构、剪切-复制然后进行缩进对齐时，这些命令尤为好用。有了<code>gb</code> 命令，我们可以很容易地选中刚粘贴的文本，然后使用 <code>&lt;</code> 或者 <code>&gt;</code> 来修正缩进。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc217fe93101938914\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\" select last paste in visual mode\r\nnnoremap &lt;expr&gt; gb '`[' . strpart(getregtype(), 0, 1) . '`]'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc217fe93101938914-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc217fe93101938914-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc217fe93101938914-1\">\"<span class=\"crayon-h\"> </span><span class=\"crayon-e\">select </span><span class=\"crayon-e\">last </span><span class=\"crayon-e\">paste </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">visual </span><span class=\"crayon-e\">mode</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc217fe93101938914-2\"><span class=\"crayon-v\">nnoremap</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">expr</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">gb</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'`['</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">strpart</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">getregtype</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'`]'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<h3>4. 在插入模式里粘贴文本</h3>\n<p>假设我们现在处于插入模式并且想在不离开插入模式的情况下粘贴文本，我们可以使用 <code>&lt;C-r&gt;0</code> 命令。如果复制的文本里包括换行符，<code>&lt;C-r&gt;&lt;C-p&gt;0</code> 命令可以帮我们处理缩进问题。</p>\n<h3>5. 在插入模式里删除</h3>\n<p>当我们处于 Vim 的插入模式、命令行模式或者 Shell 的命令行，我们可以使用以下快捷键来删除一个字符、单词或者一行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc217fe97676889384\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;C-h&gt; \" 向前删除一个字符（类似退格键）\r\n&lt;C-w&gt; \" 向前删除一个单词\r\n&lt;C-u&gt; \" 删除至行首\r\n&lt;C-k&gt; \" 删除至行尾</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc217fe97676889384-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc217fe97676889384-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc217fe97676889384-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc217fe97676889384-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc217fe97676889384-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">C</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">h</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" 向前删除一个字符（类似退格键）</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc217fe97676889384-2\"><span class=\"crayon-s\">&lt;C-w&gt; \"</span><span class=\"crayon-h\"> </span>向前删除一个单词</div><div class=\"crayon-line\" id=\"crayon-59b9cc217fe97676889384-3\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">C</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">u</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\" 删除至行首</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc217fe97676889384-4\"><span class=\"crayon-s\">&lt;C-k&gt; \"</span><span class=\"crayon-h\"> </span>删除至行尾</div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p>\n<h3>6. 多行范围内运行正常模式命令</h3>\n<p>假设我们忘了给以下的 Javascript 代码行的行尾添加 <code>;</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc217fe9b400419644\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nvar element = $(this)\r\nvar tabName = element.data('tab')\r\nvar report = element.data('report')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc217fe9b400419644-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc217fe9b400419644-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc217fe9b400419644-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc217fe9b400419644-1\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">element</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc217fe9b400419644-2\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tabName</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">element</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'tab'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc217fe9b400419644-3\"><span class=\"crayon-t\">var</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">report</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">element</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'report'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>要给每一行添加分号，我们可以在可视化模式里选中这3行代码，然后运行 <code>:normal A;</code>命令。Vim 会在选中的每一行中执行 <code>A;</code> 命令（添加<code>;</code>的命令）。我们也可以使用另外一种方式，我们可以对整个文件的内容使用 <code>:%normal A;</code> 命令。</p>\n<h3>7. 在多行上重复最后一次修改</h3>\n<p>在上面的代码片段中，如果我们只在第一行上面使用<code>A;</code> 命令向行尾添加<code>;</code>。我们可以选择2到3行的代码并且运行 <code>:'&lt;,'&gt; normal .</code>命令，为选中的每一行执行点号命令（dotcommand）重复上一次修改命令。</p>\n<h3>8. 在多个文件中执行替换</h3>\n<p>在 Vim 中，对多个文件执行替换操作并不是一个直观的操作。要在多个文件里进行搜索和替换，首先我们需要创建一个文件列表，之后在这些文件里面执行命令。我们可以使用 <code>:args</code> 命令来创建文件列表。例如，加载所有以“ext”开头的 Javascript 文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc217fe9e261768466\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:args app/assets/javascripts/ext*.js</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc217fe9e261768466-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc217fe9e261768466-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">args </span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">assets</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">javascripts</span><span class=\"crayon-o\">/</span><span class=\"crayon-e \">ext*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">js</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>我们可以通过<code>:args</code>命令来查看有哪些文件被加载到参数列表中。当文件都加载到参数列表中后，我们可以运行搜索和替换命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc217fea2422999174\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:argdo %s/From/To/g</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc217fea2422999174-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc217fea2422999174-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-v\">argdo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">From</span><span class=\"crayon-o\">/</span><span class=\"crayon-st\">To</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">g</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>一旦修改应用到文件后，我们可以通过以下命令来更新参数列表中的文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc217fea5300907716\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:argdo update</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc217fea5300907716-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc217fea5300907716-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">argdo </span><span class=\"crayon-v\">update</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h3>9. 在多个文件中进行搜索和替换</h3>\n<p>当我们知道要执行替换命令的文件在那的情况下，之前的替换技巧会很有用。但是，在大多数情况下，我们想要的是，在一堆文件里搜索文本并且仅在匹配的文件里执行替换命令。要实现这个替换操作，我们可以使用<code>vimgrep</code> 命令在文件中搜索匹配的文本。<code>vimgrep</code> 命令会创建一个快速列表（quicklist）来展示包含与模式匹配的文本的文件列表，我们可以使用 <code>:copen</code> 命令来打开这个列表。如果我们想充分利用好快速列表（quicklist)，我们可以使用 <code>:Qargs</code> 命令把快速列表转换为参数列表， <code>:Qargs</code> 命令是我们在 vimrc 文件里设置的一个映射：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc217fea8083215665\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncommand! -nargs=0 -bar Qargs execute 'args' QuickfixFilenames()\r\n\r\n\" populate the argument list with each of the files named in the quickfix list\r\nfunction! QuickfixFilenames()\r\n  let buffer_numbers = {}\r\n  for quickfix_item in getqflist()\r\n    let buffer_numbers[quickfix_item['bufnr']] = bufname(quickfix_item['bufnr'])\r\n  endfor\r\n  return join(map(values(buffer_numbers), 'fnameescape(v:val)'))\r\nendfunction</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc217fea8083215665-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc217fea8083215665-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc217fea8083215665-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc217fea8083215665-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc217fea8083215665-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc217fea8083215665-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc217fea8083215665-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc217fea8083215665-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc217fea8083215665-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc217fea8083215665-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc217fea8083215665-1\"><span class=\"crayon-v\">command</span><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">nargs</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">bar </span><span class=\"crayon-e\">Qargs </span><span class=\"crayon-i\">execute</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'args'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">QuickfixFilenames</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc217fea8083215665-2\"> </div><div class=\"crayon-line\" id=\"crayon-59b9cc217fea8083215665-3\">\"<span class=\"crayon-h\"> </span><span class=\"crayon-e\">populate </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">argument </span><span class=\"crayon-e\">list </span><span class=\"crayon-e\">with </span><span class=\"crayon-st\">each</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">files </span><span class=\"crayon-e\">named </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">quickfix </span><span class=\"crayon-e\">list</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc217fea8083215665-4\"><span class=\"crayon-t\">function</span><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">QuickfixFilenames</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc217fea8083215665-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-e\">let </span><span class=\"crayon-v\">buffer_numbers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc217fea8083215665-6\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">quickfix_item </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getqflist</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc217fea8083215665-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">let </span><span class=\"crayon-v\">buffer_numbers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">quickfix_item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'bufnr'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bufname</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">quickfix_item</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'bufnr'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc217fea8083215665-8\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">endfor</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc217fea8083215665-9\"><span class=\"crayon-h\">  </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">map</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">buffer_numbers</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'fnameescape(v:val)'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc217fea8083215665-10\"><span class=\"crayon-v\">endfunction</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>最后， 下面是一个在多个文件中进行搜索和替换的操作命令：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc217feac691936225\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:vimgrep /CurrencyNumberHelper/ app/models/*.rb\r\n:Qargs\r\n:argdo %s/CurrencyNumberHelper/CurrencyHelper/g\r\n:argdo update</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc217feac691936225-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc217feac691936225-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc217feac691936225-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc217feac691936225-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc217feac691936225-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-v\">vimgrep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">CurrencyNumberHelper</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">models</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rb</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc217feac691936225-2\"><span class=\"crayon-o\">:</span><span class=\"crayon-v\">Qargs</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc217feac691936225-3\"><span class=\"crayon-o\">:</span><span class=\"crayon-v\">argdo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">CurrencyNumberHelper</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">CurrencyHelper</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">g</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc217feac691936225-4\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">argdo </span><span class=\"crayon-v\">update</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>buztard 在评论里提出一个更简单的方法，使用 ack-grep 来创建参数列表：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc217feaf729344278\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:args `ack-grep -l CurrencyNumberHelper`\r\n# or, if you're using Ack plugin, then just :Ack CurrencyNumberHelper\r\n:argdo %s/CurrencyNumberHelper/CurrencyHelper/g\r\n:argdo update</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc217feaf729344278-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc217feaf729344278-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-59b9cc217feaf729344278-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc217feaf729344278-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc217feaf729344278-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-i\">args</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">`</span><span class=\"crayon-v\">ack</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CurrencyNumberHelper</span><span class=\"crayon-sy\">`</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc217feaf729344278-2\"><span class=\"crayon-p\"># or, if you're using Ack plugin, then just :Ack CurrencyNumberHelper</span></div><div class=\"crayon-line\" id=\"crayon-59b9cc217feaf729344278-3\"><span class=\"crayon-o\">:</span><span class=\"crayon-v\">argdo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">CurrencyNumberHelper</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">CurrencyHelper</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">g</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc217feaf729344278-4\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">argdo </span><span class=\"crayon-v\">update</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>如果你使用<a href=\"https://github.com/vim/vim/commit/aa23b379421aa214e6543b06c974594a25799b09\">版本比较新的 Vim</a>， 这个操作会更简单。正如 Thiago A. z 在评论里提出的方法，你可以简单地使用 <code>cdo</code> 和 <code>cfdo</code> 命令即可：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc217feb3553081703\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:Ack CurrencyNumberHelper\r\n:cfdo s/CurrencyNumberHelper/CurrencyHelper/g | update</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc217feb3553081703-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-59b9cc217feb3553081703-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc217feb3553081703-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">Ack </span><span class=\"crayon-v\">CurrencyNumberHelper</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-59b9cc217feb3553081703-2\"><span class=\"crayon-o\">:</span><span class=\"crayon-i\">cfdo</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">CurrencyNumberHelper</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">CurrencyHelper</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">g</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">update</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p></p>\n<h3>10. 编辑已经录制的宏</h3>\n<p>在录制宏的过程中经常会出现误操作，当出现出现误操作时，对已录制的宏进行编辑比重新录制更简单方便。假设我们录制了一个宏到寄存器a里，我们可以使用 <code>:put a</code> 命令把宏的内容打印到当前的缓冲区里，然后在 Vim 里对这个宏进行编辑。一旦对宏的内容进行了修改，我们可以选择修改后的宏并且使用 <code>\"ay</code> 命令把它复制到寄存器<code>a</code>中。之后我们就可以使用 <a href=\"http://www.jobbole.com/members/a58797\"><code>@a</code></a> 命令运行寄存器 a 中的新宏。</p>\n<h3>11. 在多个文件里运行宏</h3>\n<p>如果我们已经录制了宏，并且想在某些文件里运行它。首先，我们需要使用这些文件来建立一个参数列表。比如我们需要加载一个 Rails 应用的所有 model：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc217feb6612796221\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:args app/models/*.rb</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc217feb6612796221-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc217feb6612796221-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">args </span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">models</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">rb</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>然后我们使用以下命令老来运行宏（这个宏已经录制保存在寄存器 a1a 中）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc217feb9144743662\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:argdo normal @a1a</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc217feb9144743662-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc217feb9144743662-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">argdo </span><span class=\"crayon-i\">normal</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">a1a</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>最后，我们使用下面命令来保存所有缓冲区的修改：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc217febc127193846\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n:argdo update</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc217febc127193846-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc217febc127193846-1\"><span class=\"crayon-o\">:</span><span class=\"crayon-e\">argdo </span><span class=\"crayon-v\">update</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p></p>\n<h3>12. 命令行中的 Vi 模式</h3>\n<p>Bash shell 提供了两种命令行编辑模式：emacs 和 vi 模式。emacs 编辑模式是命令行的默认模式，我们可以使用以下命令来把命令行的编辑模式改为 vi 模式：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc217febf748405047\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset -o vi</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc217febf748405047-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc217febf748405047-1\"><span class=\"crayon-v\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">vi</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>然后我们就可以在命令行模式里使用 ESC 键来进入 vi 的编辑模式，并且可以使用 vi 文本行编辑能力。当我们在命令行里处于 vi 编辑模式时，我们可以使用 v 键弹出编辑器，我们在里面编辑保存的命令会直接在命令行里运行。这是一个很赞的功能， 你觉得呢？:)</p>\n<p>如果我们需要返回 emacs 模式，打印一下命令即可：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-59b9cc217fec3222392419\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nset -o emacs</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-59b9cc217fec3222392419-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-59b9cc217fec3222392419-1\"><span class=\"crayon-v\">set</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">emacs</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这里有一张<a href=\"http://www.catonmat.net/download/bash-vi-editing-mode-cheat-sheet.txt\">速查表</a>，记录了在 bash shell 中使用 vi 模式的可用命令。</p>\n<p>在寻找更多的 Vim 技巧？ 可以查看作者的 <a href=\"http://github.com/dalibor/vimfiles\">vimfiles</a>，还有《<span data-rel=\"title\"><a class=\"archive-title\" title=\"25个Vim教程、视频和资源\" href=\"http://blog.jobbole.com/10250/\" target=\"_blank\">25个Vim教程、视频和资源</a>》和</span>《<a class=\"archive-title\" title=\"提高 Vim 使用效率的 12 个技巧\" href=\"http://blog.jobbole.com/87481/\" target=\"_blank\"><span data-rel=\"title\">提高 Vim 使用效率的 12 个技巧</span></a>》。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"111962\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"111962votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"2\" data-item-id=\"111962\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 9 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/8zjl8\">周进林</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/8zjl8\">\r\n\t\t\t<img src=\"http://www.jobbole.com/wp-content/uploads/avatars/37626/5eae1c6800ce93c5d98ee059843e9513-bpfull.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            茫茫大海中的一枚程序猿，为了进化为一个高富帅人类而努力着。关注java、python、linux、vim等（新浪微博：@酒肉和尚--进林）        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/8zjl8\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://blog.jobbole.com/author/8zjl8/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/8zjl8/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 19</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://www.cnblogs.com/averey/\"><i class=\"fa fa-link\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}
